{"version":3,"sources":["leaflet-src.js","includes.js","BoundaryCanvas.js","proj4js-compressed.js","proj4leaflet.js","epsg.leaflet.js","L.Control.Sidebar.js","leaflet.ajax.custom.js","leaflet.markercluster.js","Control.MiniMap.js","leaflet-hash.js","leaflet-gps.js","L.TileLayer.BetterWMS.js","leaflet.draw-custom.js","leaflet.measurecontrol.js","leaflet.awesome-markers-custom.js","leaflet-heat_custom.js","oms.min.js","turf.min.js","leaflet.utfgridWMS.js","L.Panoramio.js","L.Panoramio.custom.js","leaflet.label-src.js","geojson-vt-dev.js","leaflet.timedimension.custom.js","leaflet-routing-machine.js","lrm-mapzen.js","Control.Geocoder.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACt9RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClvBA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC54FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3vDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC39FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACh+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"leaflet-10eb3d074a.js","sourcesContent":["/*\r\n Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com\r\n (c) 2010-2013, Vladimir Agafonkin\r\n (c) 2010-2011, CloudMade\r\n*/\r\n(function (window, document, undefined) {\r\nvar oldL = window.L,\r\n    L = {};\r\n\r\nL.version = '0.7.7';\r\n\r\n// define Leaflet for Node module pattern loaders, including Browserify\r\nif (typeof module === 'object' && typeof module.exports === 'object') {\r\n\tmodule.exports = L;\r\n\r\n// define Leaflet as an AMD module\r\n} else if (typeof define === 'function' && define.amd) {\r\n\tdefine(L);\r\n}\r\n\r\n// define Leaflet as a global L variable, saving the original L to restore later if needed\r\n\r\nL.noConflict = function () {\r\n\twindow.L = oldL;\r\n\treturn this;\r\n};\r\n\r\nwindow.L = L;\r\n\r\n\r\n/*\r\n * L.Util contains various utility functions used throughout Leaflet code.\r\n */\r\n\r\nL.Util = {\r\n\textend: function (dest) { // (Object[, Object, ...]) ->\r\n\t\tvar sources = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, j, len, src;\r\n\r\n\t\tfor (j = 0, len = sources.length; j < len; j++) {\r\n\t\t\tsrc = sources[j] || {};\r\n\t\t\tfor (i in src) {\r\n\t\t\t\tif (src.hasOwnProperty(i)) {\r\n\t\t\t\t\tdest[i] = src[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dest;\r\n\t},\r\n\r\n\tbind: function (fn, obj) { // (Function, Object) -> Function\r\n\t\tvar args = arguments.length > 2 ? Array.prototype.slice.call(arguments, 2) : null;\r\n\t\treturn function () {\r\n\t\t\treturn fn.apply(obj, args || arguments);\r\n\t\t};\r\n\t},\r\n\r\n\tstamp: (function () {\r\n\t\tvar lastId = 0,\r\n\t\t    key = '_leaflet_id';\r\n\t\treturn function (obj) {\r\n\t\t\tobj[key] = obj[key] || ++lastId;\r\n\t\t\treturn obj[key];\r\n\t\t};\r\n\t}()),\r\n\r\n\tinvokeEach: function (obj, method, context) {\r\n\t\tvar i, args;\r\n\r\n\t\tif (typeof obj === 'object') {\r\n\t\t\targs = Array.prototype.slice.call(arguments, 3);\r\n\r\n\t\t\tfor (i in obj) {\r\n\t\t\t\tmethod.apply(context, [i, obj[i]].concat(args));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\tlimitExecByInterval: function (fn, time, context) {\r\n\t\tvar lock, execOnUnlock;\r\n\r\n\t\treturn function wrapperFn() {\r\n\t\t\tvar args = arguments;\r\n\r\n\t\t\tif (lock) {\r\n\t\t\t\texecOnUnlock = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlock = true;\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tlock = false;\r\n\r\n\t\t\t\tif (execOnUnlock) {\r\n\t\t\t\t\twrapperFn.apply(context, args);\r\n\t\t\t\t\texecOnUnlock = false;\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\r\n\t\t\tfn.apply(context, args);\r\n\t\t};\r\n\t},\r\n\r\n\tfalseFn: function () {\r\n\t\treturn false;\r\n\t},\r\n\r\n\tformatNum: function (num, digits) {\r\n\t\tvar pow = Math.pow(10, digits || 5);\r\n\t\treturn Math.round(num * pow) / pow;\r\n\t},\r\n\r\n\ttrim: function (str) {\r\n\t\treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n\t},\r\n\r\n\tsplitWords: function (str) {\r\n\t\treturn L.Util.trim(str).split(/\\s+/);\r\n\t},\r\n\r\n\tsetOptions: function (obj, options) {\r\n\t\tobj.options = L.extend({}, obj.options, options);\r\n\t\treturn obj.options;\r\n\t},\r\n\r\n\tgetParamString: function (obj, existingUrl, uppercase) {\r\n\t\tvar params = [];\r\n\t\tfor (var i in obj) {\r\n\t\t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\t\treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n\t},\r\n\ttemplate: function (str, data) {\r\n\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tthrow new Error('No value provided for variable ' + str);\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t});\r\n\t},\r\n\r\n\tisArray: Array.isArray || function (obj) {\r\n\t\treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n\t},\r\n\r\n\temptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='\r\n};\r\n\r\n(function () {\r\n\r\n\t// inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n\tfunction getPrefixed(name) {\r\n\t\tvar i, fn,\r\n\t\t    prefixes = ['webkit', 'moz', 'o', 'ms'];\r\n\r\n\t\tfor (i = 0; i < prefixes.length && !fn; i++) {\r\n\t\t\tfn = window[prefixes[i] + name];\r\n\t\t}\r\n\r\n\t\treturn fn;\r\n\t}\r\n\r\n\tvar lastTime = 0;\r\n\r\n\tfunction timeoutDefer(fn) {\r\n\t\tvar time = +new Date(),\r\n\t\t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n\t\tlastTime = time + timeToCall;\r\n\t\treturn window.setTimeout(fn, timeToCall);\r\n\t}\r\n\r\n\tvar requestFn = window.requestAnimationFrame ||\r\n\t        getPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n\r\n\tvar cancelFn = window.cancelAnimationFrame ||\r\n\t        getPrefixed('CancelAnimationFrame') ||\r\n\t        getPrefixed('CancelRequestAnimationFrame') ||\r\n\t        function (id) { window.clearTimeout(id); };\r\n\r\n\r\n\tL.Util.requestAnimFrame = function (fn, context, immediate, element) {\r\n\t\tfn = L.bind(fn, context);\r\n\r\n\t\tif (immediate && requestFn === timeoutDefer) {\r\n\t\t\tfn();\r\n\t\t} else {\r\n\t\t\treturn requestFn.call(window, fn, element);\r\n\t\t}\r\n\t};\r\n\r\n\tL.Util.cancelAnimFrame = function (id) {\r\n\t\tif (id) {\r\n\t\t\tcancelFn.call(window, id);\r\n\t\t}\r\n\t};\r\n\r\n}());\r\n\r\n// shortcuts for most used utility functions\r\nL.extend = L.Util.extend;\r\nL.bind = L.Util.bind;\r\nL.stamp = L.Util.stamp;\r\nL.setOptions = L.Util.setOptions;\r\n\r\n\r\n/*\r\n * L.Class powers the OOP facilities of the library.\r\n * Thanks to John Resig and Dean Edwards for inspiration!\r\n */\r\n\r\nL.Class = function () {};\r\n\r\nL.Class.extend = function (props) {\r\n\r\n\t// extended class with the new prototype\r\n\tvar NewClass = function () {\r\n\r\n\t\t// call the constructor\r\n\t\tif (this.initialize) {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\t// call all constructor hooks\r\n\t\tif (this._initHooks) {\r\n\t\t\tthis.callInitHooks();\r\n\t\t}\r\n\t};\r\n\r\n\t// instantiate class without calling constructor\r\n\tvar F = function () {};\r\n\tF.prototype = this.prototype;\r\n\r\n\tvar proto = new F();\r\n\tproto.constructor = NewClass;\r\n\r\n\tNewClass.prototype = proto;\r\n\r\n\t//inherit parent's statics\r\n\tfor (var i in this) {\r\n\t\tif (this.hasOwnProperty(i) && i !== 'prototype') {\r\n\t\t\tNewClass[i] = this[i];\r\n\t\t}\r\n\t}\r\n\r\n\t// mix static properties into the class\r\n\tif (props.statics) {\r\n\t\tL.extend(NewClass, props.statics);\r\n\t\tdelete props.statics;\r\n\t}\r\n\r\n\t// mix includes into the prototype\r\n\tif (props.includes) {\r\n\t\tL.Util.extend.apply(null, [proto].concat(props.includes));\r\n\t\tdelete props.includes;\r\n\t}\r\n\r\n\t// merge options\r\n\tif (props.options && proto.options) {\r\n\t\tprops.options = L.extend({}, proto.options, props.options);\r\n\t}\r\n\r\n\t// mix given properties into the prototype\r\n\tL.extend(proto, props);\r\n\r\n\tproto._initHooks = [];\r\n\r\n\tvar parent = this;\r\n\t// jshint camelcase: false\r\n\tNewClass.__super__ = parent.prototype;\r\n\r\n\t// add method for calling all hooks\r\n\tproto.callInitHooks = function () {\r\n\r\n\t\tif (this._initHooksCalled) { return; }\r\n\r\n\t\tif (parent.prototype.callInitHooks) {\r\n\t\t\tparent.prototype.callInitHooks.call(this);\r\n\t\t}\r\n\r\n\t\tthis._initHooksCalled = true;\r\n\r\n\t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n\t\t\tproto._initHooks[i].call(this);\r\n\t\t}\r\n\t};\r\n\r\n\treturn NewClass;\r\n};\r\n\r\n\r\n// method for adding properties to prototype\r\nL.Class.include = function (props) {\r\n\tL.extend(this.prototype, props);\r\n};\r\n\r\n// merge new default options to the Class\r\nL.Class.mergeOptions = function (options) {\r\n\tL.extend(this.prototype.options, options);\r\n};\r\n\r\n// add a constructor hook\r\nL.Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n\tvar init = typeof fn === 'function' ? fn : function () {\r\n\t\tthis[fn].apply(this, args);\r\n\t};\r\n\r\n\tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n\tthis.prototype._initHooks.push(init);\r\n};\r\n\r\n\r\n/*\r\n * L.Mixin.Events is used to add custom events functionality to Leaflet classes.\r\n */\r\n\r\nvar eventsKey = '_leaflet_events';\r\n\r\nL.Mixin = {};\r\n\r\nL.Mixin.Events = {\r\n\r\n\taddEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])\r\n\r\n\t\t// types can be a map of types/handlers\r\n\t\tif (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey] = this[eventsKey] || {},\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, event, type, indexKey, indexLenKey, typeIndex;\r\n\r\n\t\t// types can be a string of space-separated words\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\tevent = {\r\n\t\t\t\taction: fn,\r\n\t\t\t\tcontext: context || this\r\n\t\t\t};\r\n\t\t\ttype = types[i];\r\n\r\n\t\t\tif (contextId) {\r\n\t\t\t\t// store listeners of a particular context in a separate hash (if it has an id)\r\n\t\t\t\t// gives a major performance boost when removing thousands of map layers\r\n\r\n\t\t\t\tindexKey = type + '_idx';\r\n\t\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\t\ttypeIndex = events[indexKey] = events[indexKey] || {};\r\n\r\n\t\t\t\tif (!typeIndex[contextId]) {\r\n\t\t\t\t\ttypeIndex[contextId] = [];\r\n\r\n\t\t\t\t\t// keep track of the number of keys in the index to quickly check if it's empty\r\n\t\t\t\t\tevents[indexLenKey] = (events[indexLenKey] || 0) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttypeIndex[contextId].push(event);\r\n\r\n\r\n\t\t\t} else {\r\n\t\t\t\tevents[type] = events[type] || [];\r\n\t\t\t\tevents[type].push(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasEventListeners: function (type) { // (String) -> Boolean\r\n\t\tvar events = this[eventsKey];\r\n\t\treturn !!events && ((type in events && events[type].length > 0) ||\r\n\t\t                    (type + '_idx' in events && events[type + '_idx_len'] > 0));\r\n\t},\r\n\r\n\tremoveEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])\r\n\r\n\t\tif (!this[eventsKey]) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!types) {\r\n\t\t\treturn this.clearAllEventListeners();\r\n\t\t}\r\n\r\n\t\tif (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    contextId = context && context !== this && L.stamp(context),\r\n\t\t    i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;\r\n\r\n\t\ttypes = L.Util.splitWords(types);\r\n\r\n\t\tfor (i = 0, len = types.length; i < len; i++) {\r\n\t\t\ttype = types[i];\r\n\t\t\tindexKey = type + '_idx';\r\n\t\t\tindexLenKey = indexKey + '_len';\r\n\r\n\t\t\ttypeIndex = events[indexKey];\r\n\r\n\t\t\tif (!fn) {\r\n\t\t\t\t// clear all listeners for a type if function isn't specified\r\n\t\t\t\tdelete events[type];\r\n\t\t\t\tdelete events[indexKey];\r\n\t\t\t\tdelete events[indexLenKey];\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlisteners = contextId && typeIndex ? typeIndex[contextId] : events[type];\r\n\r\n\t\t\t\tif (listeners) {\r\n\t\t\t\t\tfor (j = listeners.length - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {\r\n\t\t\t\t\t\t\tremoved = listeners.splice(j, 1);\r\n\t\t\t\t\t\t\t// set the old action to a no-op, because it is possible\r\n\t\t\t\t\t\t\t// that the listener is being iterated over as part of a dispatch\r\n\t\t\t\t\t\t\tremoved[0].action = L.Util.falseFn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (context && typeIndex && (listeners.length === 0)) {\r\n\t\t\t\t\t\tdelete typeIndex[contextId];\r\n\t\t\t\t\t\tevents[indexLenKey]--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclearAllEventListeners: function () {\r\n\t\tdelete this[eventsKey];\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfireEvent: function (type, data) { // (String[, Object])\r\n\t\tif (!this.hasEventListeners(type)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar event = L.Util.extend({}, data, { type: type, target: this });\r\n\r\n\t\tvar events = this[eventsKey],\r\n\t\t    listeners, i, len, typeIndex, contextId;\r\n\r\n\t\tif (events[type]) {\r\n\t\t\t// make sure adding/removing listeners inside other listeners won't cause infinite loop\r\n\t\t\tlisteners = events[type].slice();\r\n\r\n\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// fire event for the context-indexed listeners as well\r\n\t\ttypeIndex = events[type + '_idx'];\r\n\r\n\t\tfor (contextId in typeIndex) {\r\n\t\t\tlisteners = typeIndex[contextId].slice();\r\n\r\n\t\t\tif (listeners) {\r\n\t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n\t\t\t\t\tlisteners[i].action.call(listeners[i].context, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOneTimeEventListener: function (types, fn, context) {\r\n\r\n\t\tif (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }\r\n\r\n\t\tvar handler = L.bind(function () {\r\n\t\t\tthis\r\n\t\t\t    .removeEventListener(types, fn, context)\r\n\t\t\t    .removeEventListener(types, handler, context);\r\n\t\t}, this);\r\n\r\n\t\treturn this\r\n\t\t    .addEventListener(types, fn, context)\r\n\t\t    .addEventListener(types, handler, context);\r\n\t}\r\n};\r\n\r\nL.Mixin.Events.on = L.Mixin.Events.addEventListener;\r\nL.Mixin.Events.off = L.Mixin.Events.removeEventListener;\r\nL.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;\r\nL.Mixin.Events.fire = L.Mixin.Events.fireEvent;\r\n\r\n\r\n/*\r\n * L.Browser handles different browser and feature detections for internal Leaflet use.\r\n */\r\n\r\n(function () {\r\n\r\n\tvar ie = 'ActiveXObject' in window,\r\n\t\tielt9 = ie && !document.addEventListener,\r\n\r\n\t    // terrible browser detection to work around Safari / iOS / Android browser bugs\r\n\t    ua = navigator.userAgent.toLowerCase(),\r\n\t    webkit = ua.indexOf('webkit') !== -1,\r\n\t    chrome = ua.indexOf('chrome') !== -1,\r\n\t    phantomjs = ua.indexOf('phantom') !== -1,\r\n\t    android = ua.indexOf('android') !== -1,\r\n\t    android23 = ua.search('android [23]') !== -1,\r\n\t\tgecko = ua.indexOf('gecko') !== -1,\r\n\r\n\t    mobile = typeof orientation !== undefined + '',\r\n\t    msPointer = !window.PointerEvent && window.MSPointerEvent,\r\n\t\tpointer = (window.PointerEvent && window.navigator.pointerEnabled) ||\r\n\t\t\t\t  msPointer,\r\n\t    retina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||\r\n\t             ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&\r\n\t              window.matchMedia('(min-resolution:144dpi)').matches),\r\n\r\n\t    doc = document.documentElement,\r\n\t    ie3d = ie && ('transition' in doc.style),\r\n\t    webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,\r\n\t    gecko3d = 'MozPerspective' in doc.style,\r\n\t    opera3d = 'OTransition' in doc.style,\r\n\t    any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;\r\n\r\n\tvar touch = !window.L_NO_TOUCH && !phantomjs && (pointer || 'ontouchstart' in window ||\r\n\t\t(window.DocumentTouch && document instanceof window.DocumentTouch));\r\n\r\n\tL.Browser = {\r\n\t\tie: ie,\r\n\t\tielt9: ielt9,\r\n\t\twebkit: webkit,\r\n\t\tgecko: gecko && !webkit && !window.opera && !ie,\r\n\r\n\t\tandroid: android,\r\n\t\tandroid23: android23,\r\n\r\n\t\tchrome: chrome,\r\n\r\n\t\tie3d: ie3d,\r\n\t\twebkit3d: webkit3d,\r\n\t\tgecko3d: gecko3d,\r\n\t\topera3d: opera3d,\r\n\t\tany3d: any3d,\r\n\r\n\t\tmobile: mobile,\r\n\t\tmobileWebkit: mobile && webkit,\r\n\t\tmobileWebkit3d: mobile && webkit3d,\r\n\t\tmobileOpera: mobile && window.opera,\r\n\r\n\t\ttouch: touch,\r\n\t\tmsPointer: msPointer,\r\n\t\tpointer: pointer,\r\n\r\n\t\tretina: retina\r\n\t};\r\n\r\n}());\r\n\r\n\r\n/*\r\n * L.Point represents a point with x and y coordinates.\r\n */\r\n\r\nL.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {\r\n\tthis.x = (round ? Math.round(x) : x);\r\n\tthis.y = (round ? Math.round(y) : y);\r\n};\r\n\r\nL.Point.prototype = {\r\n\r\n\tclone: function () {\r\n\t\treturn new L.Point(this.x, this.y);\r\n\t},\r\n\r\n\t// non-destructive, returns a new point\r\n\tadd: function (point) {\r\n\t\treturn this.clone()._add(L.point(point));\r\n\t},\r\n\r\n\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n\t_add: function (point) {\r\n\t\tthis.x += point.x;\r\n\t\tthis.y += point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsubtract: function (point) {\r\n\t\treturn this.clone()._subtract(L.point(point));\r\n\t},\r\n\r\n\t_subtract: function (point) {\r\n\t\tthis.x -= point.x;\r\n\t\tthis.y -= point.y;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdivideBy: function (num) {\r\n\t\treturn this.clone()._divideBy(num);\r\n\t},\r\n\r\n\t_divideBy: function (num) {\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmultiplyBy: function (num) {\r\n\t\treturn this.clone()._multiplyBy(num);\r\n\t},\r\n\r\n\t_multiplyBy: function (num) {\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tround: function () {\r\n\t\treturn this.clone()._round();\r\n\t},\r\n\r\n\t_round: function () {\r\n\t\tthis.x = Math.round(this.x);\r\n\t\tthis.y = Math.round(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfloor: function () {\r\n\t\treturn this.clone()._floor();\r\n\t},\r\n\r\n\t_floor: function () {\r\n\t\tthis.x = Math.floor(this.x);\r\n\t\tthis.y = Math.floor(this.y);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdistanceTo: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tvar x = point.x - this.x,\r\n\t\t    y = point.y - this.y;\r\n\r\n\t\treturn Math.sqrt(x * x + y * y);\r\n\t},\r\n\r\n\tequals: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn point.x === this.x &&\r\n\t\t       point.y === this.y;\r\n\t},\r\n\r\n\tcontains: function (point) {\r\n\t\tpoint = L.point(point);\r\n\r\n\t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n\t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n\t},\r\n\r\n\ttoString: function () {\r\n\t\treturn 'Point(' +\r\n\t\t        L.Util.formatNum(this.x) + ', ' +\r\n\t\t        L.Util.formatNum(this.y) + ')';\r\n\t}\r\n};\r\n\r\nL.point = function (x, y, round) {\r\n\tif (x instanceof L.Point) {\r\n\t\treturn x;\r\n\t}\r\n\tif (L.Util.isArray(x)) {\r\n\t\treturn new L.Point(x[0], x[1]);\r\n\t}\r\n\tif (x === undefined || x === null) {\r\n\t\treturn x;\r\n\t}\r\n\treturn new L.Point(x, y, round);\r\n};\r\n\r\n\r\n/*\r\n * L.Bounds represents a rectangular area on the screen in pixel coordinates.\r\n */\r\n\r\nL.Bounds = function (a, b) { //(Point, Point) or Point[]\r\n\tif (!a) { return; }\r\n\r\n\tvar points = b ? [a, b] : a;\r\n\r\n\tfor (var i = 0, len = points.length; i < len; i++) {\r\n\t\tthis.extend(points[i]);\r\n\t}\r\n};\r\n\r\nL.Bounds.prototype = {\r\n\t// extend the bounds to contain the given point\r\n\textend: function (point) { // (Point)\r\n\t\tpoint = L.point(point);\r\n\r\n\t\tif (!this.min && !this.max) {\r\n\t\t\tthis.min = point.clone();\r\n\t\t\tthis.max = point.clone();\r\n\t\t} else {\r\n\t\t\tthis.min.x = Math.min(point.x, this.min.x);\r\n\t\t\tthis.max.x = Math.max(point.x, this.max.x);\r\n\t\t\tthis.min.y = Math.min(point.y, this.min.y);\r\n\t\t\tthis.max.y = Math.max(point.y, this.max.y);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetCenter: function (round) { // (Boolean) -> Point\r\n\t\treturn new L.Point(\r\n\t\t        (this.min.x + this.max.x) / 2,\r\n\t\t        (this.min.y + this.max.y) / 2, round);\r\n\t},\r\n\r\n\tgetBottomLeft: function () { // -> Point\r\n\t\treturn new L.Point(this.min.x, this.max.y);\r\n\t},\r\n\r\n\tgetTopRight: function () { // -> Point\r\n\t\treturn new L.Point(this.max.x, this.min.y);\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\treturn this.max.subtract(this.min);\r\n\t},\r\n\r\n\tcontains: function (obj) { // (Bounds) or (Point) -> Boolean\r\n\t\tvar min, max;\r\n\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.Point) {\r\n\t\t\tobj = L.point(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.bounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.Bounds) {\r\n\t\t\tmin = obj.min;\r\n\t\t\tmax = obj.max;\r\n\t\t} else {\r\n\t\t\tmin = max = obj;\r\n\t\t}\r\n\r\n\t\treturn (min.x >= this.min.x) &&\r\n\t\t       (max.x <= this.max.x) &&\r\n\t\t       (min.y >= this.min.y) &&\r\n\t\t       (max.y <= this.max.y);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (Bounds) -> Boolean\r\n\t\tbounds = L.bounds(bounds);\r\n\r\n\t\tvar min = this.min,\r\n\t\t    max = this.max,\r\n\t\t    min2 = bounds.min,\r\n\t\t    max2 = bounds.max,\r\n\t\t    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n\t\t    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n\t\treturn xIntersects && yIntersects;\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this.min && this.max);\r\n\t}\r\n};\r\n\r\nL.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])\r\n\tif (!a || a instanceof L.Bounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.Bounds(a, b);\r\n};\r\n\r\n\r\n/*\r\n * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.\r\n */\r\n\r\nL.Transformation = function (a, b, c, d) {\r\n\tthis._a = a;\r\n\tthis._b = b;\r\n\tthis._c = c;\r\n\tthis._d = d;\r\n};\r\n\r\nL.Transformation.prototype = {\r\n\ttransform: function (point, scale) { // (Point, Number) -> Point\r\n\t\treturn this._transform(point.clone(), scale);\r\n\t},\r\n\r\n\t// destructive transform (faster)\r\n\t_transform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\tpoint.x = scale * (this._a * point.x + this._b);\r\n\t\tpoint.y = scale * (this._c * point.y + this._d);\r\n\t\treturn point;\r\n\t},\r\n\r\n\tuntransform: function (point, scale) {\r\n\t\tscale = scale || 1;\r\n\t\treturn new L.Point(\r\n\t\t        (point.x / scale - this._b) / this._a,\r\n\t\t        (point.y / scale - this._d) / this._c);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.DomUtil contains various utility functions for working with DOM.\r\n */\r\n\r\nL.DomUtil = {\r\n\tget: function (id) {\r\n\t\treturn (typeof id === 'string' ? document.getElementById(id) : id);\r\n\t},\r\n\r\n\tgetStyle: function (el, style) {\r\n\r\n\t\tvar value = el.style[style];\r\n\r\n\t\tif (!value && el.currentStyle) {\r\n\t\t\tvalue = el.currentStyle[style];\r\n\t\t}\r\n\r\n\t\tif ((!value || value === 'auto') && document.defaultView) {\r\n\t\t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tvalue = css ? css[style] : null;\r\n\t\t}\r\n\r\n\t\treturn value === 'auto' ? null : value;\r\n\t},\r\n\r\n\tgetViewportOffset: function (element) {\r\n\r\n\t\tvar top = 0,\r\n\t\t    left = 0,\r\n\t\t    el = element,\r\n\t\t    docBody = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    pos;\r\n\r\n\t\tdo {\r\n\t\t\ttop  += el.offsetTop  || 0;\r\n\t\t\tleft += el.offsetLeft || 0;\r\n\r\n\t\t\t//add borders\r\n\t\t\ttop += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;\r\n\t\t\tleft += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;\r\n\r\n\t\t\tpos = L.DomUtil.getStyle(el, 'position');\r\n\r\n\t\t\tif (el.offsetParent === docBody && pos === 'absolute') { break; }\r\n\r\n\t\t\tif (pos === 'fixed') {\r\n\t\t\t\ttop  += docBody.scrollTop  || docEl.scrollTop  || 0;\r\n\t\t\t\tleft += docBody.scrollLeft || docEl.scrollLeft || 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (pos === 'relative' && !el.offsetLeft) {\r\n\t\t\t\tvar width = L.DomUtil.getStyle(el, 'width'),\r\n\t\t\t\t    maxWidth = L.DomUtil.getStyle(el, 'max-width'),\r\n\t\t\t\t    r = el.getBoundingClientRect();\r\n\r\n\t\t\t\tif (width !== 'none' || maxWidth !== 'none') {\r\n\t\t\t\t\tleft += r.left + el.clientLeft;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//calculate full y offset since we're breaking out of the loop\r\n\t\t\t\ttop += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tel = el.offsetParent;\r\n\r\n\t\t} while (el);\r\n\r\n\t\tel = element;\r\n\r\n\t\tdo {\r\n\t\t\tif (el === docBody) { break; }\r\n\r\n\t\t\ttop  -= el.scrollTop  || 0;\r\n\t\t\tleft -= el.scrollLeft || 0;\r\n\r\n\t\t\tel = el.parentNode;\r\n\t\t} while (el);\r\n\r\n\t\treturn new L.Point(left, top);\r\n\t},\r\n\r\n\tdocumentIsLtr: function () {\r\n\t\tif (!L.DomUtil._docIsLtrCached) {\r\n\t\t\tL.DomUtil._docIsLtrCached = true;\r\n\t\t\tL.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';\r\n\t\t}\r\n\t\treturn L.DomUtil._docIsLtr;\r\n\t},\r\n\r\n\tcreate: function (tagName, className, container) {\r\n\r\n\t\tvar el = document.createElement(tagName);\r\n\t\tel.className = className;\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer.appendChild(el);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\thasClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\treturn el.classList.contains(name);\r\n\t\t}\r\n\t\tvar className = L.DomUtil._getClass(el);\r\n\t\treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n\t},\r\n\r\n\taddClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tvar classes = L.Util.splitWords(name);\r\n\t\t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n\t\t\t\tel.classList.add(classes[i]);\r\n\t\t\t}\r\n\t\t} else if (!L.DomUtil.hasClass(el, name)) {\r\n\t\t\tvar className = L.DomUtil._getClass(el);\r\n\t\t\tL.DomUtil._setClass(el, (className ? className + ' ' : '') + name);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveClass: function (el, name) {\r\n\t\tif (el.classList !== undefined) {\r\n\t\t\tel.classList.remove(name);\r\n\t\t} else {\r\n\t\t\tL.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n\t\t}\r\n\t},\r\n\r\n\t_setClass: function (el, name) {\r\n\t\tif (el.className.baseVal === undefined) {\r\n\t\t\tel.className = name;\r\n\t\t} else {\r\n\t\t\t// in case of SVG element\r\n\t\t\tel.className.baseVal = name;\r\n\t\t}\r\n\t},\r\n\r\n\t_getClass: function (el) {\r\n\t\treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n\t},\r\n\r\n\tsetOpacity: function (el, value) {\r\n\r\n\t\tif ('opacity' in el.style) {\r\n\t\t\tel.style.opacity = value;\r\n\r\n\t\t} else if ('filter' in el.style) {\r\n\r\n\t\t\tvar filter = false,\r\n\t\t\t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n\t\t\t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n\t\t\ttry {\r\n\t\t\t\tfilter = el.filters.item(filterName);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n\t\t\t\t// it isn't needed and breaks transparent pngs.\r\n\t\t\t\tif (value === 1) { return; }\r\n\t\t\t}\r\n\r\n\t\t\tvalue = Math.round(value * 100);\r\n\r\n\t\t\tif (filter) {\r\n\t\t\t\tfilter.Enabled = (value !== 100);\r\n\t\t\t\tfilter.Opacity = value;\r\n\t\t\t} else {\r\n\t\t\t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\ttestProp: function (props) {\r\n\r\n\t\tvar style = document.documentElement.style;\r\n\r\n\t\tfor (var i = 0; i < props.length; i++) {\r\n\t\t\tif (props[i] in style) {\r\n\t\t\t\treturn props[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tgetTranslateString: function (point) {\r\n\t\t// on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate\r\n\t\t// makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care\r\n\t\t// (same speed either way), Opera 12 doesn't support translate3d\r\n\r\n\t\tvar is3d = L.Browser.webkit3d,\r\n\t\t    open = 'translate' + (is3d ? '3d' : '') + '(',\r\n\t\t    close = (is3d ? ',0' : '') + ')';\r\n\r\n\t\treturn open + point.x + 'px,' + point.y + 'px' + close;\r\n\t},\r\n\r\n\tgetScaleString: function (scale, origin) {\r\n\r\n\t\tvar preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),\r\n\t\t    scaleStr = ' scale(' + scale + ') ';\r\n\r\n\t\treturn preTranslateStr + scaleStr;\r\n\t},\r\n\r\n\tsetPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])\r\n\r\n\t\t// jshint camelcase: false\r\n\t\tel._leaflet_pos = point;\r\n\r\n\t\tif (!disable3D && L.Browser.any3d) {\r\n\t\t\tel.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);\r\n\t\t} else {\r\n\t\t\tel.style.left = point.x + 'px';\r\n\t\t\tel.style.top = point.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\tgetPosition: function (el) {\r\n\t\t// this method is only used for elements previously positioned using setPosition,\r\n\t\t// so it's safe to cache the position for performance\r\n\r\n\t\t// jshint camelcase: false\r\n\t\treturn el._leaflet_pos;\r\n\t}\r\n};\r\n\r\n\r\n// prefix style property names\r\n\r\nL.DomUtil.TRANSFORM = L.DomUtil.testProp(\r\n        ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n// webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n// the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\nL.DomUtil.TRANSITION = L.DomUtil.testProp(\r\n        ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\nL.DomUtil.TRANSITION_END =\r\n        L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?\r\n        L.DomUtil.TRANSITION + 'End' : 'transitionend';\r\n\r\n(function () {\r\n    if ('onselectstart' in document) {\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);\r\n            }\r\n        });\r\n    } else {\r\n        var userSelectProperty = L.DomUtil.testProp(\r\n            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n        L.extend(L.DomUtil, {\r\n            disableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    var style = document.documentElement.style;\r\n                    this._userSelect = style[userSelectProperty];\r\n                    style[userSelectProperty] = 'none';\r\n                }\r\n            },\r\n\r\n            enableTextSelection: function () {\r\n                if (userSelectProperty) {\r\n                    document.documentElement.style[userSelectProperty] = this._userSelect;\r\n                    delete this._userSelect;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\tL.extend(L.DomUtil, {\r\n\t\tdisableImageDrag: function () {\r\n\t\t\tL.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t},\r\n\r\n\t\tenableImageDrag: function () {\r\n\t\t\tL.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);\r\n\t\t}\r\n\t});\r\n})();\r\n\r\n\r\n/*\r\n * L.LatLng represents a geographical point with latitude and longitude coordinates.\r\n */\r\n\r\nL.LatLng = function (lat, lng, alt) { // (Number, Number, Number)\r\n\tlat = parseFloat(lat);\r\n\tlng = parseFloat(lng);\r\n\r\n\tif (isNaN(lat) || isNaN(lng)) {\r\n\t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n\t}\r\n\r\n\tthis.lat = lat;\r\n\tthis.lng = lng;\r\n\r\n\tif (alt !== undefined) {\r\n\t\tthis.alt = parseFloat(alt);\r\n\t}\r\n};\r\n\r\nL.extend(L.LatLng, {\r\n\tDEG_TO_RAD: Math.PI / 180,\r\n\tRAD_TO_DEG: 180 / Math.PI,\r\n\tMAX_MARGIN: 1.0E-9 // max margin of error for the \"equals\" check\r\n});\r\n\r\nL.LatLng.prototype = {\r\n\tequals: function (obj) { // (LatLng) -> Boolean\r\n\t\tif (!obj) { return false; }\r\n\r\n\t\tobj = L.latLng(obj);\r\n\r\n\t\tvar margin = Math.max(\r\n\t\t        Math.abs(this.lat - obj.lat),\r\n\t\t        Math.abs(this.lng - obj.lng));\r\n\r\n\t\treturn margin <= L.LatLng.MAX_MARGIN;\r\n\t},\r\n\r\n\ttoString: function (precision) { // (Number) -> String\r\n\t\treturn 'LatLng(' +\r\n\t\t        L.Util.formatNum(this.lat, precision) + ', ' +\r\n\t\t        L.Util.formatNum(this.lng, precision) + ')';\r\n\t},\r\n\r\n\t// Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula\r\n\t// TODO move to projection code, LatLng shouldn't know about Earth\r\n\tdistanceTo: function (other) { // (LatLng) -> Number\r\n\t\tother = L.latLng(other);\r\n\r\n\t\tvar R = 6378137, // earth radius in meters\r\n\t\t    d2r = L.LatLng.DEG_TO_RAD,\r\n\t\t    dLat = (other.lat - this.lat) * d2r,\r\n\t\t    dLon = (other.lng - this.lng) * d2r,\r\n\t\t    lat1 = this.lat * d2r,\r\n\t\t    lat2 = other.lat * d2r,\r\n\t\t    sin1 = Math.sin(dLat / 2),\r\n\t\t    sin2 = Math.sin(dLon / 2);\r\n\r\n\t\tvar a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);\r\n\r\n\t\treturn R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t},\r\n\r\n\twrap: function (a, b) { // (Number, Number) -> LatLng\r\n\t\tvar lng = this.lng;\r\n\r\n\t\ta = a || -180;\r\n\t\tb = b ||  180;\r\n\r\n\t\tlng = (lng + b) % (b - a) + (lng < a || lng === b ? b : a);\r\n\r\n\t\treturn new L.LatLng(this.lat, lng);\r\n\t}\r\n};\r\n\r\nL.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)\r\n\tif (a instanceof L.LatLng) {\r\n\t\treturn a;\r\n\t}\r\n\tif (L.Util.isArray(a)) {\r\n\t\tif (typeof a[0] === 'number' || typeof a[0] === 'string') {\r\n\t\t\treturn new L.LatLng(a[0], a[1], a[2]);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tif (a === undefined || a === null) {\r\n\t\treturn a;\r\n\t}\r\n\tif (typeof a === 'object' && 'lat' in a) {\r\n\t\treturn new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);\r\n\t}\r\n\tif (b === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\treturn new L.LatLng(a, b);\r\n};\r\n\r\n\r\n\r\n/*\r\n * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.\r\n */\r\n\r\nL.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])\r\n\tif (!southWest) { return; }\r\n\r\n\tvar latlngs = northEast ? [southWest, northEast] : southWest;\r\n\r\n\tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n\t\tthis.extend(latlngs[i]);\r\n\t}\r\n};\r\n\r\nL.LatLngBounds.prototype = {\r\n\t// extend the bounds to contain the given point or bounds\r\n\textend: function (obj) { // (LatLng) or (LatLngBounds)\r\n\t\tif (!obj) { return this; }\r\n\r\n\t\tvar latLng = L.latLng(obj);\r\n\t\tif (latLng !== null) {\r\n\t\t\tobj = latLng;\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tif (obj instanceof L.LatLng) {\r\n\t\t\tif (!this._southWest && !this._northEast) {\r\n\t\t\t\tthis._southWest = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t\tthis._northEast = new L.LatLng(obj.lat, obj.lng);\r\n\t\t\t} else {\r\n\t\t\t\tthis._southWest.lat = Math.min(obj.lat, this._southWest.lat);\r\n\t\t\t\tthis._southWest.lng = Math.min(obj.lng, this._southWest.lng);\r\n\r\n\t\t\t\tthis._northEast.lat = Math.max(obj.lat, this._northEast.lat);\r\n\t\t\t\tthis._northEast.lng = Math.max(obj.lng, this._northEast.lng);\r\n\t\t\t}\r\n\t\t} else if (obj instanceof L.LatLngBounds) {\r\n\t\t\tthis.extend(obj._southWest);\r\n\t\t\tthis.extend(obj._northEast);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// extend the bounds by a percentage\r\n\tpad: function (bufferRatio) { // (Number) -> LatLngBounds\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n\t\t    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        new L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n\t\t        new L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n\t},\r\n\r\n\tgetCenter: function () { // -> LatLng\r\n\t\treturn new L.LatLng(\r\n\t\t        (this._southWest.lat + this._northEast.lat) / 2,\r\n\t\t        (this._southWest.lng + this._northEast.lng) / 2);\r\n\t},\r\n\r\n\tgetSouthWest: function () {\r\n\t\treturn this._southWest;\r\n\t},\r\n\r\n\tgetNorthEast: function () {\r\n\t\treturn this._northEast;\r\n\t},\r\n\r\n\tgetNorthWest: function () {\r\n\t\treturn new L.LatLng(this.getNorth(), this.getWest());\r\n\t},\r\n\r\n\tgetSouthEast: function () {\r\n\t\treturn new L.LatLng(this.getSouth(), this.getEast());\r\n\t},\r\n\r\n\tgetWest: function () {\r\n\t\treturn this._southWest.lng;\r\n\t},\r\n\r\n\tgetSouth: function () {\r\n\t\treturn this._southWest.lat;\r\n\t},\r\n\r\n\tgetEast: function () {\r\n\t\treturn this._northEast.lng;\r\n\t},\r\n\r\n\tgetNorth: function () {\r\n\t\treturn this._northEast.lat;\r\n\t},\r\n\r\n\tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n\t\tif (typeof obj[0] === 'number' || obj instanceof L.LatLng) {\r\n\t\t\tobj = L.latLng(obj);\r\n\t\t} else {\r\n\t\t\tobj = L.latLngBounds(obj);\r\n\t\t}\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2, ne2;\r\n\r\n\t\tif (obj instanceof L.LatLngBounds) {\r\n\t\t\tsw2 = obj.getSouthWest();\r\n\t\t\tne2 = obj.getNorthEast();\r\n\t\t} else {\r\n\t\t\tsw2 = ne2 = obj;\r\n\t\t}\r\n\r\n\t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n\t\t       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n\t},\r\n\r\n\tintersects: function (bounds) { // (LatLngBounds)\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar sw = this._southWest,\r\n\t\t    ne = this._northEast,\r\n\t\t    sw2 = bounds.getSouthWest(),\r\n\t\t    ne2 = bounds.getNorthEast(),\r\n\r\n\t\t    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n\t\t    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n\t\treturn latIntersects && lngIntersects;\r\n\t},\r\n\r\n\ttoBBoxString: function () {\r\n\t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n\t},\r\n\r\n\tequals: function (bounds) { // (LatLngBounds)\r\n\t\tif (!bounds) { return false; }\r\n\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\treturn this._southWest.equals(bounds.getSouthWest()) &&\r\n\t\t       this._northEast.equals(bounds.getNorthEast());\r\n\t},\r\n\r\n\tisValid: function () {\r\n\t\treturn !!(this._southWest && this._northEast);\r\n\t}\r\n};\r\n\r\n//TODO International date line?\r\n\r\nL.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)\r\n\tif (!a || a instanceof L.LatLngBounds) {\r\n\t\treturn a;\r\n\t}\r\n\treturn new L.LatLngBounds(a, b);\r\n};\r\n\r\n\r\n/*\r\n * L.Projection contains various geographical projections used by CRS classes.\r\n */\r\n\r\nL.Projection = {};\r\n\r\n\r\n/*\r\n * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.\r\n */\r\n\r\nL.Projection.SphericalMercator = {\r\n\tMAX_LATITUDE: 85.0511287798,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    x = latlng.lng * d,\r\n\t\t    y = lat * d;\r\n\r\n\t\ty = Math.log(Math.tan((Math.PI / 4) + (y / 2)));\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    lng = point.x * d,\r\n\t\t    lat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;\r\n\r\n\t\treturn new L.LatLng(lat, lng);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.\r\n */\r\n\r\nL.Projection.LonLat = {\r\n\tproject: function (latlng) {\r\n\t\treturn new L.Point(latlng.lng, latlng.lat);\r\n\t},\r\n\r\n\tunproject: function (point) {\r\n\t\treturn new L.LatLng(point.y, point.x);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.\r\n */\r\n\r\nL.CRS = {\r\n\tlatLngToPoint: function (latlng, zoom) { // (LatLng, Number) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    scale = this.scale(zoom);\r\n\r\n\t\treturn this.transformation._transform(projectedPoint, scale);\r\n\t},\r\n\r\n\tpointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) -> LatLng\r\n\t\tvar scale = this.scale(zoom),\r\n\t\t    untransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n\t\treturn this.projection.unproject(untransformedPoint);\r\n\t},\r\n\r\n\tproject: function (latlng) {\r\n\t\treturn this.projection.project(latlng);\r\n\t},\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn 256 * Math.pow(2, zoom);\r\n\t},\r\n\r\n\tgetSize: function (zoom) {\r\n\t\tvar s = this.scale(zoom);\r\n\t\treturn L.point(s, s);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.\r\n */\r\n\r\nL.CRS.Simple = L.extend({}, L.CRS, {\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1, 0, -1, 0),\r\n\r\n\tscale: function (zoom) {\r\n\t\treturn Math.pow(2, zoom);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping\r\n * and is used by Leaflet by default.\r\n */\r\n\r\nL.CRS.EPSG3857 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3857',\r\n\r\n\tprojection: L.Projection.SphericalMercator,\r\n\ttransformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar projectedPoint = this.projection.project(latlng),\r\n\t\t    earthRadius = 6378137;\r\n\t\treturn projectedPoint.multiplyBy(earthRadius);\r\n\t}\r\n});\r\n\r\nL.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {\r\n\tcode: 'EPSG:900913'\r\n});\r\n\r\n\r\n/*\r\n * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.\r\n */\r\n\r\nL.CRS.EPSG4326 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:4326',\r\n\r\n\tprojection: L.Projection.LonLat,\r\n\ttransformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)\r\n});\r\n\r\n\r\n/*\r\n * L.Map is the central class of the API - it is used to create a map.\r\n */\r\n\r\nL.Map = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tcrs: L.CRS.EPSG3857,\r\n\r\n\t\t/*\r\n\t\tcenter: LatLng,\r\n\t\tzoom: Number,\r\n\t\tlayers: Array,\r\n\t\t*/\r\n\r\n\t\tfadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,\r\n\t\ttrackResize: true,\r\n\t\tmarkerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d\r\n\t},\r\n\r\n\tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\r\n\t\tthis._initContainer(id);\r\n\t\tthis._initLayout();\r\n\r\n\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n\t\tthis._onResize = L.bind(this._onResize, this);\r\n\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (options.maxBounds) {\r\n\t\t\tthis.setMaxBounds(options.maxBounds);\r\n\t\t}\r\n\r\n\t\tif (options.center && options.zoom !== undefined) {\r\n\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\r\n\t\t}\r\n\r\n\t\tthis._handlers = [];\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._zoomBoundLayers = {};\r\n\t\tthis._tileLayersNum = 0;\r\n\r\n\t\tthis.callInitHooks();\r\n\r\n\t\tthis._addLayers(options.layers);\r\n\t},\r\n\r\n\r\n\t// public methods that modify map state\r\n\r\n\t// replaced by animation-powered implementation in Map.PanAnimation.js\r\n\tsetView: function (center, zoom) {\r\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\r\n\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZoom: function (zoom, options) {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthis._zoom = this._limitZoom(zoom);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n\t},\r\n\r\n\tzoomIn: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom + (delta || 1), options);\r\n\t},\r\n\r\n\tzoomOut: function (delta, options) {\r\n\t\treturn this.setZoom(this._zoom - (delta || 1), options);\r\n\t},\r\n\r\n\tsetZoomAround: function (latlng, zoom, options) {\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n\t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n\t\t    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n\t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n\t},\r\n\r\n\tfitBounds: function (bounds, options) {\r\n\r\n\t\toptions = options || {};\r\n\t\tbounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);\r\n\r\n\t\tvar paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),\r\n\t\t    paddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n\t\t    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR));\r\n\r\n\t\tzoom = (options.maxZoom) ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n\t\tvar paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n\t\t    swPoint = this.project(bounds.getSouthWest(), zoom),\r\n\t\t    nePoint = this.project(bounds.getNorthEast(), zoom),\r\n\t\t    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n\t\treturn this.setView(center, zoom, options);\r\n\t},\r\n\r\n\tfitWorld: function (options) {\r\n\t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n\t},\r\n\r\n\tpanTo: function (center, options) { // (LatLng)\r\n\t\treturn this.setView(center, this._zoom, {pan: options});\r\n\t},\r\n\r\n\tpanBy: function (offset) { // (Point)\r\n\t\t// replaced with animated panBy in Map.PanAnimation.js\r\n\t\tthis.fire('movestart');\r\n\r\n\t\tthis._rawPanBy(L.point(offset));\r\n\r\n\t\tthis.fire('move');\r\n\t\treturn this.fire('moveend');\r\n\t},\r\n\r\n\tsetMaxBounds: function (bounds) {\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tthis.options.maxBounds = bounds;\r\n\r\n\t\tif (!bounds) {\r\n\t\t\treturn this.off('moveend', this._panInsideMaxBounds, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._panInsideMaxBounds();\r\n\t\t}\r\n\r\n\t\treturn this.on('moveend', this._panInsideMaxBounds, this);\r\n\t},\r\n\r\n\tpanInsideBounds: function (bounds, options) {\r\n\t\tvar center = this.getCenter(),\r\n\t\t\tnewCenter = this._limitCenter(center, this._zoom, bounds);\r\n\r\n\t\tif (center.equals(newCenter)) { return this; }\r\n\r\n\t\treturn this.panTo(newCenter, options);\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\t// TODO method is too big, refactor\r\n\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (this._layers[id]) { return this; }\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\t// TODO getMaxZoom, getMinZoom in ILayer (instead of options)\r\n\t\tif (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {\r\n\t\t\tthis._zoomBoundLayers[id] = layer;\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor!!!\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum++;\r\n\t\t\tthis._tileLayersToLoad++;\r\n\t\t\tlayer.on('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis._layerAdd(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tif (!this._layers[id]) { return this; }\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tlayer.onRemove(this);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('layerremove', {layer: layer});\r\n\t\t}\r\n\r\n\t\tif (this._zoomBoundLayers[id]) {\r\n\t\t\tdelete this._zoomBoundLayers[id];\r\n\t\t\tthis._updateZoomLevels();\r\n\t\t}\r\n\r\n\t\t// TODO looks ugly, refactor\r\n\t\tif (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {\r\n\t\t\tthis._tileLayersNum--;\r\n\t\t\tthis._tileLayersToLoad--;\r\n\t\t\tlayer.off('load', this._onTileLayerLoad, this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (L.stamp(layer) in this._layers);\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvalidateSize: function (options) {\r\n\t\tif (!this._loaded) { return this; }\r\n\r\n\t\toptions = L.extend({\r\n\t\t\tanimate: false,\r\n\t\t\tpan: true\r\n\t\t}, options === true ? {animate: true} : options);\r\n\r\n\t\tvar oldSize = this.getSize();\r\n\t\tthis._sizeChanged = true;\r\n\t\tthis._initialCenter = null;\r\n\r\n\t\tvar newSize = this.getSize(),\r\n\t\t    oldCenter = oldSize.divideBy(2).round(),\r\n\t\t    newCenter = newSize.divideBy(2).round(),\r\n\t\t    offset = oldCenter.subtract(newCenter);\r\n\r\n\t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n\t\tif (options.animate && options.pan) {\r\n\t\t\tthis.panBy(offset);\r\n\r\n\t\t} else {\r\n\t\t\tif (options.pan) {\r\n\t\t\t\tthis._rawPanBy(offset);\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('move');\r\n\r\n\t\t\tif (options.debounceMoveend) {\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\r\n\t\t\t} else {\r\n\t\t\t\tthis.fire('moveend');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.fire('resize', {\r\n\t\t\toldSize: oldSize,\r\n\t\t\tnewSize: newSize\r\n\t\t});\r\n\t},\r\n\r\n\t// TODO handler.addTo\r\n\taddHandler: function (name, HandlerClass) {\r\n\t\tif (!HandlerClass) { return this; }\r\n\r\n\t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n\t\tthis._handlers.push(handler);\r\n\r\n\t\tif (this.options[name]) {\r\n\t\t\thandler.enable();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremove: function () {\r\n\t\tif (this._loaded) {\r\n\t\t\tthis.fire('unload');\r\n\t\t}\r\n\r\n\t\tthis._initEvents('off');\r\n\r\n\t\ttry {\r\n\t\t\t// throws error in IE6-8\r\n\t\t\tdelete this._container._leaflet;\r\n\t\t} catch (e) {\r\n\t\t\tthis._container._leaflet = undefined;\r\n\t\t}\r\n\r\n\t\tthis._clearPanes();\r\n\t\tif (this._clearControlPos) {\r\n\t\t\tthis._clearControlPos();\r\n\t\t}\r\n\r\n\t\tthis._clearHandlers();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\r\n\t// public methods for getting map state\r\n\r\n\tgetCenter: function () { // (Boolean) -> LatLng\r\n\t\tthis._checkIfLoaded();\r\n\r\n\t\tif (this._initialCenter && !this._moved()) {\r\n\t\t\treturn this._initialCenter;\r\n\t\t}\r\n\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\tgetZoom: function () {\r\n\t\treturn this._zoom;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = this.getPixelBounds(),\r\n\t\t    sw = this.unproject(bounds.getBottomLeft()),\r\n\t\t    ne = this.unproject(bounds.getTopRight());\r\n\r\n\t\treturn new L.LatLngBounds(sw, ne);\r\n\t},\r\n\r\n\tgetMinZoom: function () {\r\n\t\treturn this.options.minZoom === undefined ?\r\n\t\t\t(this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :\r\n\t\t\tthis.options.minZoom;\r\n\t},\r\n\r\n\tgetMaxZoom: function () {\r\n\t\treturn this.options.maxZoom === undefined ?\r\n\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n\t\t\tthis.options.maxZoom;\r\n\t},\r\n\r\n\tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n\t\tbounds = L.latLngBounds(bounds);\r\n\r\n\t\tvar zoom = this.getMinZoom() - (inside ? 1 : 0),\r\n\t\t    maxZoom = this.getMaxZoom(),\r\n\t\t    size = this.getSize(),\r\n\r\n\t\t    nw = bounds.getNorthWest(),\r\n\t\t    se = bounds.getSouthEast(),\r\n\r\n\t\t    zoomNotFound = true,\r\n\t\t    boundsSize;\r\n\r\n\t\tpadding = L.point(padding || [0, 0]);\r\n\r\n\t\tdo {\r\n\t\t\tzoom++;\r\n\t\t\tboundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);\r\n\t\t\tzoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x < size.x || boundsSize.y < size.y;\r\n\r\n\t\t} while (zoomNotFound && zoom <= maxZoom);\r\n\r\n\t\tif (zoomNotFound && inside) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn inside ? zoom : zoom - 1;\r\n\t},\r\n\r\n\tgetSize: function () {\r\n\t\tif (!this._size || this._sizeChanged) {\r\n\t\t\tthis._size = new L.Point(\r\n\t\t\t\tthis._container.clientWidth,\r\n\t\t\t\tthis._container.clientHeight);\r\n\r\n\t\t\tthis._sizeChanged = false;\r\n\t\t}\r\n\t\treturn this._size.clone();\r\n\t},\r\n\r\n\tgetPixelBounds: function () {\r\n\t\tvar topLeftPoint = this._getTopLeftPoint();\r\n\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n\t},\r\n\r\n\tgetPixelOrigin: function () {\r\n\t\tthis._checkIfLoaded();\r\n\t\treturn this._initialTopLeftPoint;\r\n\t},\r\n\r\n\tgetPanes: function () {\r\n\t\treturn this._panes;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\r\n\t// TODO replace with universal implementation after refactoring projections\r\n\r\n\tgetZoomScale: function (toZoom) {\r\n\t\tvar crs = this.options.crs;\r\n\t\treturn crs.scale(toZoom) / crs.scale(this._zoom);\r\n\t},\r\n\r\n\tgetScaleZoom: function (scale) {\r\n\t\treturn this._zoom + (Math.log(scale) / Math.LN2);\r\n\t},\r\n\r\n\r\n\t// conversion methods\r\n\r\n\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\r\n\t},\r\n\r\n\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\r\n\t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\r\n\t},\r\n\r\n\tlayerPointToLatLng: function (point) { // (Point)\r\n\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\r\n\t\treturn this.unproject(projectedPoint);\r\n\t},\r\n\r\n\tlatLngToLayerPoint: function (latlng) { // (LatLng)\r\n\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\r\n\t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n\t},\r\n\r\n\tcontainerPointToLayerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\tlayerPointToContainerPoint: function (point) { // (Point)\r\n\t\treturn L.point(point).add(this._getMapPanePos());\r\n\t},\r\n\r\n\tcontainerPointToLatLng: function (point) {\r\n\t\tvar layerPoint = this.containerPointToLayerPoint(L.point(point));\r\n\t\treturn this.layerPointToLatLng(layerPoint);\r\n\t},\r\n\r\n\tlatLngToContainerPoint: function (latlng) {\r\n\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\r\n\t},\r\n\r\n\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\r\n\t\treturn L.DomEvent.getMousePosition(e, this._container);\r\n\t},\r\n\r\n\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\r\n\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n\t},\r\n\r\n\tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n\t},\r\n\r\n\r\n\t// map initialization methods\r\n\r\n\t_initContainer: function (id) {\r\n\t\tvar container = this._container = L.DomUtil.get(id);\r\n\r\n\t\tif (!container) {\r\n\t\t\tthrow new Error('Map container not found.');\r\n\t\t} else if (container._leaflet) {\r\n\t\t\tthrow new Error('Map container is already initialized.');\r\n\t\t}\r\n\r\n\t\tcontainer._leaflet = true;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar container = this._container;\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-container' +\r\n\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\r\n\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\r\n\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n\t\t\t(this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));\r\n\r\n\t\tvar position = L.DomUtil.getStyle(container, 'position');\r\n\r\n\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\r\n\t\t\tcontainer.style.position = 'relative';\r\n\t\t}\r\n\r\n\t\tthis._initPanes();\r\n\r\n\t\tif (this._initControlPos) {\r\n\t\t\tthis._initControlPos();\r\n\t\t}\r\n\t},\r\n\r\n\t_initPanes: function () {\r\n\t\tvar panes = this._panes = {};\r\n\r\n\t\tthis._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);\r\n\r\n\t\tthis._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);\r\n\t\tpanes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);\r\n\t\tpanes.shadowPane = this._createPane('leaflet-shadow-pane');\r\n\t\tpanes.overlayPane = this._createPane('leaflet-overlay-pane');\r\n\t\tpanes.markerPane = this._createPane('leaflet-marker-pane');\r\n\t\tpanes.popupPane = this._createPane('leaflet-popup-pane');\r\n\r\n\t\tvar zoomHide = ' leaflet-zoom-hide';\r\n\r\n\t\tif (!this.options.markerZoomAnimation) {\r\n\t\t\tL.DomUtil.addClass(panes.markerPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.shadowPane, zoomHide);\r\n\t\t\tL.DomUtil.addClass(panes.popupPane, zoomHide);\r\n\t\t}\r\n\t},\r\n\r\n\t_createPane: function (className, container) {\r\n\t\treturn L.DomUtil.create('div', className, container || this._panes.objectsPane);\r\n\t},\r\n\r\n\t_clearPanes: function () {\r\n\t\tthis._container.removeChild(this._mapPane);\r\n\t},\r\n\r\n\t_addLayers: function (layers) {\r\n\t\tlayers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];\r\n\r\n\t\tfor (var i = 0, len = layers.length; i < len; i++) {\r\n\t\t\tthis.addLayer(layers[i]);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// private methods that modify map state\r\n\r\n\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\r\n\r\n\t\tvar zoomChanged = (this._zoom !== zoom);\r\n\r\n\t\tif (!afterZoomAnim) {\r\n\t\t\tthis.fire('movestart');\r\n\r\n\t\t\tif (zoomChanged) {\r\n\t\t\t\tthis.fire('zoomstart');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._zoom = zoom;\r\n\t\tthis._initialCenter = center;\r\n\r\n\t\tthis._initialTopLeftPoint = this._getNewTopLeftPoint(center);\r\n\r\n\t\tif (!preserveMapOffset) {\r\n\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\r\n\t\t} else {\r\n\t\t\tthis._initialTopLeftPoint._add(this._getMapPanePos());\r\n\t\t}\r\n\r\n\t\tthis._tileLayersToLoad = this._tileLayersNum;\r\n\r\n\t\tvar loading = !this._loaded;\r\n\t\tthis._loaded = true;\r\n\r\n\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\r\n\r\n\t\tif (loading) {\r\n\t\t\tthis.fire('load');\r\n\t\t\tthis.eachLayer(this._layerAdd, this);\r\n\t\t}\r\n\r\n\t\tthis.fire('move');\r\n\r\n\t\tif (zoomChanged || afterZoomAnim) {\r\n\t\t\tthis.fire('zoomend');\r\n\t\t}\r\n\r\n\t\tthis.fire('moveend', {hard: !preserveMapOffset});\r\n\t},\r\n\r\n\t_rawPanBy: function (offset) {\r\n\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n\t},\r\n\r\n\t_getZoomSpan: function () {\r\n\t\treturn this.getMaxZoom() - this.getMinZoom();\r\n\t},\r\n\r\n\t_updateZoomLevels: function () {\r\n\t\tvar i,\r\n\t\t\tminZoom = Infinity,\r\n\t\t\tmaxZoom = -Infinity,\r\n\t\t\toldZoomSpan = this._getZoomSpan();\r\n\r\n\t\tfor (i in this._zoomBoundLayers) {\r\n\t\t\tvar layer = this._zoomBoundLayers[i];\r\n\t\t\tif (!isNaN(layer.options.minZoom)) {\r\n\t\t\t\tminZoom = Math.min(minZoom, layer.options.minZoom);\r\n\t\t\t}\r\n\t\t\tif (!isNaN(layer.options.maxZoom)) {\r\n\t\t\t\tmaxZoom = Math.max(maxZoom, layer.options.maxZoom);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (i === undefined) { // we have no tilelayers\r\n\t\t\tthis._layersMaxZoom = this._layersMinZoom = undefined;\r\n\t\t} else {\r\n\t\t\tthis._layersMaxZoom = maxZoom;\r\n\t\t\tthis._layersMinZoom = minZoom;\r\n\t\t}\r\n\r\n\t\tif (oldZoomSpan !== this._getZoomSpan()) {\r\n\t\t\tthis.fire('zoomlevelschange');\r\n\t\t}\r\n\t},\r\n\r\n\t_panInsideMaxBounds: function () {\r\n\t\tthis.panInsideBounds(this.options.maxBounds);\r\n\t},\r\n\r\n\t_checkIfLoaded: function () {\r\n\t\tif (!this._loaded) {\r\n\t\t\tthrow new Error('Set map center and zoom first.');\r\n\t\t}\r\n\t},\r\n\r\n\t// map events\r\n\r\n\t_initEvents: function (onOff) {\r\n\t\tif (!L.DomEvent) { return; }\r\n\r\n\t\tonOff = onOff || 'on';\r\n\r\n\t\tL.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\tvar events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',\r\n\t\t              'mouseleave', 'mousemove', 'contextmenu'],\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = events.length; i < len; i++) {\r\n\t\t\tL.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (this.options.trackResize) {\r\n\t\t\tL.DomEvent[onOff](window, 'resize', this._onResize, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onResize: function () {\r\n\t\tL.Util.cancelAnimFrame(this._resizeRequest);\r\n\t\tthis._resizeRequest = L.Util.requestAnimFrame(\r\n\t\t        function () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (!this._loaded || (!e._simulated &&\r\n\t\t        ((this.dragging && this.dragging.moved()) ||\r\n\t\t         (this.boxZoom  && this.boxZoom.moved()))) ||\r\n\t\t            L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tthis.fire('preclick');\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._loaded || L.DomEvent._skipped(e)) { return; }\r\n\r\n\t\tvar type = e.type;\r\n\r\n\t\ttype = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));\r\n\r\n\t\tif (!this.hasEventListeners(type)) { return; }\r\n\r\n\t\tif (type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\r\n\t\tvar containerPoint = this.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = this.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = this.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\t},\r\n\r\n\t_onTileLayerLoad: function () {\r\n\t\tthis._tileLayersToLoad--;\r\n\t\tif (this._tileLayersNum && !this._tileLayersToLoad) {\r\n\t\t\tthis.fire('tilelayersload');\r\n\t\t}\r\n\t},\r\n\r\n\t_clearHandlers: function () {\r\n\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n\t\t\tthis._handlers[i].disable();\r\n\t\t}\r\n\t},\r\n\r\n\twhenReady: function (callback, context) {\r\n\t\tif (this._loaded) {\r\n\t\t\tcallback.call(context || this, this);\r\n\t\t} else {\r\n\t\t\tthis.on('load', callback, context);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_layerAdd: function (layer) {\r\n\t\tlayer.onAdd(this);\r\n\t\tthis.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\r\n\t// private methods for getting map state\r\n\r\n\t_getMapPanePos: function () {\r\n\t\treturn L.DomUtil.getPosition(this._mapPane);\r\n\t},\r\n\r\n\t_moved: function () {\r\n\t\tvar pos = this._getMapPanePos();\r\n\t\treturn pos && !pos.equals([0, 0]);\r\n\t},\r\n\r\n\t_getTopLeftPoint: function () {\r\n\t\treturn this.getPixelOrigin().subtract(this._getMapPanePos());\r\n\t},\r\n\r\n\t_getNewTopLeftPoint: function (center, zoom) {\r\n\t\tvar viewHalf = this.getSize()._divideBy(2);\r\n\t\t// TODO round on display, not calculation to increase precision?\r\n\t\treturn this.project(center, zoom)._subtract(viewHalf)._round();\r\n\t},\r\n\r\n\t_latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {\r\n\t\tvar topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());\r\n\t\treturn this.project(latlng, newZoom)._subtract(topLeft);\r\n\t},\r\n\r\n\t// layer point of the current center\r\n\t_getCenterLayerPoint: function () {\r\n\t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n\t},\r\n\r\n\t// offset of the specified place to the current center in pixels\r\n\t_getCenterOffset: function (latlng) {\r\n\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n\t},\r\n\r\n\t// adjust center for view to get inside bounds\r\n\t_limitCenter: function (center, zoom, bounds) {\r\n\r\n\t\tif (!bounds) { return center; }\r\n\r\n\t\tvar centerPoint = this.project(center, zoom),\r\n\t\t    viewHalf = this.getSize().divideBy(2),\r\n\t\t    viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n\t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n\t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n\t},\r\n\r\n\t// adjust offset for view to get inside bounds\r\n\t_limitOffset: function (offset, bounds) {\r\n\t\tif (!bounds) { return offset; }\r\n\r\n\t\tvar viewBounds = this.getPixelBounds(),\r\n\t\t    newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n\t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n\t},\r\n\r\n\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\r\n\t\t    seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\r\n\r\n\t\t    dx = this._rebound(nwOffset.x, -seOffset.x),\r\n\t\t    dy = this._rebound(nwOffset.y, -seOffset.y);\r\n\r\n\t\treturn new L.Point(dx, dy);\r\n\t},\r\n\r\n\t_rebound: function (left, right) {\r\n\t\treturn left + right > 0 ?\r\n\t\t\tMath.round(left - right) / 2 :\r\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n\t},\r\n\r\n\t_limitZoom: function (zoom) {\r\n\t\tvar min = this.getMinZoom(),\r\n\t\t    max = this.getMaxZoom();\r\n\r\n\t\treturn Math.max(min, Math.min(max, zoom));\r\n\t}\r\n});\r\n\r\nL.map = function (id, options) {\r\n\treturn new L.Map(id, options);\r\n};\r\n\r\n\r\n/*\r\n * Mercator projection that takes into account that the Earth is not a perfect sphere.\r\n * Less popular than spherical mercator; used by projections like EPSG:3395.\r\n */\r\n\r\nL.Projection.Mercator = {\r\n\tMAX_LATITUDE: 85.0840591556,\r\n\r\n\tR_MINOR: 6356752.314245179,\r\n\tR_MAJOR: 6378137,\r\n\r\n\tproject: function (latlng) { // (LatLng) -> Point\r\n\t\tvar d = L.LatLng.DEG_TO_RAD,\r\n\t\t    max = this.MAX_LATITUDE,\r\n\t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    x = latlng.lng * d * r,\r\n\t\t    y = lat * d,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1.0 - tmp * tmp),\r\n\t\t    con = eccent * Math.sin(y);\r\n\r\n\t\tcon = Math.pow((1 - con) / (1 + con), eccent * 0.5);\r\n\r\n\t\tvar ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;\r\n\t\ty = -r * Math.log(ts);\r\n\r\n\t\treturn new L.Point(x, y);\r\n\t},\r\n\r\n\tunproject: function (point) { // (Point, Boolean) -> LatLng\r\n\t\tvar d = L.LatLng.RAD_TO_DEG,\r\n\t\t    r = this.R_MAJOR,\r\n\t\t    r2 = this.R_MINOR,\r\n\t\t    lng = point.x * d / r,\r\n\t\t    tmp = r2 / r,\r\n\t\t    eccent = Math.sqrt(1 - (tmp * tmp)),\r\n\t\t    ts = Math.exp(- point.y / r),\r\n\t\t    phi = (Math.PI / 2) - 2 * Math.atan(ts),\r\n\t\t    numIter = 15,\r\n\t\t    tol = 1e-7,\r\n\t\t    i = numIter,\r\n\t\t    dphi = 0.1,\r\n\t\t    con;\r\n\r\n\t\twhile ((Math.abs(dphi) > tol) && (--i > 0)) {\r\n\t\t\tcon = eccent * Math.sin(phi);\r\n\t\t\tdphi = (Math.PI / 2) - 2 * Math.atan(ts *\r\n\t\t\t            Math.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;\r\n\t\t\tphi += dphi;\r\n\t\t}\r\n\r\n\t\treturn new L.LatLng(phi * d, lng);\r\n\t}\r\n};\r\n\r\n\r\n\r\nL.CRS.EPSG3395 = L.extend({}, L.CRS, {\r\n\tcode: 'EPSG:3395',\r\n\r\n\tprojection: L.Projection.Mercator,\r\n\r\n\ttransformation: (function () {\r\n\t\tvar m = L.Projection.Mercator,\r\n\t\t    r = m.R_MAJOR,\r\n\t\t    scale = 0.5 / (Math.PI * r);\r\n\r\n\t\treturn new L.Transformation(scale, 0.5, -scale, 0.5);\r\n\t}())\r\n});\r\n\r\n\r\n/*\r\n * L.TileLayer is used for standard xyz-numbered tile layers.\r\n */\r\n\r\nL.TileLayer = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminZoom: 0,\r\n\t\tmaxZoom: 18,\r\n\t\ttileSize: 256,\r\n\t\tsubdomains: 'abc',\r\n\t\terrorTileUrl: '',\r\n\t\tattribution: '',\r\n\t\tzoomOffset: 0,\r\n\t\topacity: 1,\r\n\t\t/*\r\n\t\tmaxNativeZoom: null,\r\n\t\tzIndex: null,\r\n\t\ttms: false,\r\n\t\tcontinuousWorld: false,\r\n\t\tnoWrap: false,\r\n\t\tzoomReverse: false,\r\n\t\tdetectRetina: false,\r\n\t\treuseTiles: false,\r\n\t\tbounds: false,\r\n\t\t*/\r\n\t\tunloadInvisibleTiles: L.Browser.mobile,\r\n\t\tupdateWhenIdle: L.Browser.mobile\r\n\t},\r\n\r\n\tinitialize: function (url, options) {\r\n\t\toptions = L.setOptions(this, options);\r\n\r\n\t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n\t\tif (options.detectRetina && L.Browser.retina && options.maxZoom > 0) {\r\n\r\n\t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\t\t\toptions.zoomOffset++;\r\n\r\n\t\t\tif (options.minZoom > 0) {\r\n\t\t\t\toptions.minZoom--;\r\n\t\t\t}\r\n\t\t\tthis.options.maxZoom--;\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\toptions.bounds = L.latLngBounds(options.bounds);\r\n\t\t}\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar subdomains = this.options.subdomains;\r\n\r\n\t\tif (typeof subdomains === 'string') {\r\n\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._animated = map._zoomAnimated;\r\n\r\n\t\t// create a container div for tiles\r\n\t\tthis._initContainer();\r\n\r\n\t\t// set up events\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.on({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tthis._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);\r\n\t\t\tmap.on('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t\tthis._update();\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._container.parentNode.removeChild(this._container);\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this._reset,\r\n\t\t\t'moveend': this._update\r\n\t\t}, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.off({\r\n\t\t\t\t'zoomanim': this._animateZoom,\r\n\t\t\t\t'zoomend': this._endZoomAnim\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\tif (!this.options.updateWhenIdle) {\r\n\t\t\tmap.off('move', this._limitedUpdate, this);\r\n\t\t}\r\n\r\n\t\tthis._container = null;\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.appendChild(this._container);\r\n\t\t\tthis._setAutoZIndex(pane, Math.max);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.tilePane;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tpane.insertBefore(this._container, pane.firstChild);\r\n\t\t\tthis._setAutoZIndex(pane, Math.min);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\tthis.options.zIndex = zIndex;\r\n\t\tthis._updateZIndex();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url, noRedraw) {\r\n\t\tthis._url = url;\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateZIndex: function () {\r\n\t\tif (this._container && this.options.zIndex !== undefined) {\r\n\t\t\tthis._container.style.zIndex = this.options.zIndex;\r\n\t\t}\r\n\t},\r\n\r\n\t_setAutoZIndex: function (pane, compare) {\r\n\r\n\t\tvar layers = pane.children,\r\n\t\t    edgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min\r\n\t\t    zIndex, i, len;\r\n\r\n\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\r\n\t\t\tif (layers[i] !== this._container) {\r\n\t\t\t\tzIndex = parseInt(layers[i].style.zIndex, 10);\r\n\r\n\t\t\t\tif (!isNaN(zIndex)) {\r\n\t\t\t\t\tedgeZIndex = compare(edgeZIndex, zIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.options.zIndex = this._container.style.zIndex =\r\n\t\t        (isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tvar i,\r\n\t\t    tiles = this._tiles;\r\n\r\n\t\tif (L.Browser.ielt9) {\r\n\t\t\tfor (i in tiles) {\r\n\t\t\t\tL.DomUtil.setOpacity(tiles[i], this.options.opacity);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tL.DomUtil.setOpacity(this._container, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_initContainer: function () {\r\n\t\tvar tilePane = this._map._panes.tilePane;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-layer');\r\n\r\n\t\t\tthis._updateZIndex();\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\tvar className = 'leaflet-tile-container';\r\n\r\n\t\t\t\tthis._bgBuffer = L.DomUtil.create('div', className, this._container);\r\n\t\t\t\tthis._tileContainer = L.DomUtil.create('div', className, this._container);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._tileContainer = this._container;\r\n\t\t\t}\r\n\r\n\t\t\ttilePane.appendChild(this._container);\r\n\r\n\t\t\tif (this.options.opacity < 1) {\r\n\t\t\t\tthis._updateOpacity();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_reset: function (e) {\r\n\t\tfor (var key in this._tiles) {\r\n\t\t\tthis.fire('tileunload', {tile: this._tiles[key]});\r\n\t\t}\r\n\r\n\t\tthis._tiles = {};\r\n\t\tthis._tilesToLoad = 0;\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tthis._unusedTiles = [];\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.innerHTML = '';\r\n\r\n\t\tif (this._animated && e && e.hard) {\r\n\t\t\tthis._clearBgBuffer();\r\n\t\t}\r\n\r\n\t\tthis._initContainer();\r\n\t},\r\n\r\n\t_getTileSize: function () {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + this.options.zoomOffset,\r\n\t\t    zoomN = this.options.maxNativeZoom,\r\n\t\t    tileSize = this.options.tileSize;\r\n\r\n\t\tif (zoomN && zoom > zoomN) {\r\n\t\t\ttileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);\r\n\t\t}\r\n\r\n\t\treturn tileSize;\r\n\t},\r\n\r\n\t_update: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    bounds = map.getPixelBounds(),\r\n\t\t    zoom = map.getZoom(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar tileBounds = L.bounds(\r\n\t\t        bounds.min.divideBy(tileSize)._floor(),\r\n\t\t        bounds.max.divideBy(tileSize)._floor());\r\n\r\n\t\tthis._addTilesFromCenterOut(tileBounds);\r\n\r\n\t\tif (this.options.unloadInvisibleTiles || this.options.reuseTiles) {\r\n\t\t\tthis._removeOtherTiles(tileBounds);\r\n\t\t}\r\n\t},\r\n\r\n\t_addTilesFromCenterOut: function (bounds) {\r\n\t\tvar queue = [],\r\n\t\t    center = bounds.getCenter();\r\n\r\n\t\tvar j, i, point;\r\n\r\n\t\tfor (j = bounds.min.y; j <= bounds.max.y; j++) {\r\n\t\t\tfor (i = bounds.min.x; i <= bounds.max.x; i++) {\r\n\t\t\t\tpoint = new L.Point(i, j);\r\n\r\n\t\t\t\tif (this._tileShouldBeLoaded(point)) {\r\n\t\t\t\t\tqueue.push(point);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar tilesToLoad = queue.length;\r\n\r\n\t\tif (tilesToLoad === 0) { return; }\r\n\r\n\t\t// load tiles in order of their distance to center\r\n\t\tqueue.sort(function (a, b) {\r\n\t\t\treturn a.distanceTo(center) - b.distanceTo(center);\r\n\t\t});\r\n\r\n\t\tvar fragment = document.createDocumentFragment();\r\n\r\n\t\t// if its the first batch of tiles to load\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('loading');\r\n\t\t}\r\n\r\n\t\tthis._tilesToLoad += tilesToLoad;\r\n\r\n\t\tfor (i = 0; i < tilesToLoad; i++) {\r\n\t\t\tthis._addTile(queue[i], fragment);\r\n\t\t}\r\n\r\n\t\tthis._tileContainer.appendChild(fragment);\r\n\t},\r\n\r\n\t_tileShouldBeLoaded: function (tilePoint) {\r\n\t\tif ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {\r\n\t\t\treturn false; // already loaded\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (!options.continuousWorld) {\r\n\t\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t\t// don't load if exceeds world bounds\r\n\t\t\tif ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||\r\n\t\t\t\ttilePoint.y < 0 || tilePoint.y >= limit.y) { return false; }\r\n\t\t}\r\n\r\n\t\tif (options.bounds) {\r\n\t\t\tvar tileSize = this._getTileSize(),\r\n\t\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\t\t\t    nw = this._map.unproject(nwPoint),\r\n\t\t\t    se = this._map.unproject(sePoint);\r\n\r\n\t\t\t// TODO temporary hack, will be removed after refactoring projections\r\n\t\t\t// https://github.com/Leaflet/Leaflet/issues/1618\r\n\t\t\tif (!options.continuousWorld && !options.noWrap) {\r\n\t\t\t\tnw = nw.wrap();\r\n\t\t\t\tse = se.wrap();\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.bounds.intersects([nw, se])) { return false; }\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_removeOtherTiles: function (bounds) {\r\n\t\tvar kArr, x, y, key;\r\n\r\n\t\tfor (key in this._tiles) {\r\n\t\t\tkArr = key.split(':');\r\n\t\t\tx = parseInt(kArr[0], 10);\r\n\t\t\ty = parseInt(kArr[1], 10);\r\n\r\n\t\t\t// remove tile if it's out of bounds\r\n\t\t\tif (x < bounds.min.x || x > bounds.max.x || y < bounds.min.y || y > bounds.max.y) {\r\n\t\t\t\tthis._removeTile(key);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_removeTile: function (key) {\r\n\t\tvar tile = this._tiles[key];\r\n\r\n\t\tthis.fire('tileunload', {tile: tile, url: tile.src});\r\n\r\n\t\tif (this.options.reuseTiles) {\r\n\t\t\tL.DomUtil.removeClass(tile, 'leaflet-tile-loaded');\r\n\t\t\tthis._unusedTiles.push(tile);\r\n\r\n\t\t} else if (tile.parentNode === this._tileContainer) {\r\n\t\t\tthis._tileContainer.removeChild(tile);\r\n\t\t}\r\n\r\n\t\t// for https://github.com/CloudMade/Leaflet/issues/137\r\n\t\tif (!L.Browser.android) {\r\n\t\t\ttile.onload = null;\r\n\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\t\t}\r\n\r\n\t\tdelete this._tiles[key];\r\n\t},\r\n\r\n\t_addTile: function (tilePoint, container) {\r\n\t\tvar tilePos = this._getTilePos(tilePoint);\r\n\r\n\t\t// get unused tile - or create a new tile\r\n\t\tvar tile = this._getTile();\r\n\r\n\t\t/*\r\n\t\tChrome 20 layouts much faster with top/left (verify with timeline, frames)\r\n\t\tAndroid 4 browser has display issues with top/left and requires transform instead\r\n\t\t(other browsers don't currently care) - see debug/hacks/jitter.html for an example\r\n\t\t*/\r\n\t\tL.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);\r\n\r\n\t\tthis._tiles[tilePoint.x + ':' + tilePoint.y] = tile;\r\n\r\n\t\tthis._loadTile(tile, tilePoint);\r\n\r\n\t\tif (tile.parentNode !== this._tileContainer) {\r\n\t\t\tcontainer.appendChild(tile);\r\n\t\t}\r\n\t},\r\n\r\n\t_getZoomForUrl: function () {\r\n\r\n\t\tvar options = this.options,\r\n\t\t    zoom = this._map.getZoom();\r\n\r\n\t\tif (options.zoomReverse) {\r\n\t\t\tzoom = options.maxZoom - zoom;\r\n\t\t}\r\n\r\n\t\tzoom += options.zoomOffset;\r\n\r\n\t\treturn options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;\r\n\t},\r\n\r\n\t_getTilePos: function (tilePoint) {\r\n\t\tvar origin = this._map.getPixelOrigin(),\r\n\t\t    tileSize = this._getTileSize();\r\n\r\n\t\treturn tilePoint.multiplyBy(tileSize).subtract(origin);\r\n\t},\r\n\r\n\t// image-specific code (override to implement e.g. Canvas or SVG tile layer)\r\n\r\n\tgetTileUrl: function (tilePoint) {\r\n\t\treturn L.Util.template(this._url, L.extend({\r\n\t\t\ts: this._getSubdomain(tilePoint),\r\n\t\t\tz: tilePoint.z,\r\n\t\t\tx: tilePoint.x,\r\n\t\t\ty: tilePoint.y\r\n\t\t}, this.options));\r\n\t},\r\n\r\n\t_getWrapTileNum: function () {\r\n\t\tvar crs = this._map.options.crs,\r\n\t\t    size = crs.getSize(this._map.getZoom());\r\n\t\treturn size.divideBy(this._getTileSize())._floor();\r\n\t},\r\n\r\n\t_adjustTilePoint: function (tilePoint) {\r\n\r\n\t\tvar limit = this._getWrapTileNum();\r\n\r\n\t\t// wrap tile coordinates\r\n\t\tif (!this.options.continuousWorld && !this.options.noWrap) {\r\n\t\t\ttilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;\r\n\t\t}\r\n\r\n\t\tif (this.options.tms) {\r\n\t\t\ttilePoint.y = limit.y - tilePoint.y - 1;\r\n\t\t}\r\n\r\n\t\ttilePoint.z = this._getZoomForUrl();\r\n\t},\r\n\r\n\t_getSubdomain: function (tilePoint) {\r\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n\t\treturn this.options.subdomains[index];\r\n\t},\r\n\r\n\t_getTile: function () {\r\n\t\tif (this.options.reuseTiles && this._unusedTiles.length > 0) {\r\n\t\t\tvar tile = this._unusedTiles.pop();\r\n\t\t\tthis._resetTile(tile);\r\n\t\t\treturn tile;\r\n\t\t}\r\n\t\treturn this._createTile();\r\n\t},\r\n\r\n\t// Override if data stored on a tile needs to be cleaned up before reuse\r\n\t_resetTile: function (/*tile*/) {},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('img', 'leaflet-tile');\r\n\t\ttile.style.width = tile.style.height = this._getTileSize() + 'px';\r\n\t\ttile.galleryimg = 'no';\r\n\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\r\n\t\tif (L.Browser.ielt9 && this.options.opacity !== undefined) {\r\n\t\t\tL.DomUtil.setOpacity(tile, this.options.opacity);\r\n\t\t}\r\n\t\t// without this hack, tiles disappear after zoom on Chrome for Android\r\n\t\t// https://github.com/Leaflet/Leaflet/issues/2078\r\n\t\tif (L.Browser.mobileWebkit3d) {\r\n\t\t\ttile.style.WebkitBackfaceVisibility = 'hidden';\r\n\t\t}\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer  = this;\r\n\t\ttile.onload  = this._tileOnLoad;\r\n\t\ttile.onerror = this._tileOnError;\r\n\r\n\t\tthis._adjustTilePoint(tilePoint);\r\n\t\ttile.src     = this.getTileUrl(tilePoint);\r\n\r\n\t\tthis.fire('tileloadstart', {\r\n\t\t\ttile: tile,\r\n\t\t\turl: tile.src\r\n\t\t});\r\n\t},\r\n\r\n\t_tileLoaded: function () {\r\n\t\tthis._tilesToLoad--;\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tL.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');\r\n\t\t}\r\n\r\n\t\tif (!this._tilesToLoad) {\r\n\t\t\tthis.fire('load');\r\n\r\n\t\t\tif (this._animated) {\r\n\t\t\t\t// clear scaled tiles after all new tiles are loaded (for performance)\r\n\t\t\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t\t\t\tthis._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_tileOnLoad: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\t//Only if we are loading an actual image\r\n\t\tif (this.src !== L.Util.emptyImageUrl) {\r\n\t\t\tL.DomUtil.addClass(this, 'leaflet-tile-loaded');\r\n\r\n\t\t\tlayer.fire('tileload', {\r\n\t\t\t\ttile: this,\r\n\t\t\t\turl: this.src\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t},\r\n\r\n\t_tileOnError: function () {\r\n\t\tvar layer = this._layer;\r\n\r\n\t\tlayer.fire('tileerror', {\r\n\t\t\ttile: this,\r\n\t\t\turl: this.src\r\n\t\t});\r\n\r\n\t\tvar newUrl = layer.options.errorTileUrl;\r\n\t\tif (newUrl) {\r\n\t\t\tthis.src = newUrl;\r\n\t\t}\r\n\r\n\t\tlayer._tileLoaded();\r\n\t}\r\n});\r\n\r\nL.tileLayer = function (url, options) {\r\n\treturn new L.TileLayer(url, options);\r\n};\r\n\r\n\r\n/*\r\n * L.TileLayer.WMS is used for putting WMS tile layers on the map.\r\n */\r\n\r\nL.TileLayer.WMS = L.TileLayer.extend({\r\n\r\n\tdefaultWmsParams: {\r\n\t\tservice: 'WMS',\r\n\t\trequest: 'GetMap',\r\n\t\tversion: '1.1.1',\r\n\t\tlayers: '',\r\n\t\tstyles: '',\r\n\t\tformat: 'image/jpeg',\r\n\t\ttransparent: false\r\n\t},\r\n\r\n\tinitialize: function (url, options) { // (String, Object)\r\n\r\n\t\tthis._url = url;\r\n\r\n\t\tvar wmsParams = L.extend({}, this.defaultWmsParams),\r\n\t\t    tileSize = options.tileSize || this.options.tileSize;\r\n\r\n\t\tif (options.detectRetina && L.Browser.retina) {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize * 2;\r\n\t\t} else {\r\n\t\t\twmsParams.width = wmsParams.height = tileSize;\r\n\t\t}\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\tif (!this.options.hasOwnProperty(i) && i !== 'crs') {\r\n\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\r\n\t\tthis._crs = this.options.crs || map.options.crs;\r\n\r\n\t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n\t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n\t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n\t\tL.TileLayer.prototype.onAdd.call(this, map);\r\n\t},\r\n\r\n\tgetTileUrl: function (tilePoint) { // (Point, Number) -> String\r\n\r\n\t\tvar map = this._map,\r\n\t\t    tileSize = this.options.tileSize,\r\n\r\n\t\t    nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t    sePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t    nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\r\n\t\t    se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\r\n\t\t    bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ?\r\n\t\t        [se.y, nw.x, nw.y, se.x].join(',') :\r\n\t\t        [nw.x, se.y, se.x, nw.y].join(','),\r\n\r\n\t\t    url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\r\n\r\n\t\treturn url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;\r\n\t},\r\n\r\n\tsetParams: function (params, noRedraw) {\r\n\r\n\t\tL.extend(this.wmsParams, params);\r\n\r\n\t\tif (!noRedraw) {\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.tileLayer.wms = function (url, options) {\r\n\treturn new L.TileLayer.WMS(url, options);\r\n};\r\n\r\n\r\n/*\r\n * L.TileLayer.Canvas is a class that you can use as a base for creating\r\n * dynamically drawn Canvas-based tile layers.\r\n */\r\n\r\nL.TileLayer.Canvas = L.TileLayer.extend({\r\n\toptions: {\r\n\t\tasync: false\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._reset({hard: true});\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tfor (var i in this._tiles) {\r\n\t\t\tthis._redrawTile(this._tiles[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_redrawTile: function (tile) {\r\n\t\tthis.drawTile(tile, tile._tilePoint, this._map._zoom);\r\n\t},\r\n\r\n\t_createTile: function () {\r\n\t\tvar tile = L.DomUtil.create('canvas', 'leaflet-tile');\r\n\t\ttile.width = tile.height = this.options.tileSize;\r\n\t\ttile.onselectstart = tile.onmousemove = L.Util.falseFn;\r\n\t\treturn tile;\r\n\t},\r\n\r\n\t_loadTile: function (tile, tilePoint) {\r\n\t\ttile._layer = this;\r\n\t\ttile._tilePoint = tilePoint;\r\n\r\n\t\tthis._redrawTile(tile);\r\n\r\n\t\tif (!this.options.async) {\r\n\t\t\tthis.tileDrawn(tile);\r\n\t\t}\r\n\t},\r\n\r\n\tdrawTile: function (/*tile, tilePoint*/) {\r\n\t\t// override with rendering code\r\n\t},\r\n\r\n\ttileDrawn: function (tile) {\r\n\t\tthis._tileOnLoad.call(tile);\r\n\t}\r\n});\r\n\r\n\r\nL.tileLayer.canvas = function (options) {\r\n\treturn new L.TileLayer.Canvas(options);\r\n};\r\n\r\n\r\n/*\r\n * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).\r\n */\r\n\r\nL.ImageOverlay = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\topacity: 1\r\n\t},\r\n\r\n\tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n\t\tthis._url = url;\r\n\t\tthis._bounds = L.latLngBounds(bounds);\r\n\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._image) {\r\n\t\t\tthis._initImage();\r\n\t\t}\r\n\r\n\t\tmap._panes.overlayPane.appendChild(this._image);\r\n\r\n\t\tmap.on('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\r\n\t\tthis._reset();\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.getPanes().overlayPane.removeChild(this._image);\r\n\r\n\t\tmap.off('viewreset', this._reset, this);\r\n\r\n\t\tif (map.options.zoomAnimation) {\r\n\t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tthis._updateOpacity();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// TODO remove bringToFront/bringToBack duplication from TileLayer/Path\r\n\tbringToFront: function () {\r\n\t\tif (this._image) {\r\n\t\t\tthis._map._panes.overlayPane.appendChild(this._image);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar pane = this._map._panes.overlayPane;\r\n\t\tif (this._image) {\r\n\t\t\tpane.insertBefore(this._image, pane.firstChild);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetUrl: function (url) {\r\n\t\tthis._url = url;\r\n\t\tthis._image.src = this._url;\r\n\t},\r\n\r\n\tgetAttribution: function () {\r\n\t\treturn this.options.attribution;\r\n\t},\r\n\r\n\t_initImage: function () {\r\n\t\tthis._image = L.DomUtil.create('img', 'leaflet-image-layer');\r\n\r\n\t\tif (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-animated');\r\n\t\t} else {\r\n\t\t\tL.DomUtil.addClass(this._image, 'leaflet-zoom-hide');\r\n\t\t}\r\n\r\n\t\tthis._updateOpacity();\r\n\r\n\t\t//TODO createImage util method to remove duplication\r\n\t\tL.extend(this._image, {\r\n\t\t\tgalleryimg: 'no',\r\n\t\t\tonselectstart: L.Util.falseFn,\r\n\t\t\tonmousemove: L.Util.falseFn,\r\n\t\t\tonload: L.bind(this._onImageLoad, this),\r\n\t\t\tsrc: this._url\r\n\t\t});\r\n\t},\r\n\r\n\t_animateZoom: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    image = this._image,\r\n\t\t    scale = map.getZoomScale(e.zoom),\r\n\t\t    nw = this._bounds.getNorthWest(),\r\n\t\t    se = this._bounds.getSouthEast(),\r\n\r\n\t\t    topLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),\r\n\t\t    size = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),\r\n\t\t    origin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));\r\n\r\n\t\timage.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';\r\n\t},\r\n\r\n\t_reset: function () {\r\n\t\tvar image   = this._image,\r\n\t\t    topLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n\t\t    size = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);\r\n\r\n\t\tL.DomUtil.setPosition(image, topLeft);\r\n\r\n\t\timage.style.width  = size.x + 'px';\r\n\t\timage.style.height = size.y + 'px';\r\n\t},\r\n\r\n\t_onImageLoad: function () {\r\n\t\tthis.fire('load');\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._image, this.options.opacity);\r\n\t}\r\n});\r\n\r\nL.imageOverlay = function (url, bounds, options) {\r\n\treturn new L.ImageOverlay(url, bounds, options);\r\n};\r\n\r\n\r\n/*\r\n * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.\r\n */\r\n\r\nL.Icon = L.Class.extend({\r\n\toptions: {\r\n\t\t/*\r\n\t\ticonUrl: (String) (required)\r\n\t\ticonRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\ticonSize: (Point) (can be set through CSS)\r\n\t\ticonAnchor: (Point) (centered by default, can be set in CSS with negative margins)\r\n\t\tpopupAnchor: (Point) (if not specified, popup opens in the anchor point)\r\n\t\tshadowUrl: (String) (no shadow by default)\r\n\t\tshadowRetinaUrl: (String) (optional, used for retina devices if detected)\r\n\t\tshadowSize: (Point)\r\n\t\tshadowAnchor: (Point)\r\n\t\t*/\r\n\t\tclassName: ''\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\treturn this._createIcon('icon', oldIcon);\r\n\t},\r\n\r\n\tcreateShadow: function (oldIcon) {\r\n\t\treturn this._createIcon('shadow', oldIcon);\r\n\t},\r\n\r\n\t_createIcon: function (name, oldIcon) {\r\n\t\tvar src = this._getIconUrl(name);\r\n\r\n\t\tif (!src) {\r\n\t\t\tif (name === 'icon') {\r\n\t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar img;\r\n\t\tif (!oldIcon || oldIcon.tagName !== 'IMG') {\r\n\t\t\timg = this._createImg(src);\r\n\t\t} else {\r\n\t\t\timg = this._createImg(src, oldIcon);\r\n\t\t}\r\n\t\tthis._setIconStyles(img, name);\r\n\r\n\t\treturn img;\r\n\t},\r\n\r\n\t_setIconStyles: function (img, name) {\r\n\t\tvar options = this.options,\r\n\t\t    size = L.point(options[name + 'Size']),\r\n\t\t    anchor;\r\n\r\n\t\tif (name === 'shadow') {\r\n\t\t\tanchor = L.point(options.shadowAnchor || options.iconAnchor);\r\n\t\t} else {\r\n\t\t\tanchor = L.point(options.iconAnchor);\r\n\t\t}\r\n\r\n\t\tif (!anchor && size) {\r\n\t\t\tanchor = size.divideBy(2, true);\r\n\t\t}\r\n\r\n\t\timg.className = 'leaflet-marker-' + name + ' ' + options.className;\r\n\r\n\t\tif (anchor) {\r\n\t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n\t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n\t\t}\r\n\r\n\t\tif (size) {\r\n\t\t\timg.style.width  = size.x + 'px';\r\n\t\t\timg.style.height = size.y + 'px';\r\n\t\t}\r\n\t},\r\n\r\n\t_createImg: function (src, el) {\r\n\t\tel = el || document.createElement('img');\r\n\t\tel.src = src;\r\n\t\treturn el;\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tif (L.Browser.retina && this.options[name + 'RetinaUrl']) {\r\n\t\t\treturn this.options[name + 'RetinaUrl'];\r\n\t\t}\r\n\t\treturn this.options[name + 'Url'];\r\n\t}\r\n});\r\n\r\nL.icon = function (options) {\r\n\treturn new L.Icon(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Icon.Default is the blue marker icon used by default in Leaflet.\r\n */\r\n\r\nL.Icon.Default = L.Icon.extend({\r\n\r\n\toptions: {\r\n\t\ticonSize: [25, 41],\r\n\t\ticonAnchor: [12, 41],\r\n\t\tpopupAnchor: [1, -34],\r\n\r\n\t\tshadowSize: [41, 41]\r\n\t},\r\n\r\n\t_getIconUrl: function (name) {\r\n\t\tvar key = name + 'Url';\r\n\r\n\t\tif (this.options[key]) {\r\n\t\t\treturn this.options[key];\r\n\t\t}\r\n\r\n\t\tif (L.Browser.retina && name === 'icon') {\r\n\t\t\tname += '-2x';\r\n\t\t}\r\n\r\n\t\tvar path = L.Icon.Default.imagePath;\r\n\r\n\t\tif (!path) {\r\n\t\t\tthrow new Error('Couldn\\'t autodetect L.Icon.Default.imagePath, set it manually.');\r\n\t\t}\r\n\r\n\t\treturn path + '/marker-' + name + '.png';\r\n\t}\r\n});\r\n\r\nL.Icon.Default.imagePath = (function () {\r\n\tvar scripts = document.getElementsByTagName('script'),\r\n\t    leafletRe = /[\\/^]leaflet[\\-\\._]?([\\w\\-\\._]*)\\.js\\??/;\r\n\r\n\tvar i, len, src, matches, path;\r\n\r\n\tfor (i = 0, len = scripts.length; i < len; i++) {\r\n\t\tsrc = scripts[i].src;\r\n\t\tmatches = src.match(leafletRe);\r\n\r\n\t\tif (matches) {\r\n\t\t\tpath = src.split(leafletRe)[0];\r\n\t\t\treturn (path ? path + '/' : '') + 'images';\r\n\t\t}\r\n\t}\r\n}());\r\n\r\n\r\n/*\r\n * L.Marker is used to display clickable/draggable icons on the map.\r\n */\r\n\r\nL.Marker = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\ticon: new L.Icon.Default(),\r\n\t\ttitle: '',\r\n\t\talt: '',\r\n\t\tclickable: true,\r\n\t\tdraggable: false,\r\n\t\tkeyboard: true,\r\n\t\tzIndexOffset: 0,\r\n\t\topacity: 1,\r\n\t\triseOnHover: false,\r\n\t\triseOffset: 250\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.setOptions(this, options);\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tmap.on('viewreset', this.update, this);\r\n\r\n\t\tthis._initIcon();\r\n\t\tthis.update();\r\n\t\tthis.fire('add');\r\n\r\n\t\tif (map.options.zoomAnimation && map.options.markerZoomAnimation) {\r\n\t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tif (this.dragging) {\r\n\t\t\tthis.dragging.disable();\r\n\t\t}\r\n\r\n\t\tthis._removeIcon();\r\n\t\tthis._removeShadow();\r\n\r\n\t\tthis.fire('remove');\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.update,\r\n\t\t\t'zoomanim': this._animateZoom\r\n\t\t}, this);\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\r\n\t\tthis.update();\r\n\r\n\t\treturn this.fire('move', { latlng: this._latlng });\r\n\t},\r\n\r\n\tsetZIndexOffset: function (offset) {\r\n\t\tthis.options.zIndexOffset = offset;\r\n\t\tthis.update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetIcon: function (icon) {\r\n\r\n\t\tthis.options.icon = icon;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._initIcon();\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tif (this._popup) {\r\n\t\t\tthis.bindPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (this._icon) {\r\n\t\t\tthis._setPos(this._map.latLngToLayerPoint(this._latlng).round());\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initIcon: function () {\r\n\t\tvar options = this.options,\r\n\t\t    map = this._map,\r\n\t\t    animation = (map.options.zoomAnimation && map.options.markerZoomAnimation),\r\n\t\t    classToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';\r\n\r\n\t\tvar icon = options.icon.createIcon(this._icon),\r\n\t\t\taddIcon = false;\r\n\r\n\t\t// if we're not reusing the icon, remove the old one and init new one\r\n\t\tif (icon !== this._icon) {\r\n\t\t\tif (this._icon) {\r\n\t\t\t\tthis._removeIcon();\r\n\t\t\t}\r\n\t\t\taddIcon = true;\r\n\r\n\t\t\tif (options.title) {\r\n\t\t\t\ticon.title = options.title;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.alt) {\r\n\t\t\t\ticon.alt = options.alt;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tL.DomUtil.addClass(icon, classToAdd);\r\n\r\n\t\tif (options.keyboard) {\r\n\t\t\ticon.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tthis._icon = icon;\r\n\r\n\t\tthis._initInteraction();\r\n\r\n\t\tif (options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.on(icon, 'mouseover', this._bringToFront, this)\r\n\t\t\t\t.on(icon, 'mouseout', this._resetZIndex, this);\r\n\t\t}\r\n\r\n\t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n\t\t\taddShadow = false;\r\n\r\n\t\tif (newShadow !== this._shadow) {\r\n\t\t\tthis._removeShadow();\r\n\t\t\taddShadow = true;\r\n\t\t}\r\n\r\n\t\tif (newShadow) {\r\n\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\r\n\t\t}\r\n\t\tthis._shadow = newShadow;\r\n\r\n\r\n\t\tif (options.opacity < 1) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\r\n\t\tvar panes = this._map._panes;\r\n\r\n\t\tif (addIcon) {\r\n\t\t\tpanes.markerPane.appendChild(this._icon);\r\n\t\t}\r\n\r\n\t\tif (newShadow && addShadow) {\r\n\t\t\tpanes.shadowPane.appendChild(this._shadow);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeIcon: function () {\r\n\t\tif (this.options.riseOnHover) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(this._icon, 'mouseover', this._bringToFront)\r\n\t\t\t    .off(this._icon, 'mouseout', this._resetZIndex);\r\n\t\t}\r\n\r\n\t\tthis._map._panes.markerPane.removeChild(this._icon);\r\n\r\n\t\tthis._icon = null;\r\n\t},\r\n\r\n\t_removeShadow: function () {\r\n\t\tif (this._shadow) {\r\n\t\t\tthis._map._panes.shadowPane.removeChild(this._shadow);\r\n\t\t}\r\n\t\tthis._shadow = null;\r\n\t},\r\n\r\n\t_setPos: function (pos) {\r\n\t\tL.DomUtil.setPosition(this._icon, pos);\r\n\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setPosition(this._shadow, pos);\r\n\t\t}\r\n\r\n\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n\t\tthis._resetZIndex();\r\n\t},\r\n\r\n\t_updateZIndex: function (offset) {\r\n\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n\t},\r\n\r\n\t_animateZoom: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\tthis._setPos(pos);\r\n\t},\r\n\r\n\t_initInteraction: function () {\r\n\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\t// TODO refactor into something shared with Map/Path/etc. to DRY it up\r\n\r\n\t\tvar icon = this._icon,\r\n\t\t    events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.addClass(icon, 'leaflet-clickable');\r\n\t\tL.DomEvent.on(icon, 'click', this._onMouseClick, this);\r\n\t\tL.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.on(icon, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\r\n\t\tif (L.Handler.MarkerDrag) {\r\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\r\n\r\n\t\t\tif (this.options.draggable) {\r\n\t\t\t\tthis.dragging.enable();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tvar wasDragged = this.dragging && this.dragging.moved();\r\n\r\n\t\tif (this.hasEventListeners(e.type) || wasDragged) {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\r\n\t\tif (wasDragged) { return; }\r\n\r\n\t\tif ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyPress: function (e) {\r\n\t\tif (e.keyCode === 13) {\r\n\t\t\tthis.fire('click', {\r\n\t\t\t\toriginalEvent: e,\r\n\t\t\t\tlatlng: this._latlng\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e,\r\n\t\t\tlatlng: this._latlng\r\n\t\t});\r\n\r\n\t\t// TODO proper custom event propagation\r\n\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousedown') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateOpacity();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_updateOpacity: function () {\r\n\t\tL.DomUtil.setOpacity(this._icon, this.options.opacity);\r\n\t\tif (this._shadow) {\r\n\t\t\tL.DomUtil.setOpacity(this._shadow, this.options.opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_bringToFront: function () {\r\n\t\tthis._updateZIndex(this.options.riseOffset);\r\n\t},\r\n\r\n\t_resetZIndex: function () {\r\n\t\tthis._updateZIndex(0);\r\n\t}\r\n});\r\n\r\nL.marker = function (latlng, options) {\r\n\treturn new L.Marker(latlng, options);\r\n};\r\n\r\n\r\n/*\r\n * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)\r\n * to use with L.Marker.\r\n */\r\n\r\nL.DivIcon = L.Icon.extend({\r\n\toptions: {\r\n\t\ticonSize: [12, 12], // also can be set through CSS\r\n\t\t/*\r\n\t\ticonAnchor: (Point)\r\n\t\tpopupAnchor: (Point)\r\n\t\thtml: (String)\r\n\t\tbgPos: (Point)\r\n\t\t*/\r\n\t\tclassName: 'leaflet-div-icon',\r\n\t\thtml: false\r\n\t},\r\n\r\n\tcreateIcon: function (oldIcon) {\r\n\t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\r\n\t\t    options = this.options;\r\n\r\n\t\tif (options.html !== false) {\r\n\t\t\tdiv.innerHTML = options.html;\r\n\t\t} else {\r\n\t\t\tdiv.innerHTML = '';\r\n\t\t}\r\n\r\n\t\tif (options.bgPos) {\r\n\t\t\tdiv.style.backgroundPosition =\r\n\t\t\t        (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\r\n\t\t}\r\n\r\n\t\tthis._setIconStyles(div, 'icon');\r\n\t\treturn div;\r\n\t},\r\n\r\n\tcreateShadow: function () {\r\n\t\treturn null;\r\n\t}\r\n});\r\n\r\nL.divIcon = function (options) {\r\n\treturn new L.DivIcon(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Popup is used for displaying popups on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tclosePopupOnClick: true\r\n});\r\n\r\nL.Popup = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tminWidth: 50,\r\n\t\tmaxWidth: 300,\r\n\t\t// maxHeight: null,\r\n\t\tautoPan: true,\r\n\t\tcloseButton: true,\r\n\t\toffset: [0, 7],\r\n\t\tautoPanPadding: [5, 5],\r\n\t\t// autoPanPaddingTopLeft: null,\r\n\t\t// autoPanPaddingBottomRight: null,\r\n\t\tkeepInView: false,\r\n\t\tclassName: '',\r\n\t\tzoomAnimation: true\r\n\t},\r\n\r\n\tinitialize: function (options, source) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._source = source;\r\n\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\tthis._isOpen = false;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initLayout();\r\n\t\t}\r\n\r\n\t\tvar animFade = map.options.fadeAnimation;\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\t\tmap._panes.popupPane.appendChild(this._container);\r\n\r\n\t\tmap.on(this._getEvents(), this);\r\n\r\n\t\tthis.update();\r\n\r\n\t\tif (animFade) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 1);\r\n\t\t}\r\n\r\n\t\tthis.fire('open');\r\n\r\n\t\tmap.fire('popupopen', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupopen', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenOn: function (map) {\r\n\t\tmap.openPopup(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._panes.popupPane.removeChild(this._container);\r\n\r\n\t\tL.Util.falseFn(this._container.offsetWidth); // force reflow\r\n\r\n\t\tmap.off(this._getEvents(), this);\r\n\r\n\t\tif (map.options.fadeAnimation) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, 0);\r\n\t\t}\r\n\r\n\t\tthis._map = null;\r\n\r\n\t\tthis.fire('close');\r\n\r\n\t\tmap.fire('popupclose', {popup: this});\r\n\r\n\t\tif (this._source) {\r\n\t\t\tthis._source.fire('popupclose', {popup: this});\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tif (this._map) {\r\n\t\t\tthis._updatePosition();\r\n\t\t\tthis._adjustPan();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContent: function () {\r\n\t\treturn this._content;\r\n\t},\r\n\r\n\tsetContent: function (content) {\r\n\t\tthis._content = content;\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdate: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\tthis._updateContent();\r\n\t\tthis._updateLayout();\r\n\t\tthis._updatePosition();\r\n\r\n\t\tthis._container.style.visibility = '';\r\n\r\n\t\tthis._adjustPan();\r\n\t},\r\n\r\n\t_getEvents: function () {\r\n\t\tvar events = {\r\n\t\t\tviewreset: this._updatePosition\r\n\t\t};\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tevents.zoomanim = this._zoomAnimation;\r\n\t\t}\r\n\t\tif ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n\t\t\tevents.preclick = this._close;\r\n\t\t}\r\n\t\tif (this.options.keepInView) {\r\n\t\t\tevents.moveend = this._adjustPan;\r\n\t\t}\r\n\r\n\t\treturn events;\r\n\t},\r\n\r\n\t_close: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.closePopup(this);\r\n\t\t}\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t\tcontainerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +\r\n\t\t\t        (this._animated ? 'animated' : 'hide'),\r\n\t\t\tcontainer = this._container = L.DomUtil.create('div', containerClass),\r\n\t\t\tcloseButton;\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tcloseButton = this._closeButton =\r\n\t\t\t        L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '&#215;';\r\n\t\t\tL.DomEvent.disableClickPropagation(closeButton);\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);\r\n\t\t}\r\n\r\n\t\tvar wrapper = this._wrapper =\r\n\t\t        L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tL.DomEvent.disableClickPropagation(wrapper);\r\n\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\t},\r\n\r\n\t_updateContent: function () {\r\n\t\tif (!this._content) { return; }\r\n\r\n\t\tif (typeof this._content === 'string') {\r\n\t\t\tthis._contentNode.innerHTML = this._content;\r\n\t\t} else {\r\n\t\t\twhile (this._contentNode.hasChildNodes()) {\r\n\t\t\t\tthis._contentNode.removeChild(this._contentNode.firstChild);\r\n\t\t\t}\r\n\t\t\tthis._contentNode.appendChild(this._content);\r\n\t\t}\r\n\t\tthis.fire('contentupdate');\r\n\t},\r\n\r\n\t_updateLayout: function () {\r\n\t\tvar container = this._contentNode,\r\n\t\t    style = container.style;\r\n\r\n\t\tstyle.width = '';\r\n\t\tstyle.whiteSpace = 'nowrap';\r\n\r\n\t\tvar width = container.offsetWidth;\r\n\t\twidth = Math.min(width, this.options.maxWidth);\r\n\t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n\t\tstyle.width = (width + 1) + 'px';\r\n\t\tstyle.whiteSpace = '';\r\n\r\n\t\tstyle.height = '';\r\n\r\n\t\tvar height = container.offsetHeight,\r\n\t\t    maxHeight = this.options.maxHeight,\r\n\t\t    scrolledClass = 'leaflet-popup-scrolled';\r\n\r\n\t\tif (maxHeight && height > maxHeight) {\r\n\t\t\tstyle.height = maxHeight + 'px';\r\n\t\t\tL.DomUtil.addClass(container, scrolledClass);\r\n\t\t} else {\r\n\t\t\tL.DomUtil.removeClass(container, scrolledClass);\r\n\t\t}\r\n\r\n\t\tthis._containerWidth = this._container.offsetWidth;\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t\t    animated = this._animated,\r\n\t\t    offset = L.point(this.options.offset);\r\n\r\n\t\tif (animated) {\r\n\t\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t\t}\r\n\r\n\t\tthis._containerBottom = -offset.y - (animated ? 0 : pos.y);\r\n\t\tthis._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);\r\n\r\n\t\t// bottom position the popup in case the height of the popup changes (images loading etc)\r\n\t\tthis._container.style.bottom = this._containerBottom + 'px';\r\n\t\tthis._container.style.left = this._containerLeft + 'px';\r\n\t},\r\n\r\n\t_zoomAnimation: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);\r\n\r\n\t\tL.DomUtil.setPosition(this._container, pos);\r\n\t},\r\n\r\n\t_adjustPan: function () {\r\n\t\tif (!this.options.autoPan) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerHeight = this._container.offsetHeight,\r\n\t\t    containerWidth = this._containerWidth,\r\n\r\n\t\t    layerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tlayerPos._add(L.DomUtil.getPosition(this._container));\r\n\t\t}\r\n\r\n\t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t\t    size = map.getSize(),\r\n\t\t    dx = 0,\r\n\t\t    dy = 0;\r\n\r\n\t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n\t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n\t\t}\r\n\t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n\t\t\tdx = containerPos.x - paddingTL.x;\r\n\t\t}\r\n\t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n\t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n\t\t}\r\n\t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n\t\t\tdy = containerPos.y - paddingTL.y;\r\n\t\t}\r\n\r\n\t\tif (dx || dy) {\r\n\t\t\tmap\r\n\t\t\t    .fire('autopanstart')\r\n\t\t\t    .panBy([dx, dy]);\r\n\t\t}\r\n\t},\r\n\r\n\t_onCloseButtonClick: function (e) {\r\n\t\tthis._close();\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.popup = function (options, source) {\r\n\treturn new L.Popup(options, source);\r\n};\r\n\r\n\r\nL.Map.include({\r\n\topenPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])\r\n\t\tthis.closePopup();\r\n\r\n\t\tif (!(popup instanceof L.Popup)) {\r\n\t\t\tvar content = popup;\r\n\r\n\t\t\tpopup = new L.Popup(options)\r\n\t\t\t    .setLatLng(latlng)\r\n\t\t\t    .setContent(content);\r\n\t\t}\r\n\t\tpopup._isOpen = true;\r\n\r\n\t\tthis._popup = popup;\r\n\t\treturn this.addLayer(popup);\r\n\t},\r\n\r\n\tclosePopup: function (popup) {\r\n\t\tif (!popup || popup === this._popup) {\r\n\t\t\tpopup = this._popup;\r\n\t\t\tthis._popup = null;\r\n\t\t}\r\n\t\tif (popup) {\r\n\t\t\tthis.removeLayer(popup);\r\n\t\t\tpopup._isOpen = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Popup extension to L.Marker, adding popup-related methods.\r\n */\r\n\r\nL.Marker.include({\r\n\topenPopup: function () {\r\n\t\tif (this._popup && this._map && !this._map.hasLayer(this._popup)) {\r\n\t\t\tthis._popup.setLatLng(this._latlng);\r\n\t\t\tthis._map.openPopup(this._popup);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\ttogglePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tif (this._popup._isOpen) {\r\n\t\t\t\tthis.closePopup();\r\n\t\t\t} else {\r\n\t\t\t\tthis.openPopup();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tvar anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);\r\n\r\n\t\tanchor = anchor.add(L.Popup.prototype.options.offset);\r\n\r\n\t\tif (options && options.offset) {\r\n\t\t\tanchor = anchor.add(options.offset);\r\n\t\t}\r\n\r\n\t\toptions = L.extend({offset: anchor}, options);\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this.togglePopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this)\r\n\t\t\t    .on('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tL.setOptions(content, options);\r\n\t\t\tthis._popup = content;\r\n\t\t\tcontent._source = this;\r\n\t\t} else {\r\n\t\t\tthis._popup = new L.Popup(options, this)\r\n\t\t\t\t.setContent(content);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetPopupContent: function (content) {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this.togglePopup, this)\r\n\t\t\t    .off('remove', this.closePopup, this)\r\n\t\t\t    .off('move', this._movePopup, this);\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPopup: function () {\r\n\t\treturn this._popup;\r\n\t},\r\n\r\n\t_movePopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.LayerGroup is a class to combine several layers into one so that\r\n * you can manipulate the group (e.g. add/remove it) as one layer.\r\n */\r\n\r\nL.LayerGroup = L.Class.extend({\r\n\tinitialize: function (layers) {\r\n\t\tthis._layers = {};\r\n\r\n\t\tvar i, len;\r\n\r\n\t\tif (layers) {\r\n\t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n\t\t\t\tthis.addLayer(layers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tvar id = this.getLayerId(layer);\r\n\r\n\t\tthis._layers[id] = layer;\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.addLayer(layer);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n\t\tif (this._map && this._layers[id]) {\r\n\t\t\tthis._map.removeLayer(this._layers[id]);\r\n\t\t}\r\n\r\n\t\tdelete this._layers[id];\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thasLayer: function (layer) {\r\n\t\tif (!layer) { return false; }\r\n\r\n\t\treturn (layer in this._layers || this.getLayerId(layer) in this._layers);\r\n\t},\r\n\r\n\tclearLayers: function () {\r\n\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tinvoke: function (methodName) {\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n\t\t    i, layer;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tlayer = this._layers[i];\r\n\r\n\t\t\tif (layer[methodName]) {\r\n\t\t\t\tlayer[methodName].apply(layer, args);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis.eachLayer(map.addLayer, map);\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis.eachLayer(map.removeLayer, map);\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\teachLayer: function (method, context) {\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tmethod.call(context, this._layers[i]);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetLayer: function (id) {\r\n\t\treturn this._layers[id];\r\n\t},\r\n\r\n\tgetLayers: function () {\r\n\t\tvar layers = [];\r\n\r\n\t\tfor (var i in this._layers) {\r\n\t\t\tlayers.push(this._layers[i]);\r\n\t\t}\r\n\t\treturn layers;\r\n\t},\r\n\r\n\tsetZIndex: function (zIndex) {\r\n\t\treturn this.invoke('setZIndex', zIndex);\r\n\t},\r\n\r\n\tgetLayerId: function (layer) {\r\n\t\treturn L.stamp(layer);\r\n\t}\r\n});\r\n\r\nL.layerGroup = function (layers) {\r\n\treturn new L.LayerGroup(layers);\r\n};\r\n\r\n\r\n/*\r\n * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods\r\n * shared between a group of interactive layers (like vectors or markers).\r\n */\r\n\r\nL.FeatureGroup = L.LayerGroup.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tEVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\r\n\t},\r\n\r\n\taddLayer: function (layer) {\r\n\t\tif (this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif ('on' in layer) {\r\n\t\t\tlayer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent && layer.bindPopup) {\r\n\t\t\tlayer.bindPopup(this._popupContent, this._popupOptions);\r\n\t\t}\r\n\r\n\t\treturn this.fire('layeradd', {layer: layer});\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tif (!this.hasLayer(layer)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif (layer in this._layers) {\r\n\t\t\tlayer = this._layers[layer];\r\n\t\t}\r\n\r\n\t\tif ('off' in layer) {\r\n\t\t\tlayer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);\r\n\t\t}\r\n\r\n\t\tL.LayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n\t\tif (this._popupContent) {\r\n\t\t\tthis.invoke('unbindPopup');\r\n\t\t}\r\n\r\n\t\treturn this.fire('layerremove', {layer: layer});\r\n\t},\r\n\r\n\tbindPopup: function (content, options) {\r\n\t\tthis._popupContent = content;\r\n\t\tthis._popupOptions = options;\r\n\t\treturn this.invoke('bindPopup', content, options);\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\t\t// open popup on the first layer\r\n\t\tfor (var id in this._layers) {\r\n\t\t\tthis._layers[id].openPopup(latlng);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\treturn this.invoke('setStyle', style);\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\treturn this.invoke('bringToFront');\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\treturn this.invoke('bringToBack');\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar bounds = new L.LatLngBounds();\r\n\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tbounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());\r\n\t\t});\r\n\r\n\t\treturn bounds;\r\n\t},\r\n\r\n\t_propagateEvent: function (e) {\r\n\t\te = L.extend({\r\n\t\t\tlayer: e.target,\r\n\t\t\ttarget: this\r\n\t\t}, e);\r\n\t\tthis.fire(e.type, e);\r\n\t}\r\n});\r\n\r\nL.featureGroup = function (layers) {\r\n\treturn new L.FeatureGroup(layers);\r\n};\r\n\r\n\r\n/*\r\n * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.\r\n */\r\n\r\nL.Path = L.Class.extend({\r\n\tincludes: [L.Mixin.Events],\r\n\r\n\tstatics: {\r\n\t\t// how much to extend the clip area around the map view\r\n\t\t// (relative to its size, e.g. 0.5 is half the screen in each direction)\r\n\t\t// set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)\r\n\t\tCLIP_PADDING: (function () {\r\n\t\t\tvar max = L.Browser.mobile ? 1280 : 2000,\r\n\t\t\t    target = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;\r\n\t\t\treturn Math.max(0, Math.min(0.5, target));\r\n\t\t})()\r\n\t},\r\n\r\n\toptions: {\r\n\t\tstroke: true,\r\n\t\tcolor: '#0033ff',\r\n\t\tdashArray: null,\r\n\t\tlineCap: null,\r\n\t\tlineJoin: null,\r\n\t\tweight: 5,\r\n\t\topacity: 0.5,\r\n\r\n\t\tfill: false,\r\n\t\tfillColor: null, //same as color by default\r\n\t\tfillOpacity: 0.2,\r\n\r\n\t\tclickable: true\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initElements();\r\n\t\t\tthis._initEvents();\r\n\t\t}\r\n\r\n\t\tthis.projectLatlngs();\r\n\t\tthis._updatePath();\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._map._pathRoot.appendChild(this._container);\r\n\t\t}\r\n\r\n\t\tthis.fire('add');\r\n\r\n\t\tmap.on({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tmap.addLayer(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap._pathRoot.removeChild(this._container);\r\n\r\n\t\t// Need to fire remove event before we set _map to null as the event hooks might need the object\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\r\n\t\tif (L.Browser.vml) {\r\n\t\t\tthis._container = null;\r\n\t\t\tthis._stroke = null;\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\r\n\t\tmap.off({\r\n\t\t\t'viewreset': this.projectLatlngs,\r\n\t\t\t'moveend': this._updatePath\r\n\t\t}, this);\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\t// do all projection stuff here\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._container) {\r\n\t\t\tthis._updateStyle();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._updatePath();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_updatePathViewport: function () {\r\n\t\tvar p = L.Path.CLIP_PADDING,\r\n\t\t    size = this.getSize(),\r\n\t\t    panePos = L.DomUtil.getPosition(this._mapPane),\r\n\t\t    min = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),\r\n\t\t    max = min.add(size.multiplyBy(1 + p * 2)._round());\r\n\r\n\t\tthis._pathViewport = new L.Bounds(min, max);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Path with SVG-specific rendering code.\r\n */\r\n\r\nL.Path.SVG_NS = 'http://www.w3.org/2000/svg';\r\n\r\nL.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);\r\n\r\nL.Path = L.Path.extend({\r\n\tstatics: {\r\n\t\tSVG: L.Browser.svg\r\n\t},\r\n\r\n\tbringToFront: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container;\r\n\r\n\t\tif (path && root.lastChild !== path) {\r\n\t\t\troot.appendChild(path);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbringToBack: function () {\r\n\t\tvar root = this._map._pathRoot,\r\n\t\t    path = this._container,\r\n\t\t    first = root.firstChild;\r\n\r\n\t\tif (path && first !== path) {\r\n\t\t\troot.insertBefore(path, first);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\t// form path string here\r\n\t},\r\n\r\n\t_createElement: function (name) {\r\n\t\treturn document.createElementNS(L.Path.SVG_NS, name);\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._initPath();\r\n\t\tthis._initStyle();\r\n\t},\r\n\r\n\t_initPath: function () {\r\n\t\tthis._container = this._createElement('g');\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\r\n\t\tif (this.options.className) {\r\n\t\t\tL.DomUtil.addClass(this._path, this.options.className);\r\n\t\t}\r\n\r\n\t\tthis._container.appendChild(this._path);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke-linejoin', 'round');\r\n\t\t\tthis._path.setAttribute('stroke-linecap', 'round');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill-rule', 'evenodd');\r\n\t\t}\r\n\t\tif (this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', this.options.pointerEvents);\r\n\t\t}\r\n\t\tif (!this.options.clickable && !this.options.pointerEvents) {\r\n\t\t\tthis._path.setAttribute('pointer-events', 'none');\r\n\t\t}\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tif (this.options.stroke) {\r\n\t\t\tthis._path.setAttribute('stroke', this.options.color);\r\n\t\t\tthis._path.setAttribute('stroke-opacity', this.options.opacity);\r\n\t\t\tthis._path.setAttribute('stroke-width', this.options.weight);\r\n\t\t\tif (this.options.dashArray) {\r\n\t\t\t\tthis._path.setAttribute('stroke-dasharray', this.options.dashArray);\r\n\t\t\t} else {\r\n\t\t\t\tthis._path.removeAttribute('stroke-dasharray');\r\n\t\t\t}\r\n\t\t\tif (this.options.lineCap) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linecap', this.options.lineCap);\r\n\t\t\t}\r\n\t\t\tif (this.options.lineJoin) {\r\n\t\t\t\tthis._path.setAttribute('stroke-linejoin', this.options.lineJoin);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('stroke', 'none');\r\n\t\t}\r\n\t\tif (this.options.fill) {\r\n\t\t\tthis._path.setAttribute('fill', this.options.fillColor || this.options.color);\r\n\t\t\tthis._path.setAttribute('fill-opacity', this.options.fillOpacity);\r\n\t\t} else {\r\n\t\t\tthis._path.setAttribute('fill', 'none');\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar str = this.getPathString();\r\n\t\tif (!str) {\r\n\t\t\t// fix webkit empty string parsing bug\r\n\t\t\tstr = 'M0 0';\r\n\t\t}\r\n\t\tthis._path.setAttribute('d', str);\r\n\t},\r\n\r\n\t// TODO remove duplication with L.Map\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tif (L.Browser.svg || !L.Browser.vml) {\r\n\t\t\t\tL.DomUtil.addClass(this._path, 'leaflet-clickable');\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.on(this._container, 'click', this._onMouseClick, this);\r\n\r\n\t\t\tvar events = ['dblclick', 'mousedown', 'mouseover',\r\n\t\t\t              'mouseout', 'mousemove', 'contextmenu'];\r\n\t\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\t\tL.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tif (this._map.dragging && this._map.dragging.moved()) { return; }\r\n\r\n\t\tthis._fireMouseEvent(e);\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (!this._map || !this.hasEventListeners(e.type)) { return; }\r\n\r\n\t\tvar map = this._map,\r\n\t\t    containerPoint = map.mouseEventToContainerPoint(e),\r\n\t\t    layerPoint = map.containerPointToLayerPoint(containerPoint),\r\n\t\t    latlng = map.layerPointToLatLng(layerPoint);\r\n\r\n\t\tthis.fire(e.type, {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tlayerPoint: layerPoint,\r\n\t\t\tcontainerPoint: containerPoint,\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\r\n\t\tif (e.type === 'contextmenu') {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousemove') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\t_initPathRoot: function () {\r\n\t\tif (!this._pathRoot) {\r\n\t\t\tthis._pathRoot = L.Path.prototype._createElement('svg');\r\n\t\t\tthis._panes.overlayPane.appendChild(this._pathRoot);\r\n\r\n\t\t\tif (this.options.zoomAnimation && L.Browser.any3d) {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');\r\n\r\n\t\t\t\tthis.on({\r\n\t\t\t\t\t'zoomanim': this._animatePathZoom,\r\n\t\t\t\t\t'zoomend': this._endPathZoom\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');\r\n\t\t\t}\r\n\r\n\t\t\tthis.on('moveend', this._updateSvgViewport);\r\n\t\t\tthis._updateSvgViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_animatePathZoom: function (e) {\r\n\t\tvar scale = this.getZoomScale(e.zoom),\r\n\t\t    offset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);\r\n\r\n\t\tthis._pathRoot.style[L.DomUtil.TRANSFORM] =\r\n\t\t        L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';\r\n\r\n\t\tthis._pathZooming = true;\r\n\t},\r\n\r\n\t_endPathZoom: function () {\r\n\t\tthis._pathZooming = false;\r\n\t},\r\n\r\n\t_updateSvgViewport: function () {\r\n\r\n\t\tif (this._pathZooming) {\r\n\t\t\t// Do not update SVGs while a zoom animation is going on otherwise the animation will break.\r\n\t\t\t// When the zoom animation ends we will be updated again anyway\r\n\t\t\t// This fixes the case where you do a momentum move and zoom while the move is still ongoing.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    max = vp.max,\r\n\t\t    width = max.x - min.x,\r\n\t\t    height = max.y - min.y,\r\n\t\t    root = this._pathRoot,\r\n\t\t    pane = this._panes.overlayPane;\r\n\r\n\t\t// Hack to make flicker on drag end on mobile webkit less irritating\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.removeChild(root);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.setAttribute('width', width);\r\n\t\troot.setAttribute('height', height);\r\n\t\troot.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));\r\n\r\n\t\tif (L.Browser.mobileWebkit) {\r\n\t\t\tpane.appendChild(root);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.\r\n */\r\n\r\nL.Path.include({\r\n\r\n\tbindPopup: function (content, options) {\r\n\r\n\t\tif (content instanceof L.Popup) {\r\n\t\t\tthis._popup = content;\r\n\t\t} else {\r\n\t\t\tif (!this._popup || options) {\r\n\t\t\t\tthis._popup = new L.Popup(options, this);\r\n\t\t\t}\r\n\t\t\tthis._popup.setContent(content);\r\n\t\t}\r\n\r\n\t\tif (!this._popupHandlersAdded) {\r\n\t\t\tthis\r\n\t\t\t    .on('click', this._openPopup, this)\r\n\t\t\t    .on('remove', this.closePopup, this);\r\n\r\n\t\t\tthis._popupHandlersAdded = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindPopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup = null;\r\n\t\t\tthis\r\n\t\t\t    .off('click', this._openPopup)\r\n\t\t\t    .off('remove', this.closePopup);\r\n\r\n\t\t\tthis._popupHandlersAdded = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\topenPopup: function (latlng) {\r\n\r\n\t\tif (this._popup) {\r\n\t\t\t// open the popup from one of the path's points if not specified\r\n\t\t\tlatlng = latlng || this._latlng ||\r\n\t\t\t         this._latlngs[Math.floor(this._latlngs.length / 2)];\r\n\r\n\t\t\tthis._openPopup({latlng: latlng});\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclosePopup: function () {\r\n\t\tif (this._popup) {\r\n\t\t\tthis._popup._close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_openPopup: function (e) {\r\n\t\tthis._popup.setLatLng(e.latlng);\r\n\t\tthis._map.openPopup(this._popup);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Vector rendering for IE6-8 through VML.\r\n * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\r\n */\r\n\r\nL.Browser.vml = !L.Browser.svg && (function () {\r\n\ttry {\r\n\t\tvar div = document.createElement('div');\r\n\t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n\t\tvar shape = div.firstChild;\r\n\t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n\t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}());\r\n\r\nL.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\tVML: true,\r\n\t\tCLIP_PADDING: 0.02\r\n\t},\r\n\r\n\t_createElement: (function () {\r\n\t\ttry {\r\n\t\t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\treturn function (name) {\r\n\t\t\t\treturn document.createElement(\r\n\t\t\t\t        '<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\r\n\t\t\t};\r\n\t\t}\r\n\t}()),\r\n\r\n\t_initPath: function () {\r\n\t\tvar container = this._container = this._createElement('shape');\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-vml-shape' +\r\n\t\t\t(this.options.className ? ' ' + this.options.className : ''));\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\t}\r\n\r\n\t\tcontainer.coordsize = '1 1';\r\n\r\n\t\tthis._path = this._createElement('path');\r\n\t\tcontainer.appendChild(this._path);\r\n\r\n\t\tthis._map._pathRoot.appendChild(container);\r\n\t},\r\n\r\n\t_initStyle: function () {\r\n\t\tthis._updateStyle();\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar stroke = this._stroke,\r\n\t\t    fill = this._fill,\r\n\t\t    options = this.options,\r\n\t\t    container = this._container;\r\n\r\n\t\tcontainer.stroked = options.stroke;\r\n\t\tcontainer.filled = options.fill;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tif (!stroke) {\r\n\t\t\t\tstroke = this._stroke = this._createElement('stroke');\r\n\t\t\t\tstroke.endcap = 'round';\r\n\t\t\t\tcontainer.appendChild(stroke);\r\n\t\t\t}\r\n\t\t\tstroke.weight = options.weight + 'px';\r\n\t\t\tstroke.color = options.color;\r\n\t\t\tstroke.opacity = options.opacity;\r\n\r\n\t\t\tif (options.dashArray) {\r\n\t\t\t\tstroke.dashStyle = L.Util.isArray(options.dashArray) ?\r\n\t\t\t\t    options.dashArray.join(' ') :\r\n\t\t\t\t    options.dashArray.replace(/( *, *)/g, ' ');\r\n\t\t\t} else {\r\n\t\t\t\tstroke.dashStyle = '';\r\n\t\t\t}\r\n\t\t\tif (options.lineCap) {\r\n\t\t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\r\n\t\t\t}\r\n\t\t\tif (options.lineJoin) {\r\n\t\t\t\tstroke.joinstyle = options.lineJoin;\r\n\t\t\t}\r\n\r\n\t\t} else if (stroke) {\r\n\t\t\tcontainer.removeChild(stroke);\r\n\t\t\tthis._stroke = null;\r\n\t\t}\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tif (!fill) {\r\n\t\t\t\tfill = this._fill = this._createElement('fill');\r\n\t\t\t\tcontainer.appendChild(fill);\r\n\t\t\t}\r\n\t\t\tfill.color = options.fillColor || options.color;\r\n\t\t\tfill.opacity = options.fillOpacity;\r\n\r\n\t\t} else if (fill) {\r\n\t\t\tcontainer.removeChild(fill);\r\n\t\t\tthis._fill = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tvar style = this._container.style;\r\n\r\n\t\tstyle.display = 'none';\r\n\t\tthis._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug\r\n\t\tstyle.display = '';\r\n\t}\r\n});\r\n\r\nL.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tif (this._pathRoot) { return; }\r\n\r\n\t\tvar root = this._pathRoot = document.createElement('div');\r\n\t\troot.className = 'leaflet-vml-container';\r\n\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\tthis.on('moveend', this._updatePathViewport);\r\n\t\tthis._updatePathViewport();\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Vector rendering for all browsers that support canvas.\r\n */\r\n\r\nL.Browser.canvas = (function () {\r\n\treturn !!document.createElement('canvas').getContext;\r\n}());\r\n\r\nL.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({\r\n\tstatics: {\r\n\t\t//CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value\r\n\t\tCANVAS: true,\r\n\t\tSVG: false\r\n\t},\r\n\r\n\tredraw: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis.projectLatlngs();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tL.setOptions(this, style);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._updateStyle();\r\n\t\t\tthis._requestUpdate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('viewreset', this.projectLatlngs, this)\r\n\t\t    .off('moveend', this._updatePath, this);\r\n\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.off('click', this._onClick, this);\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\r\n\t\tthis._requestUpdate();\r\n\t\t\r\n\t\tthis.fire('remove');\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\t_requestUpdate: function () {\r\n\t\tif (this._map && !L.Path._updateRequest) {\r\n\t\t\tL.Path._updateRequest = L.Util.requestAnimFrame(this._fireMapMoveEnd, this._map);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireMapMoveEnd: function () {\r\n\t\tL.Path._updateRequest = null;\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_initElements: function () {\r\n\t\tthis._map._initPathRoot();\r\n\t\tthis._ctx = this._map._canvasCtx;\r\n\t},\r\n\r\n\t_updateStyle: function () {\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tthis._ctx.lineWidth = options.weight;\r\n\t\t\tthis._ctx.strokeStyle = options.color;\r\n\t\t}\r\n\t\tif (options.fill) {\r\n\t\t\tthis._ctx.fillStyle = options.fillColor || options.color;\r\n\t\t}\r\n\r\n\t\tif (options.lineCap) {\r\n\t\t\tthis._ctx.lineCap = options.lineCap;\r\n\t\t}\r\n\t\tif (options.lineJoin) {\r\n\t\t\tthis._ctx.lineJoin = options.lineJoin;\r\n\t\t}\r\n\t},\r\n\r\n\t_drawPath: function () {\r\n\t\tvar i, j, len, len2, point, drawMethod;\r\n\r\n\t\tthis._ctx.beginPath();\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tfor (j = 0, len2 = this._parts[i].length; j < len2; j++) {\r\n\t\t\t\tpoint = this._parts[i][j];\r\n\t\t\t\tdrawMethod = (j === 0 ? 'move' : 'line') + 'To';\r\n\r\n\t\t\t\tthis._ctx[drawMethod](point.x, point.y);\r\n\t\t\t}\r\n\t\t\t// TODO refactor ugly hack\r\n\t\t\tif (this instanceof L.Polygon) {\r\n\t\t\t\tthis._ctx.closePath();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\treturn !this._parts.length;\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (this._checkIfEmpty()) { return; }\r\n\r\n\t\tvar ctx = this._ctx,\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._drawPath();\r\n\t\tctx.save();\r\n\t\tthis._updateStyle();\r\n\r\n\t\tif (options.fill) {\r\n\t\t\tctx.globalAlpha = options.fillOpacity;\r\n\t\t\tctx.fill(options.fillRule || 'evenodd');\r\n\t\t}\r\n\r\n\t\tif (options.stroke) {\r\n\t\t\tctx.globalAlpha = options.opacity;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\tctx.restore();\r\n\r\n\t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tif (this.options.clickable) {\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t\tthis._map.on('click', this._onClick, this);\r\n\t\t\tthis._map.on('dblclick contextmenu', this._fireMouseEvent, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onClick: function (e) {\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis.fire('click', e);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fireMouseEvent: function (e) {\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis.fire(e.type, e);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._map || this._map._animatingZoom) { return; }\r\n\r\n\t\t// TODO don't do on each move\r\n\t\tif (this._containsPoint(e.layerPoint)) {\r\n\t\t\tthis._ctx.canvas.style.cursor = 'pointer';\r\n\t\t\tthis._mouseInside = true;\r\n\t\t\tthis.fire('mouseover', e);\r\n\r\n\t\t} else if (this._mouseInside) {\r\n\t\t\tthis._ctx.canvas.style.cursor = '';\r\n\t\t\tthis._mouseInside = false;\r\n\t\t\tthis.fire('mouseout', e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {\r\n\t_initPathRoot: function () {\r\n\t\tvar root = this._pathRoot,\r\n\t\t    ctx;\r\n\r\n\t\tif (!root) {\r\n\t\t\troot = this._pathRoot = document.createElement('canvas');\r\n\t\t\troot.style.position = 'absolute';\r\n\t\t\tctx = this._canvasCtx = root.getContext('2d');\r\n\r\n\t\t\tctx.lineCap = 'round';\r\n\t\t\tctx.lineJoin = 'round';\r\n\r\n\t\t\tthis._panes.overlayPane.appendChild(root);\r\n\r\n\t\t\tif (this.options.zoomAnimation) {\r\n\t\t\t\tthis._pathRoot.className = 'leaflet-zoom-animated';\r\n\t\t\t\tthis.on('zoomanim', this._animatePathZoom);\r\n\t\t\t\tthis.on('zoomend', this._endPathZoom);\r\n\t\t\t}\r\n\t\t\tthis.on('moveend', this._updateCanvasViewport);\r\n\t\t\tthis._updateCanvasViewport();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateCanvasViewport: function () {\r\n\t\t// don't redraw while zooming. See _updateSvgViewport for more details\r\n\t\tif (this._pathZooming) { return; }\r\n\t\tthis._updatePathViewport();\r\n\r\n\t\tvar vp = this._pathViewport,\r\n\t\t    min = vp.min,\r\n\t\t    size = vp.max.subtract(min),\r\n\t\t    root = this._pathRoot;\r\n\r\n\t\t//TODO check if this works properly on mobile webkit\r\n\t\tL.DomUtil.setPosition(root, min);\r\n\t\troot.width = size.x;\r\n\t\troot.height = size.y;\r\n\t\troot.getContext('2d').translate(-min.x, -min.y);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.LineUtil contains different utility functions for line segments\r\n * and polylines (clipping, simplification, distances, etc.)\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations for this file\r\n\r\nL.LineUtil = {\r\n\r\n\t// Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n\t// Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n\tsimplify: function (/*Point[]*/ points, /*Number*/ tolerance) {\r\n\t\tif (!tolerance || !points.length) {\r\n\t\t\treturn points.slice();\r\n\t\t}\r\n\r\n\t\tvar sqTolerance = tolerance * tolerance;\r\n\r\n\t\t// stage 1: vertex reduction\r\n\t\tpoints = this._reducePoints(points, sqTolerance);\r\n\r\n\t\t// stage 2: Douglas-Peucker simplification\r\n\t\tpoints = this._simplifyDP(points, sqTolerance);\r\n\r\n\t\treturn points;\r\n\t},\r\n\r\n\t// distance from a point to a segment between two points\r\n\tpointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));\r\n\t},\r\n\r\n\tclosestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn this._sqClosestPointOnSegment(p, p1, p2);\r\n\t},\r\n\r\n\t// Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm\r\n\t_simplifyDP: function (points, sqTolerance) {\r\n\r\n\t\tvar len = points.length,\r\n\t\t    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n\t\t    markers = new ArrayConstructor(len);\r\n\r\n\t\tmarkers[0] = markers[len - 1] = 1;\r\n\r\n\t\tthis._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n\t\tvar i,\r\n\t\t    newPoints = [];\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tif (markers[i]) {\r\n\t\t\t\tnewPoints.push(points[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newPoints;\r\n\t},\r\n\r\n\t_simplifyDPStep: function (points, markers, sqTolerance, first, last) {\r\n\r\n\t\tvar maxSqDist = 0,\r\n\t\t    index, i, sqDist;\r\n\r\n\t\tfor (i = first + 1; i <= last - 1; i++) {\r\n\t\t\tsqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n\t\t\tif (sqDist > maxSqDist) {\r\n\t\t\t\tindex = i;\r\n\t\t\t\tmaxSqDist = sqDist;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (maxSqDist > sqTolerance) {\r\n\t\t\tmarkers[index] = 1;\r\n\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, first, index);\r\n\t\t\tthis._simplifyDPStep(points, markers, sqTolerance, index, last);\r\n\t\t}\r\n\t},\r\n\r\n\t// reduce points that are too close to each other to a single point\r\n\t_reducePoints: function (points, sqTolerance) {\r\n\t\tvar reducedPoints = [points[0]];\r\n\r\n\t\tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n\t\t\tif (this._sqDist(points[i], points[prev]) > sqTolerance) {\r\n\t\t\t\treducedPoints.push(points[i]);\r\n\t\t\t\tprev = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (prev < len - 1) {\r\n\t\t\treducedPoints.push(points[len - 1]);\r\n\t\t}\r\n\t\treturn reducedPoints;\r\n\t},\r\n\r\n\t// Cohen-Sutherland line clipping algorithm.\r\n\t// Used to avoid rendering parts of a polyline that are not currently visible.\r\n\r\n\tclipSegment: function (a, b, bounds, useLastCode) {\r\n\t\tvar codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),\r\n\t\t    codeB = this._getBitCode(b, bounds),\r\n\r\n\t\t    codeOut, p, newCode;\r\n\r\n\t\t// save 2nd code to avoid calculating it on the next segment\r\n\t\tthis._lastCode = codeB;\r\n\r\n\t\twhile (true) {\r\n\t\t\t// if a,b is inside the clip window (trivial accept)\r\n\t\t\tif (!(codeA | codeB)) {\r\n\t\t\t\treturn [a, b];\r\n\t\t\t// if a,b is outside the clip window (trivial reject)\r\n\t\t\t} else if (codeA & codeB) {\r\n\t\t\t\treturn false;\r\n\t\t\t// other cases\r\n\t\t\t} else {\r\n\t\t\t\tcodeOut = codeA || codeB;\r\n\t\t\t\tp = this._getEdgeIntersection(a, b, codeOut, bounds);\r\n\t\t\t\tnewCode = this._getBitCode(p, bounds);\r\n\r\n\t\t\t\tif (codeOut === codeA) {\r\n\t\t\t\t\ta = p;\r\n\t\t\t\t\tcodeA = newCode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tb = p;\r\n\t\t\t\t\tcodeB = newCode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getEdgeIntersection: function (a, b, code, bounds) {\r\n\t\tvar dx = b.x - a.x,\r\n\t\t    dy = b.y - a.y,\r\n\t\t    min = bounds.min,\r\n\t\t    max = bounds.max;\r\n\r\n\t\tif (code & 8) { // top\r\n\t\t\treturn new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);\r\n\t\t} else if (code & 4) { // bottom\r\n\t\t\treturn new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);\r\n\t\t} else if (code & 2) { // right\r\n\t\t\treturn new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);\r\n\t\t} else if (code & 1) { // left\r\n\t\t\treturn new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);\r\n\t\t}\r\n\t},\r\n\r\n\t_getBitCode: function (/*Point*/ p, bounds) {\r\n\t\tvar code = 0;\r\n\r\n\t\tif (p.x < bounds.min.x) { // left\r\n\t\t\tcode |= 1;\r\n\t\t} else if (p.x > bounds.max.x) { // right\r\n\t\t\tcode |= 2;\r\n\t\t}\r\n\t\tif (p.y < bounds.min.y) { // bottom\r\n\t\t\tcode |= 4;\r\n\t\t} else if (p.y > bounds.max.y) { // top\r\n\t\t\tcode |= 8;\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t},\r\n\r\n\t// square distance (to avoid unnecessary Math.sqrt calls)\r\n\t_sqDist: function (p1, p2) {\r\n\t\tvar dx = p2.x - p1.x,\r\n\t\t    dy = p2.y - p1.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\t},\r\n\r\n\t// return closest point on segment or distance to that point\r\n\t_sqClosestPointOnSegment: function (p, p1, p2, sqDist) {\r\n\t\tvar x = p1.x,\r\n\t\t    y = p1.y,\r\n\t\t    dx = p2.x - x,\r\n\t\t    dy = p2.y - y,\r\n\t\t    dot = dx * dx + dy * dy,\r\n\t\t    t;\r\n\r\n\t\tif (dot > 0) {\r\n\t\t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n\t\t\tif (t > 1) {\r\n\t\t\t\tx = p2.x;\r\n\t\t\t\ty = p2.y;\r\n\t\t\t} else if (t > 0) {\r\n\t\t\t\tx += dx * t;\r\n\t\t\t\ty += dy * t;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdx = p.x - x;\r\n\t\tdy = p.y - y;\r\n\r\n\t\treturn sqDist ? dx * dx + dy * dy : new L.Point(x, y);\r\n\t}\r\n};\r\n\r\n\r\n/*\r\n * L.Polyline is used to display polylines on a map.\r\n */\r\n\r\nL.Polyline = L.Path.extend({\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t},\r\n\r\n\toptions: {\r\n\t\t// how much to simplify the polyline on each zoom level\r\n\t\t// more = better performance and smoother look, less = more accurate\r\n\t\tsmoothFactor: 1.0,\r\n\t\tnoClip: false\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._originalPoints = [];\r\n\r\n\t\tfor (var i = 0, len = this._latlngs.length; i < len; i++) {\r\n\t\t\tthis._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tfor (var i = 0, len = this._parts.length, str = ''; i < len; i++) {\r\n\t\t\tstr += this._getPathPartStr(this._parts[i]);\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\tgetLatLngs: function () {\r\n\t\treturn this._latlngs;\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tthis._latlngs = this._convertLatLngs(latlngs);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\taddLatLng: function (latlng) {\r\n\t\tthis._latlngs.push(L.latLng(latlng));\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tspliceLatLngs: function () { // (Number index, Number howMany)\r\n\t\tvar removed = [].splice.apply(this._latlngs, arguments);\r\n\t\tthis._convertLatLngs(this._latlngs, true);\r\n\t\tthis.redraw();\r\n\t\treturn removed;\r\n\t},\r\n\r\n\tclosestLayerPoint: function (p) {\r\n\t\tvar minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;\r\n\r\n\t\tfor (var j = 0, jLen = parts.length; j < jLen; j++) {\r\n\t\t\tvar points = parts[j];\r\n\t\t\tfor (var i = 1, len = points.length; i < len; i++) {\r\n\t\t\t\tp1 = points[i - 1];\r\n\t\t\t\tp2 = points[i];\r\n\t\t\t\tvar sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);\r\n\t\t\t\tif (sqDist < minDistance) {\r\n\t\t\t\t\tminDistance = sqDist;\r\n\t\t\t\t\tminPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (minPoint) {\r\n\t\t\tminPoint.distance = Math.sqrt(minDistance);\r\n\t\t}\r\n\t\treturn minPoint;\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\treturn new L.LatLngBounds(this.getLatLngs());\r\n\t},\r\n\r\n\t_convertLatLngs: function (latlngs, overwrite) {\r\n\t\tvar i, len, target = overwrite ? latlngs : [];\r\n\r\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\t\t\tif (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget[i] = L.latLng(latlngs[i]);\r\n\t\t}\r\n\t\treturn target;\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tL.Path.prototype._initEvents.call(this);\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar round = L.Path.VML;\r\n\r\n\t\tfor (var j = 0, len2 = points.length, str = '', p; j < len2; j++) {\r\n\t\t\tp = points[j];\r\n\t\t\tif (round) {\r\n\t\t\t\tp._round();\r\n\t\t\t}\r\n\t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\r\n\t\t}\r\n\t\treturn str;\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    len = points.length,\r\n\t\t    i, k, segment;\r\n\r\n\t\tif (this.options.noClip) {\r\n\t\t\tthis._parts = [points];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._parts = [];\r\n\r\n\t\tvar parts = this._parts,\r\n\t\t    vp = this._map._pathViewport,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (i = 0, k = 0; i < len - 1; i++) {\r\n\t\t\tsegment = lu.clipSegment(points[i], points[i + 1], vp, i);\r\n\t\t\tif (!segment) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tparts[k] = parts[k] || [];\r\n\t\t\tparts[k].push(segment[0]);\r\n\r\n\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\r\n\t\t\tif ((segment[1] !== points[i + 1]) || (i === len - 2)) {\r\n\t\t\t\tparts[k].push(segment[1]);\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// simplify each clipped part of the polyline\r\n\t_simplifyPoints: function () {\r\n\t\tvar parts = this._parts,\r\n\t\t    lu = L.LineUtil;\r\n\r\n\t\tfor (var i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tparts[i] = lu.simplify(parts[i], this.options.smoothFactor);\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePath: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._clipPoints();\r\n\t\tthis._simplifyPoints();\r\n\r\n\t\tL.Path.prototype._updatePath.call(this);\r\n\t}\r\n});\r\n\r\nL.polyline = function (latlngs, options) {\r\n\treturn new L.Polyline(latlngs, options);\r\n};\r\n\r\n\r\n/*\r\n * L.PolyUtil contains utility functions for polygons (clipping, etc.).\r\n */\r\n\r\n/*jshint bitwise:false */ // allow bitwise operations here\r\n\r\nL.PolyUtil = {};\r\n\r\n/*\r\n * Sutherland-Hodgeman polygon clipping algorithm.\r\n * Used to avoid rendering parts of a polygon that are not currently visible.\r\n */\r\nL.PolyUtil.clipPolygon = function (points, bounds) {\r\n\tvar clippedPoints,\r\n\t    edges = [1, 4, 2, 8],\r\n\t    i, j, k,\r\n\t    a, b,\r\n\t    len, edge, p,\r\n\t    lu = L.LineUtil;\r\n\r\n\tfor (i = 0, len = points.length; i < len; i++) {\r\n\t\tpoints[i]._code = lu._getBitCode(points[i], bounds);\r\n\t}\r\n\r\n\t// for each edge (left, bottom, right, top)\r\n\tfor (k = 0; k < 4; k++) {\r\n\t\tedge = edges[k];\r\n\t\tclippedPoints = [];\r\n\r\n\t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n\t\t\ta = points[i];\r\n\t\t\tb = points[j];\r\n\r\n\t\t\t// if a is inside the clip window\r\n\t\t\tif (!(a._code & edge)) {\r\n\t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n\t\t\t\tif (b._code & edge) {\r\n\t\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\t\tclippedPoints.push(p);\r\n\t\t\t\t}\r\n\t\t\t\tclippedPoints.push(a);\r\n\r\n\t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n\t\t\t} else if (!(b._code & edge)) {\r\n\t\t\t\tp = lu._getEdgeIntersection(b, a, edge, bounds);\r\n\t\t\t\tp._code = lu._getBitCode(p, bounds);\r\n\t\t\t\tclippedPoints.push(p);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpoints = clippedPoints;\r\n\t}\r\n\r\n\treturn points;\r\n};\r\n\r\n\r\n/*\r\n * L.Polygon is used to display polygons on a map.\r\n */\r\n\r\nL.Polygon = L.Polyline.extend({\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tinitialize: function (latlngs, options) {\r\n\t\tL.Polyline.prototype.initialize.call(this, latlngs, options);\r\n\t\tthis._initWithHoles(latlngs);\r\n\t},\r\n\r\n\t_initWithHoles: function (latlngs) {\r\n\t\tvar i, len, hole;\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._latlngs = this._convertLatLngs(latlngs[0]);\r\n\t\t\tthis._holes = latlngs.slice(1);\r\n\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = this._holes[i] = this._convertLatLngs(this._holes[i]);\r\n\t\t\t\tif (hole[0].equals(hole[hole.length - 1])) {\r\n\t\t\t\t\thole.pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// filter out last point if its equal to the first one\r\n\t\tlatlngs = this._latlngs;\r\n\r\n\t\tif (latlngs.length >= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {\r\n\t\t\tlatlngs.pop();\r\n\t\t}\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tL.Polyline.prototype.projectLatlngs.call(this);\r\n\r\n\t\t// project polygon holes points\r\n\t\t// TODO move this logic to Polyline to get rid of duplication\r\n\t\tthis._holePoints = [];\r\n\r\n\t\tif (!this._holes) { return; }\r\n\r\n\t\tvar i, j, len, len2;\r\n\r\n\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\tthis._holePoints[i] = [];\r\n\r\n\t\t\tfor (j = 0, len2 = this._holes[i].length; j < len2; j++) {\r\n\t\t\t\tthis._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetLatLngs: function (latlngs) {\r\n\t\tif (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {\r\n\t\t\tthis._initWithHoles(latlngs);\r\n\t\t\treturn this.redraw();\r\n\t\t} else {\r\n\t\t\treturn L.Polyline.prototype.setLatLngs.call(this, latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t_clipPoints: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t    newParts = [];\r\n\r\n\t\tthis._parts = [points].concat(this._holePoints);\r\n\r\n\t\tif (this.options.noClip) { return; }\r\n\r\n\t\tfor (var i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tvar clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);\r\n\t\t\tif (clipped.length) {\r\n\t\t\t\tnewParts.push(clipped);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._parts = newParts;\r\n\t},\r\n\r\n\t_getPathPartStr: function (points) {\r\n\t\tvar str = L.Polyline.prototype._getPathPartStr.call(this, points);\r\n\t\treturn str + (L.Browser.svg ? 'z' : 'x');\r\n\t}\r\n});\r\n\r\nL.polygon = function (latlngs, options) {\r\n\treturn new L.Polygon(latlngs, options);\r\n};\r\n\r\n\r\n/*\r\n * Contains L.MultiPolyline and L.MultiPolygon layers.\r\n */\r\n\r\n(function () {\r\n\tfunction createMulti(Klass) {\r\n\r\n\t\treturn L.FeatureGroup.extend({\r\n\r\n\t\t\tinitialize: function (latlngs, options) {\r\n\t\t\t\tthis._layers = {};\r\n\t\t\t\tthis._options = options;\r\n\t\t\t\tthis.setLatLngs(latlngs);\r\n\t\t\t},\r\n\r\n\t\t\tsetLatLngs: function (latlngs) {\r\n\t\t\t\tvar i = 0,\r\n\t\t\t\t    len = latlngs.length;\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tif (i < len) {\r\n\t\t\t\t\t\tlayer.setLatLngs(latlngs[i++]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.removeLayer(layer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\r\n\t\t\t\twhile (i < len) {\r\n\t\t\t\t\tthis.addLayer(new Klass(latlngs[i++], this._options));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tgetLatLngs: function () {\r\n\t\t\t\tvar latlngs = [];\r\n\r\n\t\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\t\tlatlngs.push(layer.getLatLngs());\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn latlngs;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tL.MultiPolyline = createMulti(L.Polyline);\r\n\tL.MultiPolygon = createMulti(L.Polygon);\r\n\r\n\tL.multiPolyline = function (latlngs, options) {\r\n\t\treturn new L.MultiPolyline(latlngs, options);\r\n\t};\r\n\r\n\tL.multiPolygon = function (latlngs, options) {\r\n\t\treturn new L.MultiPolygon(latlngs, options);\r\n\t};\r\n}());\r\n\r\n\r\n/*\r\n * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\r\n */\r\n\r\nL.Rectangle = L.Polygon.extend({\r\n\tinitialize: function (latLngBounds, options) {\r\n\t\tL.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\r\n\t},\r\n\r\n\tsetBounds: function (latLngBounds) {\r\n\t\tthis.setLatLngs(this._boundsToLatLngs(latLngBounds));\r\n\t},\r\n\r\n\t_boundsToLatLngs: function (latLngBounds) {\r\n\t\tlatLngBounds = L.latLngBounds(latLngBounds);\r\n\t\treturn [\r\n\t\t\tlatLngBounds.getSouthWest(),\r\n\t\t\tlatLngBounds.getNorthWest(),\r\n\t\t\tlatLngBounds.getNorthEast(),\r\n\t\t\tlatLngBounds.getSouthEast()\r\n\t\t];\r\n\t}\r\n});\r\n\r\nL.rectangle = function (latLngBounds, options) {\r\n\treturn new L.Rectangle(latLngBounds, options);\r\n};\r\n\r\n\r\n/*\r\n * L.Circle is a circle overlay (with a certain radius in meters).\r\n */\r\n\r\nL.Circle = L.Path.extend({\r\n\tinitialize: function (latlng, radius, options) {\r\n\t\tL.Path.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tthis._mRadius = radius;\r\n\t},\r\n\r\n\toptions: {\r\n\t\tfill: true\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis._mRadius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latlng = this._latlng,\r\n\t\t    pointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);\r\n\r\n\t\tthis._point = this._map.latLngToLayerPoint(latlng);\r\n\t\tthis._radius = Math.max(this._point.x - pointLeft.x, 1);\r\n\t},\r\n\r\n\tgetBounds: function () {\r\n\t\tvar lngRadius = this._getLngRadius(),\r\n\t\t    latRadius = (this._mRadius / 40075017) * 360,\r\n\t\t    latlng = this._latlng;\r\n\r\n\t\treturn new L.LatLngBounds(\r\n\t\t        [latlng.lat - latRadius, latlng.lng - lngRadius],\r\n\t\t        [latlng.lat + latRadius, latlng.lng + lngRadius]);\r\n\t},\r\n\r\n\tgetLatLng: function () {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\tgetPathString: function () {\r\n\t\tvar p = this._point,\r\n\t\t    r = this._radius;\r\n\r\n\t\tif (this._checkIfEmpty()) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif (L.Browser.svg) {\r\n\t\t\treturn 'M' + p.x + ',' + (p.y - r) +\r\n\t\t\t       'A' + r + ',' + r + ',0,1,1,' +\r\n\t\t\t       (p.x - 0.1) + ',' + (p.y - r) + ' z';\r\n\t\t} else {\r\n\t\t\tp._round();\r\n\t\t\tr = Math.round(r);\r\n\t\t\treturn 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);\r\n\t\t}\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._mRadius;\r\n\t},\r\n\r\n\t// TODO Earth hardcoded, move into projection code!\r\n\r\n\t_getLatRadius: function () {\r\n\t\treturn (this._mRadius / 40075017) * 360;\r\n\t},\r\n\r\n\t_getLngRadius: function () {\r\n\t\treturn this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);\r\n\t},\r\n\r\n\t_checkIfEmpty: function () {\r\n\t\tif (!this._map) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar vp = this._map._pathViewport,\r\n\t\t    r = this._radius,\r\n\t\t    p = this._point;\r\n\r\n\t\treturn p.x - r > vp.max.x || p.y - r > vp.max.y ||\r\n\t\t       p.x + r < vp.min.x || p.y + r < vp.min.y;\r\n\t}\r\n});\r\n\r\nL.circle = function (latlng, radius, options) {\r\n\treturn new L.Circle(latlng, radius, options);\r\n};\r\n\r\n\r\n/*\r\n * L.CircleMarker is a circle overlay with a permanent pixel radius.\r\n */\r\n\r\nL.CircleMarker = L.Circle.extend({\r\n\toptions: {\r\n\t\tradius: 10,\r\n\t\tweight: 2\r\n\t},\r\n\r\n\tinitialize: function (latlng, options) {\r\n\t\tL.Circle.prototype.initialize.call(this, latlng, null, options);\r\n\t\tthis._radius = this.options.radius;\r\n\t},\r\n\r\n\tprojectLatlngs: function () {\r\n\t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\r\n\t},\r\n\r\n\t_updateStyle : function () {\r\n\t\tL.Circle.prototype._updateStyle.call(this);\r\n\t\tthis.setRadius(this.options.radius);\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tL.Circle.prototype.setLatLng.call(this, latlng);\r\n\t\tif (this._popup && this._popup._isOpen) {\r\n\t\t\tthis._popup.setLatLng(latlng);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetRadius: function (radius) {\r\n\t\tthis.options.radius = this._radius = radius;\r\n\t\treturn this.redraw();\r\n\t},\r\n\r\n\tgetRadius: function () {\r\n\t\treturn this._radius;\r\n\t}\r\n});\r\n\r\nL.circleMarker = function (latlng, options) {\r\n\treturn new L.CircleMarker(latlng, options);\r\n};\r\n\r\n\r\n/*\r\n * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.\r\n */\r\n\r\nL.Polyline.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p, closed) {\r\n\t\tvar i, j, k, len, len2, dist, part,\r\n\t\t    w = this.options.weight / 2;\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tw += 10; // polyline click tolerance on touch devices\r\n\t\t}\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tif (!closed && (j === 0)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);\r\n\r\n\t\t\t\tif (dist <= w) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.\r\n */\r\n\r\nL.Polygon.include(!L.Path.CANVAS ? {} : {\r\n\t_containsPoint: function (p) {\r\n\t\tvar inside = false,\r\n\t\t    part, p1, p2,\r\n\t\t    i, j, k,\r\n\t\t    len, len2;\r\n\r\n\t\t// TODO optimization: check if within bounds first\r\n\r\n\t\tif (L.Polyline.prototype._containsPoint.call(this, p, true)) {\r\n\t\t\t// click on polygon border\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// ray casting algorithm for detecting if point is in polygon\r\n\r\n\t\tfor (i = 0, len = this._parts.length; i < len; i++) {\r\n\t\t\tpart = this._parts[i];\r\n\r\n\t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\r\n\t\t\t\tp1 = part[j];\r\n\t\t\t\tp2 = part[k];\r\n\r\n\t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) &&\r\n\t\t\t\t\t\t(p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n\t\t\t\t\tinside = !inside;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn inside;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Circle with Canvas-specific code.\r\n */\r\n\r\nL.Circle.include(!L.Path.CANVAS ? {} : {\r\n\t_drawPath: function () {\r\n\t\tvar p = this._point;\r\n\t\tthis._ctx.beginPath();\r\n\t\tthis._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);\r\n\t},\r\n\r\n\t_containsPoint: function (p) {\r\n\t\tvar center = this._point,\r\n\t\t    w2 = this.options.stroke ? this.options.weight / 2 : 0;\r\n\r\n\t\treturn (p.distanceTo(center) <= this._radius + w2);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * CircleMarker canvas specific drawing parts.\r\n */\r\n\r\nL.CircleMarker.include(!L.Path.CANVAS ? {} : {\r\n\t_updateStyle: function () {\r\n\t\tL.Path.prototype._updateStyle.call(this);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.GeoJSON turns any GeoJSON data into a Leaflet layer.\r\n */\r\n\r\nL.GeoJSON = L.FeatureGroup.extend({\r\n\r\n\tinitialize: function (geojson, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\r\n\t\tif (geojson) {\r\n\t\t\tthis.addData(geojson);\r\n\t\t}\r\n\t},\r\n\r\n\taddData: function (geojson) {\r\n\t\tvar features = L.Util.isArray(geojson) ? geojson : geojson.features,\r\n\t\t    i, len, feature;\r\n\r\n\t\tif (features) {\r\n\t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n\t\t\t\t// Only add this if geometry or geometries are set and not null\r\n\t\t\t\tfeature = features[i];\r\n\t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n\t\t\t\t\tthis.addData(features[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\tif (options.filter && !options.filter(geojson)) { return; }\r\n\r\n\t\tvar layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);\r\n\t\tlayer.feature = L.GeoJSON.asFeature(geojson);\r\n\r\n\t\tlayer.defaultOptions = layer.options;\r\n\t\tthis.resetStyle(layer);\r\n\r\n\t\tif (options.onEachFeature) {\r\n\t\t\toptions.onEachFeature(geojson, layer);\r\n\t\t}\r\n\r\n\t\treturn this.addLayer(layer);\r\n\t},\r\n\r\n\tresetStyle: function (layer) {\r\n\t\tvar style = this.options.style;\r\n\t\tif (style) {\r\n\t\t\t// reset any custom styles\r\n\t\t\tL.Util.extend(layer.options, layer.defaultOptions);\r\n\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}\r\n\t},\r\n\r\n\tsetStyle: function (style) {\r\n\t\tthis.eachLayer(function (layer) {\r\n\t\t\tthis._setLayerStyle(layer, style);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_setLayerStyle: function (layer, style) {\r\n\t\tif (typeof style === 'function') {\r\n\t\t\tstyle = style(layer.feature);\r\n\t\t}\r\n\t\tif (layer.setStyle) {\r\n\t\t\tlayer.setStyle(style);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.extend(L.GeoJSON, {\r\n\tgeometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {\r\n\t\tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n\t\t    coords = geometry.coordinates,\r\n\t\t    layers = [],\r\n\t\t    latlng, latlngs, i, len;\r\n\r\n\t\tcoordsToLatLng = coordsToLatLng || this.coordsToLatLng;\r\n\r\n\t\tswitch (geometry.type) {\r\n\t\tcase 'Point':\r\n\t\t\tlatlng = coordsToLatLng(coords);\r\n\t\t\treturn pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);\r\n\r\n\t\tcase 'MultiPoint':\r\n\t\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\t\tlatlng = coordsToLatLng(coords[i]);\r\n\t\t\t\tlayers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tcase 'LineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);\r\n\t\t\treturn new L.Polyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'Polygon':\r\n\t\t\tif (coords.length === 2 && !coords[1].length) {\r\n\t\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t\t}\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.Polygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiLineString':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolyline(latlngs, vectorOptions);\r\n\r\n\t\tcase 'MultiPolygon':\r\n\t\t\tlatlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);\r\n\t\t\treturn new L.MultiPolygon(latlngs, vectorOptions);\r\n\r\n\t\tcase 'GeometryCollection':\r\n\t\t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n\r\n\t\t\t\tlayers.push(this.geometryToLayer({\r\n\t\t\t\t\tgeometry: geometry.geometries[i],\r\n\t\t\t\t\ttype: 'Feature',\r\n\t\t\t\t\tproperties: geojson.properties\r\n\t\t\t\t}, pointToLayer, coordsToLatLng, vectorOptions));\r\n\t\t\t}\r\n\t\t\treturn new L.FeatureGroup(layers);\r\n\r\n\t\tdefault:\r\n\t\t\tthrow new Error('Invalid GeoJSON object.');\r\n\t\t}\r\n\t},\r\n\r\n\tcoordsToLatLng: function (coords) { // (Array[, Boolean]) -> LatLng\r\n\t\treturn new L.LatLng(coords[1], coords[0], coords[2]);\r\n\t},\r\n\r\n\tcoordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array\r\n\t\tvar latlng, i, len,\r\n\t\t    latlngs = [];\r\n\r\n\t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n\t\t\tlatlng = levelsDeep ?\r\n\t\t\t        this.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :\r\n\t\t\t        (coordsToLatLng || this.coordsToLatLng)(coords[i]);\r\n\r\n\t\t\tlatlngs.push(latlng);\r\n\t\t}\r\n\r\n\t\treturn latlngs;\r\n\t},\r\n\r\n\tlatLngToCoords: function (latlng) {\r\n\t\tvar coords = [latlng.lng, latlng.lat];\r\n\r\n\t\tif (latlng.alt !== undefined) {\r\n\t\t\tcoords.push(latlng.alt);\r\n\t\t}\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tlatLngsToCoords: function (latLngs) {\r\n\t\tvar coords = [];\r\n\r\n\t\tfor (var i = 0, len = latLngs.length; i < len; i++) {\r\n\t\t\tcoords.push(L.GeoJSON.latLngToCoords(latLngs[i]));\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\t},\r\n\r\n\tgetFeature: function (layer, newGeometry) {\r\n\t\treturn layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);\r\n\t},\r\n\r\n\tasFeature: function (geoJSON) {\r\n\t\tif (geoJSON.type === 'Feature') {\r\n\t\t\treturn geoJSON;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttype: 'Feature',\r\n\t\t\tproperties: {},\r\n\t\t\tgeometry: geoJSON\r\n\t\t};\r\n\t}\r\n});\r\n\r\nvar PointToGeoJSON = {\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Point',\r\n\t\t\tcoordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\r\n\t\t});\r\n\t}\r\n};\r\n\r\nL.Marker.include(PointToGeoJSON);\r\nL.Circle.include(PointToGeoJSON);\r\nL.CircleMarker.include(PointToGeoJSON);\r\n\r\nL.Polyline.include({\r\n\ttoGeoJSON: function () {\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'LineString',\r\n\t\t\tcoordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())\r\n\t\t});\r\n\t}\r\n});\r\n\r\nL.Polygon.include({\r\n\ttoGeoJSON: function () {\r\n\t\tvar coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],\r\n\t\t    i, len, hole;\r\n\r\n\t\tcoords[0].push(coords[0][0]);\r\n\r\n\t\tif (this._holes) {\r\n\t\t\tfor (i = 0, len = this._holes.length; i < len; i++) {\r\n\t\t\t\thole = L.GeoJSON.latLngsToCoords(this._holes[i]);\r\n\t\t\t\thole.push(hole[0]);\r\n\t\t\t\tcoords.push(hole);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\ttype: 'Polygon',\r\n\t\t\tcoordinates: coords\r\n\t\t});\r\n\t}\r\n});\r\n\r\n(function () {\r\n\tfunction multiToGeoJSON(type) {\r\n\t\treturn function () {\r\n\t\t\tvar coords = [];\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tcoords.push(layer.toGeoJSON().geometry.coordinates);\r\n\t\t\t});\r\n\r\n\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tcoordinates: coords\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tL.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});\r\n\tL.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});\r\n\r\n\tL.LayerGroup.include({\r\n\t\ttoGeoJSON: function () {\r\n\r\n\t\t\tvar geometry = this.feature && this.feature.geometry,\r\n\t\t\t\tjsons = [],\r\n\t\t\t\tjson;\r\n\r\n\t\t\tif (geometry && geometry.type === 'MultiPoint') {\r\n\t\t\t\treturn multiToGeoJSON('MultiPoint').call(this);\r\n\t\t\t}\r\n\r\n\t\t\tvar isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n\t\t\tthis.eachLayer(function (layer) {\r\n\t\t\t\tif (layer.toGeoJSON) {\r\n\t\t\t\t\tjson = layer.toGeoJSON();\r\n\t\t\t\t\tjsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (isGeometryCollection) {\r\n\t\t\t\treturn L.GeoJSON.getFeature(this, {\r\n\t\t\t\t\tgeometries: jsons,\r\n\t\t\t\t\ttype: 'GeometryCollection'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttype: 'FeatureCollection',\r\n\t\t\t\tfeatures: jsons\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n}());\r\n\r\nL.geoJson = function (geojson, options) {\r\n\treturn new L.GeoJSON(geojson, options);\r\n};\r\n\r\n\r\n/*\r\n * L.DomEvent contains functions for working with DOM events.\r\n */\r\n\r\nL.DomEvent = {\r\n\t/* inspired by John Resig, Dean Edwards and YUI addEvent implementations */\r\n\taddListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler, originalHandler, newType;\r\n\r\n\t\tif (obj[key]) { return this; }\r\n\r\n\t\thandler = function (e) {\r\n\t\t\treturn fn.call(context || obj, e || L.DomEvent._getEvent());\r\n\t\t};\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\treturn this.addPointerListener(obj, type, handler, id);\r\n\t\t}\r\n\t\tif (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {\r\n\t\t\tthis.addDoubleTapListener(obj, handler, id);\r\n\t\t}\r\n\r\n\t\tif ('addEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.addEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\tnewType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');\r\n\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\tif (!L.DomEvent._checkMouse(obj, e)) { return; }\r\n\t\t\t\t\treturn originalHandler(e);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(newType, handler, false);\r\n\r\n\t\t\t} else if (type === 'click' && L.Browser.android) {\r\n\t\t\t\toriginalHandler = handler;\r\n\t\t\t\thandler = function (e) {\r\n\t\t\t\t\treturn L.DomEvent._filterClick(e, originalHandler);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.addEventListener(type, handler, false);\r\n\t\t\t}\r\n\r\n\t\t} else if ('attachEvent' in obj) {\r\n\t\t\tobj.attachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = handler;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveListener: function (obj, type, fn) {  // (HTMLElement, String, Function)\r\n\r\n\t\tvar id = L.stamp(fn),\r\n\t\t    key = '_leaflet_' + type + id,\r\n\t\t    handler = obj[key];\r\n\r\n\t\tif (!handler) { return this; }\r\n\r\n\t\tif (L.Browser.pointer && type.indexOf('touch') === 0) {\r\n\t\t\tthis.removePointerListener(obj, type, id);\r\n\t\t} else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {\r\n\t\t\tthis.removeDoubleTapListener(obj, id);\r\n\r\n\t\t} else if ('removeEventListener' in obj) {\r\n\r\n\t\t\tif (type === 'mousewheel') {\r\n\t\t\t\tobj.removeEventListener('DOMMouseScroll', handler, false);\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\r\n\t\t\t} else if ((type === 'mouseenter') || (type === 'mouseleave')) {\r\n\t\t\t\tobj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);\r\n\t\t\t} else {\r\n\t\t\t\tobj.removeEventListener(type, handler, false);\r\n\t\t\t}\r\n\t\t} else if ('detachEvent' in obj) {\r\n\t\t\tobj.detachEvent('on' + type, handler);\r\n\t\t}\r\n\r\n\t\tobj[key] = null;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopPropagation: function (e) {\r\n\r\n\t\tif (e.stopPropagation) {\r\n\t\t\te.stopPropagation();\r\n\t\t} else {\r\n\t\t\te.cancelBubble = true;\r\n\t\t}\r\n\t\tL.DomEvent._skipped(e);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdisableScrollPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'mousewheel', stop)\r\n\t\t\t.on(el, 'MozMousePixelScroll', stop);\r\n\t},\r\n\r\n\tdisableClickPropagation: function (el) {\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(el, L.Draggable.START[i], stop);\r\n\t\t}\r\n\r\n\t\treturn L.DomEvent\r\n\t\t\t.on(el, 'click', L.DomEvent._fakeStop)\r\n\t\t\t.on(el, 'dblclick', stop);\r\n\t},\r\n\r\n\tpreventDefault: function (e) {\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault();\r\n\t\t} else {\r\n\t\t\te.returnValue = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstop: function (e) {\r\n\t\treturn L.DomEvent\r\n\t\t\t.preventDefault(e)\r\n\t\t\t.stopPropagation(e);\r\n\t},\r\n\r\n\tgetMousePosition: function (e, container) {\r\n\t\tif (!container) {\r\n\t\t\treturn new L.Point(e.clientX, e.clientY);\r\n\t\t}\r\n\r\n\t\tvar rect = container.getBoundingClientRect();\r\n\r\n\t\treturn new L.Point(\r\n\t\t\te.clientX - rect.left - container.clientLeft,\r\n\t\t\te.clientY - rect.top - container.clientTop);\r\n\t},\r\n\r\n\tgetWheelDelta: function (e) {\r\n\r\n\t\tvar delta = 0;\r\n\r\n\t\tif (e.wheelDelta) {\r\n\t\t\tdelta = e.wheelDelta / 120;\r\n\t\t}\r\n\t\tif (e.detail) {\r\n\t\t\tdelta = -e.detail / 3;\r\n\t\t}\r\n\t\treturn delta;\r\n\t},\r\n\r\n\t_skipEvents: {},\r\n\r\n\t_fakeStop: function (e) {\r\n\t\t// fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)\r\n\t\tL.DomEvent._skipEvents[e.type] = true;\r\n\t},\r\n\r\n\t_skipped: function (e) {\r\n\t\tvar skipped = this._skipEvents[e.type];\r\n\t\t// reset when checking, as it's only used in map container and propagates outside of the map\r\n\t\tthis._skipEvents[e.type] = false;\r\n\t\treturn skipped;\r\n\t},\r\n\r\n\t// check if element really left/entered the event target (for mouseenter/mouseleave)\r\n\t_checkMouse: function (el, e) {\r\n\r\n\t\tvar related = e.relatedTarget;\r\n\r\n\t\tif (!related) { return true; }\r\n\r\n\t\ttry {\r\n\t\t\twhile (related && (related !== el)) {\r\n\t\t\t\trelated = related.parentNode;\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn (related !== el);\r\n\t},\r\n\r\n\t_getEvent: function () { // evil magic for IE\r\n\t\t/*jshint noarg:false */\r\n\t\tvar e = window.event;\r\n\t\tif (!e) {\r\n\t\t\tvar caller = arguments.callee.caller;\r\n\t\t\twhile (caller) {\r\n\t\t\t\te = caller['arguments'][0];\r\n\t\t\t\tif (e && window.Event === e.constructor) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcaller = caller.caller;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn e;\r\n\t},\r\n\r\n\t// this is a horrible workaround for a bug in Android where a single touch triggers two click events\r\n\t_filterClick: function (e, handler) {\r\n\t\tvar timeStamp = (e.timeStamp || e.originalEvent.timeStamp),\r\n\t\t\telapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\r\n\r\n\t\t// are they closer together than 500ms yet more than 100ms?\r\n\t\t// Android typically triggers them ~300ms apart while multiple listeners\r\n\t\t// on the same event should be triggered far faster;\r\n\t\t// or check if click is simulated on the element, and if it is, reject any non-simulated events\r\n\r\n\t\tif ((elapsed && elapsed > 100 && elapsed < 500) || (e.target._simulatedClick && !e._simulated)) {\r\n\t\t\tL.DomEvent.stop(e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tL.DomEvent._lastClick = timeStamp;\r\n\r\n\t\treturn handler(e);\r\n\t}\r\n};\r\n\r\nL.DomEvent.on = L.DomEvent.addListener;\r\nL.DomEvent.off = L.DomEvent.removeListener;\r\n\r\n\r\n/*\r\n * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.\r\n */\r\n\r\nL.Draggable = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tstatics: {\r\n\t\tSTART: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],\r\n\t\tEND: {\r\n\t\t\tmousedown: 'mouseup',\r\n\t\t\ttouchstart: 'touchend',\r\n\t\t\tpointerdown: 'touchend',\r\n\t\t\tMSPointerDown: 'touchend'\r\n\t\t},\r\n\t\tMOVE: {\r\n\t\t\tmousedown: 'mousemove',\r\n\t\t\ttouchstart: 'touchmove',\r\n\t\t\tpointerdown: 'touchmove',\r\n\t\t\tMSPointerDown: 'touchmove'\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (element, dragStartTarget) {\r\n\t\tthis._element = element;\r\n\t\tthis._dragStartTarget = dragStartTarget || element;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = true;\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tfor (var i = L.Draggable.START.length - 1; i >= 0; i--) {\r\n\t\t\tL.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);\r\n\t\t}\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\r\n\t\tif (L.Draggable._disabled) { return; }\r\n\r\n\t\tL.DomUtil.disableImageDrag();\r\n\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\tif (this._moving) { return; }\r\n\r\n\t\tvar first = e.touches ? e.touches[0] : e;\r\n\r\n\t\tthis._startPoint = new L.Point(first.clientX, first.clientY);\r\n\t\tthis._startPos = this._newPos = L.DomUtil.getPosition(this._element);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, L.Draggable.MOVE[e.type], this._onMove, this)\r\n\t\t    .on(document, L.Draggable.END[e.type], this._onUp, this);\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\tthis._moved = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n\t\t    newPoint = new L.Point(first.clientX, first.clientY),\r\n\t\t    offset = newPoint.subtract(this._startPoint);\r\n\r\n\t\tif (!offset.x && !offset.y) { return; }\r\n\t\tif (L.Browser.touch && Math.abs(offset.x) + Math.abs(offset.y) < 3) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tthis.fire('dragstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t\tthis._startPos = L.DomUtil.getPosition(this._element).subtract(offset);\r\n\r\n\t\t\tL.DomUtil.addClass(document.body, 'leaflet-dragging');\r\n\t\t\tthis._lastTarget = e.target || e.srcElement;\r\n\t\t\tL.DomUtil.addClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t}\r\n\r\n\t\tthis._newPos = this._startPos.add(offset);\r\n\t\tthis._moving = true;\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tthis.fire('predrag');\r\n\t\tL.DomUtil.setPosition(this._element, this._newPos);\r\n\t\tthis.fire('drag');\r\n\t},\r\n\r\n\t_onUp: function () {\r\n\t\tL.DomUtil.removeClass(document.body, 'leaflet-dragging');\r\n\r\n\t\tif (this._lastTarget) {\r\n\t\t\tL.DomUtil.removeClass(this._lastTarget, 'leaflet-drag-target');\r\n\t\t\tthis._lastTarget = null;\r\n\t\t}\r\n\r\n\t\tfor (var i in L.Draggable.MOVE) {\r\n\t\t\tL.DomEvent\r\n\t\t\t    .off(document, L.Draggable.MOVE[i], this._onMove)\r\n\t\t\t    .off(document, L.Draggable.END[i], this._onUp);\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableImageDrag();\r\n\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\tif (this._moved && this._moving) {\r\n\t\t\t// ensure drag is not fired after dragend\r\n\t\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\t\tthis.fire('dragend', {\r\n\t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._moving = false;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n\tL.Handler is a base class for handler classes that are used internally to inject\r\n\tinteraction features like dragging to classes like Map and Marker.\r\n*/\r\n\r\nL.Handler = L.Class.extend({\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tthis._enabled = true;\r\n\t\tthis.addHooks();\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tthis._enabled = false;\r\n\t\tthis.removeHooks();\r\n\t},\r\n\r\n\tenabled: function () {\r\n\t\treturn !!this._enabled;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tdragging: true,\r\n\r\n\tinertia: !L.Browser.android23,\r\n\tinertiaDeceleration: 3400, // px/s^2\r\n\tinertiaMaxSpeed: Infinity, // px/s\r\n\tinertiaThreshold: L.Browser.touch ? 32 : 18, // ms\r\n\teaseLinearity: 0.25,\r\n\r\n\t// TODO refactor, move to CRS\r\n\tworldCopyJump: false\r\n});\r\n\r\nL.Map.Drag = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tif (!this._draggable) {\r\n\t\t\tvar map = this._map;\r\n\r\n\t\t\tthis._draggable = new L.Draggable(map._mapPane, map._container);\r\n\r\n\t\t\tthis._draggable.on({\r\n\t\t\t\t'dragstart': this._onDragStart,\r\n\t\t\t\t'drag': this._onDrag,\r\n\t\t\t\t'dragend': this._onDragEnd\r\n\t\t\t}, this);\r\n\r\n\t\t\tif (map.options.worldCopyJump) {\r\n\t\t\t\tthis._draggable.on('predrag', this._onPreDrag, this);\r\n\t\t\t\tmap.on('viewreset', this._onViewReset, this);\r\n\r\n\t\t\t\tmap.whenReady(this._onViewReset, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._draggable.enable();\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._draggable.disable();\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._draggable && this._draggable._moved;\r\n\t},\r\n\r\n\t_onDragStart: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map._panAnim) {\r\n\t\t\tmap._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tmap\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('dragstart');\r\n\r\n\t\tif (map.options.inertia) {\r\n\t\t\tthis._positions = [];\r\n\t\t\tthis._times = [];\r\n\t\t}\r\n\t},\r\n\r\n\t_onDrag: function () {\r\n\t\tif (this._map.options.inertia) {\r\n\t\t\tvar time = this._lastTime = +new Date(),\r\n\t\t\t    pos = this._lastPos = this._draggable._newPos;\r\n\r\n\t\t\tthis._positions.push(pos);\r\n\t\t\tthis._times.push(time);\r\n\r\n\t\t\tif (time - this._times[0] > 200) {\r\n\t\t\t\tthis._positions.shift();\r\n\t\t\t\tthis._times.shift();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._map\r\n\t\t    .fire('move')\r\n\t\t    .fire('drag');\r\n\t},\r\n\r\n\t_onViewReset: function () {\r\n\t\t// TODO fix hardcoded Earth values\r\n\t\tvar pxCenter = this._map.getSize()._divideBy(2),\r\n\t\t    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\r\n\r\n\t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\r\n\t\tthis._worldWidth = this._map.project([0, 180]).x;\r\n\t},\r\n\r\n\t_onPreDrag: function () {\r\n\t\t// TODO refactor to be able to adjust map pane position after zoom\r\n\t\tvar worldWidth = this._worldWidth,\r\n\t\t    halfWidth = Math.round(worldWidth / 2),\r\n\t\t    dx = this._initialWorldOffset,\r\n\t\t    x = this._draggable._newPos.x,\r\n\t\t    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\r\n\t\t    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\r\n\t\t    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\r\n\r\n\t\tthis._draggable._newPos.x = newX;\r\n\t},\r\n\r\n\t_onDragEnd: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    options = map.options,\r\n\t\t    delay = +new Date() - this._lastTime,\r\n\r\n\t\t    noInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];\r\n\r\n\t\tmap.fire('dragend', e);\r\n\r\n\t\tif (noInertia) {\r\n\t\t\tmap.fire('moveend');\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\r\n\t\t\t    duration = (this._lastTime + delay - this._times[0]) / 1000,\r\n\t\t\t    ease = options.easeLinearity,\r\n\r\n\t\t\t    speedVector = direction.multiplyBy(ease / duration),\r\n\t\t\t    speed = speedVector.distanceTo([0, 0]),\r\n\r\n\t\t\t    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\r\n\t\t\t    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\r\n\r\n\t\t\t    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\r\n\t\t\t    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\r\n\r\n\t\t\tif (!offset.x || !offset.y) {\r\n\t\t\t\tmap.fire('moveend');\r\n\r\n\t\t\t} else {\r\n\t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\r\n\r\n\t\t\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\t\t\tmap.panBy(offset, {\r\n\t\t\t\t\t\tduration: decelerationDuration,\r\n\t\t\t\t\t\teaseLinearity: ease,\r\n\t\t\t\t\t\tnoMoveStart: true\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);\r\n\r\n\r\n/*\r\n * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tdoubleClickZoom: true\r\n});\r\n\r\nL.Map.DoubleClickZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tthis._map.on('dblclick', this._onDoubleClick, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._map.off('dblclick', this._onDoubleClick, this);\r\n\t},\r\n\r\n\t_onDoubleClick: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);\r\n\r\n\t\tif (map.options.doubleClickZoom === 'center') {\r\n\t\t\tmap.setZoom(zoom);\r\n\t\t} else {\r\n\t\t\tmap.setZoomAround(e.containerPoint, zoom);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);\r\n\r\n\r\n/*\r\n * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tscrollWheelZoom: true\r\n});\r\n\r\nL.Map.ScrollWheelZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);\r\n\t\tL.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t\tthis._delta = 0;\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);\r\n\t\tL.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);\r\n\t},\r\n\r\n\t_onWheelScroll: function (e) {\r\n\t\tvar delta = L.DomEvent.getWheelDelta(e);\r\n\r\n\t\tthis._delta += delta;\r\n\t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\r\n\r\n\t\tif (!this._startTime) {\r\n\t\t\tthis._startTime = +new Date();\r\n\t\t}\r\n\r\n\t\tvar left = Math.max(40 - (+new Date() - this._startTime), 0);\r\n\r\n\t\tclearTimeout(this._timer);\r\n\t\tthis._timer = setTimeout(L.bind(this._performZoom, this), left);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t\tL.DomEvent.stopPropagation(e);\r\n\t},\r\n\r\n\t_performZoom: function () {\r\n\t\tvar map = this._map,\r\n\t\t    delta = this._delta,\r\n\t\t    zoom = map.getZoom();\r\n\r\n\t\tdelta = delta > 0 ? Math.ceil(delta) : Math.floor(delta);\r\n\t\tdelta = Math.max(Math.min(delta, 4), -4);\r\n\t\tdelta = map._limitZoom(zoom + delta) - zoom;\r\n\r\n\t\tthis._delta = 0;\r\n\t\tthis._startTime = null;\r\n\r\n\t\tif (!delta) { return; }\r\n\r\n\t\tif (map.options.scrollWheelZoom === 'center') {\r\n\t\t\tmap.setZoom(zoom + delta);\r\n\t\t} else {\r\n\t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);\r\n\r\n\r\n/*\r\n * Extends the event handling code with double tap support for mobile browsers.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t_touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',\r\n\t_touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',\r\n\r\n\t// inspired by Zepto touch code by Thomas Fuchs\r\n\taddDoubleTapListener: function (obj, handler, id) {\r\n\t\tvar last,\r\n\t\t    doubleTap = false,\r\n\t\t    delay = 250,\r\n\t\t    touch,\r\n\t\t    pre = '_leaflet_',\r\n\t\t    touchstart = this._touchstart,\r\n\t\t    touchend = this._touchend,\r\n\t\t    trackedTouches = [];\r\n\r\n\t\tfunction onTouchStart(e) {\r\n\t\t\tvar count;\r\n\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\ttrackedTouches.push(e.pointerId);\r\n\t\t\t\tcount = trackedTouches.length;\r\n\t\t\t} else {\r\n\t\t\t\tcount = e.touches.length;\r\n\t\t\t}\r\n\t\t\tif (count > 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar now = Date.now(),\r\n\t\t\t\tdelta = now - (last || now);\r\n\r\n\t\t\ttouch = e.touches ? e.touches[0] : e;\r\n\t\t\tdoubleTap = (delta > 0 && delta <= delay);\r\n\t\t\tlast = now;\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd(e) {\r\n\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\tvar idx = trackedTouches.indexOf(e.pointerId);\r\n\t\t\t\tif (idx === -1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttrackedTouches.splice(idx, 1);\r\n\t\t\t}\r\n\r\n\t\t\tif (doubleTap) {\r\n\t\t\t\tif (L.Browser.pointer) {\r\n\t\t\t\t\t// work around .type being readonly with MSPointer* events\r\n\t\t\t\t\tvar newTouch = { },\r\n\t\t\t\t\t\tprop;\r\n\r\n\t\t\t\t\t// jshint forin:false\r\n\t\t\t\t\tfor (var i in touch) {\r\n\t\t\t\t\t\tprop = touch[i];\r\n\t\t\t\t\t\tif (typeof prop === 'function') {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop.bind(touch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnewTouch[i] = prop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttouch = newTouch;\r\n\t\t\t\t}\r\n\t\t\t\ttouch.type = 'dblclick';\r\n\t\t\t\thandler(touch);\r\n\t\t\t\tlast = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tobj[pre + touchstart + id] = onTouchStart;\r\n\t\tobj[pre + touchend + id] = onTouchEnd;\r\n\r\n\t\t// on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen\r\n\t\t// will not come through to us, so we will lose track of how many touches are ongoing\r\n\t\tvar endElement = L.Browser.pointer ? document.documentElement : obj;\r\n\r\n\t\tobj.addEventListener(touchstart, onTouchStart, false);\r\n\t\tendElement.addEventListener(touchend, onTouchEnd, false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tendElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveDoubleTapListener: function (obj, id) {\r\n\t\tvar pre = '_leaflet_';\r\n\r\n\t\tobj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);\r\n\t\t(L.Browser.pointer ? document.documentElement : obj).removeEventListener(\r\n\t\t        this._touchend, obj[pre + this._touchend + id], false);\r\n\r\n\t\tif (L.Browser.pointer) {\r\n\t\t\tdocument.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],\r\n\t\t\t\tfalse);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\r\n */\r\n\r\nL.extend(L.DomEvent, {\r\n\r\n\t//static\r\n\tPOINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',\r\n\tPOINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',\r\n\tPOINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',\r\n\tPOINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',\r\n\r\n\t_pointers: [],\r\n\t_pointerDocumentListener: false,\r\n\r\n\t// Provides a touch events wrapper for (ms)pointer events.\r\n\t// Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019\r\n\t//ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\r\n\r\n\taddPointerListener: function (obj, type, handler, id) {\r\n\r\n\t\tswitch (type) {\r\n\t\tcase 'touchstart':\r\n\t\t\treturn this.addPointerListenerStart(obj, type, handler, id);\r\n\t\tcase 'touchend':\r\n\t\t\treturn this.addPointerListenerEnd(obj, type, handler, id);\r\n\t\tcase 'touchmove':\r\n\t\t\treturn this.addPointerListenerMove(obj, type, handler, id);\r\n\t\tdefault:\r\n\t\t\tthrow 'Unknown touch event type';\r\n\t\t}\r\n\t},\r\n\r\n\taddPointerListenerStart: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    pointers = this._pointers;\r\n\r\n\t\tvar cb = function (e) {\r\n\t\t\tif (e.pointerType !== 'mouse' && e.pointerType !== e.MSPOINTER_TYPE_MOUSE) {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t}\r\n\r\n\t\t\tvar alreadyInArray = false;\r\n\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\talreadyInArray = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!alreadyInArray) {\r\n\t\t\t\tpointers.push(e);\r\n\t\t\t}\r\n\r\n\t\t\te.touches = pointers.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t};\r\n\r\n\t\tobj[pre + 'touchstart' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_DOWN, cb, false);\r\n\r\n\t\t// need to also listen for end events to keep the _pointers list accurate\r\n\t\t// this needs to be on the body and never go away\r\n\t\tif (!this._pointerDocumentListener) {\r\n\t\t\tvar internalCb = function (e) {\r\n\t\t\t\tfor (var i = 0; i < pointers.length; i++) {\r\n\t\t\t\t\tif (pointers[i].pointerId === e.pointerId) {\r\n\t\t\t\t\t\tpointers.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t//We listen on the documentElement as any drags that end by moving the touch off the screen get fired there\r\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_UP, internalCb, false);\r\n\t\t\tdocument.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);\r\n\r\n\t\t\tthis._pointerDocumentListener = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddPointerListenerMove: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    touches = this._pointers;\r\n\r\n\t\tfunction cb(e) {\r\n\r\n\t\t\t// don't fire touch moves when mouse isn't down\r\n\t\t\tif ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }\r\n\r\n\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\ttouches[i] = e;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.touches = touches.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t}\r\n\r\n\t\tobj[pre + 'touchmove' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_MOVE, cb, false);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddPointerListenerEnd: function (obj, type, handler, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    touches = this._pointers;\r\n\r\n\t\tvar cb = function (e) {\r\n\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\tif (touches[i].pointerId === e.pointerId) {\r\n\t\t\t\t\ttouches.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.touches = touches.slice();\r\n\t\t\te.changedTouches = [e];\r\n\r\n\t\t\thandler(e);\r\n\t\t};\r\n\r\n\t\tobj[pre + 'touchend' + id] = cb;\r\n\t\tobj.addEventListener(this.POINTER_UP, cb, false);\r\n\t\tobj.addEventListener(this.POINTER_CANCEL, cb, false);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremovePointerListener: function (obj, type, id) {\r\n\t\tvar pre = '_leaflet_',\r\n\t\t    cb = obj[pre + type + id];\r\n\r\n\t\tswitch (type) {\r\n\t\tcase 'touchstart':\r\n\t\t\tobj.removeEventListener(this.POINTER_DOWN, cb, false);\r\n\t\t\tbreak;\r\n\t\tcase 'touchmove':\r\n\t\t\tobj.removeEventListener(this.POINTER_MOVE, cb, false);\r\n\t\t\tbreak;\r\n\t\tcase 'touchend':\r\n\t\t\tobj.removeEventListener(this.POINTER_UP, cb, false);\r\n\t\t\tobj.removeEventListener(this.POINTER_CANCEL, cb, false);\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\ttouchZoom: L.Browser.touch && !L.Browser.android23,\r\n\tbounceAtZoomLimits: true\r\n});\r\n\r\nL.Map.TouchZoom = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);\r\n\t},\r\n\r\n\t_onTouchStart: function (e) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\r\n\r\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]),\r\n\t\t    viewCenter = map._getCenterLayerPoint();\r\n\r\n\t\tthis._startCenter = p1.add(p2)._divideBy(2);\r\n\t\tthis._startDist = p1.distanceTo(p2);\r\n\r\n\t\tthis._moved = false;\r\n\t\tthis._zooming = true;\r\n\r\n\t\tthis._centerOffset = viewCenter.subtract(this._startCenter);\r\n\r\n\t\tif (map._panAnim) {\r\n\t\t\tmap._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, 'touchmove', this._onTouchMove, this)\r\n\t\t    .on(document, 'touchend', this._onTouchEnd, this);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t},\r\n\r\n\t_onTouchMove: function (e) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\r\n\r\n\t\tvar p1 = map.mouseEventToLayerPoint(e.touches[0]),\r\n\t\t    p2 = map.mouseEventToLayerPoint(e.touches[1]);\r\n\r\n\t\tthis._scale = p1.distanceTo(p2) / this._startDist;\r\n\t\tthis._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);\r\n\r\n\t\tif (this._scale === 1) { return; }\r\n\r\n\t\tif (!map.options.bounceAtZoomLimits) {\r\n\t\t\tif ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||\r\n\t\t\t    (map.getZoom() === map.getMaxZoom() && this._scale > 1)) { return; }\r\n\t\t}\r\n\r\n\t\tif (!this._moved) {\r\n\t\t\tL.DomUtil.addClass(map._mapPane, 'leaflet-touching');\r\n\r\n\t\t\tmap\r\n\t\t\t    .fire('movestart')\r\n\t\t\t    .fire('zoomstart');\r\n\r\n\t\t\tthis._moved = true;\r\n\t\t}\r\n\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\t\tthis._animRequest = L.Util.requestAnimFrame(\r\n\t\t        this._updateOnMove, this, true, this._map._container);\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\t},\r\n\r\n\t_updateOnMove: function () {\r\n\t\tvar map = this._map,\r\n\t\t    origin = this._getScaleOrigin(),\r\n\t\t    center = map.layerPointToLatLng(origin),\r\n\t\t    zoom = map.getScaleZoom(this._scale);\r\n\r\n\t\tmap._animateZoom(center, zoom, this._startCenter, this._scale, this._delta, false, true);\r\n\t},\r\n\r\n\t_onTouchEnd: function () {\r\n\t\tif (!this._moved || !this._zooming) {\r\n\t\t\tthis._zooming = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar map = this._map;\r\n\r\n\t\tthis._zooming = false;\r\n\t\tL.DomUtil.removeClass(map._mapPane, 'leaflet-touching');\r\n\t\tL.Util.cancelAnimFrame(this._animRequest);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(document, 'touchmove', this._onTouchMove)\r\n\t\t    .off(document, 'touchend', this._onTouchEnd);\r\n\r\n\t\tvar origin = this._getScaleOrigin(),\r\n\t\t    center = map.layerPointToLatLng(origin),\r\n\r\n\t\t    oldZoom = map.getZoom(),\r\n\t\t    floatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,\r\n\t\t    roundZoomDelta = (floatZoomDelta > 0 ?\r\n\t\t            Math.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),\r\n\r\n\t\t    zoom = map._limitZoom(oldZoom + roundZoomDelta),\r\n\t\t    scale = map.getZoomScale(zoom) / this._scale;\r\n\r\n\t\tmap._animateZoom(center, zoom, origin, scale);\r\n\t},\r\n\r\n\t_getScaleOrigin: function () {\r\n\t\tvar centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);\r\n\t\treturn this._startCenter.add(centerOffset);\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);\r\n\r\n\r\n/*\r\n * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\ttap: true,\r\n\ttapTolerance: 15\r\n});\r\n\r\nL.Map.Tap = L.Handler.extend({\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);\r\n\t},\r\n\r\n\t_onDown: function (e) {\r\n\t\tif (!e.touches) { return; }\r\n\r\n\t\tL.DomEvent.preventDefault(e);\r\n\r\n\t\tthis._fireClick = true;\r\n\r\n\t\t// don't simulate click or track longpress if more than 1 touch\r\n\t\tif (e.touches.length > 1) {\r\n\t\t\tthis._fireClick = false;\r\n\t\t\tclearTimeout(this._holdTimeout);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar first = e.touches[0],\r\n\t\t    el = first.target;\r\n\r\n\t\tthis._startPos = this._newPos = new L.Point(first.clientX, first.clientY);\r\n\r\n\t\t// if touching a link, highlight it\r\n\t\tif (el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\tL.DomUtil.addClass(el, 'leaflet-active');\r\n\t\t}\r\n\r\n\t\t// simulate long hold but setting a timeout\r\n\t\tthis._holdTimeout = setTimeout(L.bind(function () {\r\n\t\t\tif (this._isTapValid()) {\r\n\t\t\t\tthis._fireClick = false;\r\n\t\t\t\tthis._onUp();\r\n\t\t\t\tthis._simulateEvent('contextmenu', first);\r\n\t\t\t}\r\n\t\t}, this), 1000);\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.on(document, 'touchmove', this._onMove, this)\r\n\t\t\t.on(document, 'touchend', this._onUp, this);\r\n\t},\r\n\r\n\t_onUp: function (e) {\r\n\t\tclearTimeout(this._holdTimeout);\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.off(document, 'touchmove', this._onMove, this)\r\n\t\t\t.off(document, 'touchend', this._onUp, this);\r\n\r\n\t\tif (this._fireClick && e && e.changedTouches) {\r\n\r\n\t\t\tvar first = e.changedTouches[0],\r\n\t\t\t    el = first.target;\r\n\r\n\t\t\tif (el && el.tagName && el.tagName.toLowerCase() === 'a') {\r\n\t\t\t\tL.DomUtil.removeClass(el, 'leaflet-active');\r\n\t\t\t}\r\n\r\n\t\t\t// simulate click if the touch didn't move too much\r\n\t\t\tif (this._isTapValid()) {\r\n\t\t\t\tthis._simulateEvent('click', first);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_isTapValid: function () {\r\n\t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\r\n\t},\r\n\r\n\t_onMove: function (e) {\r\n\t\tvar first = e.touches[0];\r\n\t\tthis._newPos = new L.Point(first.clientX, first.clientY);\r\n\t},\r\n\r\n\t_simulateEvent: function (type, e) {\r\n\t\tvar simulatedEvent = document.createEvent('MouseEvents');\r\n\r\n\t\tsimulatedEvent._simulated = true;\r\n\t\te.target._simulatedClick = true;\r\n\r\n\t\tsimulatedEvent.initMouseEvent(\r\n\t\t        type, true, true, window, 1,\r\n\t\t        e.screenX, e.screenY,\r\n\t\t        e.clientX, e.clientY,\r\n\t\t        false, false, false, false, 0, null);\r\n\r\n\t\te.target.dispatchEvent(simulatedEvent);\r\n\t}\r\n});\r\n\r\nif (L.Browser.touch && !L.Browser.pointer) {\r\n\tL.Map.addInitHook('addHandler', 'tap', L.Map.Tap);\r\n}\r\n\r\n\r\n/*\r\n * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map\r\n  * (zoom to a selected bounding box), enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tboxZoom: true\r\n});\r\n\r\nL.Map.BoxZoom = L.Handler.extend({\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._container = map._container;\r\n\t\tthis._pane = map._panes.overlayPane;\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tL.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.DomEvent.off(this._container, 'mousedown', this._onMouseDown);\r\n\t\tthis._moved = false;\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._moved;\r\n\t},\r\n\r\n\t_onMouseDown: function (e) {\r\n\t\tthis._moved = false;\r\n\r\n\t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\r\n\r\n\t\tL.DomUtil.disableTextSelection();\r\n\t\tL.DomUtil.disableImageDrag();\r\n\r\n\t\tthis._startLayerPoint = this._map.mouseEventToLayerPoint(e);\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(document, 'mousemove', this._onMouseMove, this)\r\n\t\t    .on(document, 'mouseup', this._onMouseUp, this)\r\n\t\t    .on(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tif (!this._moved) {\r\n\t\t\tthis._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);\r\n\t\t\tL.DomUtil.setPosition(this._box, this._startLayerPoint);\r\n\r\n\t\t\t//TODO refactor: move cursor to styles\r\n\t\t\tthis._container.style.cursor = 'crosshair';\r\n\t\t\tthis._map.fire('boxzoomstart');\r\n\t\t}\r\n\r\n\t\tvar startPoint = this._startLayerPoint,\r\n\t\t    box = this._box,\r\n\r\n\t\t    layerPoint = this._map.mouseEventToLayerPoint(e),\r\n\t\t    offset = layerPoint.subtract(startPoint),\r\n\r\n\t\t    newPos = new L.Point(\r\n\t\t        Math.min(layerPoint.x, startPoint.x),\r\n\t\t        Math.min(layerPoint.y, startPoint.y));\r\n\r\n\t\tL.DomUtil.setPosition(box, newPos);\r\n\r\n\t\tthis._moved = true;\r\n\r\n\t\t// TODO refactor: remove hardcoded 4 pixels\r\n\t\tbox.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';\r\n\t\tbox.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';\r\n\t},\r\n\r\n\t_finish: function () {\r\n\t\tif (this._moved) {\r\n\t\t\tthis._pane.removeChild(this._box);\r\n\t\t\tthis._container.style.cursor = '';\r\n\t\t}\r\n\r\n\t\tL.DomUtil.enableTextSelection();\r\n\t\tL.DomUtil.enableImageDrag();\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(document, 'mousemove', this._onMouseMove)\r\n\t\t    .off(document, 'mouseup', this._onMouseUp)\r\n\t\t    .off(document, 'keydown', this._onKeyDown);\r\n\t},\r\n\r\n\t_onMouseUp: function (e) {\r\n\r\n\t\tthis._finish();\r\n\r\n\t\tvar map = this._map,\r\n\t\t    layerPoint = map.mouseEventToLayerPoint(e);\r\n\r\n\t\tif (this._startLayerPoint.equals(layerPoint)) { return; }\r\n\r\n\t\tvar bounds = new L.LatLngBounds(\r\n\t\t        map.layerPointToLatLng(this._startLayerPoint),\r\n\t\t        map.layerPointToLatLng(layerPoint));\r\n\r\n\t\tmap.fitBounds(bounds);\r\n\r\n\t\tmap.fire('boxzoomend', {\r\n\t\t\tboxZoomBounds: bounds\r\n\t\t});\r\n\t},\r\n\r\n\t_onKeyDown: function (e) {\r\n\t\tif (e.keyCode === 27) {\r\n\t\t\tthis._finish();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);\r\n\r\n\r\n/*\r\n * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tkeyboard: true,\r\n\tkeyboardPanOffset: 80,\r\n\tkeyboardZoomOffset: 1\r\n});\r\n\r\nL.Map.Keyboard = L.Handler.extend({\r\n\r\n\tkeyCodes: {\r\n\t\tleft:    [37],\r\n\t\tright:   [39],\r\n\t\tdown:    [40],\r\n\t\tup:      [38],\r\n\t\tzoomIn:  [187, 107, 61, 171],\r\n\t\tzoomOut: [189, 109, 173]\r\n\t},\r\n\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._setPanOffset(map.options.keyboardPanOffset);\r\n\t\tthis._setZoomOffset(map.options.keyboardZoomOffset);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar container = this._map._container;\r\n\r\n\t\t// make the container focusable by tabbing\r\n\t\tif (container.tabIndex === -1) {\r\n\t\t\tcontainer.tabIndex = '0';\r\n\t\t}\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(container, 'focus', this._onFocus, this)\r\n\t\t    .on(container, 'blur', this._onBlur, this)\r\n\t\t    .on(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\tthis._map\r\n\t\t    .on('focus', this._addHooks, this)\r\n\t\t    .on('blur', this._removeHooks, this);\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._removeHooks();\r\n\r\n\t\tvar container = this._map._container;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .off(container, 'focus', this._onFocus, this)\r\n\t\t    .off(container, 'blur', this._onBlur, this)\r\n\t\t    .off(container, 'mousedown', this._onMouseDown, this);\r\n\r\n\t\tthis._map\r\n\t\t    .off('focus', this._addHooks, this)\r\n\t\t    .off('blur', this._removeHooks, this);\r\n\t},\r\n\r\n\t_onMouseDown: function () {\r\n\t\tif (this._focused) { return; }\r\n\r\n\t\tvar body = document.body,\r\n\t\t    docEl = document.documentElement,\r\n\t\t    top = body.scrollTop || docEl.scrollTop,\r\n\t\t    left = body.scrollLeft || docEl.scrollLeft;\r\n\r\n\t\tthis._map._container.focus();\r\n\r\n\t\twindow.scrollTo(left, top);\r\n\t},\r\n\r\n\t_onFocus: function () {\r\n\t\tthis._focused = true;\r\n\t\tthis._map.fire('focus');\r\n\t},\r\n\r\n\t_onBlur: function () {\r\n\t\tthis._focused = false;\r\n\t\tthis._map.fire('blur');\r\n\t},\r\n\r\n\t_setPanOffset: function (pan) {\r\n\t\tvar keys = this._panKeys = {},\r\n\t\t    codes = this.keyCodes,\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = codes.left.length; i < len; i++) {\r\n\t\t\tkeys[codes.left[i]] = [-1 * pan, 0];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.right.length; i < len; i++) {\r\n\t\t\tkeys[codes.right[i]] = [pan, 0];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.down.length; i < len; i++) {\r\n\t\t\tkeys[codes.down[i]] = [0, pan];\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.up.length; i < len; i++) {\r\n\t\t\tkeys[codes.up[i]] = [0, -1 * pan];\r\n\t\t}\r\n\t},\r\n\r\n\t_setZoomOffset: function (zoom) {\r\n\t\tvar keys = this._zoomKeys = {},\r\n\t\t    codes = this.keyCodes,\r\n\t\t    i, len;\r\n\r\n\t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\r\n\t\t\tkeys[codes.zoomIn[i]] = zoom;\r\n\t\t}\r\n\t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\r\n\t\t\tkeys[codes.zoomOut[i]] = -zoom;\r\n\t\t}\r\n\t},\r\n\r\n\t_addHooks: function () {\r\n\t\tL.DomEvent.on(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_removeHooks: function () {\r\n\t\tL.DomEvent.off(document, 'keydown', this._onKeyDown, this);\r\n\t},\r\n\r\n\t_onKeyDown: function (e) {\r\n\t\tvar key = e.keyCode,\r\n\t\t    map = this._map;\r\n\r\n\t\tif (key in this._panKeys) {\r\n\r\n\t\t\tif (map._panAnim && map._panAnim._inProgress) { return; }\r\n\r\n\t\t\tmap.panBy(this._panKeys[key]);\r\n\r\n\t\t\tif (map.options.maxBounds) {\r\n\t\t\t\tmap.panInsideBounds(map.options.maxBounds);\r\n\t\t\t}\r\n\r\n\t\t} else if (key in this._zoomKeys) {\r\n\t\t\tmap.setZoom(map.getZoom() + this._zoomKeys[key]);\r\n\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tL.DomEvent.stop(e);\r\n\t}\r\n});\r\n\r\nL.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);\r\n\r\n\r\n/*\r\n * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\r\n */\r\n\r\nL.Handler.MarkerDrag = L.Handler.extend({\r\n\tinitialize: function (marker) {\r\n\t\tthis._marker = marker;\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar icon = this._marker._icon;\r\n\t\tif (!this._draggable) {\r\n\t\t\tthis._draggable = new L.Draggable(icon, icon);\r\n\t\t}\r\n\r\n\t\tthis._draggable\r\n\t\t\t.on('dragstart', this._onDragStart, this)\r\n\t\t\t.on('drag', this._onDrag, this)\r\n\t\t\t.on('dragend', this._onDragEnd, this);\r\n\t\tthis._draggable.enable();\r\n\t\tL.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tthis._draggable\r\n\t\t\t.off('dragstart', this._onDragStart, this)\r\n\t\t\t.off('drag', this._onDrag, this)\r\n\t\t\t.off('dragend', this._onDragEnd, this);\r\n\r\n\t\tthis._draggable.disable();\r\n\t\tL.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');\r\n\t},\r\n\r\n\tmoved: function () {\r\n\t\treturn this._draggable && this._draggable._moved;\r\n\t},\r\n\r\n\t_onDragStart: function () {\r\n\t\tthis._marker\r\n\t\t    .closePopup()\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('dragstart');\r\n\t},\r\n\r\n\t_onDrag: function () {\r\n\t\tvar marker = this._marker,\r\n\t\t    shadow = marker._shadow,\r\n\t\t    iconPos = L.DomUtil.getPosition(marker._icon),\r\n\t\t    latlng = marker._map.layerPointToLatLng(iconPos);\r\n\r\n\t\t// update shadow position\r\n\t\tif (shadow) {\r\n\t\t\tL.DomUtil.setPosition(shadow, iconPos);\r\n\t\t}\r\n\r\n\t\tmarker._latlng = latlng;\r\n\r\n\t\tmarker\r\n\t\t    .fire('move', {latlng: latlng})\r\n\t\t    .fire('drag');\r\n\t},\r\n\r\n\t_onDragEnd: function (e) {\r\n\t\tthis._marker\r\n\t\t    .fire('moveend')\r\n\t\t    .fire('dragend', e);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Control is a base class for implementing map controls. Handles positioning.\r\n * All other controls extend from this class.\r\n */\r\n\r\nL.Control = L.Class.extend({\r\n\toptions: {\r\n\t\tposition: 'topright'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\t\treturn this.options.position;\r\n\t},\r\n\r\n\tsetPosition: function (position) {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.removeControl(this);\r\n\t\t}\r\n\r\n\t\tthis.options.position = position;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.addControl(this);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tgetContainer: function () {\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar container = this._container = this.onAdd(map),\r\n\t\t    pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-control');\r\n\r\n\t\tif (pos.indexOf('bottom') !== -1) {\r\n\t\t\tcorner.insertBefore(container, corner.firstChild);\r\n\t\t} else {\r\n\t\t\tcorner.appendChild(container);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveFrom: function (map) {\r\n\t\tvar pos = this.getPosition(),\r\n\t\t    corner = map._controlCorners[pos];\r\n\r\n\t\tcorner.removeChild(this._container);\r\n\t\tthis._map = null;\r\n\r\n\t\tif (this.onRemove) {\r\n\t\t\tthis.onRemove(map);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_refocusOnMap: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._map.getContainer().focus();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.control = function (options) {\r\n\treturn new L.Control(options);\r\n};\r\n\r\n\r\n// adds control-related methods to L.Map\r\n\r\nL.Map.include({\r\n\taddControl: function (control) {\r\n\t\tcontrol.addTo(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveControl: function (control) {\r\n\t\tcontrol.removeFrom(this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initControlPos: function () {\r\n\t\tvar corners = this._controlCorners = {},\r\n\t\t    l = 'leaflet-',\r\n\t\t    container = this._controlContainer =\r\n\t\t            L.DomUtil.create('div', l + 'control-container', this._container);\r\n\r\n\t\tfunction createCorner(vSide, hSide) {\r\n\t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n\t\t\tcorners[vSide + hSide] = L.DomUtil.create('div', className, container);\r\n\t\t}\r\n\r\n\t\tcreateCorner('top', 'left');\r\n\t\tcreateCorner('top', 'right');\r\n\t\tcreateCorner('bottom', 'left');\r\n\t\tcreateCorner('bottom', 'right');\r\n\t},\r\n\r\n\t_clearControlPos: function () {\r\n\t\tthis._container.removeChild(this._controlContainer);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.Control.Zoom is used for the default zoom buttons on the map.\r\n */\r\n\r\nL.Control.Zoom = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'topleft',\r\n\t\tzoomInText: '+',\r\n\t\tzoomInTitle: 'Zoom in',\r\n\t\tzoomOutText: '-',\r\n\t\tzoomOutTitle: 'Zoom out'\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tvar zoomName = 'leaflet-control-zoom',\r\n\t\t    container = L.DomUtil.create('div', zoomName + ' leaflet-bar');\r\n\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._zoomInButton  = this._createButton(\r\n\t\t        this.options.zoomInText, this.options.zoomInTitle,\r\n\t\t        zoomName + '-in',  container, this._zoomIn,  this);\r\n\t\tthis._zoomOutButton = this._createButton(\r\n\t\t        this.options.zoomOutText, this.options.zoomOutTitle,\r\n\t\t        zoomName + '-out', container, this._zoomOut, this);\r\n\r\n\t\tthis._updateDisabled();\r\n\t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\t},\r\n\r\n\t_zoomIn: function (e) {\r\n\t\tthis._map.zoomIn(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_zoomOut: function (e) {\r\n\t\tthis._map.zoomOut(e.shiftKey ? 3 : 1);\r\n\t},\r\n\r\n\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.innerHTML = html;\r\n\t\tlink.href = '#';\r\n\t\tlink.title = title;\r\n\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tL.DomEvent\r\n\t\t    .on(link, 'click', stop)\r\n\t\t    .on(link, 'mousedown', stop)\r\n\t\t    .on(link, 'dblclick', stop)\r\n\t\t    .on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t    .on(link, 'click', fn, context)\r\n\t\t    .on(link, 'click', this._refocusOnMap, context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_updateDisabled: function () {\r\n\t\tvar map = this._map,\r\n\t\t\tclassName = 'leaflet-disabled';\r\n\r\n\t\tL.DomUtil.removeClass(this._zoomInButton, className);\r\n\t\tL.DomUtil.removeClass(this._zoomOutButton, className);\r\n\r\n\t\tif (map._zoom === map.getMinZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomOutButton, className);\r\n\t\t}\r\n\t\tif (map._zoom === map.getMaxZoom()) {\r\n\t\t\tL.DomUtil.addClass(this._zoomInButton, className);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tzoomControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.zoomControl) {\r\n\t\tthis.zoomControl = new L.Control.Zoom();\r\n\t\tthis.addControl(this.zoomControl);\r\n\t}\r\n});\r\n\r\nL.control.zoom = function (options) {\r\n\treturn new L.Control.Zoom(options);\r\n};\r\n\r\n\r\n\r\n/*\r\n * L.Control.Attribution is used for displaying attribution on the map (added by default).\r\n */\r\n\r\nL.Control.Attribution = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomright',\r\n\t\tprefix: '<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>'\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._attributions = {};\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-attribution');\r\n\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\r\n\t\tfor (var i in map._layers) {\r\n\t\t\tif (map._layers[i].getAttribution) {\r\n\t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerAdd, this)\r\n\t\t    .on('layerremove', this._onLayerRemove, this);\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerAdd)\r\n\t\t    .off('layerremove', this._onLayerRemove);\r\n\r\n\t},\r\n\r\n\tsetPrefix: function (prefix) {\r\n\t\tthis.options.prefix = prefix;\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (!this._attributions[text]) {\r\n\t\t\tthis._attributions[text] = 0;\r\n\t\t}\r\n\t\tthis._attributions[text]++;\r\n\r\n\t\tthis._update();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveAttribution: function (text) {\r\n\t\tif (!text) { return; }\r\n\r\n\t\tif (this._attributions[text]) {\r\n\t\t\tthis._attributions[text]--;\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tvar attribs = [];\r\n\r\n\t\tfor (var i in this._attributions) {\r\n\t\t\tif (this._attributions[i]) {\r\n\t\t\t\tattribs.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar prefixAndAttribs = [];\r\n\r\n\t\tif (this.options.prefix) {\r\n\t\t\tprefixAndAttribs.push(this.options.prefix);\r\n\t\t}\r\n\t\tif (attribs.length) {\r\n\t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n\t\t}\r\n\r\n\t\tthis._container.innerHTML = prefixAndAttribs.join(' | ');\r\n\t},\r\n\r\n\t_onLayerAdd: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.addAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t},\r\n\r\n\t_onLayerRemove: function (e) {\r\n\t\tif (e.layer.getAttribution) {\r\n\t\t\tthis.removeAttribution(e.layer.getAttribution());\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tattributionControl: true\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.attributionControl) {\r\n\t\tthis.attributionControl = (new L.Control.Attribution()).addTo(this);\r\n\t}\r\n});\r\n\r\nL.control.attribution = function (options) {\r\n\treturn new L.Control.Attribution(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Control.Scale is used for displaying metric/imperial scale on the map.\r\n */\r\n\r\nL.Control.Scale = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomleft',\r\n\t\tmaxWidth: 100,\r\n\t\tmetric: true,\r\n\t\timperial: true,\r\n\t\tupdateWhenIdle: false\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tvar className = 'leaflet-control-scale',\r\n\t\t    container = L.DomUtil.create('div', className),\r\n\t\t    options = this.options;\r\n\r\n\t\tthis._addScales(options, className, container);\r\n\r\n\t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t\tmap.whenReady(this._update, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\r\n\t},\r\n\r\n\t_addScales: function (options, className, container) {\r\n\t\tif (options.metric) {\r\n\t\t\tthis._mScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t}\r\n\t\tif (options.imperial) {\r\n\t\t\tthis._iScale = L.DomUtil.create('div', className + '-line', container);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tvar bounds = this._map.getBounds(),\r\n\t\t    centerLat = bounds.getCenter().lat,\r\n\t\t    halfWorldMeters = 6378137 * Math.PI * Math.cos(centerLat * Math.PI / 180),\r\n\t\t    dist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,\r\n\r\n\t\t    size = this._map.getSize(),\r\n\t\t    options = this.options,\r\n\t\t    maxMeters = 0;\r\n\r\n\t\tif (size.x > 0) {\r\n\t\t\tmaxMeters = dist * (options.maxWidth / size.x);\r\n\t\t}\r\n\r\n\t\tthis._updateScales(options, maxMeters);\r\n\t},\r\n\r\n\t_updateScales: function (options, maxMeters) {\r\n\t\tif (options.metric && maxMeters) {\r\n\t\t\tthis._updateMetric(maxMeters);\r\n\t\t}\r\n\r\n\t\tif (options.imperial && maxMeters) {\r\n\t\t\tthis._updateImperial(maxMeters);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateMetric: function (maxMeters) {\r\n\t\tvar meters = this._getRoundNum(maxMeters);\r\n\r\n\t\tthis._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';\r\n\t\tthis._mScale.innerHTML = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\r\n\t},\r\n\r\n\t_updateImperial: function (maxMeters) {\r\n\t\tvar maxFeet = maxMeters * 3.2808399,\r\n\t\t    scale = this._iScale,\r\n\t\t    maxMiles, miles, feet;\r\n\r\n\t\tif (maxFeet > 5280) {\r\n\t\t\tmaxMiles = maxFeet / 5280;\r\n\t\t\tmiles = this._getRoundNum(maxMiles);\r\n\r\n\t\t\tscale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';\r\n\t\t\tscale.innerHTML = miles + ' mi';\r\n\r\n\t\t} else {\r\n\t\t\tfeet = this._getRoundNum(maxFeet);\r\n\r\n\t\t\tscale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';\r\n\t\t\tscale.innerHTML = feet + ' ft';\r\n\t\t}\r\n\t},\r\n\r\n\t_getScaleWidth: function (ratio) {\r\n\t\treturn Math.round(this.options.maxWidth * ratio) - 10;\r\n\t},\r\n\r\n\t_getRoundNum: function (num) {\r\n\t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\r\n\t\t    d = num / pow10;\r\n\r\n\t\td = d >= 10 ? 10 : d >= 5 ? 5 : d >= 3 ? 3 : d >= 2 ? 2 : 1;\r\n\r\n\t\treturn pow10 * d;\r\n\t}\r\n});\r\n\r\nL.control.scale = function (options) {\r\n\treturn new L.Control.Scale(options);\r\n};\r\n\r\n\r\n/*\r\n * L.Control.Layers is a control to allow users to switch between different layers on the map.\r\n */\r\n\r\nL.Control.Layers = L.Control.extend({\r\n\toptions: {\r\n\t\tcollapsed: true,\r\n\t\tposition: 'topright',\r\n\t\tautoZIndex: true\r\n\t},\r\n\r\n\tinitialize: function (baseLayers, overlays, options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._layers = {};\r\n\t\tthis._lastZIndex = 0;\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tfor (var i in baseLayers) {\r\n\t\t\tthis._addLayer(baseLayers[i], i);\r\n\t\t}\r\n\r\n\t\tfor (i in overlays) {\r\n\t\t\tthis._addLayer(overlays[i], i, true);\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._initLayout();\r\n\t\tthis._update();\r\n\r\n\t\tmap\r\n\t\t    .on('layeradd', this._onLayerChange, this)\r\n\t\t    .on('layerremove', this._onLayerChange, this);\r\n\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tmap\r\n\t\t    .off('layeradd', this._onLayerChange, this)\r\n\t\t    .off('layerremove', this._onLayerChange, this);\r\n\t},\r\n\r\n\taddBaseLayer: function (layer, name) {\r\n\t\tthis._addLayer(layer, name);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddOverlay: function (layer, name) {\r\n\t\tthis._addLayer(layer, name, true);\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveLayer: function (layer) {\r\n\t\tvar id = L.stamp(layer);\r\n\t\tdelete this._layers[id];\r\n\t\tthis._update();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tvar className = 'leaflet-control-layers',\r\n\t\t    container = this._container = L.DomUtil.create('div', className);\r\n\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!L.Browser.touch) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container)\r\n\t\t\t\t.disableScrollPropagation(container);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\tvar form = this._form = L.DomUtil.create('form', className + '-list');\r\n\r\n\t\tif (this.options.collapsed) {\r\n\t\t\tif (!L.Browser.android) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(container, 'mouseover', this._expand, this)\r\n\t\t\t\t    .on(container, 'mouseout', this._collapse, this);\r\n\t\t\t}\r\n\t\t\tvar link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);\r\n\t\t\tlink.href = '#';\r\n\t\t\tlink.title = 'Layers';\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tL.DomEvent\r\n\t\t\t\t    .on(link, 'click', L.DomEvent.stop)\r\n\t\t\t\t    .on(link, 'click', this._expand, this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tL.DomEvent.on(link, 'focus', this._expand, this);\r\n\t\t\t}\r\n\t\t\t//Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033\r\n\t\t\tL.DomEvent.on(form, 'click', function () {\r\n\t\t\t\tsetTimeout(L.bind(this._onInputClick, this), 0);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t// TODO keyboard accessibility\r\n\t\t} else {\r\n\t\t\tthis._expand();\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList = L.DomUtil.create('div', className + '-base', form);\r\n\t\tthis._separator = L.DomUtil.create('div', className + '-separator', form);\r\n\t\tthis._overlaysList = L.DomUtil.create('div', className + '-overlays', form);\r\n\r\n\t\tcontainer.appendChild(form);\r\n\t},\r\n\r\n\t_addLayer: function (layer, name, overlay) {\r\n\t\tvar id = L.stamp(layer);\r\n\r\n\t\tthis._layers[id] = {\r\n\t\t\tlayer: layer,\r\n\t\t\tname: name,\r\n\t\t\toverlay: overlay\r\n\t\t};\r\n\r\n\t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n\t\t\tthis._lastZIndex++;\r\n\t\t\tlayer.setZIndex(this._lastZIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._container) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._baseLayersList.innerHTML = '';\r\n\t\tthis._overlaysList.innerHTML = '';\r\n\r\n\t\tvar baseLayersPresent = false,\r\n\t\t    overlaysPresent = false,\r\n\t\t    i, obj;\r\n\r\n\t\tfor (i in this._layers) {\r\n\t\t\tobj = this._layers[i];\r\n\t\t\tthis._addItem(obj);\r\n\t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n\t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n\t\t}\r\n\r\n\t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\t},\r\n\r\n\t_onLayerChange: function (e) {\r\n\t\tvar obj = this._layers[L.stamp(e.layer)];\r\n\r\n\t\tif (!obj) { return; }\r\n\r\n\t\tif (!this._handlingClick) {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\r\n\t\tvar type = obj.overlay ?\r\n\t\t\t(e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :\r\n\t\t\t(e.type === 'layeradd' ? 'baselayerchange' : null);\r\n\r\n\t\tif (type) {\r\n\t\t\tthis._map.fire(type, obj);\r\n\t\t}\r\n\t},\r\n\r\n\t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)\r\n\t_createRadioElement: function (name, checked) {\r\n\r\n\t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' + name + '\"';\r\n\t\tif (checked) {\r\n\t\t\tradioHtml += ' checked=\"checked\"';\r\n\t\t}\r\n\t\tradioHtml += '/>';\r\n\r\n\t\tvar radioFragment = document.createElement('div');\r\n\t\tradioFragment.innerHTML = radioHtml;\r\n\r\n\t\treturn radioFragment.firstChild;\r\n\t},\r\n\r\n\t_addItem: function (obj) {\r\n\t\tvar label = document.createElement('label'),\r\n\t\t    input,\r\n\t\t    checked = this._map.hasLayer(obj.layer);\r\n\r\n\t\tif (obj.overlay) {\r\n\t\t\tinput = document.createElement('input');\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t\tinput.className = 'leaflet-control-layers-selector';\r\n\t\t\tinput.defaultChecked = checked;\r\n\t\t} else {\r\n\t\t\tinput = this._createRadioElement('leaflet-base-layers', checked);\r\n\t\t}\r\n\r\n\t\tinput.layerId = L.stamp(obj.layer);\r\n\r\n\t\tL.DomEvent.on(input, 'click', this._onInputClick, this);\r\n\r\n\t\tvar name = document.createElement('span');\r\n\t\tname.innerHTML = ' ' + obj.name;\r\n\r\n\t\tlabel.appendChild(input);\r\n\t\tlabel.appendChild(name);\r\n\r\n\t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n\t\tcontainer.appendChild(label);\r\n\r\n\t\treturn label;\r\n\t},\r\n\r\n\t_onInputClick: function () {\r\n\t\tvar i, input, obj,\r\n\t\t    inputs = this._form.getElementsByTagName('input'),\r\n\t\t    inputsLen = inputs.length;\r\n\r\n\t\tthis._handlingClick = true;\r\n\r\n\t\tfor (i = 0; i < inputsLen; i++) {\r\n\t\t\tinput = inputs[i];\r\n\t\t\tobj = this._layers[input.layerId];\r\n\r\n\t\t\tif (input.checked && !this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.addLayer(obj.layer);\r\n\r\n\t\t\t} else if (!input.checked && this._map.hasLayer(obj.layer)) {\r\n\t\t\t\tthis._map.removeLayer(obj.layer);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._handlingClick = false;\r\n\r\n\t\tthis._refocusOnMap();\r\n\t},\r\n\r\n\t_expand: function () {\r\n\t\tL.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');\r\n\t},\r\n\r\n\t_collapse: function () {\r\n\t\tthis._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');\r\n\t}\r\n});\r\n\r\nL.control.layers = function (baseLayers, overlays, options) {\r\n\treturn new L.Control.Layers(baseLayers, overlays, options);\r\n};\r\n\r\n\r\n/*\r\n * L.PosAnimation is used by Leaflet internally for pan animations.\r\n */\r\n\r\nL.PosAnimation = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\tthis.stop();\r\n\r\n\t\tthis._el = el;\r\n\t\tthis._inProgress = true;\r\n\t\tthis._newPos = newPos;\r\n\r\n\t\tthis.fire('start');\r\n\r\n\t\tel.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +\r\n\t\t        's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';\r\n\r\n\t\tL.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\t\tL.DomUtil.setPosition(el, newPos);\r\n\r\n\t\t// toggle reflow, Chrome flickers for some reason if you don't do this\r\n\t\tL.Util.falseFn(el.offsetWidth);\r\n\r\n\t\t// there's no native way to track value updates of transitioned properties, so we imitate this\r\n\t\tthis._stepTimer = setInterval(L.bind(this._onStep, this), 50);\r\n\t},\r\n\r\n\tstop: function () {\r\n\t\tif (!this._inProgress) { return; }\r\n\r\n\t\t// if we just removed the transition property, the element would jump to its final position,\r\n\t\t// so we need to make it stay at the current position\r\n\r\n\t\tL.DomUtil.setPosition(this._el, this._getPos());\r\n\t\tthis._onTransitionEnd();\r\n\t\tL.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation\r\n\t},\r\n\r\n\t_onStep: function () {\r\n\t\tvar stepPos = this._getPos();\r\n\t\tif (!stepPos) {\r\n\t\t\tthis._onTransitionEnd();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// jshint camelcase: false\r\n\t\t// make L.DomUtil.getPosition return intermediate position value during animation\r\n\t\tthis._el._leaflet_pos = stepPos;\r\n\r\n\t\tthis.fire('step');\r\n\t},\r\n\r\n\t// you can't easily get intermediate values of properties animated with CSS3 Transitions,\r\n\t// we need to parse computed style (in case of transform it returns matrix string)\r\n\r\n\t_transformRe: /([-+]?(?:\\d*\\.)?\\d+)\\D*, ([-+]?(?:\\d*\\.)?\\d+)\\D*\\)/,\r\n\r\n\t_getPos: function () {\r\n\t\tvar left, top, matches,\r\n\t\t    el = this._el,\r\n\t\t    style = window.getComputedStyle(el);\r\n\r\n\t\tif (L.Browser.any3d) {\r\n\t\t\tmatches = style[L.DomUtil.TRANSFORM].match(this._transformRe);\r\n\t\t\tif (!matches) { return; }\r\n\t\t\tleft = parseFloat(matches[1]);\r\n\t\t\ttop  = parseFloat(matches[2]);\r\n\t\t} else {\r\n\t\t\tleft = parseFloat(style.left);\r\n\t\t\ttop  = parseFloat(style.top);\r\n\t\t}\r\n\r\n\t\treturn new L.Point(left, top, true);\r\n\t},\r\n\r\n\t_onTransitionEnd: function () {\r\n\t\tL.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);\r\n\r\n\t\tif (!this._inProgress) { return; }\r\n\t\tthis._inProgress = false;\r\n\r\n\t\tthis._el.style[L.DomUtil.TRANSITION] = '';\r\n\r\n\t\t// jshint camelcase: false\r\n\t\t// make sure L.DomUtil.getPosition returns the final position value after animation\r\n\t\tthis._el._leaflet_pos = this._newPos;\r\n\r\n\t\tclearInterval(this._stepTimer);\r\n\r\n\t\tthis.fire('step').fire('end');\r\n\t}\r\n\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Map to handle panning animations.\r\n */\r\n\r\nL.Map.include({\r\n\r\n\tsetView: function (center, zoom, options) {\r\n\r\n\t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\r\n\t\tcenter = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);\r\n\t\toptions = options || {};\r\n\r\n\t\tif (this._panAnim) {\r\n\t\t\tthis._panAnim.stop();\r\n\t\t}\r\n\r\n\t\tif (this._loaded && !options.reset && options !== true) {\r\n\r\n\t\t\tif (options.animate !== undefined) {\r\n\t\t\t\toptions.zoom = L.extend({animate: options.animate}, options.zoom);\r\n\t\t\t\toptions.pan = L.extend({animate: options.animate}, options.pan);\r\n\t\t\t}\r\n\r\n\t\t\t// try animating pan or zoom\r\n\t\t\tvar animated = (this._zoom !== zoom) ?\r\n\t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\r\n\t\t\t\tthis._tryAnimatedPan(center, options.pan);\r\n\r\n\t\t\tif (animated) {\r\n\t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\r\n\t\t\t\tclearTimeout(this._sizeTimer);\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// animation didn't start, just reset the map view\r\n\t\tthis._resetView(center, zoom);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tpanBy: function (offset, options) {\r\n\t\toffset = L.point(offset).round();\r\n\t\toptions = options || {};\r\n\r\n\t\tif (!offset.x && !offset.y) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (!this._panAnim) {\r\n\t\t\tthis._panAnim = new L.PosAnimation();\r\n\r\n\t\t\tthis._panAnim.on({\r\n\t\t\t\t'step': this._onPanTransitionStep,\r\n\t\t\t\t'end': this._onPanTransitionEnd\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t\t// don't fire movestart if animating inertia\r\n\t\tif (!options.noMoveStart) {\r\n\t\t\tthis.fire('movestart');\r\n\t\t}\r\n\r\n\t\t// animate pan unless animate: false specified\r\n\t\tif (options.animate !== false) {\r\n\t\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');\r\n\r\n\t\t\tvar newPos = this._getMapPanePos().subtract(offset);\r\n\t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\r\n\t\t} else {\r\n\t\t\tthis._rawPanBy(offset);\r\n\t\t\tthis.fire('move').fire('moveend');\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_onPanTransitionStep: function () {\r\n\t\tthis.fire('move');\r\n\t},\r\n\r\n\t_onPanTransitionEnd: function () {\r\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');\r\n\t\tthis.fire('moveend');\r\n\t},\r\n\r\n\t_tryAnimatedPan: function (center, options) {\r\n\t\t// difference between the new and current centers in pixels\r\n\t\tvar offset = this._getCenterOffset(center)._floor();\r\n\r\n\t\t// don't animate too far unless animate: true specified in options\r\n\t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\tthis.panBy(offset, options);\r\n\r\n\t\treturn true;\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * L.PosAnimation fallback implementation that powers Leaflet pan animations\r\n * in browsers that don't support CSS3 Transitions.\r\n */\r\n\r\nL.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({\r\n\r\n\trun: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])\r\n\t\tthis.stop();\r\n\r\n\t\tthis._el = el;\r\n\t\tthis._inProgress = true;\r\n\t\tthis._duration = duration || 0.25;\r\n\t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\r\n\r\n\t\tthis._startPos = L.DomUtil.getPosition(el);\r\n\t\tthis._offset = newPos.subtract(this._startPos);\r\n\t\tthis._startTime = +new Date();\r\n\r\n\t\tthis.fire('start');\r\n\r\n\t\tthis._animate();\r\n\t},\r\n\r\n\tstop: function () {\r\n\t\tif (!this._inProgress) { return; }\r\n\r\n\t\tthis._step();\r\n\t\tthis._complete();\r\n\t},\r\n\r\n\t_animate: function () {\r\n\t\t// animation loop\r\n\t\tthis._animId = L.Util.requestAnimFrame(this._animate, this);\r\n\t\tthis._step();\r\n\t},\r\n\r\n\t_step: function () {\r\n\t\tvar elapsed = (+new Date()) - this._startTime,\r\n\t\t    duration = this._duration * 1000;\r\n\r\n\t\tif (elapsed < duration) {\r\n\t\t\tthis._runFrame(this._easeOut(elapsed / duration));\r\n\t\t} else {\r\n\t\t\tthis._runFrame(1);\r\n\t\t\tthis._complete();\r\n\t\t}\r\n\t},\r\n\r\n\t_runFrame: function (progress) {\r\n\t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\r\n\t\tL.DomUtil.setPosition(this._el, pos);\r\n\r\n\t\tthis.fire('step');\r\n\t},\r\n\r\n\t_complete: function () {\r\n\t\tL.Util.cancelAnimFrame(this._animId);\r\n\r\n\t\tthis._inProgress = false;\r\n\t\tthis.fire('end');\r\n\t},\r\n\r\n\t_easeOut: function (t) {\r\n\t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Extends L.Map to handle zoom animations.\r\n */\r\n\r\nL.Map.mergeOptions({\r\n\tzoomAnimation: true,\r\n\tzoomAnimationThreshold: 4\r\n});\r\n\r\nif (L.DomUtil.TRANSITION) {\r\n\r\n\tL.Map.addInitHook(function () {\r\n\t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\r\n\t\tthis._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&\r\n\t\t\t\tL.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;\r\n\r\n\t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\r\n\t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\r\n\t\tif (this._zoomAnimated) {\r\n\t\t\tL.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nL.Map.include(!L.DomUtil.TRANSITION ? {} : {\r\n\r\n\t_catchTransitionEnd: function (e) {\r\n\t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\r\n\t\t\tthis._onZoomTransitionEnd();\r\n\t\t}\r\n\t},\r\n\r\n\t_nothingToAnimate: function () {\r\n\t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\r\n\t},\r\n\r\n\t_tryAnimatedZoom: function (center, zoom, options) {\r\n\r\n\t\tif (this._animatingZoom) { return true; }\r\n\r\n\t\toptions = options || {};\r\n\r\n\t\t// don't animate if disabled, not supported or zoom difference is too large\r\n\t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\r\n\t\t        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\r\n\r\n\t\t// offset is the pixel coords of the zoom origin relative to the current center\r\n\t\tvar scale = this.getZoomScale(zoom),\r\n\t\t    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),\r\n\t\t\torigin = this._getCenterLayerPoint()._add(offset);\r\n\r\n\t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\r\n\t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n\t\tthis\r\n\t\t    .fire('movestart')\r\n\t\t    .fire('zoomstart');\r\n\r\n\t\tthis._animateZoom(center, zoom, origin, scale, null, true);\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_animateZoom: function (center, zoom, origin, scale, delta, backwards, forTouchZoom) {\r\n\r\n\t\tif (!forTouchZoom) {\r\n\t\t\tthis._animatingZoom = true;\r\n\t\t}\r\n\r\n\t\t// put transform transition on all layers with leaflet-zoom-animated class\r\n\t\tL.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\t// remember what center/zoom to set after animation\r\n\t\tthis._animateToCenter = center;\r\n\t\tthis._animateToZoom = zoom;\r\n\r\n\t\t// disable any dragging during animation\r\n\t\tif (L.Draggable) {\r\n\t\t\tL.Draggable._disabled = true;\r\n\t\t}\r\n\r\n\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\tthis.fire('zoomanim', {\r\n\t\t\t\tcenter: center,\r\n\t\t\t\tzoom: zoom,\r\n\t\t\t\torigin: origin,\r\n\t\t\t\tscale: scale,\r\n\t\t\t\tdelta: delta,\r\n\t\t\t\tbackwards: backwards\r\n\t\t\t});\r\n\t\t\t// horrible hack to work around a Chrome bug https://github.com/Leaflet/Leaflet/issues/3689\r\n\t\t\tsetTimeout(L.bind(this._onZoomTransitionEnd, this), 250);\r\n\t\t}, this);\r\n\t},\r\n\r\n\t_onZoomTransitionEnd: function () {\r\n\t\tif (!this._animatingZoom) { return; }\r\n\r\n\t\tthis._animatingZoom = false;\r\n\r\n\t\tL.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');\r\n\r\n\t\tL.Util.requestAnimFrame(function () {\r\n\t\t\tthis._resetView(this._animateToCenter, this._animateToZoom, true, true);\r\n\r\n\t\t\tif (L.Draggable) {\r\n\t\t\t\tL.Draggable._disabled = false;\r\n\t\t\t}\r\n\t\t}, this);\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n\tZoom animation logic for L.TileLayer.\r\n*/\r\n\r\nL.TileLayer.include({\r\n\t_animateZoom: function (e) {\r\n\t\tif (!this._animating) {\r\n\t\t\tthis._animating = true;\r\n\t\t\tthis._prepareBgBuffer();\r\n\t\t}\r\n\r\n\t\tvar bg = this._bgBuffer,\r\n\t\t    transform = L.DomUtil.TRANSFORM,\r\n\t\t    initialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],\r\n\t\t    scaleStr = L.DomUtil.getScaleString(e.scale, e.origin);\r\n\r\n\t\tbg.style[transform] = e.backwards ?\r\n\t\t\t\tscaleStr + ' ' + initialTransform :\r\n\t\t\t\tinitialTransform + ' ' + scaleStr;\r\n\t},\r\n\r\n\t_endZoomAnim: function () {\r\n\t\tvar front = this._tileContainer,\r\n\t\t    bg = this._bgBuffer;\r\n\r\n\t\tfront.style.visibility = '';\r\n\t\tfront.parentNode.appendChild(front); // Bring to fore\r\n\r\n\t\t// force reflow\r\n\t\tL.Util.falseFn(bg.offsetWidth);\r\n\r\n\t\tvar zoom = this._map.getZoom();\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\tthis._clearBgBuffer();\r\n\t\t}\r\n\r\n\t\tthis._animating = false;\r\n\t},\r\n\r\n\t_clearBgBuffer: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map && !map._animatingZoom && !map.touchZoom._zooming) {\r\n\t\t\tthis._bgBuffer.innerHTML = '';\r\n\t\t\tthis._bgBuffer.style[L.DomUtil.TRANSFORM] = '';\r\n\t\t}\r\n\t},\r\n\r\n\t_prepareBgBuffer: function () {\r\n\r\n\t\tvar front = this._tileContainer,\r\n\t\t    bg = this._bgBuffer;\r\n\r\n\t\t// if foreground layer doesn't have many tiles but bg layer does,\r\n\t\t// keep the existing bg layer and just zoom it some more\r\n\r\n\t\tvar bgLoaded = this._getLoadedTilesPercentage(bg),\r\n\t\t    frontLoaded = this._getLoadedTilesPercentage(front);\r\n\r\n\t\tif (bg && bgLoaded > 0.5 && frontLoaded < 0.5) {\r\n\r\n\t\t\tfront.style.visibility = 'hidden';\r\n\t\t\tthis._stopLoadingImages(front);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// prepare the buffer to become the front tile pane\r\n\t\tbg.style.visibility = 'hidden';\r\n\t\tbg.style[L.DomUtil.TRANSFORM] = '';\r\n\r\n\t\t// switch out the current layer to be the new bg layer (and vice-versa)\r\n\t\tthis._tileContainer = bg;\r\n\t\tbg = this._bgBuffer = front;\r\n\r\n\t\tthis._stopLoadingImages(bg);\r\n\r\n\t\t//prevent bg buffer from clearing right after zoom\r\n\t\tclearTimeout(this._clearBgBufferTimer);\r\n\t},\r\n\r\n\t_getLoadedTilesPercentage: function (container) {\r\n\t\tvar tiles = container.getElementsByTagName('img'),\r\n\t\t    i, len, count = 0;\r\n\r\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\tif (tiles[i].complete) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count / len;\r\n\t},\r\n\r\n\t// stops loading all tiles in the background layer\r\n\t_stopLoadingImages: function (container) {\r\n\t\tvar tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),\r\n\t\t    i, len, tile;\r\n\r\n\t\tfor (i = 0, len = tiles.length; i < len; i++) {\r\n\t\t\ttile = tiles[i];\r\n\r\n\t\t\tif (!tile.complete) {\r\n\t\t\t\ttile.onload = L.Util.falseFn;\r\n\t\t\t\ttile.onerror = L.Util.falseFn;\r\n\t\t\t\ttile.src = L.Util.emptyImageUrl;\r\n\r\n\t\t\t\ttile.parentNode.removeChild(tile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*\r\n * Provides L.Map with convenient shortcuts for using browser geolocation features.\r\n */\r\n\r\nL.Map.include({\r\n\t_defaultLocateOptions: {\r\n\t\twatch: false,\r\n\t\tsetView: false,\r\n\t\tmaxZoom: Infinity,\r\n\t\ttimeout: 10000,\r\n\t\tmaximumAge: 0,\r\n\t\tenableHighAccuracy: false\r\n\t},\r\n\r\n\tlocate: function (/*Object*/ options) {\r\n\r\n\t\toptions = this._locateOptions = L.extend(this._defaultLocateOptions, options);\r\n\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tthis._handleGeolocationError({\r\n\t\t\t\tcode: 0,\r\n\t\t\t\tmessage: 'Geolocation not supported.'\r\n\t\t\t});\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tvar onResponse = L.bind(this._handleGeolocationResponse, this),\r\n\t\t\tonError = L.bind(this._handleGeolocationError, this);\r\n\r\n\t\tif (options.watch) {\r\n\t\t\tthis._locationWatchId =\r\n\t\t\t        navigator.geolocation.watchPosition(onResponse, onError, options);\r\n\t\t} else {\r\n\t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstopLocate: function () {\r\n\t\tif (navigator.geolocation) {\r\n\t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n\t\t}\r\n\t\tif (this._locateOptions) {\r\n\t\t\tthis._locateOptions.setView = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_handleGeolocationError: function (error) {\r\n\t\tvar c = error.code,\r\n\t\t    message = error.message ||\r\n\t\t            (c === 1 ? 'permission denied' :\r\n\t\t            (c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n\t\tif (this._locateOptions.setView && !this._loaded) {\r\n\t\t\tthis.fitWorld();\r\n\t\t}\r\n\r\n\t\tthis.fire('locationerror', {\r\n\t\t\tcode: c,\r\n\t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n\t\t});\r\n\t},\r\n\r\n\t_handleGeolocationResponse: function (pos) {\r\n\t\tvar lat = pos.coords.latitude,\r\n\t\t    lng = pos.coords.longitude,\r\n\t\t    latlng = new L.LatLng(lat, lng),\r\n\r\n\t\t    latAccuracy = 180 * pos.coords.accuracy / 40075017,\r\n\t\t    lngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),\r\n\r\n\t\t    bounds = L.latLngBounds(\r\n\t\t            [lat - latAccuracy, lng - lngAccuracy],\r\n\t\t            [lat + latAccuracy, lng + lngAccuracy]),\r\n\r\n\t\t    options = this._locateOptions;\r\n\r\n\t\tif (options.setView) {\r\n\t\t\tvar zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);\r\n\t\t\tthis.setView(latlng, zoom);\r\n\t\t}\r\n\r\n\t\tvar data = {\r\n\t\t\tlatlng: latlng,\r\n\t\t\tbounds: bounds,\r\n\t\t\ttimestamp: pos.timestamp\r\n\t\t};\r\n\r\n\t\tfor (var i in pos.coords) {\r\n\t\t\tif (typeof pos.coords[i] === 'number') {\r\n\t\t\t\tdata[i] = pos.coords[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.fire('locationfound', data);\r\n\t}\r\n});\r\n\r\n\r\n}(window, document));","/**\r\n * \r\n */\r\nL.LayerGroup.include({\r\n    toGeoJSONcustom: function () {\r\n      var geometry = this.feature && this.feature.geometry,\r\n        jsons = [],\r\n        json;\r\n\r\n      if (geometry && geometry.type === 'MultiPoint') {\r\n        return multiToGeoJSON('MultiPoint').call(this);\r\n      }\r\n      \r\n     /*\r\n      if (geometry && geometry.type === 'MultiPolygon') {\r\n          return multiToGeoJSON('MultiPolygon').call(this);\r\n        }\r\n*/\r\n      var isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n      this.eachLayer(function (layer) {\r\n        if (layer.toGeoJSON) {\r\n         json = layer.toGeoJSON();\r\n         //Custom: que no es perdin les propietats del feature\r\n        \r\n         \r\n         var tipus=json.geometry.type;\r\n        \r\n         \r\n         \r\n         if(jQuery.isEmptyObject(json.properties)){\r\n           if(layer.properties.nom) json.properties.name = layer.properties.nom;\r\n           \r\n           \r\n           if(layer.properties.data){\r\n          \r\n        \t   \r\n        \t   jQuery.each(layer.properties.data, function(key, value){\r\n               if(key.indexOf(\"businessId\")==-1){\r\n                     json.properties[''+key+''] = value;\r\n               }\r\n             });\r\n           }\r\n         }\r\n         \r\n         \r\n         if(jQuery.isEmptyObject(json.styles)){\r\n        \t\r\n        \t \r\n        \tif(!jQuery.isEmptyObject(layer.options)){\r\n        \t\t json.styles=layer.options;\r\n        \t }else if(!jQuery.isEmptyObject(layer._options.style)){       \t\t\r\n        \t\t json.styles=layer._options.style;\r\n        \t }\r\n        \t\r\n        \t\r\n        \t\r\n if(tipus.indexOf(\"Multi\")!=-1){\r\n\t   \t\t if (layer.properties){\t\t \r\n\t        \t\t json.styles.fillColor=layer.properties.estil.color;\r\n\t        \t\t json.styles.borderColor=layer.properties.estil.borderColor;\r\n\t        \t\t json.styles.color=layer.properties.estil.borderColor;\r\n\t        \t\t json.styles.weight=layer.properties.estil.borderWidth;\r\n\t        \t\t json.styles.borderWidth=layer.properties.estil.borderWidth;\r\n        \t\t }\r\n        \t\t else if (layer._options.style){\r\n        \t\t\t json.styles.fillColor=layer._options.style.color;\r\n\t        \t\t json.styles.borderColor=layer._options.style.borderColor;\r\n\t        \t\t json.styles.color=layer._options.style.borderColor;\r\n\t        \t\t json.styles.weight=layer._options.style.borderWidth;\r\n\t        \t\t json.styles.borderWidth=layer._options.style.borderWidth;\r\n        \t\t }\r\n             \t\r\n              }\r\n        \r\n         \r\n         } \r\n         \r\n         //assegurem que s'han guardat estils correctament...\r\n         var count = Object.keys(json.styles).length;\r\n         \r\n         if(count <=1){\r\n        \t if(!jQuery.isEmptyObject(layer.options) && Object.keys(layer.options).length>1){\r\n        \t\t json.styles=layer.options;\r\n        \t }else if(!jQuery.isEmptyObject(layer._options) && Object.keys(layer._options).length>1){\r\n        \t\t json.styles=layer._options;\r\n        \t }\r\n         }         \r\n         \r\n         /*\r\n         if(json.geometry.type != 'Point'){\r\n\t         try{\r\n\t          _newJson = turf.simplify(json, 0.00001, false);\r\n\t\r\n\t          json.geometry=_newJson.geometry;\r\n\t          \r\n\t         }catch(err){\r\n\t         \tconsole.debug(err);\r\n\t\r\n\t         }\r\n     }\r\n         */\r\n         \r\n         jsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n       \r\n       \r\n        \r\n        \r\n        }\r\n        \r\n       \r\n      });\r\n\r\n      if (isGeometryCollection) {\r\n        return L.GeoJSON.getFeature(this, {\r\n             geometries: jsons,\r\n             type: 'GeometryCollection'\r\n        });\r\n      }\r\n\r\n      return {\r\n        type: 'FeatureCollection',\r\n            features: jsons\r\n      };\r\n\r\n    }\r\n});\r\n\r\n//nou metode per 3D afegir els styles dins dels properties\r\n\r\nL.LayerGroup.include({\r\n    toGeoJSONStyles2ToProperties: function () {\r\n      var geometry = this.feature && this.feature.geometry,\r\n        jsons = [],\r\n        json;\r\n\r\n      if (geometry && geometry.type === 'MultiPoint') {\r\n        return multiToGeoJSON('MultiPoint').call(this);\r\n      }\r\n\r\n      var isGeometryCollection = geometry && geometry.type === 'GeometryCollection';\r\n\r\n      this.eachLayer(function (layer) {\r\n        if (layer.toGeoJSON) {\r\n         json = layer.toGeoJSON();\r\n         //Custom: que no es perdin les propietats del feature\r\n         if(jQuery.isEmptyObject(json.properties)){\r\n        \t \r\n\t\t\tif(layer.properties && layer.properties.nom){ json.properties.name = layer.properties.nom;}\r\n\t\t\t\t\t   \r\n\t\t\t\r\n\r\n\t\t\t/*\r\n        \t try{\r\n        \t\t \r\n        \t\t if(layer.properties && layer.properties.nom) { \r\n\t\t\t\t\tjson.properties.name = layer.properties.nom; \r\n        \t\t }else{\r\n        \t\t\t json.properties=layer.options; \r\n        \t\t\t \r\n        \t\t }\r\n        \t\t\r\n        \t }catch(err){\r\n\t\t\t\t \r\n\t\t\t\t console.info(err);\t\r\n        \t\t json.properties=layer.options; \r\n        \t\t\r\n        \t }\r\n        \t \r\n          */\r\n\t\t  \r\n\t\t  \r\n\t\t  \r\n           if(layer.properties && layer.properties.data){\r\n             jQuery.each(layer.properties.data, function(key, value){\r\n               if(key.indexOf(\"slot\")==-1 && key.indexOf(\"businessId\")==-1){\r\n                     json.properties[''+key+''] = value;\r\n               }\r\n             });\r\n           }\r\n         }\r\n         if(jQuery.isEmptyObject(json.styles)){\r\n        \t if(!jQuery.isEmptyObject(layer.options)){\r\n        \t\t json.properties.styles=layer.options;\r\n        \t\t json.styles=layer.options;\r\n        \t }else if(!jQuery.isEmptyObject(layer._options.style)){\r\n        \t\t json.properties.styles=layer._options.style;\r\n        \t\t json.styles=layer._options.style;\r\n        \t }\r\n         }\r\n\r\n         //assegurem que s'han guardat estils correctament...\r\n         var count = Object.keys(json.styles).length;\r\n         if(count <=1){\r\n        \t if(!jQuery.isEmptyObject(layer.options) && Object.keys(layer.options).length>1){\r\n        \t\t json.properties.styles=layer.options;\r\n        \t\t json.styles=layer.options;\r\n        \t }else if(!jQuery.isEmptyObject(layer._options) && Object.keys(layer._options).length>1){\r\n        \t\t json.properties.styles=layer._options;\r\n        \t\t json.styles=layer._options;\r\n        \t }\r\n         }\r\n\r\n         /*\r\n        \r\n         if(json.geometry.type != 'Point'){\r\n\t\t         try{\r\n\t\t          _newJson = turf.simplify(json, 0.000001, false);\r\n\t\t\r\n\t\t          json.geometry=_newJson.geometry;\r\n\t\t          \r\n\t\t         }catch(err){\r\n\t\t         \tconsole.debug(err);\r\n\t\t\r\n\t\t         }\r\n         }\r\n         \r\n         */\r\n\t\t\r\n\t\t \r\n         jsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));\r\n        }\r\n      });\r\n\r\n      if (isGeometryCollection) {\r\n        return L.GeoJSON.getFeature(this, {\r\n             geometries: jsons,\r\n             type: 'GeometryCollection'\r\n        });\r\n      }\r\n\r\n      return {\r\n        type: 'FeatureCollection',\r\n            features: jsons\r\n      };\r\n\r\n    }\r\n});","L.TileLayer.BoundaryCanvas = L.TileLayer.Canvas.extend({\r\n\toptions: {\r\n        // all rings of boundary should be without self-intersections or intersections with other rings\r\n        // zero-winding fill algorithm is used in canvas, so holes should have opposite direction to exterior ring\r\n        // boundary can be\r\n        // LatLng[] - simple polygon\r\n        // LatLng[][] - polygon with holes\r\n        // LatLng[][][] - multipolygon\r\n        boundary: null\r\n\t},\r\n\r\n\tinitialize: function (url, options) {\r\n\t\tL.Util.setOptions(this, options);\r\n        this._url = url;\r\n        this._boundaryCache = {}; //cache index \"x:y:z\"\r\n        this._mercBoundary = null;\r\n        this._mercBbox = null;\r\n\t},\r\n    \r\n    //lazy calculation of layer's boundary in map's projection. Bounding box is also calculated\r\n    _getOriginalMercBoundary: function () {\r\n\r\n        if (this._mercBoundary) {\r\n            return this._mercBoundary;\r\n        }\r\n\r\n        this._mercBoundary = [];\r\n        var b = this.options.boundary,\r\n            c, r, p,\r\n            mercComponent,\r\n            mercRing,\r\n            compomentBbox;\r\n\r\n        \r\n        if (!(b[0] instanceof Array)) {\r\n            b = [[b]];\r\n        } else if (!(b[0][0] instanceof Array)) {\r\n            b = [b];\r\n        }\r\n          \r\n        for (c = 0; c < b.length; c++) {\r\n            mercComponent = [];\r\n            for (r = 0; r < b[c].length; r++) {\r\n                mercRing = [];\r\n                for (p = 0; p < b[c][r].length; p++) {\r\n                    if (this._map!=null) mercRing.push(this._map.project(b[c][r][p], 0));\r\n                }\r\n                mercComponent.push(mercRing);\r\n            }\r\n            this._mercBoundary.push(mercComponent);\r\n        }\r\n\r\n        this._mercBbox = new L.Bounds();\r\n        for (c = 0; c < this._mercBoundary.length; c++) {\r\n            compomentBbox = new L.Bounds(this._mercBoundary[c][0]);\r\n            this._mercBbox.extend(compomentBbox.min);\r\n            this._mercBbox.extend(compomentBbox.max);\r\n        }\r\n\r\n        return this._mercBoundary;\r\n    },\r\n\r\n    // Calculates intersection of original boundary geometry and tile boundary.\r\n    // Uses quadtree as cache to speed-up intersection.\r\n    // Return \r\n    //   {isOut: true} if no intersection,  \r\n    //   {isIn: true} if tile is fully inside layer's boundary\r\n    //   {geometry: <LatLng[][][]>} otherwise\r\n    _getTileGeometry: function (x, y, z, skipIntersectionCheck) {\r\n        if ( !this.options.boundary) {\r\n            return {isOut: true};\r\n        }\r\n    \r\n        var cacheID = x + \":\" + y + \":\" + z,\r\n            zCoeff = Math.pow(2, z),\r\n            parentState,\r\n            clippedGeom = [],\r\n            iC, iR,\r\n            clippedComponent,\r\n            clippedExternalRing,\r\n            clippedHoleRing,\r\n            isRingBbox = function (ring, bbox) {\r\n                if (ring.length !== 4) {\r\n                    return false;\r\n                }\r\n\r\n                var p;\r\n                for (p = 0; p < 4; p++) {\r\n                    if ((ring[p].x !== bbox.min.x && ring[p].x !== bbox.max.x) ||\r\n                        (ring[p].y !== bbox.min.y && ring[p].y !== bbox.max.y)) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n\r\n        if (this._boundaryCache[cacheID]) {\r\n            return this._boundaryCache[cacheID];\r\n        }\r\n\r\n        var mercBoundary = this._getOriginalMercBoundary(),\r\n            ts = this.options.tileSize,\r\n            tileBbox = new L.Bounds(new L.Point(x * ts / zCoeff, y * ts / zCoeff), new L.Point((x + 1) * ts / zCoeff, (y + 1) * ts / zCoeff));\r\n\r\n        //fast check intersection\r\n        if (!skipIntersectionCheck && !tileBbox.intersects(this._mercBbox)) {\r\n            return {isOut: true};\r\n        }\r\n\r\n        if (z === 0) {\r\n            this._boundaryCache[cacheID] = {geometry: mercBoundary};\r\n            return this._boundaryCache[cacheID];\r\n        }\r\n\r\n        parentState = this._getTileGeometry(Math.floor(x / 2), Math.floor(y / 2), z - 1, true);\r\n\r\n        if (parentState.isOut || parentState.isIn) {\r\n            return parentState;\r\n        }\r\n\r\n        for (iC = 0; iC < parentState.geometry.length; iC++) {\r\n            clippedComponent = [];\r\n            clippedExternalRing = L.PolyUtil.clipPolygon(parentState.geometry[iC][0], tileBbox);\r\n            if (clippedExternalRing.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            clippedComponent.push(clippedExternalRing);\r\n\r\n            for (iR = 1; iR < parentState.geometry[iC].length; iR++) {\r\n                clippedHoleRing = L.PolyUtil.clipPolygon(parentState.geometry[iC][iR], tileBbox);\r\n                if (clippedHoleRing.length > 0) {\r\n                    clippedComponent.push(clippedHoleRing);\r\n                }\r\n            }\r\n            clippedGeom.push(clippedComponent);\r\n        }\r\n\r\n        if (clippedGeom.length === 0) { //we are outside of all multipolygon components\r\n            this._boundaryCache[cacheID] = {isOut: true};\r\n            return this._boundaryCache[cacheID];\r\n        }\r\n\r\n        for (iC = 0; iC < clippedGeom.length; iC++) {\r\n            if (isRingBbox(clippedGeom[iC][0], tileBbox)) {\r\n                //inside exterior rings and no holes\r\n                if (clippedGeom[iC].length === 1) {\r\n                    this._boundaryCache[cacheID] = {isIn: true};\r\n                    return this._boundaryCache[cacheID];\r\n                }\r\n            } else { //intersect exterior ring\r\n                this._boundaryCache[cacheID] = {geometry: clippedGeom};\r\n                return this._boundaryCache[cacheID];\r\n            }\r\n\r\n            for (iR = 1; iR < clippedGeom[iC].length; iR++) {\r\n                if (!isRingBbox(clippedGeom[iC][iR], tileBbox)) { //inside exterior ring, but have intersection with hole\r\n                    this._boundaryCache[cacheID] = {geometry: clippedGeom};\r\n                    return this._boundaryCache[cacheID];\r\n                }\r\n            }\r\n        }\r\n\r\n        //we are inside all holes in geometry\r\n        this._boundaryCache[cacheID] = {isOut: true};\r\n        return this._boundaryCache[cacheID];\r\n    },\r\n\r\n\tdrawTile: function (canvas, tilePoint) {\r\n        var ts = this.options.tileSize,\r\n            tileX = ts * tilePoint.x,\r\n            tileY = ts * tilePoint.y,\r\n            zoom = this._getZoomForUrl(),\r\n            zCoeff = Math.pow(2, zoom),\r\n            ctx = canvas.getContext('2d'),\r\n            imageObj = new Image(),\r\n            _this = this,\r\n            setPattern = function () {\r\n            \r\n            var state = _this._getTileGeometry(tilePoint.x, tilePoint.y, zoom),\r\n                c, r, p,\r\n                pattern,\r\n                geom;\r\n\r\n            if (state.isOut) {\r\n                return;\r\n            }\r\n\r\n            if (!state.isIn) {\r\n                geom = state.geometry;\r\n                ctx.beginPath();\r\n\r\n                for (c = 0; c < geom.length; c++) {\r\n                    for (r = 0; r < geom[c].length; r++) {\r\n                        if (geom[c][r].length === 0) {\r\n                            continue;\r\n                        }\r\n\r\n                        ctx.moveTo(geom[c][r][0].x * zCoeff - tileX, geom[c][r][0].y * zCoeff - tileY);\r\n                        for (p = 1; p < geom[c][r].length; p++) {\r\n                            ctx.lineTo(geom[c][r][p].x * zCoeff - tileX, geom[c][r][p].y * zCoeff - tileY);\r\n                        }\r\n                    }\r\n                }\r\n                ctx.clip();\r\n            }\r\n\r\n            pattern = ctx.createPattern(imageObj, \"repeat\");\r\n            ctx.beginPath();\r\n            ctx.rect(0, 0, canvas.width, canvas.height);\r\n            ctx.fillStyle = pattern;\r\n            ctx.fill();\r\n        };\r\n        \r\n        imageObj.onload = function () {\r\n            setTimeout(setPattern, 0); //IE9 bug - black tiles appear randomly if call setPattern() without timeout\r\n        }\r\n\t\tthis._adjustTilePoint(tilePoint);\r\n        imageObj.src = this.getTileUrl(tilePoint);\r\n\t}\r\n});\r\n\r\nL.TileLayer.boundaryCanvas = function (url, options) {\r\n\treturn new L.TileLayer.BoundaryCanvas(url, options);\r\n};","/*\n  proj4js.js -- Javascript reprojection library. \n  \n  Authors:      Mike Adair madairATdmsolutions.ca\n                Richard Greenwood richATgreenwoodmap.com\n                Didier Richard didier.richardATign.fr\n                Stephen Irons\n  License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html \n                Note: This program is an almost direct port of the C library\n                Proj4.\n*/\nProj4js={defaultDatum:'WGS84',transform:function(source,dest,point){if(!source.readyToUse){this.reportError(\"Proj4js initialization for:\"+source.srsCode+\" not yet complete\");return point;}\nif(!dest.readyToUse){this.reportError(\"Proj4js initialization for:\"+dest.srsCode+\" not yet complete\");return point;}\nif((source.srsProjNumber==\"900913\"&&dest.datumCode!=\"WGS84\"&&!dest.datum_params)||(dest.srsProjNumber==\"900913\"&&source.datumCode!=\"WGS84\"&&!source.datum_params)){var wgs84=Proj4js.WGS84;this.transform(source,wgs84,point);source=wgs84;}\nif(source.axis!=\"enu\"){this.adjust_axis(source,false,point);}\nif(source.projName==\"longlat\"){point.x*=Proj4js.common.D2R;point.y*=Proj4js.common.D2R;}else{if(source.to_meter){point.x*=source.to_meter;point.y*=source.to_meter;}\nsource.inverse(point);}\nif(source.from_greenwich){point.x+=source.from_greenwich;}\npoint=this.datum_transform(source.datum,dest.datum,point);if(dest.from_greenwich){point.x-=dest.from_greenwich;}\nif(dest.projName==\"longlat\"){point.x*=Proj4js.common.R2D;point.y*=Proj4js.common.R2D;}else{dest.forward(point);if(dest.to_meter){point.x/=dest.to_meter;point.y/=dest.to_meter;}}\nif(dest.axis!=\"enu\"){this.adjust_axis(dest,true,point);}\nreturn point;},datum_transform:function(source,dest,point){if(source.compare_datums(dest)){return point;}\nif(source.datum_type==Proj4js.common.PJD_NODATUM||dest.datum_type==Proj4js.common.PJD_NODATUM){return point;}\nif(source.datum_type==Proj4js.common.PJD_GRIDSHIFT)\n{alert(\"ERROR: Grid shift transformations are not implemented yet.\");}\nif(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT)\n{alert(\"ERROR: Grid shift transformations are not implemented yet.\");}\nif(source.es!=dest.es||source.a!=dest.a||source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM||dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM)\n{source.geodetic_to_geocentric(point);if(source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM){source.geocentric_to_wgs84(point);}\nif(dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM){dest.geocentric_from_wgs84(point);}\ndest.geocentric_to_geodetic(point);}\nif(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT)\n{alert(\"ERROR: Grid shift transformations are not implemented yet.\");}\nreturn point;},adjust_axis:function(crs,denorm,point){var xin=point.x,yin=point.y,zin=point.z||0.0;var v,t;for(var i=0;i<3;i++){if(denorm&&i==2&&point.z===undefined){continue;}\nif(i==0){v=xin;t='x';}\nelse if(i==1){v=yin;t='y';}\nelse{v=zin;t='z';}\nswitch(crs.axis[i]){case'e':point[t]=v;break;case'w':point[t]=-v;break;case'n':point[t]=v;break;case's':point[t]=-v;break;case'u':if(point[t]!==undefined){point.z=v;}\nbreak;case'd':if(point[t]!==undefined){point.z=-v;}\nbreak;default:alert(\"ERROR: unknow axis (\"+crs.axis[i]+\") - check definition of \"+src.projName);return null;}}\nreturn point;},reportError:function(msg){},extend:function(destination,source){destination=destination||{};if(source){for(var property in source){var value=source[property];if(value!==undefined){destination[property]=value;}}}\nreturn destination;},Class:function(){var Class=function(){this.initialize.apply(this,arguments);};var extended={};var parent;for(var i=0;i<arguments.length;++i){if(typeof arguments[i]==\"function\"){parent=arguments[i].prototype;}else{parent=arguments[i];}\nProj4js.extend(extended,parent);}\nClass.prototype=extended;return Class;},bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));return func.apply(object,newArgs);};},scriptName:\"proj4js-compressed.js\",defsLookupService:'http://spatialreference.org/ref',libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;var scriptName=this.scriptName;var scriptNameLen=scriptName.length;var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var src=scripts[i].getAttribute('src');if(src){var index=src.lastIndexOf(scriptName);if((index>-1)&&(index+scriptNameLen==src.length)){this.libPath=src.slice(0,-scriptNameLen);break;}}}\nreturn this.libPath||\"\";},loadScript:function(url,onload,onfail,loadCheck){var script=document.createElement('script');script.defer=false;script.type=\"text/javascript\";script.id=url;script.src=url;script.onload=onload;script.onerror=onfail;script.loadCheck=loadCheck;if(/MSIE/.test(navigator.userAgent)){script.onreadystatechange=this.checkReadyState;}\ndocument.getElementsByTagName('head')[0].appendChild(script);},checkReadyState:function(){if(this.readyState=='loaded'){if(!this.loadCheck()){this.onerror();}else{this.onload();}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:false,queue:null,initialize:function(srsCode,callback){this.srsCodeInput=srsCode;this.queue=[];if(callback){this.queue.push(callback);}\nif((srsCode.indexOf('GEOGCS')>=0)||(srsCode.indexOf('GEOCCS')>=0)||(srsCode.indexOf('PROJCS')>=0)||(srsCode.indexOf('LOCAL_CS')>=0)){this.parseWKT(srsCode);this.deriveConstants();this.loadProjCode(this.projName);return;}\nif(srsCode.indexOf('urn:')==0){var urn=srsCode.split(':');if((urn[1]=='ogc'||urn[1]=='x-ogc')&&(urn[2]=='def')&&(urn[3]=='crs')){srsCode=urn[4]+':'+urn[urn.length-1];}}else if(srsCode.indexOf('http://')==0){var url=srsCode.split('#');if(url[0].match(/epsg.org/)){srsCode='EPSG:'+url[1];}else if(url[0].match(/RIG.xml/)){srsCode='IGNF:'+url[1];}}\nthis.srsCode=srsCode.toUpperCase();if(this.srsCode.indexOf(\"EPSG\")==0){this.srsCode=this.srsCode;this.srsAuth='epsg';this.srsProjNumber=this.srsCode.substring(5);}else if(this.srsCode.indexOf(\"IGNF\")==0){this.srsCode=this.srsCode;this.srsAuth='IGNF';this.srsProjNumber=this.srsCode.substring(5);}else if(this.srsCode.indexOf(\"CRS\")==0){this.srsCode=this.srsCode;this.srsAuth='CRS';this.srsProjNumber=this.srsCode.substring(4);}else{this.srsAuth='';this.srsProjNumber=this.srsCode;}\nthis.loadProjDefinition();},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return;}\nvar url=Proj4js.getScriptLocation()+'defs/'+this.srsAuth.toUpperCase()+this.srsProjNumber+'.js';Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this));},loadFromService:function(){var url=Proj4js.defsLookupService+'/'+this.srsAuth+'/'+this.srsProjNumber+'/proj4js/';Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this));},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName);},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true;}else{return false;}},defsFailed:function(){Proj4js.reportError('failed to load projection definition for: '+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs['WGS84'];this.defsLoaded();},loadProjCode:function(projName){if(Proj4js.Proj[projName]){this.initTransforms();return;}\nvar url=Proj4js.getScriptLocation()+'projCode/'+projName+'.js';Proj4js.loadScript(url,Proj4js.bind(this.loadProjCodeSuccess,this,projName),Proj4js.bind(this.loadProjCodeFailure,this,projName),Proj4js.bind(this.checkCodeLoaded,this,projName));},loadProjCodeSuccess:function(projName){if(Proj4js.Proj[projName].dependsOn){this.loadProjCode(Proj4js.Proj[projName].dependsOn);}else{this.initTransforms();}},loadProjCodeFailure:function(projName){Proj4js.reportError(\"failed to find projection file for: \"+projName);},checkCodeLoaded:function(projName){if(Proj4js.Proj[projName]){return true;}else{return false;}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;if(this.queue){var item;while((item=this.queue.shift())){item.call(this,this);}}},wktRE:/^(\\w+)\\[(.*)\\]$/,parseWKT:function(wkt){var wktMatch=wkt.match(this.wktRE);if(!wktMatch)return;var wktObject=wktMatch[1];var wktContent=wktMatch[2];var wktTemp=wktContent.split(\",\");var wktName;if(wktObject.toUpperCase()==\"TOWGS84\"){wktName=wktObject;}else{wktName=wktTemp.shift();}\nwktName=wktName.replace(/^\\\"/,\"\");wktName=wktName.replace(/\\\"$/,\"\");var wktArray=new Array();var bkCount=0;var obj=\"\";for(var i=0;i<wktTemp.length;++i){var token=wktTemp[i];for(var j=0;j<token.length;++j){if(token.charAt(j)==\"[\")++bkCount;if(token.charAt(j)==\"]\")--bkCount;}\nobj+=token;if(bkCount===0){wktArray.push(obj);obj=\"\";}else{obj+=\",\";}}\nswitch(wktObject){case'LOCAL_CS':this.projName='identity'\nthis.localCS=true;this.srsCode=wktName;break;case'GEOGCS':this.projName='longlat'\nthis.geocsCode=wktName;if(!this.srsCode)this.srsCode=wktName;break;case'PROJCS':this.srsCode=wktName;break;case'GEOCCS':break;case'PROJECTION':this.projName=Proj4js.wktProjections[wktName]\nbreak;case'DATUM':this.datumName=wktName;break;case'LOCAL_DATUM':this.datumCode='none';break;case'SPHEROID':this.ellps=wktName;this.a=parseFloat(wktArray.shift());this.rf=parseFloat(wktArray.shift());break;case'PRIMEM':this.from_greenwich=parseFloat(wktArray.shift());break;case'UNIT':this.units=wktName;this.unitsPerMeter=parseFloat(wktArray.shift());break;case'PARAMETER':var name=wktName.toLowerCase();var value=parseFloat(wktArray.shift());switch(name){case'false_easting':this.x0=value;break;case'false_northing':this.y0=value;break;case'scale_factor':this.k0=value;break;case'central_meridian':this.long0=value*Proj4js.common.D2R;break;case'latitude_of_origin':this.lat0=value*Proj4js.common.D2R;break;case'more_here':break;default:break;}\nbreak;case'TOWGS84':this.datum_params=wktArray;break;case'AXIS':var name=wktName.toLowerCase();var value=wktArray.shift();switch(value){case'EAST':value='e';break;case'WEST':value='w';break;case'NORTH':value='n';break;case'SOUTH':value='s';break;case'UP':value='u';break;case'DOWN':value='d';break;case'OTHER':default:value=' ';break;}\nif(!this.axis){this.axis=\"enu\";}\nswitch(name){case'X':this.axis=value+this.axis.substr(1,2);break;case'Y':this.axis=this.axis.substr(0,1)+value+this.axis.substr(2,1);break;case'Z':this.axis=this.axis.substr(0,2)+value;break;default:break;}\ncase'MORE_HERE':break;default:break;}\nfor(var i=0;i<wktArray.length;++i){this.parseWKT(wktArray[i]);}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var paramName,paramVal;if(!this.defData){return;}\nvar paramArray=this.defData.split(\"+\");for(var prop=0;prop<paramArray.length;prop++){var property=paramArray[prop].split(\"=\");paramName=property[0].toLowerCase();paramVal=property[1];switch(paramName.replace(/\\s/gi,\"\")){case\"\":break;case\"title\":this.title=paramVal;break;case\"proj\":this.projName=paramVal.replace(/\\s/gi,\"\");break;case\"units\":this.units=paramVal.replace(/\\s/gi,\"\");break;case\"datum\":this.datumCode=paramVal.replace(/\\s/gi,\"\");break;case\"nadgrids\":this.nagrids=paramVal.replace(/\\s/gi,\"\");break;case\"ellps\":this.ellps=paramVal.replace(/\\s/gi,\"\");break;case\"a\":this.a=parseFloat(paramVal);break;case\"b\":this.b=parseFloat(paramVal);break;case\"rf\":this.rf=parseFloat(paramVal);break;case\"lat_0\":this.lat0=paramVal*Proj4js.common.D2R;break;case\"lat_1\":this.lat1=paramVal*Proj4js.common.D2R;break;case\"lat_2\":this.lat2=paramVal*Proj4js.common.D2R;break;case\"lat_ts\":this.lat_ts=paramVal*Proj4js.common.D2R;break;case\"lon_0\":this.long0=paramVal*Proj4js.common.D2R;break;case\"alpha\":this.alpha=parseFloat(paramVal)*Proj4js.common.D2R;break;case\"lonc\":this.longc=paramVal*Proj4js.common.D2R;break;case\"x_0\":this.x0=parseFloat(paramVal);break;case\"y_0\":this.y0=parseFloat(paramVal);break;case\"k_0\":this.k0=parseFloat(paramVal);break;case\"k\":this.k0=parseFloat(paramVal);break;case\"r_a\":this.R_A=true;break;case\"zone\":this.zone=parseInt(paramVal);break;case\"south\":this.utmSouth=true;break;case\"towgs84\":this.datum_params=paramVal.split(\",\");break;case\"to_meter\":this.to_meter=parseFloat(paramVal);break;case\"from_greenwich\":this.from_greenwich=paramVal*Proj4js.common.D2R;break;case\"pm\":paramVal=paramVal.replace(/\\s/gi,\"\");this.from_greenwich=Proj4js.PrimeMeridian[paramVal]?Proj4js.PrimeMeridian[paramVal]:parseFloat(paramVal);this.from_greenwich*=Proj4js.common.D2R;break;case\"axis\":paramVal=paramVal.replace(/\\s/gi,\"\");var legalAxis=\"ewnsud\";if(paramVal.length==3&&legalAxis.indexOf(paramVal.substr(0,1))!=-1&&legalAxis.indexOf(paramVal.substr(1,1))!=-1&&legalAxis.indexOf(paramVal.substr(2,1))!=-1){this.axis=paramVal;}\nbreak\ncase\"no_defs\":break;default:}}\nthis.deriveConstants();},deriveConstants:function(){if(this.nagrids=='@null')this.datumCode='none';if(this.datumCode&&this.datumCode!='none'){var datumDef=Proj4js.Datum[this.datumCode];if(datumDef){this.datum_params=datumDef.towgs84?datumDef.towgs84.split(','):null;this.ellps=datumDef.ellipse;this.datumName=datumDef.datumName?datumDef.datumName:this.datumCode;}}\nif(!this.a){var ellipse=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid['WGS84'];Proj4js.extend(this,ellipse);}\nif(this.rf&&!this.b)this.b=(1.0-1.0/this.rf)*this.a;if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a;}\nthis.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1.-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0.;}\nthis.ep2=(this.a2-this.b2)/this.b2;if(!this.k0)this.k0=1.0;if(!this.axis){this.axis=\"enu\";}\nthis.datum=new Proj4js.datum(this);}});Proj4js.Proj.longlat={init:function(){},forward:function(pt){return pt;},inverse:function(pt){return pt;}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={'WGS84':\"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees\",'EPSG:4326':\"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees\",'EPSG:4269':\"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees\",'EPSG:3785':\"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs\"};Proj4js.defs['GOOGLE']=Proj4js.defs['EPSG:3785'];Proj4js.defs['EPSG:900913']=Proj4js.defs['EPSG:3785'];Proj4js.defs['EPSG:102113']=Proj4js.defs['EPSG:3785'];Proj4js.common={PI:3.141592653589793238,HALF_PI:1.570796326794896619,TWO_PI:6.283185307179586477,FORTPI:0.78539816339744833,R2D:57.29577951308232088,D2R:0.01745329251994329577,SEC_TO_RAD:4.84813681109535993589914102357e-6,EPSLN:1.0e-10,MAX_ITER:20,COS_67P5:0.38268343236508977,AD_C:1.0026000,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137.0,SIXTH:.1666666666666666667,RA4:.04722222222222222222,RA6:.02215608465608465608,RV4:.06944444444444444444,RV6:.04243827160493827160,msfnz:function(eccent,sinphi,cosphi){var con=eccent*sinphi;return cosphi/(Math.sqrt(1.0-con*con));},tsfnz:function(eccent,phi,sinphi){var con=eccent*sinphi;var com=.5*eccent;con=Math.pow(((1.0-con)/(1.0+con)),com);return(Math.tan(.5*(this.HALF_PI-phi))/con);},phi2z:function(eccent,ts){var eccnth=.5*eccent;var con,dphi;var phi=this.HALF_PI-2*Math.atan(ts);for(var i=0;i<=15;i++){con=eccent*Math.sin(phi);dphi=this.HALF_PI-2*Math.atan(ts*(Math.pow(((1.0-con)/(1.0+con)),eccnth)))-phi;phi+=dphi;if(Math.abs(dphi)<=.0000000001)return phi;}\nalert(\"phi2z has NoConvergence\");return(-9999);},qsfnz:function(eccent,sinphi){var con;if(eccent>1.0e-7){con=eccent*sinphi;return((1.0-eccent*eccent)*(sinphi/(1.0-con*con)-(.5/eccent)*Math.log((1.0-con)/(1.0+con))));}else{return(2.0*sinphi);}},asinz:function(x){if(Math.abs(x)>1.0){x=(x>1.0)?1.0:-1.0;}\nreturn Math.asin(x);},e0fn:function(x){return(1.0-0.25*x*(1.0+x/16.0*(3.0+1.25*x)));},e1fn:function(x){return(0.375*x*(1.0+0.25*x*(1.0+0.46875*x)));},e2fn:function(x){return(0.05859375*x*x*(1.0+0.75*x));},e3fn:function(x){return(x*x*x*(35.0/3072.0));},mlfn:function(e0,e1,e2,e3,phi){return(e0*phi-e1*Math.sin(2.0*phi)+e2*Math.sin(4.0*phi)-e3*Math.sin(6.0*phi));},srat:function(esinp,exp){return(Math.pow((1.0-esinp)/(1.0+esinp),exp));},sign:function(x){if(x<0.0)return(-1);else return(1);},adjust_lon:function(x){x=(Math.abs(x)<this.PI)?x:(x-(this.sign(x)*this.TWO_PI));return x;},adjust_lat:function(x){x=(Math.abs(x)<this.HALF_PI)?x:(x-(this.sign(x)*this.PI));return x;},latiso:function(eccent,phi,sinphi){if(Math.abs(phi)>this.HALF_PI)return+Number.NaN;if(phi==this.HALF_PI)return Number.POSITIVE_INFINITY;if(phi==-1.0*this.HALF_PI)return-1.0*Number.POSITIVE_INFINITY;var con=eccent*sinphi;return Math.log(Math.tan((this.HALF_PI+phi)/2.0))+eccent*Math.log((1.0-con)/(1.0+con))/2.0;},fL:function(x,L){return 2.0*Math.atan(x*Math.exp(L))-this.HALF_PI;},invlatiso:function(eccent,ts){var phi=this.fL(1.0,ts);var Iphi=0.0;var con=0.0;do{Iphi=phi;con=eccent*Math.sin(Iphi);phi=this.fL(Math.exp(eccent*Math.log((1.0+con)/(1.0-con))/2.0),ts)}while(Math.abs(phi-Iphi)>1.0e-12);return phi;},sinh:function(x)\n{var r=Math.exp(x);r=(r-1.0/r)/2.0;return r;},cosh:function(x)\n{var r=Math.exp(x);r=(r+1.0/r)/2.0;return r;},tanh:function(x)\n{var r=Math.exp(x);r=(r-1.0/r)/(r+1.0/r);return r;},asinh:function(x)\n{var s=(x>=0?1.0:-1.0);return s*(Math.log(Math.abs(x)+Math.sqrt(x*x+1.0)));},acosh:function(x)\n{return 2.0*Math.log(Math.sqrt((x+1.0)/2.0)+Math.sqrt((x-1.0)/2.0));},atanh:function(x)\n{return Math.log((x-1.0)/(x+1.0))/2.0;},gN:function(a,e,sinphi)\n{var temp=e*sinphi;return a/Math.sqrt(1.0-temp*temp);}};Proj4js.datum=Proj4js.Class({initialize:function(proj){this.datum_type=Proj4js.common.PJD_WGS84;if(proj.datumCode&&proj.datumCode=='none'){this.datum_type=Proj4js.common.PJD_NODATUM;}\nif(proj&&proj.datum_params){for(var i=0;i<proj.datum_params.length;i++){proj.datum_params[i]=parseFloat(proj.datum_params[i]);}\nif(proj.datum_params[0]!=0||proj.datum_params[1]!=0||proj.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM;}\nif(proj.datum_params.length>3){if(proj.datum_params[3]!=0||proj.datum_params[4]!=0||proj.datum_params[5]!=0||proj.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;proj.datum_params[3]*=Proj4js.common.SEC_TO_RAD;proj.datum_params[4]*=Proj4js.common.SEC_TO_RAD;proj.datum_params[5]*=Proj4js.common.SEC_TO_RAD;proj.datum_params[6]=(proj.datum_params[6]/1000000.0)+1.0;}}}\nif(proj){this.a=proj.a;this.b=proj.b;this.es=proj.es;this.ep2=proj.ep2;this.datum_params=proj.datum_params;}},compare_datums:function(dest){if(this.datum_type!=dest.datum_type){return false;}else if(this.a!=dest.a||Math.abs(this.es-dest.es)>0.000000000050){return false;}else if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]);}else if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]&&this.datum_params[3]==dest.datum_params[3]&&this.datum_params[4]==dest.datum_params[4]&&this.datum_params[5]==dest.datum_params[5]&&this.datum_params[6]==dest.datum_params[6]);}else if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,\"snadgrids\").s,pj_param(dest.params,\"snadgrids\").s)==0;}else{return true;}},geodetic_to_geocentric:function(p){var Longitude=p.x;var Latitude=p.y;var Height=p.z?p.z:0;var X;var Y;var Z;var Error_Code=0;var Rn;var Sin_Lat;var Sin2_Lat;var Cos_Lat;if(Latitude<-Proj4js.common.HALF_PI&&Latitude>-1.001*Proj4js.common.HALF_PI){Latitude=-Proj4js.common.HALF_PI;}else if(Latitude>Proj4js.common.HALF_PI&&Latitude<1.001*Proj4js.common.HALF_PI){Latitude=Proj4js.common.HALF_PI;}else if((Latitude<-Proj4js.common.HALF_PI)||(Latitude>Proj4js.common.HALF_PI)){Proj4js.reportError('geocent:lat out of range:'+Latitude);return null;}\nif(Longitude>Proj4js.common.PI)Longitude-=(2*Proj4js.common.PI);Sin_Lat=Math.sin(Latitude);Cos_Lat=Math.cos(Latitude);Sin2_Lat=Sin_Lat*Sin_Lat;Rn=this.a/(Math.sqrt(1.0e0-this.es*Sin2_Lat));X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);Z=((Rn*(1-this.es))+Height)*Sin_Lat;p.x=X;p.y=Y;p.z=Z;return Error_Code;},geocentric_to_geodetic:function(p){var genau=1.E-12;var genau2=(genau*genau);var maxiter=30;var P;var RR;var CT;var ST;var RX;var RK;var RN;var CPHI0;var SPHI0;var CPHI;var SPHI;var SDPHI;var At_Pole;var iter;var X=p.x;var Y=p.y;var Z=p.z?p.z:0.0;var Longitude;var Latitude;var Height;At_Pole=false;P=Math.sqrt(X*X+Y*Y);RR=Math.sqrt(X*X+Y*Y+Z*Z);if(P/this.a<genau){At_Pole=true;Longitude=0.0;if(RR/this.a<genau){Latitude=Proj4js.common.HALF_PI;Height=-this.b;return;}}else{Longitude=Math.atan2(Y,X);}\nCT=Z/RR;ST=P/RR;RX=1.0/Math.sqrt(1.0-this.es*(2.0-this.es)*ST*ST);CPHI0=ST*(1.0-this.es)*RX;SPHI0=CT*RX;iter=0;do\n{iter++;RN=this.a/Math.sqrt(1.0-this.es*SPHI0*SPHI0);Height=P*CPHI0+Z*SPHI0-RN*(1.0-this.es*SPHI0*SPHI0);RK=this.es*RN/(RN+Height);RX=1.0/Math.sqrt(1.0-RK*(2.0-RK)*ST*ST);CPHI=ST*(1.0-RK)*RX;SPHI=CT*RX;SDPHI=SPHI*CPHI0-CPHI*SPHI0;CPHI0=CPHI;SPHI0=SPHI;}\nwhile(SDPHI*SDPHI>genau2&&iter<maxiter);Latitude=Math.atan(SPHI/Math.abs(CPHI));p.x=Longitude;p.y=Latitude;p.z=Height;return p;},geocentric_to_geodetic_noniter:function(p){var X=p.x;var Y=p.y;var Z=p.z?p.z:0;var Longitude;var Latitude;var Height;var W;var W2;var T0;var T1;var S0;var S1;var Sin_B0;var Sin3_B0;var Cos_B0;var Sin_p1;var Cos_p1;var Rn;var Sum;var At_Pole;X=parseFloat(X);Y=parseFloat(Y);Z=parseFloat(Z);At_Pole=false;if(X!=0.0)\n{Longitude=Math.atan2(Y,X);}\nelse\n{if(Y>0)\n{Longitude=Proj4js.common.HALF_PI;}\nelse if(Y<0)\n{Longitude=-Proj4js.common.HALF_PI;}\nelse\n{At_Pole=true;Longitude=0.0;if(Z>0.0)\n{Latitude=Proj4js.common.HALF_PI;}\nelse if(Z<0.0)\n{Latitude=-Proj4js.common.HALF_PI;}\nelse\n{Latitude=Proj4js.common.HALF_PI;Height=-this.b;return;}}}\nW2=X*X+Y*Y;W=Math.sqrt(W2);T0=Z*Proj4js.common.AD_C;S0=Math.sqrt(T0*T0+W2);Sin_B0=T0/S0;Cos_B0=W/S0;Sin3_B0=Sin_B0*Sin_B0*Sin_B0;T1=Z+this.b*this.ep2*Sin3_B0;Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0;S1=Math.sqrt(T1*T1+Sum*Sum);Sin_p1=T1/S1;Cos_p1=Sum/S1;Rn=this.a/Math.sqrt(1.0-this.es*Sin_p1*Sin_p1);if(Cos_p1>=Proj4js.common.COS_67P5)\n{Height=W/Cos_p1-Rn;}\nelse if(Cos_p1<=-Proj4js.common.COS_67P5)\n{Height=W/-Cos_p1-Rn;}\nelse\n{Height=Z/Sin_p1+Rn*(this.es-1.0);}\nif(At_Pole==false)\n{Latitude=Math.atan(Sin_p1/Cos_p1);}\np.x=Longitude;p.y=Latitude;p.z=Height;return p;},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)\n{p.x+=this.datum_params[0];p.y+=this.datum_params[1];p.z+=this.datum_params[2];}\nelse if(this.datum_type==Proj4js.common.PJD_7PARAM)\n{var Dx_BF=this.datum_params[0];var Dy_BF=this.datum_params[1];var Dz_BF=this.datum_params[2];var Rx_BF=this.datum_params[3];var Ry_BF=this.datum_params[4];var Rz_BF=this.datum_params[5];var M_BF=this.datum_params[6];var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;p.x=x_out;p.y=y_out;p.z=z_out;}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)\n{p.x-=this.datum_params[0];p.y-=this.datum_params[1];p.z-=this.datum_params[2];}\nelse if(this.datum_type==Proj4js.common.PJD_7PARAM)\n{var Dx_BF=this.datum_params[0];var Dy_BF=this.datum_params[1];var Dz_BF=this.datum_params[2];var Rx_BF=this.datum_params[3];var Ry_BF=this.datum_params[4];var Rz_BF=this.datum_params[5];var M_BF=this.datum_params[6];var x_tmp=(p.x-Dx_BF)/M_BF;var y_tmp=(p.y-Dy_BF)/M_BF;var z_tmp=(p.z-Dz_BF)/M_BF;p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp;}}});Proj4js.Point=Proj4js.Class({initialize:function(x,y,z){if(typeof x=='object'){this.x=x[0];this.y=x[1];this.z=x[2]||0.0;}else if(typeof x=='string'&&typeof y=='undefined'){var coords=x.split(',');this.x=parseFloat(coords[0]);this.y=parseFloat(coords[1]);this.z=parseFloat(coords[2])||0.0;}else{this.x=x;this.y=y;this.z=z||0.0;}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z);},toString:function(){return(\"x=\"+this.x+\",y=\"+this.y);},toShortString:function(){return(this.x+\", \"+this.y);}});Proj4js.PrimeMeridian={\"greenwich\":0.0,\"lisbon\":-9.131906111111,\"paris\":2.337229166667,\"bogota\":-74.080916666667,\"madrid\":-3.687938888889,\"rome\":12.452333333333,\"bern\":7.439583333333,\"jakarta\":106.807719444444,\"ferro\":-17.666666666667,\"brussels\":4.367975,\"stockholm\":18.058277777778,\"athens\":23.7163375,\"oslo\":10.722916666667};Proj4js.Ellipsoid={\"MERIT\":{a:6378137.0,rf:298.257,ellipseName:\"MERIT 1983\"},\"SGS85\":{a:6378136.0,rf:298.257,ellipseName:\"Soviet Geodetic System 85\"},\"GRS80\":{a:6378137.0,rf:298.257222101,ellipseName:\"GRS 1980(IUGG, 1980)\"},\"IAU76\":{a:6378140.0,rf:298.257,ellipseName:\"IAU 1976\"},\"airy\":{a:6377563.396,b:6356256.910,ellipseName:\"Airy 1830\"},\"APL4.\":{a:6378137,rf:298.25,ellipseName:\"Appl. Physics. 1965\"},\"NWL9D\":{a:6378145.0,rf:298.25,ellipseName:\"Naval Weapons Lab., 1965\"},\"mod_airy\":{a:6377340.189,b:6356034.446,ellipseName:\"Modified Airy\"},\"andrae\":{a:6377104.43,rf:300.0,ellipseName:\"Andrae 1876 (Den., Iclnd.)\"},\"aust_SA\":{a:6378160.0,rf:298.25,ellipseName:\"Australian Natl & S. Amer. 1969\"},\"GRS67\":{a:6378160.0,rf:298.2471674270,ellipseName:\"GRS 67(IUGG 1967)\"},\"bessel\":{a:6377397.155,rf:299.1528128,ellipseName:\"Bessel 1841\"},\"bess_nam\":{a:6377483.865,rf:299.1528128,ellipseName:\"Bessel 1841 (Namibia)\"},\"clrk66\":{a:6378206.4,b:6356583.8,ellipseName:\"Clarke 1866\"},\"clrk80\":{a:6378249.145,rf:293.4663,ellipseName:\"Clarke 1880 mod.\"},\"CPM\":{a:6375738.7,rf:334.29,ellipseName:\"Comm. des Poids et Mesures 1799\"},\"delmbr\":{a:6376428.0,rf:311.5,ellipseName:\"Delambre 1810 (Belgium)\"},\"engelis\":{a:6378136.05,rf:298.2566,ellipseName:\"Engelis 1985\"},\"evrst30\":{a:6377276.345,rf:300.8017,ellipseName:\"Everest 1830\"},\"evrst48\":{a:6377304.063,rf:300.8017,ellipseName:\"Everest 1948\"},\"evrst56\":{a:6377301.243,rf:300.8017,ellipseName:\"Everest 1956\"},\"evrst69\":{a:6377295.664,rf:300.8017,ellipseName:\"Everest 1969\"},\"evrstSS\":{a:6377298.556,rf:300.8017,ellipseName:\"Everest (Sabah & Sarawak)\"},\"fschr60\":{a:6378166.0,rf:298.3,ellipseName:\"Fischer (Mercury Datum) 1960\"},\"fschr60m\":{a:6378155.0,rf:298.3,ellipseName:\"Fischer 1960\"},\"fschr68\":{a:6378150.0,rf:298.3,ellipseName:\"Fischer 1968\"},\"helmert\":{a:6378200.0,rf:298.3,ellipseName:\"Helmert 1906\"},\"hough\":{a:6378270.0,rf:297.0,ellipseName:\"Hough\"},\"intl\":{a:6378388.0,rf:297.0,ellipseName:\"International 1909 (Hayford)\"},\"kaula\":{a:6378163.0,rf:298.24,ellipseName:\"Kaula 1961\"},\"lerch\":{a:6378139.0,rf:298.257,ellipseName:\"Lerch 1979\"},\"mprts\":{a:6397300.0,rf:191.0,ellipseName:\"Maupertius 1738\"},\"new_intl\":{a:6378157.5,b:6356772.2,ellipseName:\"New International 1967\"},\"plessis\":{a:6376523.0,rf:6355863.0,ellipseName:\"Plessis 1817 (France)\"},\"krass\":{a:6378245.0,rf:298.3,ellipseName:\"Krassovsky, 1942\"},\"SEasia\":{a:6378155.0,b:6356773.3205,ellipseName:\"Southeast Asia\"},\"walbeck\":{a:6376896.0,b:6355834.8467,ellipseName:\"Walbeck\"},\"WGS60\":{a:6378165.0,rf:298.3,ellipseName:\"WGS 60\"},\"WGS66\":{a:6378145.0,rf:298.25,ellipseName:\"WGS 66\"},\"WGS72\":{a:6378135.0,rf:298.26,ellipseName:\"WGS 72\"},\"WGS84\":{a:6378137.0,rf:298.257223563,ellipseName:\"WGS 84\"},\"sphere\":{a:6370997.0,b:6370997.0,ellipseName:\"Normal Sphere (r=6370997)\"}};Proj4js.Datum={\"WGS84\":{towgs84:\"0,0,0\",ellipse:\"WGS84\",datumName:\"WGS84\"},\"GGRS87\":{towgs84:\"-199.87,74.79,246.62\",ellipse:\"GRS80\",datumName:\"Greek_Geodetic_Reference_System_1987\"},\"NAD83\":{towgs84:\"0,0,0\",ellipse:\"GRS80\",datumName:\"North_American_Datum_1983\"},\"NAD27\":{nadgrids:\"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat\",ellipse:\"clrk66\",datumName:\"North_American_Datum_1927\"},\"potsdam\":{towgs84:\"606.0,23.0,413.0\",ellipse:\"bessel\",datumName:\"Potsdam Rauenberg 1950 DHDN\"},\"carthage\":{towgs84:\"-263.0,6.0,431.0\",ellipse:\"clark80\",datumName:\"Carthage 1934 Tunisia\"},\"hermannskogel\":{towgs84:\"653.0,-212.0,449.0\",ellipse:\"bessel\",datumName:\"Hermannskogel\"},\"ire65\":{towgs84:\"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15\",ellipse:\"mod_airy\",datumName:\"Ireland 1965\"},\"nzgd49\":{towgs84:\"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993\",ellipse:\"intl\",datumName:\"New Zealand Geodetic Datum 1949\"},\"OSGB36\":{towgs84:\"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894\",ellipse:\"airy\",datumName:\"Airy 1830\"}};Proj4js.WGS84=new Proj4js.Proj('WGS84');Proj4js.Datum['OSB36']=Proj4js.Datum['OSGB36'];Proj4js.wktProjections={\"Lambert Tangential Conformal Conic Projection\":\"lcc\",\"Mercator\":\"merc\",\"Popular Visualisation Pseudo Mercator\":\"merc\",\"Transverse_Mercator\":\"tmerc\",\"Transverse Mercator\":\"tmerc\",\"Lambert Azimuthal Equal Area\":\"laea\",\"Universal Transverse Mercator System\":\"utm\"};Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError(\"aeaInitEqualLatitudes\");return;}\nthis.temp=this.b/this.a;this.es=1.0-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1);}else{this.ns0=this.con;}\nthis.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0;},forward:function(p){var lon=p.x;var lat=p.y;this.sin_phi=Math.sin(lat);this.cos_phi=Math.cos(lat);var qs=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);var rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0;var theta=this.ns0*Proj4js.common.adjust_lon(lon-this.long0);var x=rh1*Math.sin(theta)+this.x0;var y=this.rh-rh1*Math.cos(theta)+this.y0;p.x=x;p.y=y;return p;},inverse:function(p){var rh1,qs,con,theta,lon,lat;p.x-=this.x0;p.y=this.rh-p.y+this.y0;if(this.ns0>=0){rh1=Math.sqrt(p.x*p.x+p.y*p.y);con=1.0;}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);con=-1.0;}\ntheta=0.0;if(rh1!=0.0){theta=Math.atan2(con*p.x,con*p.y);}\ncon=rh1*this.ns0/this.a;qs=(this.c-con*con)/this.ns0;if(this.e3>=1e-10){con=1-.5*(1.0-this.es)*Math.log((1.0-this.e3)/(1.0+this.e3))/this.e3;if(Math.abs(Math.abs(con)-Math.abs(qs))>.0000000001){lat=this.phi1z(this.e3,qs);}else{if(qs>=0){lat=.5*PI;}else{lat=-.5*PI;}}}else{lat=this.phi1z(e3,qs);}\nlon=Proj4js.common.adjust_lon(theta/this.ns0+this.long0);p.x=lon;p.y=lat;return p;},phi1z:function(eccent,qs){var con,com,dphi;var phi=Proj4js.common.asinz(.5*qs);if(eccent<Proj4js.common.EPSLN)return phi;var eccnts=eccent*eccent;for(var i=1;i<=25;i++){sinphi=Math.sin(phi);cosphi=Math.cos(phi);con=eccent*sinphi;com=1.0-con*con;dphi=.5*com*com/cosphi*(qs/(1.0-eccnts)-sinphi/com+.5/eccent*Math.log((1.0-con)/(1.0+con)));phi=phi+dphi;if(Math.abs(dphi)<=1e-7)return phi;}\nProj4js.reportError(\"aea:phi1z:Convergence error\");return null;}};Proj4js.Proj.sterea={dependsOn:'gauss',init:function(){Proj4js.Proj['gauss'].init.apply(this);if(!this.rc){Proj4js.reportError(\"sterea:init:E_ERROR_0\");return;}\nthis.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2.0*this.rc;if(!this.title)this.title=\"Oblique Stereographic Alternative\";},forward:function(p){p.x=Proj4js.common.adjust_lon(p.x-this.long0);Proj4js.Proj['gauss'].forward.apply(this,[p]);sinc=Math.sin(p.y);cosc=Math.cos(p.y);cosl=Math.cos(p.x);k=this.k0*this.R2/(1.0+this.sinc0*sinc+this.cosc0*cosc*cosl);p.x=k*cosc*Math.sin(p.x);p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);p.x=this.a*p.x+this.x0;p.y=this.a*p.y+this.y0;return p;},inverse:function(p){var lon,lat;p.x=(p.x-this.x0)/this.a;p.y=(p.y-this.y0)/this.a;p.x/=this.k0;p.y/=this.k0;if((rho=Math.sqrt(p.x*p.x+p.y*p.y))){c=2.0*Math.atan2(rho,this.R2);sinc=Math.sin(c);cosc=Math.cos(c);lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho);lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc);}else{lat=this.phic0;lon=0.;}\np.x=lon;p.y=lat;Proj4js.Proj['gauss'].inverse.apply(this,[p]);p.x=Proj4js.common.adjust_lon(p.x+this.long0);return p;}};function phi4z(eccent,e0,e1,e2,e3,a,b,c,phi){var sinphi,sin2ph,tanph,ml,mlp,con1,con2,con3,dphi,i;phi=a;for(i=1;i<=15;i++){sinphi=Math.sin(phi);tanphi=Math.tan(phi);c=tanphi*Math.sqrt(1.0-eccent*sinphi*sinphi);sin2ph=Math.sin(2.0*phi);ml=e0*phi-e1*sin2ph+e2*Math.sin(4.0*phi)-e3*Math.sin(6.0*phi);mlp=e0-2.0*e1*Math.cos(2.0*phi)+4.0*e2*Math.cos(4.0*phi)-6.0*e3*Math.cos(6.0*phi);con1=2.0*ml+c*(ml*ml+b)-2.0*a*(c*ml+1.0);con2=eccent*sin2ph*(ml*ml+b-2.0*a*ml)/(2.0*c);con3=2.0*(a-ml)*(c*mlp-2.0/sin2ph)-2.0*mlp;dphi=con1/(con2+con3);phi+=dphi;if(Math.abs(dphi)<=.0000000001)return(phi);}\nProj4js.reportError(\"phi4z: No convergence\");return null;}\nfunction e4fn(x){var con,com;con=1.0+x;com=1.0-x;return(Math.sqrt((Math.pow(con,con))*(Math.pow(com,com))));}\nProj4js.Proj.poly={init:function(){var temp;if(this.lat0=0)this.lat0=90;this.temp=this.b/this.a;this.es=1.0-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(p){var sinphi,cosphi;var al;var c;var con,ml;var ms;var x,y;var lon=p.x;var lat=p.y;con=Proj4js.common.adjust_lon(lon-this.long0);if(Math.abs(lat)<=.0000001){x=this.x0+this.a*con;y=this.y0-this.a*this.ml0;}else{sinphi=Math.sin(lat);cosphi=Math.cos(lat);ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);ms=Proj4js.common.msfnz(this.e,sinphi,cosphi);con=sinphi;x=this.x0+this.a*ms*Math.sin(con)/sinphi;y=this.y0+this.a*(ml-this.ml0+ms*(1.0-Math.cos(con))/sinphi);}\np.x=x;p.y=y;return p;},inverse:function(p){var sin_phi,cos_phi;var al;var b;var c;var con,ml;var iflg;var lon,lat;p.x-=this.x0;p.y-=this.y0;al=this.ml0+p.y/this.a;iflg=0;if(Math.abs(al)<=.0000001){lon=p.x/this.a+this.long0;lat=0.0;}else{b=al*al+(p.x/this.a)*(p.x/this.a);iflg=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,c,lat);if(iflg!=1)return(iflg);lon=Proj4js.common.adjust_lon((Proj4js.common.asinz(p.x*c/this.a)/Math.sin(lat))+this.long0);}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.equi={init:function(){if(!this.x0)this.x0=0;if(!this.y0)this.y0=0;if(!this.lat0)this.lat0=0;if(!this.long0)this.long0=0;},forward:function(p){var lon=p.x;var lat=p.y;var dlon=Proj4js.common.adjust_lon(lon-this.long0);var x=this.x0+this.a*dlon*Math.cos(this.lat0);var y=this.y0+this.a*lat;this.t1=x;this.t2=Math.cos(this.lat0);p.x=x;p.y=y;return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var lat=p.y/this.a;if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError(\"equi:Inv:DataError\");}\nvar lon=Proj4js.common.adjust_lon(this.long0+p.x/(this.a*Math.cos(this.lat0)));p.x=lon;p.y=lat;}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts);}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts));}}},forward:function(p){var lon=p.x;var lat=p.y;if(lat*Proj4js.common.R2D>90.0&&lat*Proj4js.common.R2D<-90.0&&lon*Proj4js.common.R2D>180.0&&lon*Proj4js.common.R2D<-180.0){Proj4js.reportError(\"merc:forward: llInputOutOfRange: \"+lon+\" : \"+lat);return null;}\nvar x,y;if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError(\"merc:forward: ll2mAtPoles\");return null;}else{if(this.sphere){x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);y=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*lat));}else{var sinphi=Math.sin(lat);var ts=Proj4js.common.tsfnz(this.e,lat,sinphi);x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);y=this.y0-this.a*this.k0*Math.log(ts);}\np.x=x;p.y=y;return p;}},inverse:function(p){var x=p.x-this.x0;var y=p.y-this.y0;var lon,lat;if(this.sphere){lat=Proj4js.common.HALF_PI-2.0*Math.atan(Math.exp(-y/this.a*this.k0));}else{var ts=Math.exp(-y/(this.a*this.k0));lat=Proj4js.common.phi2z(this.e,ts);if(lat==-9999){Proj4js.reportError(\"merc:inverse: lat = -9999\");return null;}}\nlon=Proj4js.common.adjust_lon(this.long0+x/(this.a*this.k0));p.x=lon;p.y=lat;return p;}};Proj4js.Proj.utm={dependsOn:'tmerc',init:function(){if(!this.zone){Proj4js.reportError(\"utm:init: zone must be specified for UTM\");return;}\nthis.lat0=0.0;this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;this.x0=500000.0;this.y0=this.utmSouth?10000000.0:0.0;this.k0=0.9996;Proj4js.Proj['tmerc'].init.apply(this);this.forward=Proj4js.Proj['tmerc'].forward;this.inverse=Proj4js.Proj['tmerc'].inverse;}};Proj4js.Proj.eqdc={init:function(){if(!this.mode)this.mode=0;this.temp=this.b/this.a;this.es=1.0-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError(\"eqdc:Init:EqualLatitudes\");}\nthis.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1);}else{this.ns=this.sinphi;}}else{this.ns=this.sinphi;}\nthis.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0);},forward:function(p){var lon=p.x;var lat=p.y;var ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);var rh1=this.a*(this.g-ml);var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);var x=this.x0+rh1*Math.sin(theta);var y=this.y0+this.rh-rh1*Math.cos(theta);p.x=x;p.y=y;return p;},inverse:function(p){p.x-=this.x0;p.y=this.rh-p.y+this.y0;var con,rh1;if(this.ns>=0){var rh1=Math.sqrt(p.x*p.x+p.y*p.y);var con=1.0;}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);con=-1.0;}\nvar theta=0.0;if(rh1!=0.0)theta=Math.atan2(con*p.x,con*p.y);var ml=this.g-rh1/this.a;var lat=this.phi3z(ml,this.e0,this.e1,this.e2,this.e3);var lon=Proj4js.common.adjust_lon(this.long0+theta/this.ns);p.x=lon;p.y=lat;return p;},phi3z:function(ml,e0,e1,e2,e3){var phi;var dphi;phi=ml;for(var i=0;i<15;i++){dphi=(ml+e1*Math.sin(2.0*phi)-e2*Math.sin(4.0*phi)+e3*Math.sin(6.0*phi))/e0-phi;phi+=dphi;if(Math.abs(dphi)<=.0000000001){return phi;}}\nProj4js.reportError(\"PHI3Z-CONV:Latitude failed to converge after 15 iterations\");return null;}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(p){var lon=p.x;var lat=p.y;var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);var con;var x,y;var sin_phi=Math.sin(lat);var cos_phi=Math.cos(lat);if(this.sphere){var b=cos_phi*Math.sin(delta_lon);if((Math.abs(Math.abs(b)-1.0))<.0000000001){Proj4js.reportError(\"tmerc:forward: Point projects into infinity\");return(93);}else{x=.5*this.a*this.k0*Math.log((1.0+b)/(1.0-b));con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1.0-b*b));if(lat<0)con=-con;y=this.a*this.k0*(con-this.lat0);}}else{var al=cos_phi*delta_lon;var als=Math.pow(al,2);var c=this.ep2*Math.pow(cos_phi,2);var tq=Math.tan(lat);var t=Math.pow(tq,2);con=1.0-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con);var ml=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);x=this.k0*n*al*(1.0+als/6.0*(1.0-t+c+als/20.0*(5.0-18.0*t+Math.pow(t,2)+72.0*c-58.0*this.ep2)))+this.x0;y=this.k0*(ml-this.ml0+n*tq*(als*(0.5+als/24.0*(5.0-t+9.0*c+4.0*Math.pow(c,2)+als/30.0*(61.0-58.0*t+Math.pow(t,2)+600.0*c-330.0*this.ep2)))))+this.y0;}\np.x=x;p.y=y;return p;},inverse:function(p){var con,phi;var delta_phi;var i;var max_iter=6;var lat,lon;if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0));var g=.5*(f-1/f);var temp=this.lat0+p.y/(this.a*this.k0);var h=Math.cos(temp);con=Math.sqrt((1.0-h*h)/(1.0+g*g));lat=Proj4js.common.asinz(con);if(temp<0)\nlat=-lat;if((g==0)&&(h==0)){lon=this.long0;}else{lon=Proj4js.common.adjust_lon(Math.atan2(g,h)+this.long0);}}else{var x=p.x-this.x0;var y=p.y-this.y0;con=(this.ml0+y/this.k0)/this.a;phi=con;for(i=0;true;i++){delta_phi=((con+this.e1*Math.sin(2.0*phi)-this.e2*Math.sin(4.0*phi)+this.e3*Math.sin(6.0*phi))/this.e0)-phi;phi+=delta_phi;if(Math.abs(delta_phi)<=Proj4js.common.EPSLN)break;if(i>=max_iter){Proj4js.reportError(\"tmerc:inverse: Latitude failed to converge\");return(95);}}\nif(Math.abs(phi)<Proj4js.common.HALF_PI){var sin_phi=Math.sin(phi);var cos_phi=Math.cos(phi);var tan_phi=Math.tan(phi);var c=this.ep2*Math.pow(cos_phi,2);var cs=Math.pow(c,2);var t=Math.pow(tan_phi,2);var ts=Math.pow(t,2);con=1.0-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con);var r=n*(1.0-this.es)/con;var d=x/(n*this.k0);var ds=Math.pow(d,2);lat=phi-(n*tan_phi*ds/r)*(0.5-ds/24.0*(5.0+3.0*t+10.0*c-4.0*cs-9.0*this.ep2-ds/30.0*(61.0+90.0*t+298.0*c+45.0*ts-252.0*this.ep2-3.0*cs)));lon=Proj4js.common.adjust_lon(this.long0+(d*(1.0-ds/6.0*(1.0+2.0*t+c-ds/20.0*(5.0-2.0*c+28.0*t-3.0*cs+8.0*this.ep2+24.0*ts)))/cos_phi));}else{lat=Proj4js.common.HALF_PI*Proj4js.common.sign(y);lon=this.long0;}}\np.x=lon;p.y=lat;return p;}};Proj4js.defs[\"GOOGLE\"]=\"+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs\";Proj4js.defs[\"EPSG:900913\"]=Proj4js.defs[\"GOOGLE\"];Proj4js.Proj.gstmerc={init:function(){var temp=this.b/this.a;this.e=Math.sqrt(1.0-temp*temp);this.lc=this.long0;this.rs=Math.sqrt(1.0+this.e*this.e*Math.pow(Math.cos(this.lat0),4.0)/(1.0-this.e*this.e));var sinz=Math.sin(this.lat0);var pc=Math.asin(sinz/this.rs);var sinzpc=Math.sin(pc);this.cp=Proj4js.common.latiso(0.0,pc,sinzpc)-this.rs*Proj4js.common.latiso(this.e,this.lat0,sinz);this.n2=this.k0*this.a*Math.sqrt(1.0-this.e*this.e)/(1.0-this.e*this.e*sinz*sinz);this.xs=this.x0;this.ys=this.y0-this.n2*pc;if(!this.title)this.title=\"Gauss Schreiber transverse mercator\";},forward:function(p){var lon=p.x;var lat=p.y;var L=this.rs*(lon-this.lc);var Ls=this.cp+(this.rs*Proj4js.common.latiso(this.e,lat,Math.sin(lat)));var lat1=Math.asin(Math.sin(L)/Proj4js.common.cosh(Ls));var Ls1=Proj4js.common.latiso(0.0,lat1,Math.sin(lat1));p.x=this.xs+(this.n2*Ls1);p.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(Ls)/Math.cos(L)));return p;},inverse:function(p){var x=p.x;var y=p.y;var L=Math.atan(Proj4js.common.sinh((x-this.xs)/this.n2)/Math.cos((y-this.ys)/this.n2));var lat1=Math.asin(Math.sin((y-this.ys)/this.n2)/Proj4js.common.cosh((x-this.xs)/this.n2));var LC=Proj4js.common.latiso(0.0,lat1,Math.sin(lat1));p.x=this.lc+L/this.rs;p.y=Proj4js.common.invlatiso(this.e,(LC-this.cp)/this.rs);return p;}};Proj4js.Proj.ortho={init:function(def){;this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);},forward:function(p){var sinphi,cosphi;var dlon;var coslon;var ksp;var g;var lon=p.x;var lat=p.y;dlon=Proj4js.common.adjust_lon(lon-this.long0);sinphi=Math.sin(lat);cosphi=Math.cos(lat);coslon=Math.cos(dlon);g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon;ksp=1.0;if((g>0)||(Math.abs(g)<=Proj4js.common.EPSLN)){var x=this.a*ksp*cosphi*Math.sin(dlon);var y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon);}else{Proj4js.reportError(\"orthoFwdPointError\");}\np.x=x;p.y=y;return p;},inverse:function(p){var rh;var z;var sinz,cosz;var temp;var con;var lon,lat;p.x-=this.x0;p.y-=this.y0;rh=Math.sqrt(p.x*p.x+p.y*p.y);if(rh>this.a+.0000001){Proj4js.reportError(\"orthoInvDataError\");}\nz=Proj4js.common.asinz(rh/this.a);sinz=Math.sin(z);cosz=Math.cos(z);lon=this.long0;if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0;}\nlat=Proj4js.common.asinz(cosz*this.sin_p14+(p.y*sinz*this.cos_p14)/rh);con=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(con)<=Proj4js.common.EPSLN){if(this.lat0>=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y));}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y));}}\ncon=cosz-this.sin_p14*Math.sin(lat);p.x=lon;p.y=lat;return p;}};Proj4js.Proj.somerc={init:function(){var phy0=this.lat0;this.lambda0=this.long0;var sinPhy0=Math.sin(phy0);var semiMajorAxis=this.a;var invF=this.rf;var flattening=1/invF;var e2=2*flattening-Math.pow(flattening,2);var e=this.e=Math.sqrt(e2);this.R=this.k0*semiMajorAxis*Math.sqrt(1-e2)/(1-e2*Math.pow(sinPhy0,2.0));this.alpha=Math.sqrt(1+e2/(1-e2)*Math.pow(Math.cos(phy0),4.0));this.b0=Math.asin(sinPhy0/this.alpha);this.K=Math.log(Math.tan(Math.PI/4.0+this.b0/2.0))\n-this.alpha*Math.log(Math.tan(Math.PI/4.0+phy0/2.0))\n+this.alpha*e/2*Math.log((1+e*sinPhy0)/(1-e*sinPhy0));},forward:function(p){var Sa1=Math.log(Math.tan(Math.PI/4.0-p.y/2.0));var Sa2=this.e/2.0*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y)));var S=-this.alpha*(Sa1+Sa2)+this.K;var b=2.0*(Math.atan(Math.exp(S))-Math.PI/4.0);var I=this.alpha*(p.x-this.lambda0);var rotI=Math.atan(Math.sin(I)/(Math.sin(this.b0)*Math.tan(b)+\nMath.cos(this.b0)*Math.cos(I)));var rotB=Math.asin(Math.cos(this.b0)*Math.sin(b)-\nMath.sin(this.b0)*Math.cos(b)*Math.cos(I));p.y=this.R/2.0*Math.log((1+Math.sin(rotB))/(1-Math.sin(rotB)))\n+this.y0;p.x=this.R*rotI+this.x0;return p;},inverse:function(p){var Y=p.x-this.x0;var X=p.y-this.y0;var rotI=Y/this.R;var rotB=2*(Math.atan(Math.exp(X/this.R))-Math.PI/4.0);var b=Math.asin(Math.cos(this.b0)*Math.sin(rotB)\n+Math.sin(this.b0)*Math.cos(rotB)*Math.cos(rotI));var I=Math.atan(Math.sin(rotI)/(Math.cos(this.b0)*Math.cos(rotI)-Math.sin(this.b0)*Math.tan(rotB)));var lambda=this.lambda0+I/this.alpha;var S=0.0;var phy=b;var prevPhy=-1000.0;var iteration=0;while(Math.abs(phy-prevPhy)>0.0000001)\n{if(++iteration>20)\n{Proj4js.reportError(\"omercFwdInfinity\");return;}\nS=1.0/this.alpha*(Math.log(Math.tan(Math.PI/4.0+b/2.0))-this.K)\n+this.e*Math.log(Math.tan(Math.PI/4.0\n+Math.asin(this.e*Math.sin(phy))/2.0));prevPhy=phy;phy=2.0*Math.atan(Math.exp(S))-Math.PI/2.0;}\np.x=lambda;p.y=phy;return p;}};Proj4js.Proj.stere={ssfn_:function(phit,sinphi,eccen){sinphi*=eccen;return(Math.tan(.5*(Proj4js.common.HALF_PI+phit))*Math.pow((1.-sinphi)/(1.+sinphi),.5*eccen));},TOL:1.e-8,NITER:8,CONV:1.e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var t=Math.abs(this.lat0);if((Math.abs(t)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0.?this.S_POLE:this.N_POLE;}else{this.mode=t>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;}\nthis.phits=Math.abs(this.phits);if(this.es){var X;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2.*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));}else{t=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,t);t*=this.e;this.akm1/=Math.sqrt(1.-t*t);}\nbreak;case this.EQUIT:this.akm1=2.*this.k0;break;case this.OBLIQ:t=Math.sin(this.lat0);X=2.*Math.atan(this.ssfn_(this.lat0,t,this.e))-Proj4js.common.HALF_PI;t*=this.e;this.akm1=2.*this.k0*Math.cos(this.lat0)/Math.sqrt(1.-t*t);this.sinX1=Math.sin(X);this.cosX1=Math.cos(X);break;}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2.*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2.*this.k0;break;}}},forward:function(p){var lon=p.x;lon=Proj4js.common.adjust_lon(lon-this.long0);var lat=p.y;var x,y;if(this.sphere){var sinphi,cosphi,coslam,sinlam;sinphi=Math.sin(lat);cosphi=Math.cos(lat);coslam=Math.cos(lon);sinlam=Math.sin(lon);switch(this.mode){case this.EQUIT:y=1.+cosphi*coslam;if(y<=Proj4js.common.EPSLN){F_ERROR;}\ny=this.akm1/y;x=y*cosphi*sinlam;y*=sinphi;break;case this.OBLIQ:y=1.+this.sinph0*sinphi+this.cosph0*cosphi*coslam;if(y<=Proj4js.common.EPSLN){F_ERROR;}\ny=this.akm1/y;x=y*cosphi*sinlam;y*=this.cosph0*sinphi-this.sinph0*cosphi*coslam;break;case this.N_POLE:coslam=-coslam;lat=-lat;case this.S_POLE:if(Math.abs(lat-Proj4js.common.HALF_PI)<this.TOL){F_ERROR;}\ny=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*lat);x=sinlam*y;y*=coslam;break;}}else{coslam=Math.cos(lon);sinlam=Math.sin(lon);sinphi=Math.sin(lat);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2.*Math.atan(this.ssfn_(lat,sinphi,this.e));sinX=Math.sin(X-Proj4js.common.HALF_PI);cosX=Math.cos(X);}\nswitch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1.+this.sinX1*sinX+this.cosX1*cosX*coslam));y=A*(this.cosX1*sinX-this.sinX1*cosX*coslam);x=A*cosX;break;case this.EQUIT:A=2.*this.akm1/(1.+cosX*coslam);y=A*sinX;x=A*cosX;break;case this.S_POLE:lat=-lat;coslam=-coslam;sinphi=-sinphi;case this.N_POLE:x=this.akm1*Proj4js.common.tsfnz(this.e,lat,sinphi);y=-x*coslam;break;}\nx=x*sinlam;}\np.x=x*this.a+this.x0;p.y=y*this.a+this.y0;return p;},inverse:function(p){var x=(p.x-this.x0)/this.a;var y=(p.y-this.y0)/this.a;var lon,lat;var cosphi,sinphi,tp=0.0,phi_l=0.0,rho,halfe=0.0,pi2=0.0;var i;if(this.sphere){var c,rh,sinc,cosc;rh=Math.sqrt(x*x+y*y);c=2.*Math.atan(rh/this.akm1);sinc=Math.sin(c);cosc=Math.cos(c);lon=0.;switch(this.mode){case this.EQUIT:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=0.;}else{lat=Math.asin(y*sinc/rh);}\nif(cosc!=0.||x!=0.)lon=Math.atan2(x*sinc,cosc*rh);break;case this.OBLIQ:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0;}else{lat=Math.asin(cosc*sinph0+y*sinc*cosph0/rh);}\nc=cosc-sinph0*Math.sin(lat);if(c!=0.||x!=0.){lon=Math.atan2(x*sinc*cosph0,c*rh);}\nbreak;case this.N_POLE:y=-y;case this.S_POLE:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0;}else{lat=Math.asin(this.mode==this.S_POLE?-cosc:cosc);}\nlon=(x==0.&&y==0.)?0.:Math.atan2(x,y);break;}\np.x=Proj4js.common.adjust_lon(lon+this.long0);p.y=lat;}else{rho=Math.sqrt(x*x+y*y);switch(this.mode){case this.OBLIQ:case this.EQUIT:tp=2.*Math.atan2(rho*this.cosX1,this.akm1);cosphi=Math.cos(tp);sinphi=Math.sin(tp);if(rho==0.0){phi_l=Math.asin(cosphi*this.sinX1);}else{phi_l=Math.asin(cosphi*this.sinX1+(y*sinphi*this.cosX1/rho));}\ntp=Math.tan(.5*(Proj4js.common.HALF_PI+phi_l));x*=sinphi;y=rho*this.cosX1*cosphi-y*this.sinX1*sinphi;pi2=Proj4js.common.HALF_PI;halfe=.5*this.e;break;case this.N_POLE:y=-y;case this.S_POLE:tp=-rho/this.akm1;phi_l=Proj4js.common.HALF_PI-2.*Math.atan(tp);pi2=-Proj4js.common.HALF_PI;halfe=-.5*this.e;break;}\nfor(i=this.NITER;i--;phi_l=lat){sinphi=this.e*Math.sin(phi_l);lat=2.*Math.atan(tp*Math.pow((1.+sinphi)/(1.-sinphi),halfe))-pi2;if(Math.abs(phi_l-lat)<this.CONV){if(this.mode==this.S_POLE)lat=-lat;lon=(x==0.&&y==0.)?0.:Math.atan2(x,y);p.x=Proj4js.common.adjust_lon(lon+this.long0);p.y=lat;return p;}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();this.A[1]=+0.6399175073;this.A[2]=-0.1358797613;this.A[3]=+0.063294409;this.A[4]=-0.02526853;this.A[5]=+0.0117879;this.A[6]=-0.0055161;this.A[7]=+0.0026906;this.A[8]=-0.001333;this.A[9]=+0.00067;this.A[10]=-0.00034;this.B_re=new Array();this.B_im=new Array();this.B_re[1]=+0.7557853228;this.B_im[1]=0.0;this.B_re[2]=+0.249204646;this.B_im[2]=+0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=+0.041058560;this.B_re[4]=-0.10162907;this.B_im[4]=+0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array();this.C_im=new Array();this.C_re[1]=+1.3231270439;this.C_im[1]=0.0;this.C_re[2]=-0.577245789;this.C_im[2]=-0.007809598;this.C_re[3]=+0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;this.C_im[4]=+0.18200602;this.C_re[5]=+1.01418179;this.C_im[5]=+1.64497696;this.C_re[6]=+1.9660549;this.C_im[6]=+2.5127645;this.D=new Array();this.D[1]=+1.5627014243;this.D[2]=+0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;this.D[6]=+0.007317;this.D[7]=+0.01220;this.D[8]=+0.00394;this.D[9]=-0.0013;},forward:function(p){var lon=p.x;var lat=p.y;var delta_lat=lat-this.lat0;var delta_lon=lon-this.long0;var d_phi=delta_lat/Proj4js.common.SEC_TO_RAD*1E-5;var d_lambda=delta_lon;var d_phi_n=1;var d_psi=0;for(n=1;n<=10;n++){d_phi_n=d_phi_n*d_phi;d_psi=d_psi+this.A[n]*d_phi_n;}\nvar th_re=d_psi;var th_im=d_lambda;var th_n_re=1;var th_n_im=0;var th_n_re1;var th_n_im1;var z_re=0;var z_im=0;for(n=1;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;th_n_im1=th_n_im*th_re+th_n_re*th_im;th_n_re=th_n_re1;th_n_im=th_n_im1;z_re=z_re+this.B_re[n]*th_n_re-this.B_im[n]*th_n_im;z_im=z_im+this.B_im[n]*th_n_re+this.B_re[n]*th_n_im;}\nx=(z_im*this.a)+this.x0;y=(z_re*this.a)+this.y0;p.x=x;p.y=y;return p;},inverse:function(p){var x=p.x;var y=p.y;var delta_x=x-this.x0;var delta_y=y-this.y0;var z_re=delta_y/this.a;var z_im=delta_x/this.a;var z_n_re=1;var z_n_im=0;var z_n_re1;var z_n_im1;var th_re=0;var th_im=0;for(n=1;n<=6;n++){z_n_re1=z_n_re*z_re-z_n_im*z_im;z_n_im1=z_n_im*z_re+z_n_re*z_im;z_n_re=z_n_re1;z_n_im=z_n_im1;th_re=th_re+this.C_re[n]*z_n_re-this.C_im[n]*z_n_im;th_im=th_im+this.C_im[n]*z_n_re+this.C_re[n]*z_n_im;}\nfor(i=0;i<this.iterations;i++){var th_n_re=th_re;var th_n_im=th_im;var th_n_re1;var th_n_im1;var num_re=z_re;var num_im=z_im;for(n=2;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;th_n_im1=th_n_im*th_re+th_n_re*th_im;th_n_re=th_n_re1;th_n_im=th_n_im1;num_re=num_re+(n-1)*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);num_im=num_im+(n-1)*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);}\nth_n_re=1;th_n_im=0;var den_re=this.B_re[1];var den_im=this.B_im[1];for(n=2;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;th_n_im1=th_n_im*th_re+th_n_re*th_im;th_n_re=th_n_re1;th_n_im=th_n_im1;den_re=den_re+n*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);den_im=den_im+n*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);}\nvar den2=den_re*den_re+den_im*den_im;th_re=(num_re*den_re+num_im*den_im)/den2;th_im=(num_im*den_re-num_re*den_im)/den2;}\nvar d_psi=th_re;var d_lambda=th_im;var d_psi_n=1;var d_phi=0;for(n=1;n<=9;n++){d_psi_n=d_psi_n*d_psi;d_phi=d_phi+this.D[n]*d_psi_n;}\nvar lat=this.lat0+(d_phi*Proj4js.common.SEC_TO_RAD*1E5);var lon=this.long0+d_lambda;p.x=lon;p.y=lat;return p;}};Proj4js.Proj.mill={init:function(){},forward:function(p){var lon=p.x;var lat=p.y;var dlon=Proj4js.common.adjust_lon(lon-this.long0);var x=this.x0+this.a*dlon;var y=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4.0)+(lat/2.5)))*1.25;p.x=x;p.y=y;return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.a);var lat=2.5*(Math.atan(Math.exp(0.8*p.y/this.a))-Proj4js.common.PI/4.0);p.x=lon;p.y=lat;return p;}};Proj4js.Proj.gnom={init:function(def){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1000*this.a;this.rc=1;},forward:function(p){var sinphi,cosphi;var dlon;var coslon;var ksp;var g;var lon=p.x;var lat=p.y;dlon=Proj4js.common.adjust_lon(lon-this.long0);sinphi=Math.sin(lat);cosphi=Math.cos(lat);coslon=Math.cos(dlon);g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon;ksp=1.0;if((g>0)||(Math.abs(g)<=Proj4js.common.EPSLN)){x=this.x0+this.a*ksp*cosphi*Math.sin(dlon)/g;y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)/g;}else{Proj4js.reportError(\"orthoFwdPointError\");x=this.x0+this.infinity_dist*cosphi*Math.sin(dlon);y=this.y0+this.infinity_dist*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon);}\np.x=x;p.y=y;return p;},inverse:function(p){var rh;var z;var sinc,cosc;var c;var lon,lat;p.x=(p.x-this.x0)/this.a;p.y=(p.y-this.y0)/this.a;p.x/=this.k0;p.y/=this.k0;if((rh=Math.sqrt(p.x*p.x+p.y*p.y))){c=Math.atan2(rh,this.rc);sinc=Math.sin(c);cosc=Math.cos(c);lat=Proj4js.common.asinz(cosc*this.sin_p14+(p.y*sinc*this.cos_p14)/rh);lon=Math.atan2(p.x*sinc,rh*this.cos_p14*cosc-p.y*this.sin_p14*sinc);lon=Proj4js.common.adjust_lon(this.long0+lon);}else{lat=this.phic0;lon=0.0;}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.sinu={init:function(){this.R=6370997.0;},forward:function(p){var x,y,delta_lon;var lon=p.x;var lat=p.y;delta_lon=Proj4js.common.adjust_lon(lon-this.long0);x=this.R*delta_lon*Math.cos(lat)+this.x0;y=this.R*lat+this.y0;p.x=x;p.y=y;return p;},inverse:function(p){var lat,temp,lon;p.x-=this.x0;p.y-=this.y0;lat=p.y/this.R;if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError(\"sinu:Inv:DataError\");}\ntemp=Math.abs(lat)-Proj4js.common.HALF_PI;if(Math.abs(temp)>Proj4js.common.EPSLN){temp=this.long0+p.x/(this.R*Math.cos(lat));lon=Proj4js.common.adjust_lon(temp);}else{lon=this.long0;}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.vandg={init:function(){this.R=6370997.0;},forward:function(p){var lon=p.x;var lat=p.y;var dlon=Proj4js.common.adjust_lon(lon-this.long0);var x,y;if(Math.abs(lat)<=Proj4js.common.EPSLN){x=this.x0+this.R*dlon;y=this.y0;}\nvar theta=Proj4js.common.asinz(2.0*Math.abs(lat/Proj4js.common.PI));if((Math.abs(dlon)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){x=this.x0;if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.tan(.5*theta);}else{y=this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*theta);}}\nvar al=.5*Math.abs((Proj4js.common.PI/dlon)-(dlon/Proj4js.common.PI));var asq=al*al;var sinth=Math.sin(theta);var costh=Math.cos(theta);var g=costh/(sinth+costh-1.0);var gsq=g*g;var m=g*(2.0/sinth-1.0);var msq=m*m;var con=Proj4js.common.PI*this.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);if(dlon<0){con=-con;}\nx=this.x0+con;con=Math.abs(con/(Proj4js.common.PI*this.R));if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1.0-con*con-2.0*al*con);}else{y=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1.0-con*con-2.0*al*con);}\np.x=x;p.y=y;return p;},inverse:function(p){var dlon;var xx,yy,xys,c1,c2,c3;var al,asq;var a1;var m1;var con;var th1;var d;p.x-=this.x0;p.y-=this.y0;con=Proj4js.common.PI*this.R;xx=p.x/con;yy=p.y/con;xys=xx*xx+yy*yy;c1=-Math.abs(yy)*(1.0+xys);c2=c1-2.0*yy*yy+xx*xx;c3=-2.0*c1+1.0+2.0*yy*yy+xys*xys;d=yy*yy/c3+(2.0*c2*c2*c2/c3/c3/c3-9.0*c1*c2/c3/c3)/27.0;a1=(c1-c2*c2/3.0/c3)/c3;m1=2.0*Math.sqrt(-a1/3.0);con=((3.0*d)/a1)/m1;if(Math.abs(con)>1.0){if(con>=0.0){con=1.0;}else{con=-1.0;}}\nth1=Math.acos(con)/3.0;if(p.y>=0){lat=(-m1*Math.cos(th1+Proj4js.common.PI/3.0)-c2/3.0/c3)*Proj4js.common.PI;}else{lat=-(-m1*Math.cos(th1+Proj4js.common.PI/3.0)-c2/3.0/c3)*Proj4js.common.PI;}\nif(Math.abs(xx)<Proj4js.common.EPSLN){lon=this.long0;}\nlon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(xys-1.0+Math.sqrt(1.0+2.0*(xx*xx-yy*yy)+xys*xys))/2.0/xx);p.x=lon;p.y=lat;return p;}};Proj4js.Proj.cea={init:function(){},forward:function(p){var lon=p.x;var lat=p.y;dlon=Proj4js.common.adjust_lon(lon-this.long0);var x=this.x0+this.a*dlon*Math.cos(this.lat_ts);var y=this.y0+this.a*Math.sin(lat)/Math.cos(this.lat_ts);p.x=x;p.y=y;return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var lon=Proj4js.common.adjust_lon(this.long0+(p.x/this.a)/Math.cos(this.lat_ts));var lat=Math.asin((p.y/this.a)*Math.cos(this.lat_ts));p.x=lon;p.y=lat;return p;}};Proj4js.Proj.eqc={init:function(){if(!this.x0)this.x0=0;if(!this.y0)this.y0=0;if(!this.lat0)this.lat0=0;if(!this.long0)this.long0=0;if(!this.lat_ts)this.lat_ts=0;if(!this.title)this.title=\"Equidistant Cylindrical (Plate Carre)\";this.rc=Math.cos(this.lat_ts);},forward:function(p){var lon=p.x;var lat=p.y;var dlon=Proj4js.common.adjust_lon(lon-this.long0);var dlat=Proj4js.common.adjust_lat(lat-this.lat0);p.x=this.x0+(this.a*dlon*this.rc);p.y=this.y0+(this.a*dlat);return p;},inverse:function(p){var x=p.x;var y=p.y;p.x=Proj4js.common.adjust_lon(this.long0+((x-this.x0)/(this.a*this.rc)));p.y=Proj4js.common.adjust_lat(this.lat0+((y-this.y0)/(this.a)));return p;}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=this.pj_enfn(this.es)\nthis.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en);}},C1:.16666666666666666666,C2:.00833333333333333333,C3:.04166666666666666666,C4:.33333333333333333333,C5:.06666666666666666666,forward:function(p){var x,y;var lam=p.x;var phi=p.y;lam=Proj4js.common.adjust_lon(lam-this.long0);if(this.sphere){x=Math.asin(Math.cos(phi)*Math.sin(lam));y=Math.atan2(Math.tan(phi),Math.cos(lam))-this.phi0;}else{this.n=Math.sin(phi);this.c=Math.cos(phi);y=this.pj_mlfn(phi,this.n,this.c,this.en);this.n=1./Math.sqrt(1.-this.es*this.n*this.n);this.tn=Math.tan(phi);this.t=this.tn*this.tn;this.a1=lam*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;x=this.n*this.a1*(1.-this.a2*this.t*(this.C1-(8.-this.t+8.*this.c)*this.a2*this.C2));y-=this.m0-this.n*this.tn*this.a2*(.5+(5.-this.t+6.*this.c)*this.a2*this.C3);}\np.x=this.a*x+this.x0;p.y=this.a*y+this.y0;return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var x=p.x/this.a;var y=p.y/this.a;if(this.sphere){this.dd=y+this.lat0;phi=Math.asin(Math.sin(this.dd)*Math.cos(x));lam=Math.atan2(Math.tan(x),Math.cos(this.dd));}else{ph1=this.pj_inv_mlfn(this.m0+y,this.es,this.en);this.tn=Math.tan(ph1);this.t=this.tn*this.tn;this.n=Math.sin(ph1);this.r=1./(1.-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1.-this.es)*this.n;this.dd=x/this.n;this.d2=this.dd*this.dd;phi=ph1-(this.n*this.tn/this.r)*this.d2*(.5-(1.+3.*this.t)*this.d2*this.C3);lam=this.dd*(1.+this.t*this.d2*(-this.C4+(1.+3.*this.t)*this.d2*this.C5))/Math.cos(ph1);}\np.x=Proj4js.common.adjust_lon(this.long0+lam);p.y=phi;return p;},pj_enfn:function(es){en=new Array();en[0]=this.C00-es*(this.C02+es*(this.C04+es*(this.C06+es*this.C08)));en[1]=es*(this.C22-es*(this.C04+es*(this.C06+es*this.C08)));var t=es*es;en[2]=t*(this.C44-es*(this.C46+es*this.C48));t*=es;en[3]=t*(this.C66-es*this.C68);en[4]=t*es*this.C88;return en;},pj_mlfn:function(phi,sphi,cphi,en){cphi*=sphi;sphi*=sphi;return(en[0]*phi-cphi*(en[1]+sphi*(en[2]+sphi*(en[3]+sphi*en[4]))));},pj_inv_mlfn:function(arg,es,en){k=1./(1.-es);phi=arg;for(i=Proj4js.common.MAX_ITER;i;--i){s=Math.sin(phi);t=1.-es*s*s;t=(this.pj_mlfn(phi,s,Math.cos(phi),en)-arg)*(t*Math.sqrt(t))*k;phi-=t;if(Math.abs(t)<Proj4js.common.EPSLN)\nreturn phi;}\nProj4js.reportError(\"cass:pj_inv_mlfn: Convergence error\");return phi;},C00:1.0,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.01302083333333333333,C48:.00712076822916666666,C66:.36458333333333333333,C68:.00569661458333333333,C88:.3076171875}\nProj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1.0-this.es)/(1.0-this.es*sphi*sphi);this.C=Math.sqrt(1.0+this.es*cphi*cphi/(1.0-this.es));this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp));},forward:function(p){var lon=p.x;var lat=p.y;p.y=2.0*Math.atan(this.K*Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(lat),this.ratexp))-Proj4js.common.HALF_PI;p.x=this.C*lon;return p;},inverse:function(p){var DEL_TOL=1e-14;var lon=p.x/this.C;var lat=p.y;num=Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI)/this.K,1./this.C);for(var i=Proj4js.common.MAX_ITER;i>0;--i){lat=2.0*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(p.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(lat-p.y)<DEL_TOL)break;p.y=lat;}\nif(!i){Proj4js.reportError(\"gauss:inverse:convergence failed\");return null;}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.omerc={init:function(){if(!this.mode)this.mode=0;if(!this.lon1){this.lon1=0;this.mode=1;}\nif(!this.lon2)this.lon2=0;if(!this.lat2)this.lat2=0;var temp=this.b/this.a;var es=1.0-Math.pow(temp,2);var e=Math.sqrt(es);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1.0-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1.0-es);this.bl=Math.sqrt(1.0+this.es*Math.pow(this.cos_p20,4.0)/(1.0-es));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1.0;this.d=1.0;this.el=1.0;}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);if((this.d*this.d-1.0)>0.0){if(this.lat0>=0.0){this.f=this.d+Math.sqrt(this.d*this.d-1.0);}else{this.f=this.d-Math.sqrt(this.d*this.d-1.0);}}else{this.f=this.d;}\nthis.el=this.f*Math.pow(this.ts,this.bl);}\nif(this.mode!=0){this.g=.5*(this.f-1.0/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1.0)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1.0)/this.cosaz);}}else{Proj4js.reportError(\"omerc:Init:DataError\");}}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=.5*(this.f-1.0/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;if(this.dlon<-Proj4js.common.PI)this.lon2=this.lon2-2.0*Proj4js.common.PI;if(this.dlon>Proj4js.common.PI)this.lon2=this.lon2+2.0*Proj4js.common.PI;this.dlon=this.lon1-this.lon2;this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError(\"omercInitDataError\");}else{this.con=Math.abs(this.lat1);}\nif((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError(\"omercInitDataError\");}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError(\"omercInitDataError\");}}\nthis.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1.0)/this.cosaz);}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1.0)/this.cosaz);}}},forward:function(p){var theta;var sin_phi,cos_phi;var b;var c,t,tq;var con,n,ml;var q,us,vl;var ul,vs;var s;var dlon;var ts1;var lon=p.x;var lat=p.y;sin_phi=Math.sin(lat);dlon=Proj4js.common.adjust_lon(lon-this.longc);vl=Math.sin(this.bl*dlon);if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){ts1=Proj4js.common.tsfnz(this.e,lat,sin_phi);q=this.el/(Math.pow(ts1,this.bl));s=.5*(q-1.0/q);t=.5*(q+1.0/q);ul=(s*this.singam-vl*this.cosgam)/t;con=Math.cos(this.bl*dlon);if(Math.abs(con)<.0000001){us=this.al*this.bl*dlon;}else{us=this.al*Math.atan((s*this.cosgam+vl*this.singam)/con)/this.bl;if(con<0)us=us+Proj4js.common.PI*this.al/this.bl;}}else{if(lat>=0){ul=this.singam;}else{ul=-this.singam;}\nus=this.al*lat/this.bl;}\nif(Math.abs(Math.abs(ul)-1.0)<=Proj4js.common.EPSLN){Proj4js.reportError(\"omercFwdInfinity\");}\nvs=.5*this.al*Math.log((1.0-ul)/(1.0+ul))/this.bl;us=us-this.u;var x=this.x0+vs*this.cosaz+us*this.sinaz;var y=this.y0+us*this.cosaz-vs*this.sinaz;p.x=x;p.y=y;return p;},inverse:function(p){var delta_lon;var theta;var delta_theta;var sin_phi,cos_phi;var b;var c,t,tq;var con,n,ml;var vs,us,q,s,ts1;var vl,ul,bs;var dlon;var flag;p.x-=this.x0;p.y-=this.y0;flag=0;vs=p.x*this.cosaz-p.y*this.sinaz;us=p.y*this.cosaz+p.x*this.sinaz;us=us+this.u;q=Math.exp(-this.bl*vs/this.al);s=.5*(q-1.0/q);t=.5*(q+1.0/q);vl=Math.sin(this.bl*us/this.al);ul=(vl*this.cosgam+s*this.singam)/t;if(Math.abs(Math.abs(ul)-1.0)<=Proj4js.common.EPSLN)\n{lon=this.longc;if(ul>=0.0){lat=Proj4js.common.HALF_PI;}else{lat=-Proj4js.common.HALF_PI;}}else{con=1.0/this.bl;ts1=Math.pow((this.el/Math.sqrt((1.0+ul)/(1.0-ul))),con);lat=Proj4js.common.phi2z(this.e,ts1);theta=this.longc-Math.atan2((s*this.cosgam-vl*this.singam),con)/this.bl;lon=Proj4js.common.adjust_lon(theta);}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0;}\nif(!this.k0)this.k0=1.0;if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError(\"lcc:init: Equal Latitudes\");return;}\nvar temp=this.b/this.a;this.e=Math.sqrt(1.0-temp*temp);var sin1=Math.sin(this.lat1);var cos1=Math.cos(this.lat1);var ms1=Proj4js.common.msfnz(this.e,sin1,cos1);var ts1=Proj4js.common.tsfnz(this.e,this.lat1,sin1);var sin2=Math.sin(this.lat2);var cos2=Math.cos(this.lat2);var ms2=Proj4js.common.msfnz(this.e,sin2,cos2);var ts2=Proj4js.common.tsfnz(this.e,this.lat2,sin2);var ts0=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(ms1/ms2)/Math.log(ts1/ts2);}else{this.ns=sin1;}\nthis.f0=ms1/(this.ns*Math.pow(ts1,this.ns));this.rh=this.a*this.f0*Math.pow(ts0,this.ns);if(!this.title)this.title=\"Lambert Conformal Conic\";},forward:function(p){var lon=p.x;var lat=p.y;if(lat<=90.0&&lat>=-90.0&&lon<=180.0&&lon>=-180.0){}else{Proj4js.reportError(\"lcc:forward: llInputOutOfRange: \"+lon+\" : \"+lat);return null;}\nvar con=Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI);var ts,rh1;if(con>Proj4js.common.EPSLN){ts=Proj4js.common.tsfnz(this.e,lat,Math.sin(lat));rh1=this.a*this.f0*Math.pow(ts,this.ns);}else{con=lat*this.ns;if(con<=0){Proj4js.reportError(\"lcc:forward: No Projection\");return null;}\nrh1=0;}\nvar theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);p.x=this.k0*(rh1*Math.sin(theta))+this.x0;p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0;return p;},inverse:function(p){var rh1,con,ts;var lat,lon;var x=(p.x-this.x0)/this.k0;var y=(this.rh-(p.y-this.y0)/this.k0);if(this.ns>0){rh1=Math.sqrt(x*x+y*y);con=1.0;}else{rh1=-Math.sqrt(x*x+y*y);con=-1.0;}\nvar theta=0.0;if(rh1!=0){theta=Math.atan2((con*x),(con*y));}\nif((rh1!=0)||(this.ns>0.0)){con=1.0/this.ns;ts=Math.pow((rh1/(this.a*this.f0)),con);lat=Proj4js.common.phi2z(this.e,ts);if(lat==-9999)return null;}else{lat=-Proj4js.common.HALF_PI;}\nlon=Proj4js.common.adjust_lon(theta/this.ns+this.long0);p.x=lon;p.y=lat;return p;}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var t=Math.abs(this.lat0);if(Math.abs(t-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0.?this.S_POLE:this.N_POLE;}else if(Math.abs(t)<Proj4js.common.EPSLN){this.mode=this.EQUIT;}else{this.mode=this.OBLIQ;}\nif(this.es>0){var sinphi;this.qp=Proj4js.common.qsfnz(this.e,1.0);this.mmf=.5/(1.-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1.;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp);this.dd=1./this.rq;this.xmf=1.;this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp);sinphi=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,sinphi)/this.qp;this.cosb1=Math.sqrt(1.-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1.-this.es*sinphi*sinphi)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd;break;}}else{if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);}}},forward:function(p){var x,y;var lam=p.x;var phi=p.y;lam=Proj4js.common.adjust_lon(lam-this.long0);if(this.sphere){var coslam,cosphi,sinphi;sinphi=Math.sin(phi);cosphi=Math.cos(phi);coslam=Math.cos(lam);switch(this.mode){case this.OBLIQ:case this.EQUIT:y=(this.mode==this.EQUIT)?1.+cosphi*coslam:1.+this.sinph0*sinphi+this.cosph0*cosphi*coslam;if(y<=Proj4js.common.EPSLN){Proj4js.reportError(\"laea:fwd:y less than eps\");return null;}\ny=Math.sqrt(2./y);x=y*cosphi*Math.sin(lam);y*=(this.mode==this.EQUIT)?sinphi:this.cosph0*sinphi-this.sinph0*cosphi*coslam;break;case this.N_POLE:coslam=-coslam;case this.S_POLE:if(Math.abs(phi+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError(\"laea:fwd:phi < eps\");return null;}\ny=Proj4js.common.FORTPI-phi*.5;y=2.*((this.mode==this.S_POLE)?Math.cos(y):Math.sin(y));x=y*Math.sin(lam);y*=coslam;break;}}else{var coslam,sinlam,sinphi,q,sinb=0.0,cosb=0.0,b=0.0;coslam=Math.cos(lam);sinlam=Math.sin(lam);sinphi=Math.sin(phi);q=Proj4js.common.qsfnz(this.e,sinphi);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){sinb=q/this.qp;cosb=Math.sqrt(1.-sinb*sinb);}\nswitch(this.mode){case this.OBLIQ:b=1.+this.sinb1*sinb+this.cosb1*cosb*coslam;break;case this.EQUIT:b=1.+cosb*coslam;break;case this.N_POLE:b=Proj4js.common.HALF_PI+phi;q=this.qp-q;break;case this.S_POLE:b=phi-Proj4js.common.HALF_PI;q=this.qp+q;break;}\nif(Math.abs(b)<Proj4js.common.EPSLN){Proj4js.reportError(\"laea:fwd:b < eps\");return null;}\nswitch(this.mode){case this.OBLIQ:case this.EQUIT:b=Math.sqrt(2./b);if(this.mode==this.OBLIQ){y=this.ymf*b*(this.cosb1*sinb-this.sinb1*cosb*coslam);}else{y=(b=Math.sqrt(2./(1.+cosb*coslam)))*sinb*this.ymf;}\nx=this.xmf*b*cosb*sinlam;break;case this.N_POLE:case this.S_POLE:if(q>=0.){x=(b=Math.sqrt(q))*sinlam;y=coslam*((this.mode==this.S_POLE)?b:-b);}else{x=y=0.;}\nbreak;}}\np.x=this.a*x+this.x0;p.y=this.a*y+this.y0;return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var x=p.x/this.a;var y=p.y/this.a;if(this.sphere){var cosz=0.0,rh,sinz=0.0;rh=Math.sqrt(x*x+y*y);var phi=rh*.5;if(phi>1.){Proj4js.reportError(\"laea:Inv:DataError\");return null;}\nphi=2.*Math.asin(phi);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){sinz=Math.sin(phi);cosz=Math.cos(phi);}\nswitch(this.mode){case this.EQUIT:phi=(Math.abs(rh)<=Proj4js.common.EPSLN)?0.:Math.asin(y*sinz/rh);x*=sinz;y=cosz*rh;break;case this.OBLIQ:phi=(Math.abs(rh)<=Proj4js.common.EPSLN)?this.phi0:Math.asin(cosz*sinph0+y*sinz*cosph0/rh);x*=sinz*cosph0;y=(cosz-Math.sin(phi)*sinph0)*rh;break;case this.N_POLE:y=-y;phi=Proj4js.common.HALF_PI-phi;break;case this.S_POLE:phi-=Proj4js.common.HALF_PI;break;}\nlam=(y==0.&&(this.mode==this.EQUIT||this.mode==this.OBLIQ))?0.:Math.atan2(x,y);}else{var cCe,sCe,q,rho,ab=0.0;switch(this.mode){case this.EQUIT:case this.OBLIQ:x/=this.dd;y*=this.dd;rho=Math.sqrt(x*x+y*y);if(rho<Proj4js.common.EPSLN){p.x=0.;p.y=this.phi0;return p;}\nsCe=2.*Math.asin(.5*rho/this.rq);cCe=Math.cos(sCe);x*=(sCe=Math.sin(sCe));if(this.mode==this.OBLIQ){ab=cCe*this.sinb1+y*sCe*this.cosb1/rho\nq=this.qp*ab;y=rho*this.cosb1*cCe-y*this.sinb1*sCe;}else{ab=y*sCe/rho;q=this.qp*ab;y=rho*cCe;}\nbreak;case this.N_POLE:y=-y;case this.S_POLE:q=(x*x+y*y);if(!q){p.x=0.;p.y=this.phi0;return p;}\nab=1.-q/this.qp;if(this.mode==this.S_POLE){ab=-ab;}\nbreak;}\nlam=Math.atan2(x,y);phi=this.authlat(Math.asin(ab),this.apa);}\np.x=Proj4js.common.adjust_lon(this.long0+lam);p.y=phi;return p;},P00:.33333333333333333333,P01:.17222222222222222222,P02:.10257936507936507936,P10:.06388888888888888888,P11:.06640211640211640211,P20:.01641501294219154443,authset:function(es){var t;var APA=new Array();APA[0]=es*this.P00;t=es*es;APA[0]+=t*this.P01;APA[1]=t*this.P10;t*=es;APA[0]+=t*this.P02;APA[1]+=t*this.P11;APA[2]=t*this.P20;return APA;},authlat:function(beta,APA){var t=beta+beta;return(beta+APA[0]*Math.sin(t)+APA[1]*Math.sin(t+t)+APA[2]*Math.sin(t+t+t));}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0);},forward:function(p){var lon=p.x;var lat=p.y;var ksp;var sinphi=Math.sin(p.y);var cosphi=Math.cos(p.y);var dlon=Proj4js.common.adjust_lon(lon-this.long0);var coslon=Math.cos(dlon);var g=this.sin_p12*sinphi+this.cos_p12*cosphi*coslon;if(Math.abs(Math.abs(g)-1.0)<Proj4js.common.EPSLN){ksp=1.0;if(g<0.0){Proj4js.reportError(\"aeqd:Fwd:PointError\");return;}}else{var z=Math.acos(g);ksp=z/Math.sin(z);}\np.x=this.x0+this.a*ksp*cosphi*Math.sin(dlon);p.y=this.y0+this.a*ksp*(this.cos_p12*sinphi-this.sin_p12*cosphi*coslon);return p;},inverse:function(p){p.x-=this.x0;p.y-=this.y0;var rh=Math.sqrt(p.x*p.x+p.y*p.y);if(rh>(2.0*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError(\"aeqdInvDataError\");return;}\nvar z=rh/this.a;var sinz=Math.sin(z);var cosz=Math.cos(z);var lon=this.long0;var lat;if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0;}else{lat=Proj4js.common.asinz(cosz*this.sin_p12+(p.y*sinz*this.cos_p12)/rh);var con=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(con)<=Proj4js.common.EPSLN){if(lat0>=0.0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y));}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y));}}else{con=cosz-this.sin_p12*Math.sin(lat);if((Math.abs(con)<Proj4js.common.EPSLN)&&(Math.abs(p.x)<Proj4js.common.EPSLN)){}else{var temp=Math.atan2((p.x*sinz*this.cos_p12),(con*rh));lon=Proj4js.common.adjust_lon(this.long0+Math.atan2((p.x*sinz*this.cos_p12),(con*rh)));}}}\np.x=lon;p.y=lat;return p;}};Proj4js.Proj.moll={init:function(){},forward:function(p){var lon=p.x;var lat=p.y;var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);var theta=lat;var con=Proj4js.common.PI*Math.sin(lat);for(var i=0;true;i++){var delta_theta=-(theta+Math.sin(theta)-con)/(1.0+Math.cos(theta));theta+=delta_theta;if(Math.abs(delta_theta)<Proj4js.common.EPSLN)break;if(i>=50){Proj4js.reportError(\"moll:Fwd:IterationError\");}}\ntheta/=2.0;if(Proj4js.common.PI/2-Math.abs(lat)<Proj4js.common.EPSLN)delta_lon=0;var x=0.900316316158*this.a*delta_lon*Math.cos(theta)+this.x0;var y=1.4142135623731*this.a*Math.sin(theta)+this.y0;p.x=x;p.y=y;return p;},inverse:function(p){var theta;var arg;p.x-=this.x0;var arg=p.y/(1.4142135623731*this.a);if(Math.abs(arg)>0.999999999999)arg=0.999999999999;var theta=Math.asin(arg);var lon=Proj4js.common.adjust_lon(this.long0+(p.x/(0.900316316158*this.a*Math.cos(theta))));if(lon<(-Proj4js.common.PI))lon=-Proj4js.common.PI;if(lon>Proj4js.common.PI)lon=Proj4js.common.PI;arg=(2.0*theta+Math.sin(2.0*theta))/Proj4js.common.PI;if(Math.abs(arg)>1.0)arg=1.0;var lat=Math.asin(arg);p.x=lon;p.y=lat;return p;}};","L.Proj = {};\n\nL.Proj._isProj4Proj = function(a) {\n\treturn typeof a['projName'] !== 'undefined';\n}\n\nL.Proj.Projection = L.Class.extend({\n\tinitialize: function(a, def) {\n\t\tif (L.Proj._isProj4Proj(a)) {\n\t\t\tthis._proj = a;\n\t\t} else {\n\t\t\tvar code = a;\n\t\t\tif (def)\n\t\t\t\tProj4js.defs[code] = def;\n\t\t\tthis._proj = new Proj4js.Proj(code);\n\t\t}\n\t},\n\n\tproject: function (latlng) {\n\t\tvar point = new L.Point(latlng.lng, latlng.lat);\n\t\treturn Proj4js.transform(Proj4js.WGS84, this._proj, point);\n\t},\n\n\tunproject: function (point, unbounded) {\n\t\tvar point2 = Proj4js.transform(this._proj, Proj4js.WGS84, point.clone());\n\t\treturn new L.LatLng(point2.y, point2.x, unbounded);\n\t}\n});\n\nL.Proj.CRS = L.Class.extend({\n\tincludes: L.CRS,\n\n\toptions: {\n\t\ttransformation: new L.Transformation(1, 0, -1, 0)\n\t},\n\n\tinitialize: function(a, b, c) {\n\t\tvar code, proj, def, options;\n\n\t\tif (L.Proj._isProj4Proj(a)) {\n\t\t\tproj = a;\n\t\t\tcode = proj.srsCode;\n\t\t\toptions = b || {};\n\n\t\t\tthis.projection = new L.Proj.Projection(proj);\n\t\t} else {\n\t\t\tcode = a;\n\t\t\tdef = b;\n\t\t\toptions = c || {};\n\t\t\tthis.projection = new L.Proj.Projection(code, def);\n\t\t}\n\n\t\tL.Util.setOptions(this, options);\n\t\tthis.code = code;\n\t\tthis.transformation = this.options.transformation;\n\n\t\tif (this.options.origin) {\n\t\t\tthis.transformation =\n\t\t\t\tnew L.Transformation(1, -this.options.origin[0],\n\t\t\t\t\t-1, this.options.origin[1]);\n\t\t}\n\n\t\tif (this.options.scales) {\n\t\t\tthis.scale = function(zoom) {\n\t\t\t\treturn this.options.scales[zoom];\n\t\t\t}\n\t\t} else if (this.options.resolutions) {\n\t\t\tthis.scale = function(zoom) {\n\t\t\t\treturn 1 / this.options.resolutions[zoom];\n\t\t\t}\n\t\t}\n\t}\n});\n\nL.Proj.CRS.TMS = L.Proj.CRS.extend({\n\tinitialize: function(a, b, c, d) {\n\t\tif (L.Proj._isProj4Proj(a)) {\n\t\t\tvar proj = a,\n\t\t\t\tprojectedBounds = b,\n\t\t\t\toptions = c || {};\n\t\t\toptions.origin = [projectedBounds[0], projectedBounds[3]];\n\t\t\tL.Proj.CRS.prototype.initialize(proj, options);\n\t\t} else {\n\t\t\tvar code = a,\n\t\t\t\tdef = b,\n\t\t\t\tprojectedBounds = c,\n\t\t\t\toptions = d || {};\n\t\t\toptions.origin = [projectedBounds[0], projectedBounds[3]];\n\t\t\tL.Proj.CRS.prototype.initialize(code, def, options);\n\t\t}\n\n\t\tthis.projectedBounds = projectedBounds;\n\t}\n});\n\nL.Proj.TileLayer = {};\n\nL.Proj.TileLayer.TMS = L.TileLayer.extend({\n\toptions: {\n\t\ttms: true,\n\t\tcontinuousWorld: true\n\t},\n\n\tinitialize: function(urlTemplate, crs, options) {\n\t\tif (!(crs instanceof L.Proj.CRS.TMS)) {\n\t\t\tthrow new Error(\"CRS is not L.Proj.CRS.TMS.\");\n\t\t}\n\n\t\tL.TileLayer.prototype.initialize.call(this, urlTemplate, options);\n\t\tthis.crs = crs;\n\n\t\t// Verify grid alignment\n\t\tfor (var i = this.options.minZoom; i < this.options.maxZoom; i++) {\n\t\t\tvar gridHeight = (this.crs.projectedBounds[3] - this.crs.projectedBounds[1]) /\n\t\t\t\tthis._projectedTileSize(i);\n\t\t\tif (Math.abs(gridHeight - Math.round(gridHeight)) > 1e-3) {\n\t\t\t\tthrow new Error(\"Projected bounds does not match grid at zoom \" + i);\n\t\t\t}\n\t\t}\n\t},\n\n\tgetTileUrl: function(tilePoint) {\n\t\tvar gridHeight =\n\t\t\tMath.round((this.crs.projectedBounds[3] - this.crs.projectedBounds[1]) /\n\t\t\tthis._projectedTileSize(this._map.getZoom()));\n\n\t\t// TODO: relies on some of TileLayer's internals\n\t\treturn L.Util.template(this._url, L.Util.extend({\n\t\t\ts: this._getSubdomain(tilePoint),\n\t\t\tz: this._getZoomForUrl(),\n\t\t\tx: tilePoint.x,\n\t\t\ty: gridHeight - tilePoint.y - 1\n\t\t}, this.options));\n\t},\n\n\t_projectedTileSize: function(zoom) {\n\t\treturn (this.options.tileSize / this.crs.scale(zoom));\n\t}\n});\n\nL.Proj.GeoJSON = L.GeoJSON.extend({\n\tinitialize: function(geojson, options) {\n\t\tif (geojson.crs && geojson.crs.type == 'name') {\n\t\t\tvar crs = new L.Proj.CRS(geojson.crs.properties.name)\n\t\t\toptions = options || {};\n\t\t\toptions.coordsToLatLng = function(coords) {\n\t\t\t\tvar point = L.point(coords[0], coords[1]);\n\t\t\t\treturn crs.projection.unproject(point);\n\t\t\t};\n\t\t}\n\t\tL.GeoJSON.prototype.initialize.call(this, geojson, options);\n\t}\n});\n\nL.Proj.geoJson = function(geojson, options) {\n\treturn new L.Proj.GeoJSON(geojson, options);\n}\n\nif (typeof module !== 'undefined') module.exports = L.Proj;\n\nif (typeof L !== 'undefined' && typeof L.CRS !== 'undefined') {\n\t// This is left here for backwards compatibility\n\tL.CRS.proj4js = (function () {\n\t\treturn function (code, def, transformation, options) {\n\t\t\toptions = options || {};\n\t\t\tif (transformation) options.transformation = transformation;\n\n\t\t\treturn new L.Proj.CRS(code, def, options);\n\t\t};\n\t}());\n}\n","//var crs25831\nL.CRS.EPSG25831 = L.CRS.proj4js('EPSG:25831', '+proj=utm +zone=31 +ellps=GRS80 +datum=WGS84 +units=m +no_defs',\n\t\t//new L.Transformation(0.5 / (Math.PI * L.Projection.Mercator.R_MAJOR), 0.5, -0.5 / (Math.PI * L.Projection.Mercator.R_MINOR), 0.5),\n\t\tnew L.Transformation(1, -258000, -1, 4766600),\n\t\t\n\t\t{\n\t/*\n\tnew L.Transformation(0.5 / (Math.PI * L.Projection.Mercator.R_MAJOR),\n\t\t\t             0.5, -0.5 / (Math.PI * L.Projection.Mercator.R_MINOR), 0.5),\n\t\t*/\t \n\tscale:function(zoom) {\n        return 1 / (1100 / Math.pow(2, zoom));\n\t},\n\tresolutions : [1100, 550, 275, 100, 50, 25, 10, 5, 2, 1, 0.5, 0.25, 0.1]}\t\n\n);\n\n//var crs23031 \nL.CRS.EPSG23031 = L.CRS.proj4js('EPSG:23031', \"+proj=utm +zone=31 +ellps=intl +towgs84=-136.65549,-141.46580,-167.29848,-2.09308759,-0.00140548839,-0.107708594,1.000011546110 +units=m +no_defs\",\t\t\n\t\tL.Transformation(1, 0, -1, 0),\n\t\t{origin:[258000, 4485000, 536000, 4752000],\n\t\t/*\n\t\tnew L.Transformation(0.5 / (Math.PI * L.Projection.Mercator.R_MAJOR),\n\t\t\t\t             0.5, -0.5 / (Math.PI * L.Projection.Mercator.R_MINOR), 0.5),\n\t\t\t*/\t             \n\t\tresolutions : [1100, 550, 275, 100, 50, 25, 10, 5, 2, 1, 0.5, 0.25, 0.1]}\t\t             \n);\n\n\n\n/*\n\nnew L.Proj.CRS('EPSG:2400',\n  '+lon_0=15.808277777799999 +lat_0=0.0 +k=1.0 +x_0=1500000.0 ' +\n  '+y_0=0.0 +proj=tmerc +ellps=bessel +units=m ' +\n  '+towgs84=414.1,41.3,603.1,-0.855,2.141,-7.023,0 +no_defs',\n  {\n    resolutions: [8192, 4096, 2048], // 3 example zoom level resolutions\n  }\n);\n\n\nnew L.Proj.CRS('EPSG:3006',\n  '+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',\n  {\n    origin: [218128.7031, 6126002.9379],\n    resolutions: [8192, 4096, 2048], // 3 example zoom level resolutions\n  }\n);\n\n// EPSG:102012 served by TMS with bounds (-5401501.0, 4065283.0, 4402101.0, 39905283.0)\nnew L.Proj.CRS.TMS('EPSG:102012',\n    '+proj=lcc +lat_1=30 +lat_2=62 +lat_0=0 +lon_0=105 +x_0=0 +y_0=0 '\n    + '+ellps=WGS84 +datum=WGS84 +units=m +no_defs',\n    [-5401501.0, 4065283.0, 4402101.0, 39905283.0],\n    {\n        resolutions: [\n           140000.0000000000,\n            70000.0000000000,\n            35000.0000000000,\n            17500.0000000000\n        ]\n    }\n);\n\n*/\n","L.Control.Sidebar = L.Control.extend({\r\n    options: {\r\n        closeButton: true,\r\n        position: 'left'\r\n    },\r\n\r\n    initialize: function (placeholder, options) {\r\n        L.setOptions(this, options);\r\n\r\n        // Find content container\r\n        var content = this._contentContainer = L.DomUtil.get(placeholder);\r\n\r\n        // Remove the content container from its original parent\r\n        content.parentNode.removeChild(content);\r\n\r\n        // Make sure we don't drag the map when we interact with the content\r\n        var stop = L.DomEvent.stopPropagation;\r\n        L.DomEvent\r\n            .on(content, 'click', stop)\r\n            .on(content, 'mousedown', stop)\r\n            .on(content, 'touchstart', stop)\r\n            .on(content, 'dblclick', stop)\r\n            .on(content, 'mousewheel', stop)\r\n            .on(content, 'MozMousePixelScroll', stop);\r\n    },\r\n\r\n    addTo: function (map) {\r\n        var sidebar = this;\r\n        var l = 'leaflet-';\r\n\r\n        // Create sidebar container\r\n        var container = this._container =\r\n            L.DomUtil.create('div', l + 'sidebar ' + this.options.position);\r\n\r\n        // Style and attach content container\r\n        var content = this._contentContainer;\r\n        L.DomUtil.addClass(content, l + 'control');\r\n        container.appendChild(content);\r\n\r\n        // Create close button and attach it if configured\r\n        if (this.options.closeButton) {\r\n            var close = L.DomUtil.create('a', 'close', container);\r\n            close.innerHTML = '&times;';\r\n\r\n            L.DomEvent.on(close, 'click', function () {\r\n                sidebar.hide();\r\n                L.DomEvent.stopPropagation();\r\n            });\r\n        }\r\n\r\n        // Attach sidebar container to controls container\r\n        var controlContainer = map._controlContainer;\r\n        controlContainer.insertBefore(container, controlContainer.firstChild);\r\n\r\n        this._map = map;\r\n\r\n        return this;\r\n    },\r\n\r\n    removeFrom: function (map) {\r\n        // Remove sidebar container from controls container\r\n        var controlContainer = map._controlContainer;\r\n        controlContainer.removeChild(this._container);\r\n\r\n        return this;\r\n    },\r\n\r\n    isVisible: function () {\r\n        return L.DomUtil.hasClass(this._container, 'visible');\r\n    },\r\n\r\n    show: function () {\r\n        if (!this.isVisible()) {\r\n            L.DomUtil.addClass(this._container, 'visible');\r\n            this._map.panBy([-this.getOffset() / 2, 0], {\r\n                duration: 0.5\r\n            });\r\n        }\r\n    },\r\n\r\n    \r\n    hide: function () {\r\n        if (this.isVisible()) {\r\n            L.DomUtil.removeClass(this._container, 'visible');\r\n            this._map.panBy([this.getOffset() / 2, 0], {\r\n                duration: 0.5\r\n            });\r\n        }\r\n    },\r\n\r\n    toggle: function () {\r\n        if (this.isVisible()) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    },\r\n\r\n    getContainer: function () {\r\n        return this._contentContainer;\r\n    },\r\n\r\n    setContent: function (content) {\r\n        this.getContainer().innerHTML = content;\r\n        return this;\r\n    },\r\n\r\n    getOffset: function () {\r\n        if (this.options.position === 'right') {\r\n            return -this._container.offsetWidth;\r\n        } else {\r\n            return this._container.offsetWidth;\r\n        }\r\n    }\r\n});\r\n\r\nL.control.sidebar = function (placeholder, options) {\r\n    return new L.Control.Sidebar(placeholder, options);\r\n};\r\n",";(function(){\r\n\r\n/**\r\n * Require the given path.\r\n *\r\n * @param {String} path\r\n * @return {Object} exports\r\n * @api public\r\n */\r\n\r\nfunction require(path, parent, orig) {\r\n  var resolved = require.resolve(path);\r\n\r\n  // lookup failed\r\n  if (null == resolved) {\r\n    orig = orig || path;\r\n    parent = parent || 'root';\r\n    var err = new Error('Failed to require \"' + orig + '\" from \"' + parent + '\"');\r\n    err.path = orig;\r\n    err.parent = parent;\r\n    err.require = true;\r\n    throw err;\r\n  }\r\n\r\n  var module = require.modules[resolved];\r\n\r\n  // perform real require()\r\n  // by invoking the module's\r\n  // registered function\r\n  if (!module.exports) {\r\n    module.exports = {};\r\n    module.client = module.component = true;\r\n    module.call(this, module.exports, require.relative(resolved), module);\r\n  }\r\n\r\n  return module.exports;\r\n}\r\n\r\n/**\r\n * Registered modules.\r\n */\r\n\r\nrequire.modules = {};\r\n\r\n/**\r\n * Registered aliases.\r\n */\r\n\r\nrequire.aliases = {};\r\n\r\n/**\r\n * Resolve `path`.\r\n *\r\n * Lookup:\r\n *\r\n *   - PATH/index.js\r\n *   - PATH.js\r\n *   - PATH\r\n *\r\n * @param {String} path\r\n * @return {String} path or null\r\n * @api private\r\n */\r\n\r\nrequire.resolve = function(path) {\r\n  if (path.charAt(0) === '/') path = path.slice(1);\r\n\r\n  var paths = [\r\n    path,\r\n    path + '.js',\r\n    path + '.json',\r\n    path + '/index.js',\r\n    path + '/index.json'\r\n  ];\r\n\r\n  for (var i = 0; i < paths.length; i++) {\r\n    var path = paths[i];\r\n    if (require.modules.hasOwnProperty(path)) return path;\r\n    if (require.aliases.hasOwnProperty(path)) return require.aliases[path];\r\n  }\r\n};\r\n\r\n/**\r\n * Normalize `path` relative to the current path.\r\n *\r\n * @param {String} curr\r\n * @param {String} path\r\n * @return {String}\r\n * @api private\r\n */\r\n\r\nrequire.normalize = function(curr, path) {\r\n  var segs = [];\r\n\r\n  if ('.' != path.charAt(0)) return path;\r\n\r\n  curr = curr.split('/');\r\n  path = path.split('/');\r\n\r\n  for (var i = 0; i < path.length; ++i) {\r\n    if ('..' == path[i]) {\r\n      curr.pop();\r\n    } else if ('.' != path[i] && '' != path[i]) {\r\n      segs.push(path[i]);\r\n    }\r\n  }\r\n\r\n  return curr.concat(segs).join('/');\r\n};\r\n\r\n/**\r\n * Register module at `path` with callback `definition`.\r\n *\r\n * @param {String} path\r\n * @param {Function} definition\r\n * @api private\r\n */\r\n\r\nrequire.register = function(path, definition) {\r\n  require.modules[path] = definition;\r\n};\r\n\r\n/**\r\n * Alias a module definition.\r\n *\r\n * @param {String} from\r\n * @param {String} to\r\n * @api private\r\n */\r\n\r\nrequire.alias = function(from, to) {\r\n  if (!require.modules.hasOwnProperty(from)) {\r\n    throw new Error('Failed to alias \"' + from + '\", it does not exist');\r\n  }\r\n  require.aliases[to] = from;\r\n};\r\n\r\n/**\r\n * Return a require function relative to the `parent` path.\r\n *\r\n * @param {String} parent\r\n * @return {Function}\r\n * @api private\r\n */\r\n\r\nrequire.relative = function(parent) {\r\n  var p = require.normalize(parent, '..');\r\n\r\n  /**\r\n   * lastIndexOf helper.\r\n   */\r\n\r\n  function lastIndexOf(arr, obj) {\r\n    var i = arr.length;\r\n    while (i--) {\r\n      if (arr[i] === obj) return i;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * The relative require() itself.\r\n   */\r\n\r\n  function localRequire(path) {\r\n    var resolved = localRequire.resolve(path);\r\n    return require(resolved, parent, path);\r\n  }\r\n\r\n  /**\r\n   * Resolve relative to the parent.\r\n   */\r\n\r\n  localRequire.resolve = function(path) {\r\n    var c = path.charAt(0);\r\n    if ('/' == c) return path.slice(1);\r\n    if ('.' == c) return require.normalize(p, path);\r\n\r\n    // resolve deps by returning\r\n    // the dep in the nearest \"deps\"\r\n    // directory\r\n    var segs = parent.split('/');\r\n    var i = lastIndexOf(segs, 'deps') + 1;\r\n    if (!i) i = 0;\r\n    path = segs.slice(0, i + 1).join('/') + '/deps/' + path;\r\n    return path;\r\n  };\r\n\r\n  /**\r\n   * Check if module is defined at `path`.\r\n   */\r\n\r\n  localRequire.exists = function(path) {\r\n    return require.modules.hasOwnProperty(localRequire.resolve(path));\r\n  };\r\n\r\n  return localRequire;\r\n};\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/index.js\", function(exports, require, module){\r\n\"use strict\";\r\nvar types = [\r\n    require(\"./nextTick\"),\r\n    require(\"./mutation\"),\r\n    require(\"./postMessage\"),\r\n    require(\"./messageChannel\"),\r\n    require(\"./stateChange\"),\r\n    require(\"./timeout\")\r\n];\r\nvar handlerQueue = [];\r\n\r\nfunction drainQueue() {\r\n    var i = 0,\r\n        task,\r\n        innerQueue = handlerQueue;\r\n\thandlerQueue = [];\r\n\t/*jslint boss: true */\r\n\twhile (task = innerQueue[i++]) {\r\n\t\ttask();\r\n\t}\r\n}\r\nvar nextTick;\r\ntypes.some(function (obj) {\r\n    var t = obj.test();\r\n    if (t) {\r\n        nextTick = obj.install(drainQueue);\r\n    }\r\n    return t;\r\n});\r\nvar retFunc = function (task) {\r\n    var len, args;\r\n    if (arguments.length > 1 && typeof task === \"function\") {\r\n        args = Array.prototype.slice.call(arguments, 1);\r\n        args.unshift(undefined);\r\n        task = task.bind.apply(task, args);\r\n    }\r\n    if ((len = handlerQueue.push(task)) === 1) {\r\n        nextTick(drainQueue);\r\n    }\r\n    return len;\r\n};\r\nretFunc.clear = function (n) {\r\n    if (n <= handlerQueue.length) {\r\n        handlerQueue[n - 1] = function () {};\r\n    }\r\n    return this;\r\n};\r\nmodule.exports = retFunc;\r\n\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/nextTick.js\", function(exports, require, module){\r\n\"use strict\";\r\nexports.test = function () {\r\n    // Don't get fooled by e.g. browserify environments.\r\n    return typeof process === \"object\" && Object.prototype.toString.call(process) === \"[object process]\";\r\n};\r\n\r\nexports.install = function () {\r\n    return process.nextTick;\r\n};\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/postMessage.js\", function(exports, require, module){\r\n\"use strict\";\r\nvar globe = require(\"./global\");\r\nexports.test = function () {\r\n    // The test against `importScripts` prevents this implementation from being installed inside a web worker,\r\n    // where `global.postMessage` means something completely different and can\"t be used for this purpose.\r\n\r\n    if (!globe.postMessage || globe.importScripts) {\r\n        return false;\r\n    }\r\n\r\n    var postMessageIsAsynchronous = true;\r\n    var oldOnMessage = globe.onmessage;\r\n    globe.onmessage = function () {\r\n        postMessageIsAsynchronous = false;\r\n    };\r\n    globe.postMessage(\"\", \"*\");\r\n    globe.onmessage = oldOnMessage;\r\n\r\n    return postMessageIsAsynchronous;\r\n};\r\n\r\nexports.install = function (func) {\r\n    var codeWord = \"com.calvinmetcalf.setImmediate\" + Math.random();\r\n    function globalMessage(event) {\r\n        if (event.source === globe && event.data === codeWord) {\r\n            func();\r\n        }\r\n    }\r\n    if (globe.addEventListener) {\r\n        globe.addEventListener(\"message\", globalMessage, false);\r\n    } else {\r\n        globe.attachEvent(\"onmessage\", globalMessage);\r\n    }\r\n    return function () {\r\n        globe.postMessage(codeWord, \"*\");\r\n    };\r\n};\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/messageChannel.js\", function(exports, require, module){\r\n\"use strict\";\r\nvar globe = require(\"./global\");\r\nexports.test = function () {\r\n    return !!globe.MessageChannel;\r\n};\r\n\r\nexports.install = function (func) {\r\n    var channel = new globe.MessageChannel();\r\n    channel.port1.onmessage = func;\r\n    return function () {\r\n        channel.port2.postMessage(0);\r\n    };\r\n};\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/stateChange.js\", function(exports, require, module){\r\n\"use strict\";\r\nvar globe = require(\"./global\");\r\nexports.test = function () {\r\n    return \"document\" in globe && \"onreadystatechange\" in globe.document.createElement(\"script\");\r\n};\r\n\r\nexports.install = function (handle) {\r\n    return function () {\r\n\r\n        // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\r\n        // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\r\n        var scriptEl = globe.document.createElement(\"script\");\r\n        scriptEl.onreadystatechange = function () {\r\n            handle();\r\n\r\n            scriptEl.onreadystatechange = null;\r\n            scriptEl.parentNode.removeChild(scriptEl);\r\n            scriptEl = null;\r\n        };\r\n        globe.document.documentElement.appendChild(scriptEl);\r\n\r\n        return handle;\r\n    };\r\n};\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/timeout.js\", function(exports, require, module){\r\n\"use strict\";\r\nexports.test = function () {\r\n    return true;\r\n};\r\n\r\nexports.install = function (t) {\r\n    return function () {\r\n        setTimeout(t, 0);\r\n    };\r\n};\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/global.js\", function(exports, require, module){\r\nmodule.exports = typeof global === \"object\" && global ? global : this;\r\n});\r\nrequire.register(\"calvinmetcalf-setImmediate/lib/mutation.js\", function(exports, require, module){\r\n\"use strict\";\r\n//based off rsvp\r\n//https://github.com/tildeio/rsvp.js/blob/master/lib/rsvp/async.js\r\nvar globe = require(\"./global\");\r\n\r\nvar MutationObserver = globe.MutationObserver || globe.WebKitMutationObserver;\r\n\r\nexports.test = function () {\r\n    return MutationObserver;\r\n};\r\n\r\nexports.install = function (handle) {\r\n    var observer = new MutationObserver(handle);\r\n    var element = globe.document.createElement(\"div\");\r\n    observer.observe(element, { attributes: true });\r\n\r\n    // Chrome Memory Leak: https://bugs.webkit.org/show_bug.cgi?id=93661\r\n    globe.addEventListener(\"unload\", function () {\r\n        observer.disconnect();\r\n        observer = null;\r\n    }, false);\r\n    return function () {\r\n        element.setAttribute(\"drainQueue\", \"drainQueue\");\r\n    };\r\n};\r\n});\r\nrequire.register(\"lie/lie.js\", function(exports, require, module){\r\nvar immediate = require('immediate');\r\n// Creates a deferred: an object with a promise and corresponding resolve/reject methods\r\nfunction Promise(resolver) {\r\n     if (!(this instanceof Promise)) {\r\n        return new Promise(resolver);\r\n    }\r\n    var queue = [];\r\n    var resolved = false;\r\n    // The `handler` variable points to the function that will\r\n    // 1) handle a .then(onFulfilled, onRejected) call\r\n    // 2) handle a .resolve or .reject call (if not fulfilled)\r\n    // Before 2), `handler` holds a queue of callbacks.\r\n    // After 2), `handler` is a simple .then handler.\r\n    // We use only one function to save memory and complexity.\r\n     // Case 1) handle a .then(onFulfilled, onRejected) call\r\n    function pending(onFulfilled, onRejected){\r\n        return Promise(function(resolver,rejecter){\r\n            queue.push({\r\n                resolve: onFulfilled,\r\n                reject: onRejected,\r\n                resolver:resolver,\r\n                rejecter:rejecter\r\n            });\r\n        });\r\n    }\r\n    function then(onFulfilled, onRejected) {\r\n        return resolved?resolved(onFulfilled, onRejected):pending(onFulfilled, onRejected);\r\n    }\r\n    // Case 2) handle a .resolve or .reject call\r\n        // (`onFulfilled` acts as a sentinel)\r\n        // The actual function signature is\r\n        // .re[ject|solve](sentinel, success, value)\r\n    function resolve(success, value){\r\n        var action = success ? 'resolve' : 'reject';\r\n        var queued;\r\n        var callback;\r\n        for (var i = 0, l = queue.length; i < l; i++) {\r\n            queued = queue[i];\r\n            callback = queued[action];\r\n            if (typeof callback === 'function') {\r\n                immediate(execute,callback, value, queued.resolver, queued.rejecter);\r\n            }else if(success){\r\n            \tif(!value){\r\n            \t\t//out.println(callback + \"({\\\"results\\\":\\\"EXCEPTION ERROR:\"+e.getMessage()+\"\\\",\\\"status\\\":\\\"ERROR\\\"})\");\r\n\t\t\t\t\tvalue = {results: \"ERROR de COMUNICACIO\", status: \"ERROR\"};\r\n\t\t\t\t}\r\n            \t\r\n            \tif(value.status!=undefined && value.status == \"ERROR\"){\r\n\t\t\t\t\t//console.debug(value);\r\n            \t\tqueued.rejecter(value);\t\r\n            \t}else{\r\n            \t\tqueued.resolver(value);\t\r\n            \t}\r\n            }else{\r\n                queued.resolver(value);\r\n            }\r\n        }\r\n        // Replace this handler with a simple resolved or rejected handler\r\n        resolved = createHandler(then, value, success);\r\n    }\r\n    this.then = then;\r\n    function yes(value) {\r\n        if (!resolved) {\r\n            resolve(true, value);\r\n        }\r\n    }\r\n    function no (reason) {\r\n        if (!resolved) {\r\n            resolve(false, reason);\r\n        }\r\n    }\r\n    try{\r\n        resolver(function(a){\r\n            if(a && typeof a.then==='function'){\r\n                a.then(yes,no);\r\n            }else{\r\n                yes(a);\r\n            }\r\n        },no);\r\n    }catch(e){\r\n        no(e);\r\n    }\r\n}\r\n\r\n// Creates a fulfilled or rejected .then function\r\nfunction createHandler(then, value, success) {\r\n    return function(onFulfilled, onRejected) {\r\n        var callback = success ? onFulfilled : onRejected;\r\n        if (typeof callback !== 'function') {\r\n            return Promise(function(resolve,reject){\r\n                then(resolve,reject);\r\n            });\r\n        }\r\n        return Promise(function(resolve,reject){\r\n            immediate(execute,callback,value,resolve,reject);\r\n       });\r\n    };\r\n}\r\n\r\n// Executes the callback with the specified value,\r\n// resolving or rejecting the deferred\r\nfunction execute(callback, value, resolve, reject) {\r\n        try {\r\n            var result = callback(value);\r\n            if (result && typeof result.then === 'function') {\r\n                result.then(resolve, reject);\r\n            }\r\n            else {\r\n                resolve(result);\r\n            }\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n}\r\nmodule.exports = Promise;\r\n\r\n});\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/index.js\", \"lie/deps/immediate/lib/index.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/nextTick.js\", \"lie/deps/immediate/lib/nextTick.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/postMessage.js\", \"lie/deps/immediate/lib/postMessage.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/messageChannel.js\", \"lie/deps/immediate/lib/messageChannel.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/stateChange.js\", \"lie/deps/immediate/lib/stateChange.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/timeout.js\", \"lie/deps/immediate/lib/timeout.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/global.js\", \"lie/deps/immediate/lib/global.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/mutation.js\", \"lie/deps/immediate/lib/mutation.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/index.js\", \"lie/deps/immediate/index.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/index.js\", \"immediate/index.js\");\r\nrequire.alias(\"calvinmetcalf-setImmediate/lib/index.js\", \"calvinmetcalf-setImmediate/index.js\");\r\n\r\nrequire.alias(\"lie/lie.js\", \"lie/index.js\");\r\n\r\nL.Util.Promise = require(\"lie\");\r\n})();\r\n\r\nL.Util.ajax = function(url, options) {\r\n\t'use strict';\r\n\toptions = options || {};\r\n\tif (options.jsonp) {\r\n\t\treturn L.Util.ajax.jsonp(url, options);\r\n\t}\r\n\tvar request;\r\n\tvar cancel;\r\n\tvar out = L.Util.Promise(function(resolve,reject){\r\n\t\tvar Ajax;\r\n\t\tcancel=reject;\r\n\t\t// the following is from JavaScript: The Definitive Guide\r\n\t\tif (window.XMLHttpRequest === undefined) {\r\n\t\t\tAjax = function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn new ActiveXObject('Microsoft.XMLHTTP.6.0');\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e1) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn new ActiveXObject('Microsoft.XMLHTTP.3.0');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e2) {\r\n\t\t\t\t\t\treject('XMLHttpRequest is not supported');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\telse {\r\n\t\t\tAjax = window.XMLHttpRequest;\r\n\t\t}\r\n\t\tvar response;\r\n\t\trequest = new Ajax();\r\n\t\trequest.open('GET', url);\r\n\t\trequest.onreadystatechange = function() {\r\n\t\t\t/*jslint evil: true */\r\n\t\t\tif (request.readyState === 4) {\r\n\t\t\t\tif((request.status < 400&&options.local)|| request.status===200) {\r\n\t\t\t\t\tif (window.JSON) {\r\n\t\t\t\t\t\tresponse = JSON.parse(request.responseText);\r\n\t\t\t\t\t} else if (options.evil) {\r\n\t\t\t\t\t\tresponse = eval('(' + request.responseText + ')');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(response);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!request.status){\r\n\t\t\t\t\t\treject('Attempted cross origin request without CORS enabled');\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treject(request.statusText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\trequest.send();\r\n\t});\r\n\tout.then(null,function(reason){\r\n\t\trequest.abort();\r\n\t\treturn reason;\r\n\t});\r\n\tout.abort = cancel;\r\n\treturn out;\r\n};\r\n\r\nL.Util.jsonp = function(url, options) {\r\n\toptions = options || {};\r\n\tvar head = document.getElementsByTagName('head')[0];\r\n\tvar scriptNode = L.DomUtil.create('script', '', head);\r\n\tvar cbName, ourl, cbSuffix, cancel;\r\n\tvar out = L.Util.Promise(function(resolve, reject){\r\n\t\tcancel=reject;\r\n\t\tvar cbParam = options.cbParam || 'callback';\r\n\t\tif (options.callbackName) {\r\n\t\t\tcbName = options.callbackName;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcbSuffix = '_' + ('' + Math.random()).slice(2);\r\n\t\t\tcbName = 'L.Util.jsonp.cb.' + cbSuffix;\r\n\t\t}\r\n\t\tscriptNode.type = 'text/javascript';\r\n\t\tif (cbSuffix) {\r\n\t\t\tL.Util.jsonp.cb[cbSuffix] = function(data) {\r\n\t\t\t\thead.removeChild(scriptNode);\r\n\t\t\t\tdelete L.Util.jsonp.cb[cbSuffix];\r\n\t\t\t\tresolve(data);\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (url.indexOf('?') === -1) {\r\n\t\t\tourl = url + '?' + cbParam + '=' + cbName;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tourl = url + '&' + cbParam + '=' + cbName;\r\n\t\t}\r\n\t\tscriptNode.src = ourl;\r\n\t}).then(null,function(reason){\r\n\t    head.removeChild(scriptNode);\r\n\t\tdelete L.Util.ajax.cb[cbSuffix];\r\n\t\treturn reason;\r\n\t});\r\n\tout.abort = cancel;\r\n\treturn out;\r\n};\r\nL.Util.jsonp.cb = {};\r\n\r\nL.GeoJSON.AJAX = L.GeoJSON.extend({\r\n\tdefaultAJAXparams: {\r\n\t\tdataType: 'json',\r\n\t\tcallbackParam: 'callback',\r\n\t\tlocal:false,\r\n\t\tmiddleware: function(f) {\r\n\t\t\treturn f;\r\n\t\t}\r\n\t},\r\n\tinitialize: function(url, options) {\r\n\r\n\t\tthis.urls = [];\r\n\t\tif (url) {\r\n\t\t\tif (typeof url === 'string') {\r\n\t\t\t\tthis.urls.push(url);\r\n\t\t\t}\r\n\t\t\telse if (typeof url.pop === 'function') {\r\n\t\t\t\tthis.urls = this.urls.concat(url);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\toptions = url;\r\n\t\t\t\turl = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar ajaxParams = L.Util.extend({}, this.defaultAJAXparams);\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\tif (this.defaultAJAXparams.hasOwnProperty(i)) {\r\n\t\t\t\tajaxParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.ajaxParams = ajaxParams;\r\n\t\tthis._layers = {};\r\n\t\tL.Util.setOptions(this, options);\r\n\t\tthis.on('data:loaded', function() {\r\n\t\t\tif (this.filter) {\r\n\t\t\t\tthis.refilter(this.filter);\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\tvar self = this;\r\n\t\tif (this.urls.length > 0) {\r\n\t\t\tL.Util.Promise(function(yes){\r\n\t\t\t    yes();\r\n\t\t\t}).then(function(){\r\n\t\t\t    self.addUrl();\r\n\t\t    });\r\n\t\t}\r\n\t},\r\n\tclearLayers: function() {\r\n\t\tthis.urls = [];\r\n\t\tL.GeoJSON.prototype.clearLayers.call(this);\r\n\t\treturn this;\r\n\t},\r\n\taddUrl: function(url) {\r\n\t\tvar self = this;\r\n\t\tif (url) {\r\n\t\t\tif (typeof url === 'string') {\r\n\t\t\t\tself.urls.push(url);\r\n\t\t\t}\r\n\t\t\telse if (typeof url.pop === 'function') {\r\n\t\t\t\tself.urls = self.urls.concat(url);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar loading = self.urls.length;\r\n\t\tvar done = 0;\r\n\t\tself.fire('data:loading');\r\n\t\tself.urls.forEach(function(url) {\r\n\t\t\tif (self.ajaxParams.dataType.toLowerCase() === 'json') {\r\n\t\t\t\tL.Util.ajax(url,self.ajaxParams).then(function(d) {\r\n\t\t\t\t\tvar data = self.ajaxParams.middleware(d);\r\n\t\t\t\t\tif(data.status && data.status === \"ERROR\"){\r\n\t\t\t\t\t\tself.fire('data:progress',{error:data});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tself.addData(data);\r\n\t\t\t\t\t\tself.fire('data:progress',data);\r\n\t\t\t\t\t}\r\n\t\t\t\t},function(err){\r\n\t\t\t\t\tself.fire('data:progress',{error:err});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (self.ajaxParams.dataType.toLowerCase() === 'jsonp') {\r\n\t\t\t\tL.Util.jsonp(url,self.ajaxParams).then(function(d) {\r\n\t\t\t\t\tvar data = self.ajaxParams.middleware(d);\r\n\t\t\t\t\tself.addData(data);\r\n\t\t\t\t\tself.fire('data:progress',data);\r\n\t\t\t\t},function(err){\r\n\t\t\t\t\tself.fire('data:progress',{error:err});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tself.on('data:progress', function() {\r\n\t\t\tif (++done === loading) {\r\n\t\t\t\tself.fire('data:loaded');\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\trefresh: function(url) {\r\n\t\turl = url || this.urls;\r\n\t\tthis.clearLayers();\r\n\t\tthis.addUrl(url);\r\n\t},\r\n\trefilter: function(func) {\r\n\t\tif (typeof func !== 'function') {\r\n\t\t\tthis.filter = false;\r\n\t\t\tthis.eachLayer(function(a) {\r\n\t\t\t\ta.setStyle({\r\n\t\t\t\t\tstroke: true,\r\n\t\t\t\t\tclickable: true\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.filter = func;\r\n\t\t\tthis.eachLayer(function(a) {\r\n\r\n\t\t\t\tif (func(a.feature)) {\r\n\t\t\t\t\ta.setStyle({\r\n\t\t\t\t\t\tstroke: true,\r\n\t\t\t\t\t\tclickable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ta.setStyle({\r\n\t\t\t\t\t\tstroke: false,\r\n\t\t\t\t\t\tclickable: false\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\nL.geoJson.ajax = function(geojson, options) {\r\n\treturn new L.GeoJSON.AJAX(geojson, options);\r\n};\r\n","/*\n Leaflet.markercluster, Provides Beautiful Animated Marker Clustering functionality for Leaflet, a JS library for interactive maps.\n https://github.com/Leaflet/Leaflet.markercluster\n (c) 2012-2013, Dave Leaver, smartrak\n*/\n!function(t,e){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null},addLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.addLayers(e)}if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this;if(!this._map)return this._needsClustering.push(t),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom);var n=t,s=this._map.getZoom();if(t.__parent)for(;n.__parent._zoom>=s;)n=n.__parent;return this._currentShownBounds.contains(n.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,n):this._animationAddLayerNonAnimated(t,n)),this},removeLayer:function(t){if(t instanceof L.LayerGroup){var e=[];for(var i in t._layers)e.push(t._layers[i]);return this.removeLayers(e)}return t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.setOpacity&&t.setOpacity(1)),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push(t),this):(this._nonPointGroup.removeLayer(t),this)},addLayers:function(t){var e,i,n,s=this._map,r=this._featureGroup,o=this._nonPointGroup;for(e=0,i=t.length;i>e;e++)if(n=t[e],n.getLatLng){if(!this.hasLayer(n))if(s){if(this._addLayer(n,this._maxZoom),n.__parent&&2===n.__parent.getChildCount()){var a=n.__parent.getAllChildMarkers(),h=a[0]===n?a[1]:a[0];r.removeLayer(h)}}else this._needsClustering.push(n)}else o.addLayer(n);return s&&(r.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)),this},removeLayers:function(t){var e,i,n,s=this._featureGroup,r=this._nonPointGroup;if(!this._map){for(e=0,i=t.length;i>e;e++)n=t[e],this._arraySplice(this._needsClustering,n),r.removeLayer(n);return this}for(e=0,i=t.length;i>e;e++)n=t[e],n.__parent?(this._removeLayer(n,!0,!0),s.hasLayer(n)&&(s.removeLayer(n),n.setOpacity&&n.setOpacity(1))):r.removeLayer(n);return this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),s.eachLayer(function(t){t instanceof L.MarkerCluster&&t._updateIcon()}),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){delete t.__parent}),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;if(this._topClusterLevel)t.extend(this._topClusterLevel._bounds);else for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i,n=this._needsClustering.slice();for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),i=n.length-1;i>=0;i--)t.call(e,n[i]);this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e]===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=function(){if((t._icon||t.__parent._icon)&&!this._inZoomAnimation)if(this._map.off(\"moveend\",i,this),this.off(\"animationend\",i,this),t._icon)e();else if(t.__parent._icon){var n=function(){this.off(\"spiderfied\",n,this),e()};this.on(\"spiderfied\",n,this),t.__parent.spiderfy()}};t._icon?e():t.__parent._zoom<this._map.getZoom()?(this._map.on(\"moveend\",i,this),t._icon||this._map.panTo(t.getLatLng())):(this._map.on(\"moveend\",i,this),this.on(\"animationend\",i,this),this._map.setView(t.getLatLng(),t.__parent._zoom+1),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,n;if(!isFinite(this._map.getMaxZoom()))throw\"Map has no maxZoom specified\";for(this._featureGroup.onAdd(t),this._nonPointGroup.onAdd(t),this._gridClusters||this._generateInitialClusters(),e=0,i=this._needsRemoving.length;i>e;e++)n=this._needsRemoving[e],this._removeLayer(n,!0);for(this._needsRemoving=[],e=0,i=this._needsClustering.length;i>e;e++)n=this._needsClustering[e],n.getLatLng?n.__parent||this._addLayer(n,this._maxZoom):this._featureGroup.addLayer(n);this._needsClustering=[],this._map.on(\"zoomend\",this._zoomEnd,this),this._map.on(\"moveend\",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(t){t.off(\"zoomend\",this._zoomEnd,this),t.off(\"moveend\",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\"),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._hideCoverage(),this._featureGroup.onRemove(t),this._nonPointGroup.onRemove(t),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeLayer:function(t,e,i){var n=this._gridClusters,s=this._gridUnclustered,r=this._featureGroup,o=this._map;if(e)for(var a=this._maxZoom;a>=0&&s[a].removeObject(t,o.project(t.getLatLng(),a));a--);var h,_=t.__parent,u=_._markers;for(this._arraySplice(u,t);_&&(_._childCount--,!(_._zoom<0));)e&&_._childCount<=1?(h=_._markers[0]===t?_._markers[1]:_._markers[0],n[_._zoom].removeObject(_,o.project(_._cLatLng,_._zoom)),s[_._zoom].addObject(h,o.project(h.getLatLng(),_._zoom)),this._arraySplice(_.__parent._childClusters,_),_.__parent._markers.push(h),h.__parent=_.__parent,_._icon&&(r.removeLayer(_),i||r.addLayer(h))):(_._recalculateBounds(),i&&_._icon||_._updateIcon()),_=_.__parent;delete t.__parent},_propagateEvent:function(t){t.layer instanceof L.MarkerCluster&&(t.type=\"cluster\"+t.type),this.fire(t.type,t)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=\" marker-cluster-\";return i+=10>e?\"small\":100>e?\"medium\":\"large\",new L.DivIcon({html:\"<div><span>\"+e+\"</span></div>\",className:\"marker-cluster\"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick;(e||n)&&this.on(\"clusterclick\",this._zoomOrSpiderfy,this),i&&(this.on(\"clustermouseover\",this._showCoverage,this),this.on(\"clustermouseout\",this._hideCoverage,this),t.on(\"zoomend\",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=this._map;e.getMaxZoom()===e.getZoom()?this.options.spiderfyOnMaxZoom&&t.layer.spiderfy():this.options.zoomToBoundsOnClick&&t.layer.zoomToBounds()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,n=this._map;(t||i)&&this.off(\"clusterclick\",this._zoomOrSpiderfy,this),e&&(this.off(\"clustermouseover\",this._showCoverage,this),this.off(\"clustermouseout\",this._hideCoverage,this),n.off(\"zoomend\",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._map._zoom,t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=this._map.getMaxZoom(),e=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var i=t;i>=0;i--)this._gridClusters[i]=new L.DistanceGrid(e),this._gridUnclustered[i]=new L.DistanceGrid(e);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(t,e){var i,n,s=this._gridClusters,r=this._gridUnclustered;for(this.options.singleMarkerMode&&(t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}}));e>=0;e--){i=this._map.project(t.getLatLng(),e);var o=s[e].getNearObject(i);if(o)return o._addChild(t),t.__parent=o,void 0;if(o=r[e].getNearObject(i)){var a=o.__parent;a&&this._removeLayer(o,!1);var h=new L.MarkerCluster(this,e,o,t);s[e].addObject(h,this._map.project(h._cLatLng,e)),o.__parent=h,t.__parent=h;var _=h;for(n=e-1;n>a._zoom;n--)_=new L.MarkerCluster(this,n,_),s[n].addObject(_,this._map.project(o.getLatLng(),n));for(a._addChild(_),n=e;n>=0&&r[n].removeObject(o,this._map.project(o.getLatLng(),n));n--);return}r[e].addObject(t,i)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_mergeSplitClusters:function(){this._zoom<this._map._zoom&&this._currentShownBounds.contains(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var t=this._map,e=t.getBounds(),i=e._southWest,n=e._northEast,s=L.Browser.mobile?0:Math.abs(i.lat-n.lat),r=L.Browser.mobile?0:Math.abs(i.lng-n.lng);return new L.LatLngBounds(new L.LatLng(i.lat-s,i.lng-r,!0),new L.LatLng(n.lat+s,n.lng+r,!0))},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=\" leaflet-cluster-anim\",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(\" leaflet-cluster-anim\",\"\")),this._inZoomAnimation--,this.fire(\"animationend\")},_animationZoomIn:function(t,e){var i,n=this,s=this._getExpandedVisibleBounds(),r=this._featureGroup;this._topClusterLevel._recursively(s,t,0,function(n){var o,a=n._latlng,h=n._markers;for(s.contains(a)||(a=null),n._isSingleParent()&&t+1===e?(r.removeLayer(n),n._recursivelyAddChildrenToMap(null,e,s)):(n.setOpacity(0),n._recursivelyAddChildrenToMap(a,e,s)),i=h.length-1;i>=0;i--)o=h[i],s.contains(o._latlng)||r.removeLayer(o)}),this._forceLayout(),n._topClusterLevel._recursivelyBecomeVisible(s,e),r.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.setOpacity(1)}),n._topClusterLevel._recursively(s,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),setTimeout(function(){n._topClusterLevel._recursively(s,t,0,function(t){r.removeLayer(t),t.setOpacity(1)}),n._animationEnd()},200)},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(t,e,i){var n=this._getExpandedVisibleBounds();t._recursivelyAnimateChildrenInAndAddSelfToMap(n,e+1,i);var s=this;this._forceLayout(),t._recursivelyBecomeVisible(n,i),setTimeout(function(){if(1===t._childCount){var r=t._markers[0];r.setLatLng(r.getLatLng()),r.setOpacity(1)}else t._recursively(n,i,0,function(t){t._recursivelyRemoveChildrenFromMap(n,e+1)});s._animationEnd()},200)},_animationAddLayer:function(t,e){var i=this,n=this._featureGroup;n.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.setOpacity(0),setTimeout(function(){n.removeLayer(t),t.setOpacity(1),i._animationEnd()},200)):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,i,n){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),n&&this._addChild(n)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);for(var i=this._markers.length-1;i>=0;i--)t.push(this._markers[i]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var t,e=this._childClusters.slice(),i=this._group._map,n=i.getBoundsZoom(this._bounds),s=this._zoom+1;e.length>0&&n>s;){s++;var r=[];for(t=0;t<e.length;t++)r=r.concat(e[t]._childClusters);e=r}n>s?this._group._map.setView(this._latlng,s):this._group._map.fitBounds(this._bounds)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._expandBounds(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_expandBounds:function(t){var e,i=t._wLatLng||t._latlng;t instanceof L.MarkerCluster?(this._bounds.extend(t._bounds),e=t._childCount):(this._bounds.extend(i),e=1),this._cLatLng||(this._cLatLng=t._cLatLng||i);var n=this._childCount+e;this._wLatLng?(this._wLatLng.lat=(i.lat*e+this._wLatLng.lat*this._childCount)/n,this._wLatLng.lng=(i.lng*e+this._wLatLng.lng*this._childCount)/n):this._latlng=this._wLatLng=new L.LatLng(i.lat,i.lng)},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,0,i-1,function(t){var i,n,s=t._markers;for(i=s.length-1;i>=0;i--)n=s[i],n._icon&&(n._setPos(e),n.setOpacity(0))},function(t){var i,n,s=t._childClusters;for(i=s.length-1;i>=0;i--)n=s[i],n._icon&&(n._setPos(e),n.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i){this._recursively(t,i,0,function(n){n._recursivelyAnimateChildrenIn(t,n._group._map.latLngToLayerPoint(n.getLatLng()).round(),e),n._isSingleParent()&&e-1===i?(n.setOpacity(1),n._recursivelyRemoveChildrenFromMap(t,e)):n.setOpacity(0),n._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,0,e,null,function(t){t.setOpacity(1)})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,-1,e,function(n){if(e!==n._zoom)for(var s=n._markers.length-1;s>=0;s--){var r=n._markers[s];i.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.setOpacity&&r.setOpacity(0)),n._group._featureGroup.addLayer(r))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._restorePosition();else for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i){var n,s;this._recursively(t,-1,e-1,function(t){for(s=t._markers.length-1;s>=0;s--)n=t._markers[s],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.setOpacity&&n.setOpacity(1))},function(t){for(s=t._childClusters.length-1;s>=0;s--)n=t._childClusters[s],i&&i.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.setOpacity&&n.setOpacity(1))})},_recursively:function(t,e,i,n,s){var r,o,a=this._childClusters,h=this._zoom;if(e>h)for(r=a.length-1;r>=0;r--)o=a[r],t.intersects(o._bounds)&&o._recursively(t,e,i,n,s);else if(n&&n(this),s&&this._zoom===i&&s(this),i>h)for(r=a.length-1;r>=0;r--)o=a[r],t.intersects(o._bounds)&&o._recursively(t,e,i,n,s)},_recalculateBounds:function(){var t,e=this._markers,i=this._childClusters;for(this._bounds=new L.LatLngBounds,delete this._wLatLng,t=e.length-1;t>=0;t--)this._expandBounds(e[t]);for(t=i.length-1;t>=0;t--)this._expandBounds(i[t])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),n=this._getCoord(e.y),s=this._grid,r=s[n]=s[n]||{},o=r[i]=r[i]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,o.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,n,s=this._getCoord(e.x),r=this._getCoord(e.y),o=this._grid,a=o[r]=o[r]||{},h=a[s]=a[s]||[];for(delete this._objectPoint[L.Util.stamp(t)],i=0,n=h.length;n>i;i++)if(h[i]===t)return h.splice(i,1),1===n&&delete a[s],!0},eachObject:function(t,e){var i,n,s,r,o,a,h,_=this._grid;for(i in _){o=_[i];for(n in o)for(a=o[n],s=0,r=a.length;r>s;s++)h=t.call(e,a[s]),h&&(s--,r--)}},getNearObject:function(t){var e,i,n,s,r,o,a,h,_=this._getCoord(t.x),u=this._getCoord(t.y),l=this._objectPoint,d=this._sqCellSize,p=null;for(e=u-1;u+1>=e;e++)if(s=this._grid[e])for(i=_-1;_+1>=i;i++)if(r=s[i])for(n=0,o=r.length;o>n;n++)a=r[n],h=this._sqDist(l[L.Util.stamp(a)],t),d>h&&(d=h,p=a);return p},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,n=e[0].lng-e[1].lng;return n*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i,n,s,r=0,o=null,a=[];for(i=e.length-1;i>=0;i--)n=e[i],s=this.getDistant(n,t),s>0&&(a.push(n),s>r&&(r=s,o=n));return{maxPoint:o,newPoints:a}},buildConvexHull:function(t,e){var i=[],n=this.findMostDistantPointFromBaseLine(t,e);return n.maxPoint?(i=i.concat(this.buildConvexHull([t[0],n.maxPoint],n.newPoints)),i=i.concat(this.buildConvexHull([n.maxPoint,t[1]],n.newPoints))):[t[0]]},getConvexHull:function(t){var e,i=!1,n=!1,s=null,r=null;for(e=t.length-1;e>=0;e--){var o=t[e];(i===!1||o.lat>i)&&(s=o,i=o.lat),(n===!1||o.lat<n)&&(r=o,n=o.lat)}var a=[].concat(this.buildConvexHull([r,s],t),this.buildConvexHull([s,r],t));return a}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,i=this.getAllChildMarkers(),n=[];for(e=i.length-1;e>=0;e--)t=i[e].getLatLng(),n.push(t);return L.QuickHull.getConvexHull(n)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),i=this._group,n=i._map,s=n.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,s):(s.y+=10,t=this._generatePointsCircle(e.length,s)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i,n,s=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),r=s/this._2PI,o=this._2PI/t,a=[];for(a.length=t,i=t-1;i>=0;i--)n=this._circleStartAngle+i*o,a[i]=new L.Point(e.x+r*Math.cos(n),e.y+r*Math.sin(n))._round();return a},_generatePointsSpiral:function(t,e){var i,n=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,s=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,r=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,o=0,a=[];for(a.length=t,i=t-1;i>=0;i--)o+=s/n+5e-4*i,a[i]=new L.Point(e.x+n*Math.cos(o),e.y+n*Math.sin(o))._round(),n+=this._2PI*r/o;return a},_noanimationUnspiderfy:function(){var t,e,i=this._group,n=i._map,s=i._featureGroup,r=this.getAllChildMarkers();for(this.setOpacity(1),e=r.length-1;e>=0;e--)t=r[e],s.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(n.removeLayer(t._spiderLeg),delete t._spiderLeg);i._spiderfied=null}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return e.createElementNS(\"http://www.w3.org/2000/svg\",\"animate\").toString().indexOf(\"SVGAnimate\")>-1}(),_animationSpiderfy:function(t,i){var n,s,r,o,a=this,h=this._group,_=h._map,u=h._featureGroup,l=_.latLngToLayerPoint(this._latlng);for(n=t.length-1;n>=0;n--)s=t[n],s.setOpacity?(s.setZIndexOffset(1e6),s.setOpacity(0),u.addLayer(s),s._setPos(l)):u.addLayer(s);h._forceLayout(),h._animationStart();var d=L.Path.SVG?0:.3,p=L.Path.SVG_NS;for(n=t.length-1;n>=0;n--)if(o=_.layerPointToLatLng(i[n]),s=t[n],s._preSpiderfyLatlng=s._latlng,s.setLatLng(o),s.setOpacity&&s.setOpacity(1),r=new L.Polyline([a._latlng,o],{weight:1.5,color:\"#222\",opacity:d}),_.addLayer(r),s._spiderLeg=r,L.Path.SVG&&this.SVG_ANIMATION){var c=r._path.getTotalLength();r._path.setAttribute(\"stroke-dasharray\",c+\",\"+c);var m=e.createElementNS(p,\"animate\");m.setAttribute(\"attributeName\",\"stroke-dashoffset\"),m.setAttribute(\"begin\",\"indefinite\"),m.setAttribute(\"from\",c),m.setAttribute(\"to\",0),m.setAttribute(\"dur\",.25),r._path.appendChild(m),m.beginElement(),m=e.createElementNS(p,\"animate\"),m.setAttribute(\"attributeName\",\"stroke-opacity\"),m.setAttribute(\"attributeName\",\"stroke-opacity\"),m.setAttribute(\"begin\",\"indefinite\"),m.setAttribute(\"from\",0),m.setAttribute(\"to\",.5),m.setAttribute(\"dur\",.25),r._path.appendChild(m),m.beginElement()}if(a.setOpacity(.3),L.Path.SVG)for(this._group._forceLayout(),n=t.length-1;n>=0;n--)s=t[n]._spiderLeg,s.options.opacity=.5,s._path.setAttribute(\"stroke-opacity\",.5);setTimeout(function(){h._animationEnd(),h.fire(\"spiderfied\")},200)},_animationUnspiderfy:function(t){var e,i,n,s=this._group,r=s._map,o=s._featureGroup,a=t?r._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):r.latLngToLayerPoint(this._latlng),h=this.getAllChildMarkers(),_=L.Path.SVG&&this.SVG_ANIMATION;for(s._animationStart(),this.setOpacity(1),i=h.length-1;i>=0;i--)e=h[i],e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,e.setOpacity?(e._setPos(a),e.setOpacity(0)):o.removeLayer(e),_&&(n=e._spiderLeg._path.childNodes[0],n.setAttribute(\"to\",n.getAttribute(\"from\")),n.setAttribute(\"from\",0),n.beginElement(),n=e._spiderLeg._path.childNodes[1],n.setAttribute(\"from\",.5),n.setAttribute(\"to\",0),n.setAttribute(\"stroke-opacity\",0),n.beginElement(),e._spiderLeg._path.setAttribute(\"stroke-opacity\",0)));setTimeout(function(){var t=0;for(i=h.length-1;i>=0;i--)e=h[i],e._spiderLeg&&t++;for(i=h.length-1;i>=0;i--)e=h[i],e._spiderLeg&&(e.setOpacity&&(e.setOpacity(1),e.setZIndexOffset(0)),t>1&&o.removeLayer(e),r.removeLayer(e._spiderLeg),delete e._spiderLeg);s._animationEnd()},200)}}:{_animationSpiderfy:function(t,e){var i,n,s,r,o=this._group,a=o._map,h=o._featureGroup;for(i=t.length-1;i>=0;i--)r=a.layerPointToLatLng(e[i]),n=t[i],n._preSpiderfyLatlng=n._latlng,n.setLatLng(r),n.setZIndexOffset&&n.setZIndexOffset(1e6),h.addLayer(n),s=new L.Polyline([this._latlng,r],{weight:1.5,color:\"#222\"}),a.addLayer(s),n._spiderLeg=s;this.setOpacity(.3),o.fire(\"spiderfied\")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on(\"click\",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on(\"zoomstart\",this._unspiderfyZoomStart,this),this._map.on(\"zoomend\",this._noanimationUnspiderfy,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off(\"click\",this._unspiderfyWrapper,this),this._map.off(\"zoomstart\",this._unspiderfyZoomStart,this),this._map.off(\"zoomanim\",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on(\"zoomanim\",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,\"leaflet-touching\")||(this._map.off(\"zoomanim\",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.setOpacity(1),t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}})}(window,document);","L.Control.MiniMap = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomright',\r\n\t\ttoggleDisplay: false,\r\n\t\tzoomLevelOffset: -5,\r\n\t\tzoomLevelFixed: false,\r\n\t\tzoomAnimation: false,\r\n\t\tautoToggleDisplay: false,\r\n\t\twidth: 150,\r\n\t\theight: 150,\r\n\t\taimingRectOptions: {color: \"#ff7800\", weight: 1, clickable: false},\r\n\t\tshadowRectOptions: {color: \"#000000\", weight: 1, clickable: false, opacity:0, fillOpacity:0},\r\n\t\tmapOptions: {} // Allows definition / override of Leaflet map options.\r\n\t},\r\n\t\r\n\thideText: 'Hide MiniMap',\r\n\t\r\n\tshowText: 'Show MiniMap',\r\n\t\r\n\t//layer is the map layer to be shown in the minimap\r\n\tinitialize: function (layer, options) {\r\n\t\tL.Util.setOptions(this, options);\r\n\t\t//Make sure the aiming rects are non-clickable even if the user tries to set them clickable (most likely by forgetting to specify them false)\r\n\t\tthis.options.aimingRectOptions.clickable = false;\r\n\t\tthis.options.shadowRectOptions.clickable = false;\r\n\t\tthis._layer = layer;\r\n\t},\r\n\t\r\n\tonAdd: function (map) {\r\n\t\tthis._mainMap = map;\r\n\r\n\t\t//Creating the container and stopping events from spilling through to the main map.\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-minimap');\r\n\t\tthis._container.style.width = this.options.width + 'px';\r\n\t\tthis._container.style.height = this.options.height + 'px';\r\n\t\tL.DomEvent.disableClickPropagation(this._container);\r\n\t\tL.DomEvent.on(this._container, 'mousewheel', L.DomEvent.stopPropagation);\r\n\r\n\t\tvar mapOptions = {\r\n\t\t\tattributionControl: false,\r\n\t\t\tzoomControl: false,\r\n\t\t\tzoomAnimation: this.options.zoomAnimation,\r\n\t\t\tautoToggleDisplay: this.options.autoToggleDisplay,\r\n\t\t\ttouchZoom: !this.options.zoomLevelFixed,\r\n\t\t\tscrollWheelZoom: !this.options.zoomLevelFixed,\r\n\t\t\tdoubleClickZoom: !this.options.zoomLevelFixed,\r\n\t\t\tboxZoom: !this.options.zoomLevelFixed,\r\n\t\t\tcrs: map.options.crs\r\n\t\t};\r\n\t\t\r\n\t\tmapOptions = L.Util.extend(this.options.mapOptions, mapOptions);\r\n\t\t\r\n\t\tthis._miniMap = new L.Map(this._container,mapOptions);\r\n\t\t\r\n\t\tthis._miniMap.addLayer(this._layer);\r\n\r\n\t\t//These bools are used to prevent infinite loops of the two maps notifying each other that they've moved.\r\n\t\tthis._mainMapMoving = false;\r\n\t\tthis._miniMapMoving = false;\r\n\r\n\t\t//Keep a record of this to prevent auto toggling when the user explicitly doesn't want it.\r\n\t\tthis._userToggledDisplay = false;\r\n\t\tthis._minimized = false;\r\n\r\n\t\tif (this.options.toggleDisplay) {\r\n\t\t\tthis._addToggleButton();\r\n\t\t}\r\n\r\n\t\tthis._miniMap.whenReady(L.Util.bind(function () {\r\n\t\t\tthis._aimingRect = L.rectangle(this._mainMap.getBounds(), this.options.aimingRectOptions).addTo(this._miniMap);\r\n\t\t\tthis._shadowRect = L.rectangle(this._mainMap.getBounds(), this.options.shadowRectOptions).addTo(this._miniMap);\r\n\t\t\tthis._mainMap.on('moveend', this._onMainMapMoved, this);\r\n\t\t\tthis._mainMap.on('move', this._onMainMapMoving, this);\r\n\t\t\t//this._miniMap.on('movestart', this._onMiniMapMoveStarted, this);\r\n\t\t\t//this._miniMap.on('move', this._onMiniMapMoving, this);\r\n\t\t\t//this._miniMap.on('moveend', this._onMiniMapMoved, this);\r\n\t\t}, this));\r\n\t\t\t\t\r\n\t\treturn this._container;\r\n\t},\r\n\r\n\taddTo: function (map) {\r\n\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\tthis._miniMap.setView(this._mainMap.getCenter(), this._decideZoom(true));\r\n\t\tthis._setDisplay(this._decideMinimized());\r\n\t\treturn this;\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._mainMap.off('moveend', this._onMainMapMoved, this);\r\n\t\tthis._mainMap.off('move', this._onMainMapMoving, this);\r\n\t\tthis._miniMap.off('moveend', this._onMiniMapMoved, this);\r\n\r\n\t\tthis._miniMap.removeLayer(this._layer);\r\n\t},\r\n\r\n\t_addToggleButton: function () {\r\n\t\tthis._toggleDisplayButton = this.options.toggleDisplay ? this._createButton(\r\n\t\t\t\t'', this.hideText, 'leaflet-control-minimap-toggle-display', this._container, this._toggleDisplayButtonClicked, this) : undefined;\r\n\t},\r\n\r\n\t_createButton: function (html, title, className, container, fn, context) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.innerHTML = html;\r\n\t\tlink.href = '#';\r\n\t\tlink.title = title;\r\n\r\n\t\tvar stop = L.DomEvent.stopPropagation;\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.on(link, 'click', stop)\r\n\t\t\t.on(link, 'mousedown', stop)\r\n\t\t\t.on(link, 'dblclick', stop)\r\n\t\t\t.on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.on(link, 'click', fn, context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_toggleDisplayButtonClicked: function () {\r\n\t\tthis._userToggledDisplay = true;\r\n\t\tif (!this._minimized) {\r\n\t\t\tthis._minimize();\r\n\t\t\tthis._toggleDisplayButton.title = this.showText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._restore();\r\n\t\t\tthis._toggleDisplayButton.title = this.hideText;\r\n\t\t}\r\n\t},\r\n\r\n\t_setDisplay: function (minimize) {\r\n\t\tif (minimize != this._minimized) {\r\n\t\t\tif (!this._minimized) {\r\n\t\t\t\tthis._minimize();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._restore();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_minimize: function () {\r\n\t\t// hide the minimap\r\n\t\tif (this.options.toggleDisplay) {\r\n\t\t\tthis._container.style.width = '19px';\r\n\t\t\tthis._container.style.height = '19px';\r\n\t\t\tthis._toggleDisplayButton.className += ' minimized';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._container.style.display = 'none';\r\n\t\t}\r\n\t\tthis._minimized = true;\r\n\t},\r\n\r\n\t_restore: function () {\r\n\t\tif (this.options.toggleDisplay) {\r\n\t\t\tthis._container.style.width = this.options.width + 'px';\r\n\t\t\tthis._container.style.height = this.options.height + 'px';\r\n\t\t\tthis._toggleDisplayButton.className = this._toggleDisplayButton.className\r\n\t\t\t\t\t.replace(/(?:^|\\s)minimized(?!\\S)/g, '');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._container.style.display = 'block';\r\n\t\t}\r\n\t\tthis._minimized = false;\r\n\t},\r\n\r\n\t_onMainMapMoved: function (e) {\r\n\t\tif (!this._miniMapMoving) {\r\n\t\t\tthis._mainMapMoving = true;\r\n\t\t\tthis._miniMap.setView(this._mainMap.getCenter(), this._decideZoom(true));\r\n\t\t\tthis._setDisplay(this._decideMinimized());\r\n\t\t} else {\r\n\t\t\tthis._miniMapMoving = false;\r\n\t\t}\r\n\t\tthis._aimingRect.setBounds(this._mainMap.getBounds());\r\n\t},\r\n\r\n\t_onMainMapMoving: function (e) {\r\n\t\tthis._aimingRect.setBounds(this._mainMap.getBounds());\r\n\t},\r\n\r\n\t_onMiniMapMoveStarted:function (e) {\r\n\t\tvar lastAimingRect = this._aimingRect.getBounds();\r\n\t\tvar sw = this._miniMap.latLngToContainerPoint(lastAimingRect.getSouthWest());\r\n\t\tvar ne = this._miniMap.latLngToContainerPoint(lastAimingRect.getNorthEast());\r\n\t\tthis._lastAimingRectPosition = {sw:sw,ne:ne};\r\n\t},\r\n\r\n\t_onMiniMapMoving: function (e) {\r\n\t\tif (!this._mainMapMoving && this._lastAimingRectPosition) {\r\n\t\t\tthis._shadowRect.setBounds(new L.LatLngBounds(this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne)));\r\n\t\t\tthis._shadowRect.setStyle({opacity:1,fillOpacity:0.3});\r\n\t\t}\r\n\t},\r\n\r\n\t_onMiniMapMoved: function (e) {\r\n\t\tif (!this._mainMapMoving) {\r\n\t\t\tthis._miniMapMoving = true;\r\n\t\t\tthis._mainMap.setView(this._miniMap.getCenter(), this._decideZoom(false));\r\n\t\t\tthis._shadowRect.setStyle({opacity:0,fillOpacity:0});\r\n\t\t} else {\r\n\t\t\tthis._mainMapMoving = false;\r\n\t\t}\r\n\t},\r\n\r\n\t_decideZoom: function (fromMaintoMini) {\r\n\t\tif (!this.options.zoomLevelFixed) {\r\n\t\t\tif (fromMaintoMini)\r\n\t\t\t\treturn this._mainMap.getZoom() + this.options.zoomLevelOffset;\r\n\t\t\telse {\r\n\t\t\t\tvar currentDiff = this._miniMap.getZoom() - this._mainMap.getZoom();\r\n\t\t\t\tvar proposedZoom = this._miniMap.getZoom() - this.options.zoomLevelOffset;\r\n\t\t\t\tvar toRet;\r\n\t\t\t\t\r\n\t\t\t\tif (currentDiff > this.options.zoomLevelOffset && this._mainMap.getZoom() < this._miniMap.getMinZoom() - this.options.zoomLevelOffset) {\r\n\t\t\t\t\t//This means the miniMap is zoomed out to the minimum zoom level and can't zoom any more.\r\n\t\t\t\t\tif (this._miniMap.getZoom() > this._lastMiniMapZoom) {\r\n\t\t\t\t\t\t//This means the user is trying to zoom in by using the minimap, zoom the main map.\r\n\t\t\t\t\t\ttoRet = this._mainMap.getZoom() + 1;\r\n\t\t\t\t\t\t//Also we cheat and zoom the minimap out again to keep it visually consistent.\r\n\t\t\t\t\t\tthis._miniMap.setZoom(this._miniMap.getZoom() -1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//Either the user is trying to zoom out past the mini map's min zoom or has just panned using it, we can't tell the difference.\r\n\t\t\t\t\t\t//Therefore, we ignore it!\r\n\t\t\t\t\t\ttoRet = this._mainMap.getZoom();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//This is what happens in the majority of cases, and always if you configure the min levels + offset in a sane fashion.\r\n\t\t\t\t\ttoRet = proposedZoom;\r\n\t\t\t\t}\r\n\t\t\t\tthis._lastMiniMapZoom = this._miniMap.getZoom();\r\n\t\t\t\treturn toRet;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (fromMaintoMini)\r\n\t\t\t\treturn this.options.zoomLevelFixed;\r\n\t\t\telse\r\n\t\t\t\treturn this._mainMap.getZoom();\r\n\t\t}\r\n\t},\r\n\r\n\t_decideMinimized: function () {\r\n\t\tif (this._userToggledDisplay) {\r\n\t\t\treturn this._minimized;\r\n\t\t}\r\n\r\n\t\tif (this.options.autoToggleDisplay) {\r\n\t\t\tif (this._mainMap.getBounds().contains(this._miniMap.getBounds())) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this._minimized;\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tminiMapControl: false\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.miniMapControl) {\r\n\t\tthis.miniMapControl = (new L.Control.MiniMap()).addTo(this);\r\n\t}\r\n});\r\n\r\nL.control.minimap = function (options) {\r\n\treturn new L.Control.MiniMap(options);\r\n};\r\n","(function(window) {\n\tvar HAS_HASHCHANGE = (function() {\n\t\tvar doc_mode = window.documentMode;\n\t\treturn ('onhashchange' in window) &&\n\t\t\t(doc_mode === undefined || doc_mode > 7);\n\t})();\n\n\tL.Hash = function(map) {\n\t\tthis.onHashChange = L.Util.bind(this.onHashChange, this);\n\n\t\tif (map) {\n\t\t\tthis.init(map);\n\t\t}\n\t};\n\n\tL.Hash.parseHash = function(hash) {\n\t\tif(hash.indexOf('#') === 0) {\n\t\t\thash = hash.substr(1);\n\t\t}\n\t\tvar args = hash.split(\"/\");\n\t\tif (args.length == 3) {\n\t\t\tvar zoom = parseInt(args[0], 10),\n\t\t\tlat = parseFloat(args[1]),\n\t\t\tlon = parseFloat(args[2]);\n\t\t\tif (isNaN(zoom) || isNaN(lat) || isNaN(lon)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tcenter: new L.LatLng(lat, lon),\n\t\t\t\t\tzoom: zoom\n\t\t\t\t};\n\t\t\t}\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tL.Hash.formatHash = function(map) {\n\t\tvar center = map.getCenter(),\n\t\t    zoom = map.getZoom(),\n\t\t    precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));\n\n\t\treturn \"#\" + [zoom,\n\t\t\tcenter.lat.toFixed(precision),\n\t\t\tcenter.lng.toFixed(precision)\n\t\t].join(\"/\");\n\t},\n\n\tL.Hash.prototype = {\n\t\tmap: null,\n\t\tlastHash: null,\n\n\t\tparseHash: L.Hash.parseHash,\n\t\tformatHash: L.Hash.formatHash,\n\n\t\tinit: function(map) {\n\t\t\tthis.map = map;\n\n\t\t\t// reset the hash\n\t\t\tthis.lastHash = null;\n\t\t\tthis.onHashChange();\n\n\t\t\tif (!this.isListening) {\n\t\t\t\tthis.startListening();\n\t\t\t}\n\t\t},\n\n\t\tremoveFrom: function(map) {\n\t\t\tif (this.changeTimeout) {\n\t\t\t\tclearTimeout(this.changeTimeout);\n\t\t\t}\n\n\t\t\tif (this.isListening) {\n\t\t\t\tthis.stopListening();\n\t\t\t}\n\n\t\t\tthis.map = null;\n\t\t},\n\n\t\tonMapMove: function() {\n\t\t\t// bail if we're moving the map (updating from a hash),\n\t\t\t// or if the map is not yet loaded\n\n\t\t\tif (this.movingMap || !this.map._loaded) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar hash = this.formatHash(this.map);\n\t\t\tif (this.lastHash != hash) {\n\t\t\t\tlocation.replace(hash);\n\t\t\t\tthis.lastHash = hash;\n\t\t\t}\n\t\t},\n\n\t\tmovingMap: false,\n\t\tupdate: function() {\n\t\t\tvar hash = location.hash;\n\t\t\tif (hash === this.lastHash) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar parsed = this.parseHash(hash);\n\t\t\tif (parsed) {\n\t\t\t\tthis.movingMap = true;\n\n\t\t\t\tthis.map.setView(parsed.center, parsed.zoom);\n\n\t\t\t\tthis.movingMap = false;\n\t\t\t} else {\n\t\t\t\tthis.onMapMove(this.map);\n\t\t\t}\n\t\t},\n\n\t\t// defer hash change updates every 100ms\n\t\tchangeDefer: 100,\n\t\tchangeTimeout: null,\n\t\tonHashChange: function() {\n\t\t\t// throttle calls to update() so that they only happen every\n\t\t\t// `changeDefer` ms\n\t\t\tif (!this.changeTimeout) {\n\t\t\t\tvar that = this;\n\t\t\t\tthis.changeTimeout = setTimeout(function() {\n\t\t\t\t\tthat.update();\n\t\t\t\t\tthat.changeTimeout = null;\n\t\t\t\t}, this.changeDefer);\n\t\t\t}\n\t\t},\n\n\t\tisListening: false,\n\t\thashChangeInterval: null,\n\t\tstartListening: function() {\n\t\t\tthis.map.on(\"moveend\", this.onMapMove, this);\n\n\t\t\tif (HAS_HASHCHANGE) {\n\t\t\t\tL.DomEvent.addListener(window, \"hashchange\", this.onHashChange);\n\t\t\t} else {\n\t\t\t\tclearInterval(this.hashChangeInterval);\n\t\t\t\tthis.hashChangeInterval = setInterval(this.onHashChange, 50);\n\t\t\t}\n\t\t\tthis.isListening = true;\n\t\t},\n\n\t\tstopListening: function() {\n\t\t\tthis.map.off(\"moveend\", this.onMapMove, this);\n\n\t\t\tif (HAS_HASHCHANGE) {\n\t\t\t\tL.DomEvent.removeListener(window, \"hashchange\", this.onHashChange);\n\t\t\t} else {\n\t\t\t\tclearInterval(this.hashChangeInterval);\n\t\t\t}\n\t\t\tthis.isListening = false;\n\t\t}\n\t};\n\tL.hash = function(map) {\n\t\treturn new L.Hash(map);\n\t};\n\tL.Map.prototype.addHash = function() {\n\t\tthis._hash = L.hash(this);\n\t};\n\tL.Map.prototype.removeHash = function() {\n\t\tthis._hash.removeFrom();\n\t};\n})(window);\n","\n(function() {\n\nL.Control.Gps = L.Control.extend({\n\n\tincludes: L.Mixin.Events, \n\t//\n\t//Managed Events:\n\t//\tEvent\t\t\tData passed\t\t\tDescription\n\t//\n\t//\tgpslocated\t\t{latlng, marker}\tfired after gps marker is located\n\t//\tgpsdisabled\t\t\t\t\t\t\tfired after gps is disabled\n\t//\n\t//Methods exposed:\n\t//\tMethod \t\t\tDescription\n\t//\n\t//  getLocation\t\treturn Latlng and marker of current position\n\t//  activate\t\tactive tracking on runtime\n\t//  deactivate\t\tdeactive tracking on runtime\n\t//\n\toptions: {\t\t\n\t\tautoActive: false,\t\t//activate control at startup\n\t\tautoCenter: false,\t\t//move map when gps location change\n\t\tmaxZoom: null,\t\t\t//max zoom for autoCenter\n\t\tmarker: null,\t\t\t//L.Marker used for location, default use a L.CircleMarker\n\t\ttextErr: null,\t\t\t//error message on alert notification\n\t\tcallErr: null,\t\t\t//function that run on gps error activating\n\t\tstyle: {radius: 16,\t\t//marker circle style\n\t\t\t\tweight:3,\n\t\t\t\tcolor: '#e03',\n\t\t\t\tfill: false},\n\t\ttitle: 'Center map on your location',\n\t\tposition: 'topleft'\n\t\t//TODO add gpsLayer\n\t\t//TODO timeout autoCenter\t\t\n\t},\n\n\tinitialize: function(options) {\n\t\tif(options && options.style)\n\t\t\toptions.style = L.Util.extend({}, this.options.style, options.style); \n\t\tL.Util.setOptions(this, options);\n\t\tthis._errorFunc = this.options.callErr || this.showAlert;\n\t\tthis._isActive = false;//global state of gps\n\t\tthis._firstMoved = false;//global state of gps\n\t\tthis._currentLocation = null;\t//store last location\n\t},\n\t\n    onAdd: function (map) {\n    \n    \tthis._map = map;\t\n        \t\n        var container = L.DomUtil.create('div', 'leaflet-control-gps');\n\n        this._button = L.DomUtil.create('a', 'gps-button', container);\n        this._button.href = '#';\n        this._button.title = this.options.title;\n\t\tL.DomEvent\n\t\t\t.on(this._button, 'click', L.DomEvent.stop, this)\n\t\t\t.on(this._button, 'click', this._switchGps, this);\n\n\t\tthis._alert = L.DomUtil.create('div', 'gps-alert', container);\n\t\tthis._alert.style.display = 'none';\n\n\t\tthis._gpsMarker = this.options.marker ? this.options.marker : new L.CircleMarker([0,0], this.options.style);\n\t\t\n\t\tthis._map\n\t\t\t.on('locationfound', this._drawGps, this)\n\t\t\t.on('locationerror', this._errorGps, this);\t\n\t\t\t\n\t\tif(this.options.autoActive)\n\t\t\tthis.activate();\n\n        return container;\n    },\n    \n\tonRemove: function(map) {\n\t\tthis.deactivate();\n\t},\n\t\n\t_switchGps: function() {\n\t\tif(this._isActive)\n\t\t\tthis.deactivate();\n\t\telse\n\t\t\tthis.activate();\n\t},\n\t\n\tgetLocation: function() {\t//get last location\n\t\treturn this._currentLocation;\n\t},\n    \n    activate: function() {\n\t    this._isActive = true;\n\t\tthis._map.addLayer( this._gpsMarker );\n\t    this._map.locate({\n\t        enableHighAccuracy: true,\n\t\t\twatch: true,\n\t\t\t//maximumAge:s\n\t        setView: false,\t//automatically sets the map view to the user location\n\t\t\tmaxZoom: this.options.maxZoom   \n\t    });\t    \n    },\n    \n    deactivate: function() {\n   \t\tthis._isActive = false;    \n\t\tthis._firstMoved = false;\n\t\tthis._map.stopLocate();\n    \tL.DomUtil.removeClass(this._button, 'active');\n    \tthis._map.removeLayer( this._gpsMarker );\n\t\t//this._gpsMarker.setLatLng([-90,0]);  //move to antarctica!\n\t\t//TODO make method .hide() using _icon.style.display = 'none'\n\t\tthis.fire('gpsdisabled');\n    },\n    \n    _drawGps: function(e) {\n    \t//TODO use e.accuracy for gps circle radius/color\n    \tthis._currentLocation = e.latlng;\n\t\t\t\n    \tthis._gpsMarker.setLatLng(e.latlng);\n\n    \tif(this._isActive && (!this._firstMoved || this.options.autoCenter))\n\t\t\tthis._moveTo(e.latlng);\n//    \tif(this._gpsMarker.accuracyCircle)\n//    \t\tthis._gpsMarker.accuracyCircle.setRadius((e.accuracy / 2).toFixed(0));\n    \t\t\n    \tthis.fire('gpslocated', {latlng: e.latlng, marker: this._gpsMarker});\n    \t\n    \tL.DomUtil.addClass(this._button, 'active');\t\n    },\n    \n    _moveTo: function(latlng) {\n    \tthis._firstMoved = true;\n\t\tif(this.options.maxZoom)\n\t\t\tthis._map.setView(latlng, Math.min(this._map.getZoom(), this.options.maxZoom) );\n\t\telse\n\t\t\tthis._map.panTo(latlng);    \n    },\n    \n    _errorGps: function(e) {\n    \tthis.deactivate();\n    \tthis._errorFunc.call(this, this.options.textErr || e.message);\n    },\n    \n\tshowAlert: function(text) {\n\t\tthis._alert.style.display = 'block';\n\t\tthis._alert.innerHTML = text;\n\t\tvar that = this;\n\t\tclearTimeout(this.timerAlert);\n\t\tthis.timerAlert = setTimeout(function() {\n\t\t\tthat._alert.style.display = 'none';\n\t\t}, 2000);\n\t}\n});\n\nL.control.gps = function (options) {\n    return new L.Control.Gps(options);\n};\n\n}).call(this);\n","var control_llegenda_WMS;\r\nL.TileLayer.BetterWMS = L.TileLayer.WMS.extend({\r\n\tonAdd: function (map) {\r\n\t\tthis.creaControlLLegenda(map);\r\n\t\t// Triggered when the layer is added to a map.\r\n\t\t// Register a click listener, then do all the upstream WMS things\r\n\t\tthis.options.maxZoom=20;\r\n\t\tthis.options.queryable=true;\r\n\t\tL.TileLayer.WMS.prototype.onAdd.call(this, map);\r\n\t\t//if (this.url && this.url.indexOf('http://betaserver.icgc.cat/geoservice/')==-1){\r\n\t\t\tmap.on('click', this.getFeatureInfo, this);\r\n\t\t\tvar params = this.getLegendGraphic();\r\n\t\t\tthis.updateControlLLegenda(params,this.wmsParams.layers,true,this.options.nom,this.options.businessId);\t\r\n\t\t//}\t\t\r\n\t\t\r\n\t},\r\n\tonRemove: function (map) {\r\n\t\t// Triggered when the layer is removed from a map.\r\n\t\t// Unregister a click listener, then do all the upstream WMS things\r\n\t\tL.TileLayer.WMS.prototype.onRemove.call(this, map);\r\n\t\tmap.off('click', this.getFeatureInfo, this);\r\n\t\tvar params = this.getLegendGraphic();\r\n\t\tthis.updateControlLLegenda(params,this.wmsParams.layers,false,this.options.nom,this.options.businessId);\r\n\t},\r\n\tgetFeatureInfo: function (evt) {\r\n\t\t// Make an AJAX request to the server and hope for the best\r\n\t\tvar params = this.getFeatureInfoUrl(evt.latlng);\r\n\t\tparams = params.replace(\"INFO_FORMAT=text%2Fhtml\",\"INFO_FORMAT=text/html\");\r\n\t\tif(this.options.queryable){\r\n\t\t\tif ((params.indexOf('instamaps.cat')!=-1 || params.indexOf('172.70.1.11')!=-1 || params.indexOf('localhost')!=-1) && params.indexOf('instaserver')==-1){\r\n\t\t\t\tif (params.indexOf('/geoservicelocal/')!=-1){\r\n\t\t\t\t\tparams = params.replace(\"INFO_FORMAT=text%2Fhtml\",\"INFO_FORMAT=text%2Fplain\");\r\n\t\t\t\t\tparams = params.replace(\"INFO_FORMAT=text/html\",\"INFO_FORMAT=text/plain\");\r\n\t\t\t\t}\r\n\t\t\t\tvar dataF=\"<iframe style=\\\"display: block; width:300px; height:200px;border:none;\\\"  src=\"+params+\" ></iframe></div>\";\r\n\t\t\t\tvar pop=L.popup({ maxWidth: 800})\r\n\t\t\t\t\t.setLatLng(evt.latlng)\r\n\t\t\t\t\t.setContent(dataF).openOn(map);\t\r\n\t\t\t}else{\r\n\t\t\t\tvar esNomesWMS = true;\r\n\t\t\t\tvar teUtfGrid = false;\r\n\t\t\t\t//De moment, si es un wms creat pel cloudifier, demanem text/pla\r\n\t\t\t\t//mes endavant passarem per ogrinfo i podrem demanar HTML amb template\r\n\t\t\t\t//per mostrar la informacio\r\n\t\t\t\tif (params.indexOf('http://betaserver.icgc.cat/geoservice/')!=-1){\r\n\t\t\t\t\tparams = params.replace(\"INFO_FORMAT=text%2Fhtml\",\"INFO_FORMAT=text%2Fplain\");\r\n\t\t\t\t}\r\n\t\t\t\tfor(val in controlCapes._layers){\r\n\t\t\t\t\tif(controlCapes._layers[val].layer.options.tipus != t_wms){\r\n\t\t\t\t\t\tesNomesWMS = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (controlCapes._layers[val].layer.options.tipus == t_vis_wms){\r\n\t\t\t\t\t\tteUtfGrid=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(esNomesWMS){\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: paramUrl.proxy_betterWMS,\r\n\t\t\t\t\t\tdata: {url: params},\r\n\t\t\t\t\t\tsuccess: function (data, status, xhr) {\r\n\t\t\t\t\t\t\tvar err = typeof data === 'string' ? null : data;\r\n\r\n\t\t\t\t\t\t\tif(data.length > 5){\r\n\t\t\t\t\t\t\t\tvar pop=L.popup({ maxWidth: 800})\r\n\t\t\t\t\t\t\t\t.setLatLng(evt.latlng)\r\n\t\t\t\t\t\t\t\t.setContent(data).openOn(map);\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (xhr, status, error) {\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif (!teUtfGrid || params.indexOf('instaserver')==-1) {\r\n\t\t\t\t\t\tvar dataF=\"<iframe style=\\\"display: block; width:300px; height:200px;border:none;\\\"  src=\"+params+\" ></iframe></div>\";\r\n\t\t\t\t\t\tvar pop=L.popup({ maxWidth: 800})\r\n\t\t\t\t\t\t\t.setLatLng(evt.latlng)\r\n\t\t\t\t\t\t\t.setContent(dataF).openOn(map);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}//fi querable\r\n\t\treturn;\r\n\t},\r\n\tgetFeatureInfoUrl: function (latlng) {\r\n\t\tvar bounds = this._map.getBounds();\r\n\t\tvar SRS=this.wmsParams.srs;\r\n\t\tvar BBOX=bounds.toBBoxString();\r\n\t\tif(SRS.indexOf('3857')!=-1){\r\n\t\t\tvar NW = L.CRS.EPSG3857.project(bounds.getNorthWest());\r\n\t\t\tvar SE = L.CRS.EPSG3857.project(bounds.getSouthEast());\r\n\t\t\tBBOX=NW.x+\",\"+SE.y+\",\"+SE.x+\",\"+NW.y;\r\n\t\t}\r\n\t\t// Construct a GetFeatureInfo request URL given a point\r\n\t\tvar point = this._map.latLngToContainerPoint(latlng, this._map.getZoom()),\r\n\t\tsize = this._map.getSize(),\r\n\t\tparams = {\r\n\t\t\trequest: 'GetFeatureInfo',\r\n\t\t\tservice: 'WMS',\r\n\t\t\tsrs: SRS,\r\n\t\t\tstyles: this.wmsParams.styles,\r\n\t\t\ttransparent: this.wmsParams.transparent,\r\n\t\t\tversion: this.wmsParams.version,\r\n\t\t\tformat: this.wmsParams.format,\r\n\t\t\tbbox: BBOX,\r\n\t\t\theight: size.y,\r\n\t\t\twidth: size.x,\r\n\t\t\t//exceptions:'application/vnd.ogc.se_blank',\r\n\t\t\tlayers: this.wmsParams.layers,\r\n\t\t\tquery_layers: this.wmsParams.layers,\r\n\t\t\tinfo_format: 'text/html'\r\n\t\t};\r\n\t\tparams[params.version === '1.3.0' ? 'i' : 'x'] = point.x;\r\n\t\tparams[params.version === '1.3.0' ? 'j' : 'y'] = point.y;\r\n\t\treturn this._url + L.Util.getParamString(params, this._url, true);\r\n\t},\r\n\tshowGetFeatureInfo: function (err, latlng, content) {\r\n\t\tif (err) { console.log(err); return; } // do nothing if there's an error\r\n\t\t// Otherwise show the content in a popup, or something.\r\n\t\tL.popup({ maxWidth: 800})\r\n\t\t.setLatLng(latlng)\r\n\t\t.setContent(content)\r\n\t\t.openOn(this._map);\r\n\t},\r\n\tgetLegendGraphic : function () {\r\n\t\t//console.debug(\"getLegendGraphic\");\r\n\t\tvar _format=this.wmsParams.format;\r\n\t\t_format=_format.replace('png8','png');\r\n\t\tvar layers = this.wmsParams.layers.split(\",\");\r\n\t\tif(layers.length === 1){\r\n\t\t\tparams = {\r\n\t\t\t\trequest : 'GetLegendGraphic',\r\n\t\t\t\tservice : 'WMS',\r\n\t\t\t\tversion : this.wmsParams.version,\r\n\t\t\t\tformat : _format,\r\n\t\t\t\tlayer : this.wmsParams.layers\r\n\t\t\t};\r\n\t\t\treturn this._url + L.Util.getParamString(params, this._url, true);\r\n\t\t}else{\r\n\t\t\tvar legend = [];\r\n\t\t\tfor(var i = 0, length = layers.length; i < length; i++){\r\n\t\t\t\tvar layer = layers[i];\r\n\t\t\t\tparams = {\r\n\t\t\t\t\trequest : 'GetLegendGraphic',\r\n\t\t\t\t\tservice : 'WMS',\r\n\t\t\t\t\tversion : this.wmsParams.version,\r\n\t\t\t\t\tformat : _format,\r\n\t\t\t\t\tlayer : layer\r\n\t\t\t\t};\r\n\t\t\t\tlegend.push(this._url + L.Util.getParamString(params, this._url, true));\r\n\t\t\t}\r\n\t\t\treturn legend;\r\n\t\t}\r\n\t\t\r\n\t},\r\n\tcreaControlLLegenda : function (map) {\r\n\t\t//console.debug(\"creaControlLLegenda\");\r\n\t\tvar fet = false;\r\n\t\tif(jQuery('#div_control_wms_llegenda').length==0){\r\n\t\t\tif (map) {\r\n\t\t\t\tcontrol_llegenda_WMS = L.control({\r\n\t\t\t\t\tposition : 'bottomright'\r\n\t\t\t\t});\r\n\t\t\t\tcontrol_llegenda_WMS.onAdd = function(map) {\r\n\t\t\t\t\tthis._div = L.DomUtil.create('div', 'psolar_infoLL'); // create div with a class\r\n\t\t\t\t\tthis._div.id = 'div_control_wms_llegenda';\r\n\t\t\t\t\tthis.update();\r\n\t\t\t\t\treturn this._div;\r\n\t\t\t\t};\r\n\t\t\t\tcontrol_llegenda_WMS.update = function(props) {\r\n\t\t\t\t\tthis._div.innerHTML = props;\r\n\t\t\t\t};\r\n\t\t\t\tcontrol_llegenda_WMS.addTo(map);\r\n\t\t\t\tcontrol_llegenda_WMS.update(\"\");\r\n\t\t\t\tfet = true;\r\n\t\t\t\treturn fet;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn fet;\r\n\t},\r\n\tupdateControlLLegenda :function (params,layer,estat,nom,businessId){\r\n\t\t\r\n\t\t/*\r\n\t\tif(getModeMapa()){//si estic visor i no hi ha llegenda\r\n\t\t\tif($(\"#mapLegend\").length==0 && $(\"#mapLegendEdicio\").length==0){\r\n\t\t\t\taddLegend();\r\n\t\t\t}\r\n\t\t\tif(estat){ //afegeixo\r\n\t\t\t\tvar html = '<div style=\"text-align:center\" id=\"wms_' + businessId + '\"><div class=\"titol-legend col-md-12 col-xs-12\">'+nom+'</div><div class=\"titol-separate-legend-row\"></div>';\r\n\t\t\t\thtml+='<img onerror=\"document.getElementById(\\'wms_' + businessId + '\\').style.display=\\'none\\';\"  src=\"' + params + '\"></div>';\r\n\t\t\t\t//mapLegendEdicio\r\n\t\t\t\tvar divLlegenda='mapLegendEdicio';\r\n\t\t\t\tif($(\"#mapLegend\").length > 0){divLlegenda='mapLegend';}\r\n\t\t\t\t$(\"#\"+divLlegenda).append(html);\t\t\t\r\n\t\t\t\t$(\"#\"+divLlegenda).addClass(\"info\");\r\n\t\t\t\t$(\"#\"+divLlegenda).addClass(\"legend\");\r\n\t\t\t\t$(\"#\"+divLlegenda).addClass(\"visor-legend\");\r\n\t\t\t\tif(!$(\"#mapLegend\").hasClass(\"mCustomScrollbar\") && $(\"#mapLegend\").length > 0){\t\t\t\t\r\n\t\t\t\t\t$(\"#mapLegend\").addClass(\"mCustomScrollbar\");\r\n\t\t\t\t\t$(\"#mapLegend\").mCustomScrollbar();\r\n\t\t\t\t}\r\n\t\t\t\tif(!$(\"#mapLegendEdicio\").hasClass(\"mCustomScrollbar\") && $(\"#mapLegendEdicio\").length > 0){\r\n\t\t\t\t\t$(\"#mapLegendEdicio\").addClass(\"mCustomScrollbar\");\r\n\t\t\t\t\t$(\"#mapLegendEdicio\").mCustomScrollbar();\r\n\t\t\t\t}\r\n\t\t\t\t$(\".bt_legend\").show();\r\n\t\t\t\tactivaLlegenda(true);\r\n\t\t\t}else{ //esborro\r\n\t\t\t\tjQuery('#wms_' + businessId).remove();\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\t\r\n\t}\r\n});\r\n\r\nL.tileLayer.betterWms = function (url, options) {\r\n\treturn new L.TileLayer.BetterWMS(url, options);\r\n};","/*\r\n\tLeaflet.draw, a plugin that adds drawing and editing tools to Leaflet powered maps.\r\n\t(c) 2012-2013, Jacob Toye, Smartrak\r\n\r\n\thttps://github.com/Leaflet/Leaflet.draw\r\n\thttp://leafletjs.com\r\n\thttps://github.com/jacobtoye\r\n*/\r\n(function (window, document, undefined) {/*\r\n * Leaflet.draw assumes that you have already included the Leaflet library.\r\n */\r\n\r\nL.drawVersion = '0.2.4-dev';\r\n\r\nL.drawLocal = {\r\n\tdraw: {\r\n\t\ttoolbar: {\r\n\t\t\tactions: {\r\n\t\t\t\ttitle: 'Cancel drawing',\r\n\t\t\t\ttext: 'Cancel'\r\n\t\t\t},\r\n\t\t\tundo: {\r\n\t\t\t\ttitle: 'Delete last point drawn',\r\n\t\t\t\ttext: 'Delete last point'\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tpolyline: 'Draw a polyline',\r\n\t\t\t\tpolygon: 'Draw a polygon',\r\n\t\t\t\trectangle: 'Draw a rectangle',\r\n\t\t\t\tcircle: 'Draw a circle',\r\n\t\t\t\tmarker: 'Draw a marker'\r\n\t\t\t}\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\tcircle: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tstart: 'Click and drag to draw circle.'\r\n\t\t\t\t},\r\n\t\t\t\tradius: 'Radius'\r\n\t\t\t},\r\n\t\t\tmarker: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tstart: 'Click map to place marker.'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpolygon: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tstart: 'Click to start drawing shape.',\r\n\t\t\t\t\tcont: 'Click to continue drawing shape.',\r\n\t\t\t\t\tend: 'Click first point to close this shape.'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpolyline: {\r\n\t\t\t\terror: '<strong>Error:</strong> shape edges cannot cross!',\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tstart: 'Click to start drawing line.',\r\n\t\t\t\t\tcont: 'Click to continue drawing line.',\r\n\t\t\t\t\tend: 'Click last point to finish line.'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trectangle: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tstart: 'Click and drag to draw rectangle.'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsimpleshape: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tend: 'Release mouse to finish drawing.'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tedit: {\r\n\t\ttoolbar: {\r\n\t\t\tactions: {\r\n\t\t\t\tsave: {\r\n\t\t\t\t\ttitle: 'Save changes.',\r\n\t\t\t\t\ttext: 'Save'\r\n\t\t\t\t},\r\n\t\t\t\tcancel: {\r\n\t\t\t\t\ttitle: 'Cancel editing, discards all changes.',\r\n\t\t\t\t\ttext: 'Cancel'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tedit: 'Edit layers.',\r\n\t\t\t\teditDisabled: 'No layers to edit.',\r\n\t\t\t\tremove: 'Delete layers.',\r\n\t\t\t\tremoveDisabled: 'No layers to delete.'\r\n\t\t\t}\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\tedit: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\ttext: 'Drag handles, or marker to edit feature.',\r\n\t\t\t\t\tsubtext: 'Click cancel to undo changes.'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tremove: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\ttext: 'Click on a feature to remove'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\nL.Draw = {};\r\n\r\nL.Draw.Feature = L.Handler.extend({\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tinitialize: function (map, options) {\r\n\t\tthis._map = map;\r\n\t\tthis._container = map._container;\r\n\t\tthis._overlayPane = map._panes.overlayPane;\r\n\t\tthis._popupPane = map._panes.popupPane;\r\n\r\n\t\t// Merge default shapeOptions options with custom shapeOptions\r\n\t\tif (options && options.shapeOptions) {\r\n\t\t\toptions.shapeOptions = L.Util.extend({}, this.options.shapeOptions, options.shapeOptions);\r\n\t\t}\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled) { return; }\r\n\r\n\t\tL.Handler.prototype.enable.call(this);\r\n\r\n\t\tthis.fire('enabled', { handler: this.type });\r\n\r\n\t\tthis._map.fire('draw:drawstart', { layerType: this.type });\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tL.Handler.prototype.disable.call(this);\r\n\r\n\t\tthis._map.fire('draw:drawstop', { layerType: this.type });\r\n\r\n\t\tthis.fire('disabled', { handler: this.type });\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tL.DomUtil.disableTextSelection();\r\n\r\n\t\t\tmap.getContainer().focus();\r\n\r\n\t\t\tthis._tooltip = new L.Tooltip(this._map);\r\n\r\n\t\t\tL.DomEvent.on(this._container, 'keyup', this._cancelDrawing, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tif (this._map) {\r\n\t\t\tL.DomUtil.enableTextSelection();\r\n\r\n\t\t\tthis._tooltip.dispose();\r\n\t\t\tthis._tooltip = null;\r\n\r\n\t\t\tL.DomEvent.off(this._container, 'keyup', this._cancelDrawing, this);\r\n\t\t}\r\n\t},\r\n\r\n\tsetOptions: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\t_fireCreatedEvent: function (layer) {\r\n\t\tthis._map.fire('draw:created', { layer: layer, layerType: this.type });\r\n\t},\r\n\r\n\t// Cancel drawing when the escape key is pressed\r\n\t_cancelDrawing: function (e) {\r\n\t\tif (e.keyCode === 27) {\r\n\t\t\tthis.disable();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Draw.Polyline = L.Draw.Feature.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'polyline'\r\n\t},\r\n\r\n\tPoly: L.Polyline,\r\n\r\n\toptions: {\r\n\t\tallowIntersection: true,\r\n\t\trepeatMode: false,\r\n\t\tdrawError: {\r\n\t\t\tcolor: '#b00b00',\r\n\t\t\ttimeout: 2500\r\n\t\t},\r\n\t\ticon: new L.DivIcon({\r\n\t\t\ticonSize: new L.Point(8, 8),\r\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon'\r\n\t\t}),\r\n\t\tguidelineDistance: 20,\r\n\t\tmaxGuideLineLength: 4000,\r\n\t\tshapeOptions: {\r\n\t\t\tstroke: true,\r\n\t\t\tcolor: '#f06eaa',\r\n\t\t\tweight: 4,\r\n\t\t\topacity: 0.5,\r\n\t\t\tfill: false,\r\n\t\t\tclickable: true\r\n\t\t},\r\n\t\tmetric: true, // Whether to use the metric meaurement system or imperial\r\n\t\tshowLength: true, // Whether to display distance in the tooltip\r\n\t\tzIndexOffset: 2000 // This should be > than the highest z-index any map layers\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\t// Need to set this here to ensure the correct message is used.\r\n\t\tthis.options.drawError.message = L.drawLocal.draw.handlers.polyline.error;\r\n\r\n\t\t// Merge default drawError options with custom options\r\n\t\tif (options && options.drawError) {\r\n\t\t\toptions.drawError = L.Util.extend({}, this.options.drawError, options.drawError);\r\n\t\t}\r\n\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.Draw.Polyline.TYPE;\r\n\r\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\r\n\t\tif (this._map) {\r\n\t\t\tthis._markers = [];\r\n\r\n\t\t\tthis._markerGroup = new L.LayerGroup();\r\n\t\t\tthis._map.addLayer(this._markerGroup);\r\n\r\n\t\t\tthis._poly = new L.Polyline([], this.options.shapeOptions);\r\n\r\n\t\t\tthis._tooltip.updateContent(this._getTooltipText());\r\n\r\n\t\t\t// Make a transparent marker that will used to catch click events. These click\r\n\t\t\t// events will create the vertices. We need to do this so we can ensure that\r\n\t\t\t// we can create vertices over other map layers (markers, vector layers). We\r\n\t\t\t// also do not want to trigger any click handlers of objects we are clicking on\r\n\t\t\t// while drawing.\r\n\t\t\tif (!this._mouseMarker) {\r\n\t\t\t\tthis._mouseMarker = L.marker(this._map.getCenter(), {\r\n\t\t\t\t\ticon: L.divIcon({\r\n\t\t\t\t\t\tclassName: 'leaflet-mouse-marker',\r\n\t\t\t\t\t\ticonAnchor: [20, 20],\r\n\t\t\t\t\t\ticonSize: [40, 40]\r\n\t\t\t\t\t}),\r\n\t\t\t\t\topacity: 0,\r\n\t\t\t\t\tzIndexOffset: this.options.zIndexOffset\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseMarker\r\n\t\t\t\t.on('mousedown', this._onMouseDown, this)\r\n\t\t\t\t.addTo(this._map);\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.on('mousemove', this._onMouseMove, this)\r\n\t\t\t\t.on('mouseup', this._onMouseUp, this)\r\n\t\t\t\t.on('zoomend', this._onZoomEnd, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\r\n\r\n\t\tthis._clearHideErrorTimeout();\r\n\r\n\t\tthis._cleanUpShape();\r\n\r\n\t\t// remove markers from map\r\n\t\tthis._map.removeLayer(this._markerGroup);\r\n\t\tdelete this._markerGroup;\r\n\t\tdelete this._markers;\r\n\r\n\t\tif(this._poly)\r\n\t\t{\r\n\t\t\r\n\t\t\tthis._map.removeLayer(this._poly);\r\n\t\t\tdelete this._poly;\r\n\r\n\t\t}\r\n\r\n\t\tthis._mouseMarker\r\n\t\t\t.off('mousedown', this._onMouseDown, this)\r\n\t\t\t.off('mouseup', this._onMouseUp, this);\r\n\t\tthis._map.removeLayer(this._mouseMarker);\r\n\t\tdelete this._mouseMarker;\r\n\r\n\t\t// clean up DOM\r\n\t\tthis._clearGuides();\r\n\r\n\t\tthis._map\r\n\t\t\t.off('mousemove', this._onMouseMove, this)\r\n\t\t\t.off('zoomend', this._onZoomEnd, this);\r\n\t},\r\n\r\n\tdeleteLastVertex: function () {\r\n\t\tif (this._markers.length <= 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar lastMarker = this._markers.pop(),\r\n\t\t\tpoly = this._poly,\r\n\t\t\tlatlng = this._poly.spliceLatLngs(poly.getLatLngs().length - 1, 1)[0];\r\n\r\n\t\tthis._markerGroup.removeLayer(lastMarker);\r\n\r\n\t\tif (poly.getLatLngs().length < 2) {\r\n\t\t\tthis._map.removeLayer(poly);\r\n\t\t}\r\n\r\n\t\tthis._vertexChanged(latlng, false);\r\n\t},\r\n\r\n\taddVertex: function (latlng) {\r\n\t\tvar markersLength = this._markers.length;\r\n\r\n\t\tif (markersLength > 0 && !this.options.allowIntersection && this._poly.newLatLngIntersects(latlng)) {\r\n\t\t\tthis._showErrorTooltip();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if (this._errorShown) {\r\n\t\t\tthis._hideErrorTooltip();\r\n\t\t}\r\n\r\n\t\tthis._markers.push(this._createMarker(latlng));\r\n\r\n\t\tthis._poly.addLatLng(latlng);\r\n\r\n\t\tif (this._poly.getLatLngs().length === 2) {\r\n\t\t\tthis._map.addLayer(this._poly);\r\n\t\t}\r\n\r\n\t\tthis._vertexChanged(latlng, true);\r\n\t},\r\n\r\n\t_finishShape: function () {\r\n\t\tvar intersects = this._poly.newLatLngIntersects(this._poly.getLatLngs()[0], true);\r\n\r\n\t\tif ((!this.options.allowIntersection && intersects) || !this._shapeIsValid()) {\r\n\t\t\tthis._showErrorTooltip();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._fireCreatedEvent();\r\n\t\tthis.disable();\r\n\t\tif (this.options.repeatMode) {\r\n\t\t\tthis.enable();\r\n\t\t}\r\n\t},\r\n\r\n\t//Called to verify the shape is valid when the user tries to finish it\r\n\t//Return false if the shape is not valid\r\n\t_shapeIsValid: function () {\r\n\t\treturn true;\r\n\t},\r\n\r\n\t_onZoomEnd: function () {\r\n\t\tthis._updateGuide();\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tvar newPos = e.layerPoint,\r\n\t\t\tlatlng = e.latlng;\r\n\r\n\t\t// Save latlng\r\n\t\t// should this be moved to _updateGuide() ?\r\n\t\tthis._currentLatLng = latlng;\r\n\r\n\t\tthis._updateTooltip(latlng);\r\n\r\n\t\t// Update the guide line\r\n\t\tthis._updateGuide(newPos);\r\n\r\n\t\t// Update the mouse marker position\r\n\t\tthis._mouseMarker.setLatLng(latlng);\r\n\r\n\t\tL.DomEvent.preventDefault(e.originalEvent);\r\n\t},\r\n\r\n\t_vertexChanged: function (latlng, added) {\r\n\t\tthis._updateFinishHandler();\r\n\r\n\t\tthis._updateRunningMeasure(latlng, added);\r\n\r\n\t\tthis._clearGuides();\r\n\r\n\t\tthis._updateTooltip();\r\n\t},\r\n\r\n\t_onMouseDown: function (e) {\r\n\t\tvar originalEvent = e.originalEvent;\r\n\t\tthis._mouseDownOrigin = L.point(originalEvent.clientX, originalEvent.clientY);\r\n\t},\r\n\r\n\t_onMouseUp: function (e) {\r\n\t\tif (this._mouseDownOrigin) {\r\n\t\t\t// We detect clicks within a certain tolerance, otherwise let it\r\n\t\t\t// be interpreted as a drag by the map\r\n\t\t\tvar distance = L.point(e.originalEvent.clientX, e.originalEvent.clientY)\r\n\t\t\t\t.distanceTo(this._mouseDownOrigin);\r\n\t\t\tif (Math.abs(distance) < 9 * (window.devicePixelRatio || 1)) {\r\n\t\t\t\tthis.addVertex(e.latlng);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._mouseDownOrigin = null;\r\n\t},\r\n\r\n\t_updateFinishHandler: function () {\r\n\t\tvar markerCount = this._markers.length;\r\n\t\t// The last marker should have a click handler to close the polyline\r\n\t\tif (markerCount > 1) {\r\n\t\t\tthis._markers[markerCount - 1].on('click', this._finishShape, this);\r\n\t\t}\r\n\r\n\t\t// Remove the old marker click handler (as only the last point should close the polyline)\r\n\t\tif (markerCount > 2) {\r\n\t\t\tthis._markers[markerCount - 2].off('click', this._finishShape, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_createMarker: function (latlng) {\r\n\t\tvar marker = new L.Marker(latlng, {\r\n\t\t\ticon: this.options.icon,\r\n\t\t\tzIndexOffset: this.options.zIndexOffset * 2\r\n\t\t});\r\n\r\n\t\tthis._markerGroup.addLayer(marker);\r\n\r\n\t\treturn marker;\r\n\t},\r\n\r\n\t_updateGuide: function (newPos) {\r\n\t\tvar markerCount = this._markers.length;\r\n\r\n\t\tif (markerCount > 0) {\r\n\t\t\tnewPos = newPos || this._map.latLngToLayerPoint(this._currentLatLng);\r\n\r\n\t\t\t// draw the guide line\r\n\t\t\tthis._clearGuides();\r\n\t\t\tthis._drawGuide(\r\n\t\t\t\tthis._map.latLngToLayerPoint(this._markers[markerCount - 1].getLatLng()),\r\n\t\t\t\tnewPos\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateTooltip: function (latLng) {\r\n\t\tvar text = this._getTooltipText();\r\n\r\n\t\tif (latLng) {\r\n\t\t\tthis._tooltip.updatePosition(latLng);\r\n\t\t}\r\n\r\n\t\tif (!this._errorShown) {\r\n\t\t\tthis._tooltip.updateContent(text);\r\n\t\t}\r\n\t},\r\n\r\n\t_drawGuide: function (pointA, pointB) {\r\n\t\tvar length = Math.floor(Math.sqrt(Math.pow((pointB.x - pointA.x), 2) + Math.pow((pointB.y - pointA.y), 2))),\r\n\t\t\tguidelineDistance = this.options.guidelineDistance,\r\n\t\t\tmaxGuideLineLength = this.options.maxGuideLineLength,\r\n\t\t\t// Only draw a guideline with a max length\r\n\t\t\ti = length > maxGuideLineLength ? length - maxGuideLineLength : guidelineDistance,\r\n\t\t\tfraction,\r\n\t\t\tdashPoint,\r\n\t\t\tdash;\r\n\r\n\t\t//create the guides container if we haven't yet\r\n\t\tif (!this._guidesContainer) {\r\n\t\t\tthis._guidesContainer = L.DomUtil.create('div', 'leaflet-draw-guides', this._overlayPane);\r\n\t\t}\r\n\r\n\t\t//draw a dash every GuildeLineDistance\r\n\t\tfor (; i < length; i += this.options.guidelineDistance) {\r\n\t\t\t//work out fraction along line we are\r\n\t\t\tfraction = i / length;\r\n\r\n\t\t\t//calculate new x,y point\r\n\t\t\tdashPoint = {\r\n\t\t\t\tx: Math.floor((pointA.x * (1 - fraction)) + (fraction * pointB.x)),\r\n\t\t\t\ty: Math.floor((pointA.y * (1 - fraction)) + (fraction * pointB.y))\r\n\t\t\t};\r\n\r\n\t\t\t//add guide dash to guide container\r\n\t\t\tdash = L.DomUtil.create('div', 'leaflet-draw-guide-dash', this._guidesContainer);\r\n\t\t\tdash.style.backgroundColor =\r\n\t\t\t\t!this._errorShown ? this.options.shapeOptions.color : this.options.drawError.color;\r\n\r\n\t\t\tL.DomUtil.setPosition(dash, dashPoint);\r\n\t\t}\r\n\t},\r\n\r\n\t_updateGuideColor: function (color) {\r\n\t\tif (this._guidesContainer) {\r\n\t\t\tfor (var i = 0, l = this._guidesContainer.childNodes.length; i < l; i++) {\r\n\t\t\t\tthis._guidesContainer.childNodes[i].style.backgroundColor = color;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// removes all child elements (guide dashes) from the guides container\r\n\t_clearGuides: function () {\r\n\t\tif (this._guidesContainer) {\r\n\t\t\twhile (this._guidesContainer.firstChild) {\r\n\t\t\t\tthis._guidesContainer.removeChild(this._guidesContainer.firstChild);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getTooltipText: function () {\r\n\t\tvar showLength = this.options.showLength,\r\n\t\t\tlabelText, distanceStr;\r\n\r\n\t\tif (this._markers.length === 0) {\r\n\t\t\tlabelText = {\r\n\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.start\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tdistanceStr = showLength ? this._getMeasurementString() : '';\r\n\r\n\t\t\tif (this._markers.length === 1) {\r\n\t\t\t\tlabelText = {\r\n\t\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.cont,\r\n\t\t\t\t\tsubtext: distanceStr\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tlabelText = {\r\n\t\t\t\t\ttext: L.drawLocal.draw.handlers.polyline.tooltip.end,\r\n\t\t\t\t\tsubtext: distanceStr\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn labelText;\r\n\t},\r\n\r\n\t_updateRunningMeasure: function (latlng, added) {\r\n\t\tvar markersLength = this._markers.length,\r\n\t\t\tpreviousMarkerIndex, distance;\r\n\r\n\t\tif (this._markers.length === 1) {\r\n\t\t\tthis._measurementRunningTotal = 0;\r\n\t\t} else {\r\n\t\t\tpreviousMarkerIndex = markersLength - (added ? 2 : 1);\r\n\t\t\tdistance = latlng.distanceTo(this._markers[previousMarkerIndex].getLatLng());\r\n\r\n\t\t\tthis._measurementRunningTotal += distance * (added ? 1 : -1);\r\n\t\t}\r\n\t},\r\n\r\n\t_getMeasurementString: function () {\r\n\t\tvar currentLatLng = this._currentLatLng,\r\n\t\t\tpreviousLatLng = this._markers[this._markers.length - 1].getLatLng(),\r\n\t\t\tdistance, latlngs = [];\r\n\r\n\t\tfor(var i=0; i<this._markers.length; ++i)\r\n\t\t\tlatlngs.push(this._markers[i].getLatLng());\r\n\r\n\t\tlatlngs.push(this._markers[this._markers.length - 1].getLatLng());\r\n\r\n\t\t// calculate the distance from the last fixed point to the mouse position\r\n\t\tdistance = this._measurementRunningTotal + currentLatLng.distanceTo(previousLatLng);\r\n\t\tdistanceStr = L.GeometryUtil.readableDistance(distance, this.options.metric);\r\n\t\tarea = L.GeometryUtil.geodesicArea(latlngs);\r\n\t\tareaStr = L.GeometryUtil.readableArea(area, this.options.metric);\r\n\r\n\t\treturn window.lang.translate(\"Distància\") + \" \" + distanceStr + \"<br />\" + window.lang.translate(\"Àrea\") + \" \" + areaStr;\r\n\t},\r\n\r\n\t_showErrorTooltip: function () {\r\n\t\tthis._errorShown = true;\r\n\r\n\t\t// Update tooltip\r\n\t\tthis._tooltip\r\n\t\t\t.showAsError()\r\n\t\t\t.updateContent({ text: this.options.drawError.message });\r\n\r\n\t\t// Update shape\r\n\t\tthis._updateGuideColor(this.options.drawError.color);\r\n\t\tthis._poly.setStyle({ color: this.options.drawError.color });\r\n\r\n\t\t// Hide the error after 2 seconds\r\n\t\tthis._clearHideErrorTimeout();\r\n\t\tthis._hideErrorTimeout = setTimeout(L.Util.bind(this._hideErrorTooltip, this), this.options.drawError.timeout);\r\n\t},\r\n\r\n\t_hideErrorTooltip: function () {\r\n\t\tthis._errorShown = false;\r\n\r\n\t\tthis._clearHideErrorTimeout();\r\n\r\n\t\t// Revert tooltip\r\n\t\tthis._tooltip\r\n\t\t\t.removeError()\r\n\t\t\t.updateContent(this._getTooltipText());\r\n\r\n\t\t// Revert shape\r\n\t\tthis._updateGuideColor(this.options.shapeOptions.color);\r\n\t\tthis._poly.setStyle({ color: this.options.shapeOptions.color });\r\n\t},\r\n\r\n\t_clearHideErrorTimeout: function () {\r\n\t\tif (this._hideErrorTimeout) {\r\n\t\t\tclearTimeout(this._hideErrorTimeout);\r\n\t\t\tthis._hideErrorTimeout = null;\r\n\t\t}\r\n\t},\r\n\r\n\t_cleanUpShape: function () {\r\n\t\tif (this._markers.length > 1) {\r\n\t\t\tthis._markers[this._markers.length - 1].off('click', this._finishShape, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_fireCreatedEvent: function () {\r\n\t\tvar poly = new this.Poly(this._poly.getLatLngs(), this.options.shapeOptions);\r\n\t\tL.Draw.Feature.prototype._fireCreatedEvent.call(this, poly);\r\n\t}\r\n});\r\n\r\n\r\nL.Draw.Polygon = L.Draw.Polyline.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'polygon'\r\n\t},\r\n\r\n\tPoly: L.Polygon,\r\n\r\n\toptions: {\r\n\t\tshowArea: false,\r\n\t\tshapeOptions: {\r\n\t\t\tstroke: true,\r\n\t\t\tcolor: '#f06eaa',\r\n\t\t\tweight: 4,\r\n\t\t\topacity: 0.5,\r\n\t\t\tfill: true,\r\n\t\t\tfillColor: null, //same as color by default\r\n\t\t\tfillOpacity: 0.2,\r\n\t\t\tclickable: true\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\tL.Draw.Polyline.prototype.initialize.call(this, map, options);\r\n\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.Draw.Polygon.TYPE;\r\n\t},\r\n\r\n\t_updateFinishHandler: function () {\r\n\t\tvar markerCount = this._markers.length;\r\n\r\n\t\t// The first marker should have a click handler to close the polygon\r\n\t\tif (markerCount === 1) {\r\n\t\t\tthis._markers[0].on('click', this._finishShape, this);\r\n\t\t}\r\n\r\n\t\t// Add and update the double click handler\r\n\t\tif (markerCount > 2) {\r\n\t\t\tthis._markers[markerCount - 1].on('dblclick', this._finishShape, this);\r\n\t\t\t// Only need to remove handler if has been added before\r\n\t\t\tif (markerCount > 3) {\r\n\t\t\t\tthis._markers[markerCount - 2].off('dblclick', this._finishShape, this);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getTooltipText: function () {\r\n\t\tvar text, subtext;\r\n\r\n\t\tif (this._markers.length === 0) {\r\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.start;\r\n\t\t} else if (this._markers.length < 3) {\r\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.cont;\r\n\t\t} else {\r\n\t\t\ttext = L.drawLocal.draw.handlers.polygon.tooltip.end;\r\n\t\t\tsubtext = this._getMeasurementString();\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttext: text,\r\n\t\t\tsubtext: subtext\r\n\t\t};\r\n\t},\r\n\r\n\t_getMeasurementString: function () {\r\n\t\tvar area = this._area;\r\n\r\n\t\tif (!area) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn L.GeometryUtil.readableArea(area, this.options.metric);\r\n\t},\r\n\r\n\t_shapeIsValid: function () {\r\n\t\treturn this._markers.length >= 3;\r\n\t},\r\n\r\n\t_vertexChanged: function (latlng, added) {\r\n\t\tvar latLngs;\r\n\r\n\t\t// Check to see if we should show the area\r\n\t\tif (!this.options.allowIntersection && this.options.showArea) {\r\n\t\t\tlatLngs = this._poly.getLatLngs();\r\n\r\n\t\t\tthis._area = L.GeometryUtil.geodesicArea(latLngs);\r\n\t\t}\r\n\r\n\t\tL.Draw.Polyline.prototype._vertexChanged.call(this, latlng, added);\r\n\t},\r\n\r\n\t_cleanUpShape: function () {\r\n\t\tvar markerCount = this._markers.length;\r\n\r\n\t\tif (markerCount > 0) {\r\n\t\t\tthis._markers[0].off('click', this._finishShape, this);\r\n\r\n\t\t\tif (markerCount > 2) {\r\n\t\t\t\tthis._markers[markerCount - 1].off('dblclick', this._finishShape, this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nL.SimpleShape = {};\r\n\r\nL.Draw.SimpleShape = L.Draw.Feature.extend({\r\n\toptions: {\r\n\t\trepeatMode: false\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\tthis._endLabelText = L.drawLocal.draw.handlers.simpleshape.tooltip.end;\r\n\r\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\r\n\t\tif (this._map) {\r\n\t\t\tthis._mapDraggable = this._map.dragging.enabled();\r\n\r\n\t\t\tif (this._mapDraggable) {\r\n\t\t\t\tthis._map.dragging.disable();\r\n\t\t\t}\r\n\r\n\t\t\t//TODO refactor: move cursor to styles\r\n\t\t\tthis._container.style.cursor = 'crosshair';\r\n\r\n\t\t\tthis._tooltip.updateContent({ text: this._initialLabelText });\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.on('mousedown', this._onMouseDown, this)\r\n\t\t\t\t.on('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\r\n\t\tif (this._map) {\r\n\t\t\tif (this._mapDraggable) {\r\n\t\t\t\tthis._map.dragging.enable();\r\n\t\t\t}\r\n\r\n\t\t\t//TODO refactor: move cursor to styles\r\n\t\t\tthis._container.style.cursor = '';\r\n\r\n\t\t\tthis._map\r\n\t\t\t\t.off('mousedown', this._onMouseDown, this)\r\n\t\t\t\t.off('mousemove', this._onMouseMove, this);\r\n\r\n\t\t\tL.DomEvent.off(document, 'mouseup', this._onMouseUp, this);\r\n\r\n\t\t\t// If the box element doesn't exist they must not have moved the mouse, so don't need to destroy/return\r\n\t\t\tif (this._shape) {\r\n\t\t\t\tthis._map.removeLayer(this._shape);\r\n\t\t\t\tdelete this._shape;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._isDrawing = false;\r\n\t},\r\n\r\n\t_getTooltipText: function () {\r\n\t\treturn {\r\n\t\t\ttext: this._endLabelText\r\n\t\t};\r\n\t},\r\n\r\n\t_onMouseDown: function (e) {\r\n\t\tthis._isDrawing = true;\r\n\t\tthis._startLatLng = e.latlng;\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.on(document, 'mouseup', this._onMouseUp, this)\r\n\t\t\t.preventDefault(e.originalEvent);\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tvar latlng = e.latlng;\r\n\r\n\t\tthis._tooltip.updatePosition(latlng);\r\n\t\tif (this._isDrawing) {\r\n\t\t\tthis._tooltip.updateContent(this._getTooltipText());\r\n\t\t\tthis._drawShape(latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseUp: function () {\r\n\t\tif (this._shape) {\r\n\t\t\tthis._fireCreatedEvent();\r\n\t\t}\r\n\r\n\t\tthis.disable();\r\n\t\tif (this.options.repeatMode) {\r\n\t\t\tthis.enable();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Draw.Rectangle = L.Draw.SimpleShape.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'rectangle'\r\n\t},\r\n\r\n\toptions: {\r\n\t\tshapeOptions: {\r\n\t\t\tstroke: true,\r\n\t\t\tcolor: '#f06eaa',\r\n\t\t\tweight: 4,\r\n\t\t\topacity: 0.5,\r\n\t\t\tfill: true,\r\n\t\t\tfillColor: null, //same as color by default\r\n\t\t\tfillOpacity: 0.2,\r\n\t\t\tclickable: true\r\n\t\t},\r\n\t\tmetric: true // Whether to use the metric meaurement system or imperial\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.Draw.Rectangle.TYPE;\r\n\r\n\t\tthis._initialLabelText = L.drawLocal.draw.handlers.rectangle.tooltip.start;\r\n\r\n\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\r\n\t},\r\n\r\n\t_drawShape: function (latlng) {\r\n\t\tif (!this._shape) {\r\n\t\t\tthis._shape = new L.Rectangle(new L.LatLngBounds(this._startLatLng, latlng), this.options.shapeOptions);\r\n\t\t\tthis._map.addLayer(this._shape);\r\n\t\t} else {\r\n\t\t\tthis._shape.setBounds(new L.LatLngBounds(this._startLatLng, latlng));\r\n\t\t}\r\n\t},\r\n\r\n\t_fireCreatedEvent: function () {\r\n\t\tvar rectangle = new L.Rectangle(this._shape.getBounds(), this.options.shapeOptions);\r\n\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, rectangle);\r\n\t},\r\n\r\n\t_getTooltipText: function () {\r\n\t\tvar tooltipText = L.Draw.SimpleShape.prototype._getTooltipText.call(this),\r\n\t\t\tshape = this._shape,\r\n\t\t\tlatLngs, area, subtext;\r\n\r\n\t\tif (shape) {\r\n\t\t\tlatLngs = this._shape.getLatLngs();\r\n\t\t\tarea = L.GeometryUtil.geodesicArea(latLngs);\r\n\t\t\tsubtext = L.GeometryUtil.readableArea(area, this.options.metric);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttext: tooltipText.text,\r\n\t\t\tsubtext: subtext\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\nL.Draw.Circle = L.Draw.SimpleShape.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'circle'\r\n\t},\r\n\r\n\toptions: {\r\n\t\tshapeOptions: {\r\n\t\t\tstroke: true,\r\n\t\t\tcolor: '#f06eaa',\r\n\t\t\tweight: 4,\r\n\t\t\topacity: 0.5,\r\n\t\t\tfill: true,\r\n\t\t\tfillColor: null, //same as color by default\r\n\t\t\tfillOpacity: 0.2,\r\n\t\t\tclickable: true\r\n\t\t},\r\n\t\tshowRadius: true,\r\n\t\tmetric: true // Whether to use the metric meaurement system or imperial\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.Draw.Circle.TYPE;\r\n\r\n\t\tthis._initialLabelText = L.drawLocal.draw.handlers.circle.tooltip.start;\r\n\r\n\t\tL.Draw.SimpleShape.prototype.initialize.call(this, map, options);\r\n\t},\r\n\r\n\t_drawShape: function (latlng) {\r\n\t\tif (!this._shape) {\r\n\t\t\tthis._shape = new L.Circle(this._startLatLng, this._startLatLng.distanceTo(latlng), this.options.shapeOptions);\r\n\t\t\tthis._map.addLayer(this._shape);\r\n\t\t} else {\r\n\t\t\tthis._shape.setRadius(this._startLatLng.distanceTo(latlng));\r\n\t\t}\r\n\t},\r\n\r\n\t_fireCreatedEvent: function () {\r\n\t\tvar circle = new L.Circle(this._startLatLng, this._shape.getRadius(), this.options.shapeOptions);\r\n\t\tL.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, circle);\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tvar latlng = e.latlng,\r\n\t\t\tshowRadius = this.options.showRadius,\r\n\t\t\tuseMetric = this.options.metric,\r\n\t\t\tradius;\r\n\r\n\t\tthis._tooltip.updatePosition(latlng);\r\n\t\tif (this._isDrawing) {\r\n\t\t\tthis._drawShape(latlng);\r\n\r\n\t\t\t// Get the new radius (rounded to 1 dp)\r\n\t\t\tradius = this._shape.getRadius().toFixed(1);\r\n\r\n\t\t\tthis._tooltip.updateContent({\r\n\t\t\t\ttext: this._endLabelText,\r\n\t\t\t\tsubtext: showRadius ? L.drawLocal.draw.handlers.circle.radius + ': ' + L.GeometryUtil.readableDistance(radius, useMetric) : ''\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nL.Draw.Marker = L.Draw.Feature.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'marker'\r\n\t},\r\n\r\n\toptions: {\r\n\t\ticon: new L.Icon.Default(),\r\n\t\trepeatMode: false,\r\n\t\tzIndexOffset: 2000 // This should be > than the highest z-index any markers\r\n\t},\r\n\r\n\tinitialize: function (map, options) {\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.Draw.Marker.TYPE;\r\n\r\n\t\tL.Draw.Feature.prototype.initialize.call(this, map, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tL.Draw.Feature.prototype.addHooks.call(this);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tthis._tooltip.updateContent({ text: L.drawLocal.draw.handlers.marker.tooltip.start });\r\n\r\n\t\t\t// Same mouseMarker as in Draw.Polyline\r\n\t\t\tif (!this._mouseMarker) {\r\n\t\t\t\tthis._mouseMarker = L.marker(this._map.getCenter(), {\r\n\t\t\t\t\ticon: L.divIcon({\r\n\t\t\t\t\t\tclassName: 'leaflet-mouse-marker',\r\n\t\t\t\t\t\ticonAnchor: [20, 20],\r\n\t\t\t\t\t\ticonSize: [40, 40]\r\n\t\t\t\t\t}),\r\n\t\t\t\t\topacity: 0,\r\n\t\t\t\t\tzIndexOffset: this.options.zIndexOffset\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseMarker\r\n\t\t\t\t.on('click', this._onClick, this)\r\n\t\t\t\t.addTo(this._map);\r\n\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tL.Draw.Feature.prototype.removeHooks.call(this);\r\n\r\n\t\tif (this._map) {\r\n\t\t\tif (this._marker) {\r\n\t\t\t\tthis._marker.off('click', this._onClick, this);\r\n\t\t\t\tthis._map\r\n\t\t\t\t\t.off('click', this._onClick, this)\r\n\t\t\t\t\t.removeLayer(this._marker);\r\n\t\t\t\tdelete this._marker;\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseMarker.off('click', this._onClick, this);\r\n\t\t\tthis._map.removeLayer(this._mouseMarker);\r\n\t\t\tdelete this._mouseMarker;\r\n\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tvar latlng = e.latlng;\r\n\r\n\t\tthis._tooltip.updatePosition(latlng);\r\n\t\tthis._mouseMarker.setLatLng(latlng);\r\n\r\n\t\tif (!this._marker) {\r\n\t\t\tthis._marker = new L.Marker(latlng, {\r\n\t\t\t\ticon: this.options.icon,\r\n\t\t\t\tzIndexOffset: this.options.zIndexOffset\r\n\t\t\t});\r\n\t\t\t// Bind to both marker and map to make sure we get the click event.\r\n\t\t\tthis._marker.on('click', this._onClick, this);\r\n\t\t\tthis._map\r\n\t\t\t\t.on('click', this._onClick, this)\r\n\t\t\t\t.addLayer(this._marker);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlatlng = this._mouseMarker.getLatLng();\r\n\t\t\tthis._marker.setLatLng(latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t_onClick: function () {\r\n\t\tthis._fireCreatedEvent();\r\n\r\n\t\tthis.disable();\r\n\t\tif (this.options.repeatMode) {\r\n\t\t\tthis.enable();\r\n\t\t}\r\n\t},\r\n\r\n\t_fireCreatedEvent: function () {\r\n\t\tvar marker = new L.Marker(this._marker.getLatLng(), { icon: this.options.icon });\r\n\t\tL.Draw.Feature.prototype._fireCreatedEvent.call(this, marker);\r\n\t}\r\n});\r\n\r\n\r\nL.Edit = L.Edit || {};\r\n\r\nL.Edit.Marker = L.Handler.extend({\r\n\tinitialize: function (marker, options) {\r\n\t\tthis._marker = marker;\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar marker = this._marker;\r\n\r\n\t\tmarker.dragging.enable();\r\n\t\tmarker.on('dragend', this._onDragEnd, marker);\r\n\t\tthis._toggleMarkerHighlight();\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tvar marker = this._marker;\r\n\r\n\t\tmarker.dragging.disable();\r\n\t\tmarker.off('dragend', this._onDragEnd, marker);\r\n\t\tthis._toggleMarkerHighlight();\r\n\t},\r\n\r\n\t_onDragEnd: function (e) {\r\n\t\tvar layer = e.target;\r\n\t\tlayer.edited = true;\r\n\t},\r\n\r\n\t_toggleMarkerHighlight: function () {\r\n\r\n\t\t// Don't do anything if this layer is a marker but doesn't have an icon. Markers\r\n\t\t// should usually have icons. If using Leaflet.draw with Leafler.markercluster there\r\n\t\t// is a chance that a marker doesn't.\r\n\t\tif (!this._icon) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// This is quite naughty, but I don't see another way of doing it. (short of setting a new icon)\r\n\t\tvar icon = this._icon;\r\n\r\n\t\ticon.style.display = 'none';\r\n\r\n\t\tif (L.DomUtil.hasClass(icon, 'leaflet-edit-marker-selected')) {\r\n\t\t\tL.DomUtil.removeClass(icon, 'leaflet-edit-marker-selected');\r\n\t\t\t// Offset as the border will make the icon move.\r\n\t\t\tthis._offsetMarker(icon, 0);\r\n\r\n\t\t} else {\r\n\t\t\tL.DomUtil.addClass(icon, 'leaflet-edit-marker-selected');\r\n\t\t\t// Offset as the border will make the icon move.\r\n\t\t\tthis._offsetMarker(icon, 0);\r\n\t\t}\r\n\r\n\t\ticon.style.display = '';\r\n\t},\r\n\r\n\t_offsetMarker: function (icon, offset) {\r\n\t\tvar iconMarginTop = parseInt(icon.style.marginTop, 10) - offset,\r\n\t\t\ticonMarginLeft = parseInt(icon.style.marginLeft, 10) - offset;\r\n\r\n\t\ticon.style.marginTop = iconMarginTop + 'px';\r\n\t\ticon.style.marginLeft = iconMarginLeft + 'px';\r\n\t}\r\n});\r\n\r\nL.Marker.addInitHook(function () {\r\n\tif (L.Edit.Marker) {\r\n\t\tthis.editing = new L.Edit.Marker(this);\r\n\r\n\t\tif (this.options.editable) {\r\n\t\t\tthis.editing.enable();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nL.Edit = L.Edit || {};\r\n\r\n/*\r\n * L.Edit.Poly is an editing handler for polylines and polygons.\r\n */\r\n\r\nL.Edit.Poly = L.Handler.extend({\r\n\toptions: {\r\n\t\ticon: new L.DivIcon({\r\n\t\t\ticonSize: new L.Point(8, 8),\r\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon'\r\n\t\t})\r\n\t},\r\n\r\n\tinitialize: function (poly, options) {\r\n\t\tthis._poly = poly;\r\n\t\tL.setOptions(this, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar poly = this._poly;\r\n\r\n\t\tif (!(poly instanceof L.Polygon)) {\r\n\t\t\tif (poly.options.editing!=undefined) {\r\n\t\t\t\tpoly.options.editing.fill = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpoly.setStyle(poly.options.editing);\r\n\r\n\t\tif (this._poly._map) {\r\n\t\t\tif (!this._markerGroup) {\r\n\t\t\t\tthis._initMarkers();\r\n\t\t\t}\r\n\t\t\tthis._poly._map.addLayer(this._markerGroup);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tvar poly = this._poly;\r\n\r\n\t\tpoly.setStyle(poly.options.original);\r\n\r\n\t\tif (poly._map) {\r\n\t\t\tpoly._map.removeLayer(this._markerGroup);\r\n\t\t\tdelete this._markerGroup;\r\n\t\t\tdelete this._markers;\r\n\t\t}\r\n\t},\r\n\r\n\tupdateMarkers: function () {\r\n\t\tthis._markerGroup.clearLayers();\r\n\t\tthis._initMarkers();\r\n\t},\r\n\r\n\t_initMarkers: function () {\r\n\t\tif (!this._markerGroup) {\r\n\t\t\tthis._markerGroup = new L.LayerGroup();\r\n\t\t}\r\n\t\tthis._markers = [];\r\n\r\n\t\tvar latlngs = this._poly._latlngs,\r\n\t\t\ti, j, len, marker;\r\n\r\n\t\t// TODO refactor holes implementation in Polygon to support it here\r\n\r\n\t\tfor (i = 0, len = latlngs.length; i < len; i++) {\r\n\r\n\t\t\tmarker = this._createMarker(latlngs[i], i);\r\n\t\t\tmarker.on('click', this._onMarkerClick, this);\r\n\t\t\tthis._markers.push(marker);\r\n\t\t}\r\n\r\n\t\tvar markerLeft, markerRight;\r\n\r\n\t\tfor (i = 0, j = len - 1; i < len; j = i++) {\r\n\t\t\tif (i === 0 && !(L.Polygon && (this._poly instanceof L.Polygon))) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tmarkerLeft = this._markers[j];\r\n\t\t\tmarkerRight = this._markers[i];\r\n\r\n\t\t\tthis._createMiddleMarker(markerLeft, markerRight);\r\n\t\t\tthis._updatePrevNext(markerLeft, markerRight);\r\n\t\t}\r\n\t},\r\n\r\n\t_createMarker: function (latlng, index) {\r\n\t\tvar marker = new L.Marker(latlng, {\r\n\t\t\tdraggable: true,\r\n\t\t\ticon: this.options.icon\r\n\t\t});\r\n\r\n\t\tmarker._origLatLng = latlng;\r\n\t\tmarker._index = index;\r\n\r\n\t\tmarker.on('drag', this._onMarkerDrag, this);\r\n\t\tmarker.on('dragend', this._fireEdit, this);\r\n\r\n\t\tthis._markerGroup.addLayer(marker);\r\n\r\n\t\treturn marker;\r\n\t},\r\n\r\n\t_removeMarker: function (marker) {\r\n\t\tvar i = marker._index;\r\n\r\n\t\tthis._markerGroup.removeLayer(marker);\r\n\t\tthis._markers.splice(i, 1);\r\n\t\tthis._poly.spliceLatLngs(i, 1);\r\n\t\tthis._updateIndexes(i, -1);\r\n\r\n\t\tmarker\r\n\t\t\t.off('drag', this._onMarkerDrag, this)\r\n\t\t\t.off('dragend', this._fireEdit, this)\r\n\t\t\t.off('click', this._onMarkerClick, this);\r\n\t},\r\n\r\n\t_fireEdit: function () {\r\n\t\tthis._poly.edited = true;\r\n\t\tthis._poly.fire('edit');\r\n\t},\r\n\r\n\t_onMarkerDrag: function (e) {\r\n\t\tvar marker = e.target;\r\n\r\n\t\tL.extend(marker._origLatLng, marker._latlng);\r\n\r\n\t\tif (marker._middleLeft) {\r\n\t\t\tmarker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));\r\n\t\t}\r\n\t\tif (marker._middleRight) {\r\n\t\t\tmarker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));\r\n\t\t}\r\n\r\n\t\tthis._poly.redraw();\r\n\t},\r\n\r\n\t_onMarkerClick: function (e) {\r\n\t\tvar minPoints = L.Polygon && (this._poly instanceof L.Polygon) ? 4 : 3,\r\n\t\t\tmarker = e.target;\r\n\r\n\t\t// If removing this point would create an invalid polyline/polygon don't remove\r\n\t\tif (this._poly._latlngs.length < minPoints) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// remove the marker\r\n\t\tthis._removeMarker(marker);\r\n\r\n\t\t// update prev/next links of adjacent markers\r\n\t\tthis._updatePrevNext(marker._prev, marker._next);\r\n\r\n\t\t// remove ghost markers near the removed marker\r\n\t\tif (marker._middleLeft) {\r\n\t\t\tthis._markerGroup.removeLayer(marker._middleLeft);\r\n\t\t}\r\n\t\tif (marker._middleRight) {\r\n\t\t\tthis._markerGroup.removeLayer(marker._middleRight);\r\n\t\t}\r\n\r\n\t\t// create a ghost marker in place of the removed one\r\n\t\tif (marker._prev && marker._next) {\r\n\t\t\tthis._createMiddleMarker(marker._prev, marker._next);\r\n\r\n\t\t} else if (!marker._prev) {\r\n\t\t\tmarker._next._middleLeft = null;\r\n\r\n\t\t} else if (!marker._next) {\r\n\t\t\tmarker._prev._middleRight = null;\r\n\t\t}\r\n\r\n\t\tthis._fireEdit();\r\n\t},\r\n\r\n\t_updateIndexes: function (index, delta) {\r\n\t\tthis._markerGroup.eachLayer(function (marker) {\r\n\t\t\tif (marker._index > index) {\r\n\t\t\t\tmarker._index += delta;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t_createMiddleMarker: function (marker1, marker2) {\r\n\t\tvar latlng = this._getMiddleLatLng(marker1, marker2),\r\n\t\t    marker = this._createMarker(latlng),\r\n\t\t    onClick,\r\n\t\t    onDragStart,\r\n\t\t    onDragEnd;\r\n\r\n\t\tmarker.setOpacity(0.6);\r\n\r\n\t\tmarker1._middleRight = marker2._middleLeft = marker;\r\n\r\n\t\tonDragStart = function () {\r\n\t\t\tvar i = marker2._index;\r\n\r\n\t\t\tmarker._index = i;\r\n\r\n\t\t\tmarker\r\n\t\t\t    .off('click', onClick, this)\r\n\t\t\t    .on('click', this._onMarkerClick, this);\r\n\r\n\t\t\tlatlng.lat = marker.getLatLng().lat;\r\n\t\t\tlatlng.lng = marker.getLatLng().lng;\r\n\t\t\tthis._poly.spliceLatLngs(i, 0, latlng);\r\n\t\t\tthis._markers.splice(i, 0, marker);\r\n\r\n\t\t\tmarker.setOpacity(1);\r\n\r\n\t\t\tthis._updateIndexes(i, 1);\r\n\t\t\tmarker2._index++;\r\n\t\t\tthis._updatePrevNext(marker1, marker);\r\n\t\t\tthis._updatePrevNext(marker, marker2);\r\n\r\n\t\t\tthis._poly.fire('editstart');\r\n\t\t};\r\n\r\n\t\tonDragEnd = function () {\r\n\t\t\tmarker.off('dragstart', onDragStart, this);\r\n\t\t\tmarker.off('dragend', onDragEnd, this);\r\n\r\n\t\t\tthis._createMiddleMarker(marker1, marker);\r\n\t\t\tthis._createMiddleMarker(marker, marker2);\r\n\t\t};\r\n\r\n\t\tonClick = function () {\r\n\t\t\tonDragStart.call(this);\r\n\t\t\tonDragEnd.call(this);\r\n\t\t\tthis._fireEdit();\r\n\t\t};\r\n\r\n\t\tmarker\r\n\t\t    .on('click', onClick, this)\r\n\t\t    .on('dragstart', onDragStart, this)\r\n\t\t    .on('dragend', onDragEnd, this);\r\n\r\n\t\tthis._markerGroup.addLayer(marker);\r\n\t},\r\n\r\n\t_updatePrevNext: function (marker1, marker2) {\r\n\t\tif (marker1) {\r\n\t\t\tmarker1._next = marker2;\r\n\t\t}\r\n\t\tif (marker2) {\r\n\t\t\tmarker2._prev = marker1;\r\n\t\t}\r\n\t},\r\n\r\n\t_getMiddleLatLng: function (marker1, marker2) {\r\n\t\tvar map = this._poly._map,\r\n\t\t    p1 = map.project(marker1.getLatLng()),\r\n\t\t    p2 = map.project(marker2.getLatLng());\r\n\r\n\t\treturn map.unproject(p1._add(p2)._divideBy(2));\r\n\t}\r\n});\r\n\r\nL.Polyline.addInitHook(function () {\r\n\r\n\t// Check to see if handler has already been initialized. This is to support versions of Leaflet that still have L.Handler.PolyEdit\r\n\tif (this.editing) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (L.Edit.Poly) {\r\n\t\tthis.editing = new L.Edit.Poly(this);\r\n\r\n\t\tif (this.options.editable) {\r\n\t\t\tthis.editing.enable();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.on('add', function () {\r\n\t\tif (this.editing && this.editing.enabled()) {\r\n\t\t\tthis.editing.addHooks();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('remove', function () {\r\n\t\tif (this.editing && this.editing.enabled()) {\r\n\t\t\tthis.editing.removeHooks();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n\r\nL.Edit = L.Edit || {};\r\n\r\nL.Edit.SimpleShape = L.Handler.extend({\r\n\toptions: {\r\n\t\tmoveIcon: new L.DivIcon({\r\n\t\t\ticonSize: new L.Point(8, 8),\r\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move'\r\n\t\t}),\r\n\t\tresizeIcon: new L.DivIcon({\r\n\t\t\ticonSize: new L.Point(8, 8),\r\n\t\t\tclassName: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize'\r\n\t\t})\r\n\t},\r\n\r\n\tinitialize: function (shape, options) {\r\n\t\tthis._shape = shape;\r\n\t\tL.Util.setOptions(this, options);\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar shape = this._shape;\r\n\r\n\t\tshape.setStyle(shape.options.editing);\r\n\r\n\t\tif (shape._map) {\r\n\t\t\tthis._map = shape._map;\r\n\r\n\t\t\tif (!this._markerGroup) {\r\n\t\t\t\tthis._initMarkers();\r\n\t\t\t}\r\n\t\t\tthis._map.addLayer(this._markerGroup);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tvar shape = this._shape;\r\n\r\n\t\tshape.setStyle(shape.options.original);\r\n\r\n\t\tif (shape._map) {\r\n\t\t\tthis._unbindMarker(this._moveMarker);\r\n\r\n\t\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\r\n\t\t\t\tthis._unbindMarker(this._resizeMarkers[i]);\r\n\t\t\t}\r\n\t\t\tthis._resizeMarkers = null;\r\n\r\n\t\t\tthis._map.removeLayer(this._markerGroup);\r\n\t\t\tdelete this._markerGroup;\r\n\t\t}\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tupdateMarkers: function () {\r\n\t\tthis._markerGroup.clearLayers();\r\n\t\tthis._initMarkers();\r\n\t},\r\n\r\n\t_initMarkers: function () {\r\n\t\tif (!this._markerGroup) {\r\n\t\t\tthis._markerGroup = new L.LayerGroup();\r\n\t\t}\r\n\r\n\t\t// Create center marker\r\n\t\tthis._createMoveMarker();\r\n\r\n\t\t// Create edge marker\r\n\t\tthis._createResizeMarker();\r\n\t},\r\n\r\n\t_createMoveMarker: function () {\r\n\t\t// Children override\r\n\t},\r\n\r\n\t_createResizeMarker: function () {\r\n\t\t// Children override\r\n\t},\r\n\r\n\t_createMarker: function (latlng, icon) {\r\n\t\tvar marker = new L.Marker(latlng, {\r\n\t\t\tdraggable: true,\r\n\t\t\ticon: icon,\r\n\t\t\tzIndexOffset: 10\r\n\t\t});\r\n\r\n\t\tthis._bindMarker(marker);\r\n\r\n\t\tthis._markerGroup.addLayer(marker);\r\n\r\n\t\treturn marker;\r\n\t},\r\n\r\n\t_bindMarker: function (marker) {\r\n\t\tmarker\r\n\t\t\t.on('dragstart', this._onMarkerDragStart, this)\r\n\t\t\t.on('drag', this._onMarkerDrag, this)\r\n\t\t\t.on('dragend', this._onMarkerDragEnd, this);\r\n\t},\r\n\r\n\t_unbindMarker: function (marker) {\r\n\t\tmarker\r\n\t\t\t.off('dragstart', this._onMarkerDragStart, this)\r\n\t\t\t.off('drag', this._onMarkerDrag, this)\r\n\t\t\t.off('dragend', this._onMarkerDragEnd, this);\r\n\t},\r\n\r\n\t_onMarkerDragStart: function (e) {\r\n\t\tvar marker = e.target;\r\n\t\tmarker.setOpacity(0);\r\n\r\n\t\tthis._shape.fire('editstart');\r\n\t},\r\n\r\n\t_fireEdit: function () {\r\n\t\tthis._shape.edited = true;\r\n\t\tthis._shape.fire('edit');\r\n\t},\r\n\r\n\t_onMarkerDrag: function (e) {\r\n\t\tvar marker = e.target,\r\n\t\t\tlatlng = marker.getLatLng();\r\n\r\n\t\tif (marker === this._moveMarker) {\r\n\t\t\tthis._move(latlng);\r\n\t\t} else {\r\n\t\t\tthis._resize(latlng);\r\n\t\t}\r\n\r\n\t\tthis._shape.redraw();\r\n\t},\r\n\r\n\t_onMarkerDragEnd: function (e) {\r\n\t\tvar marker = e.target;\r\n\t\tmarker.setOpacity(1);\r\n\r\n\t\tthis._fireEdit();\r\n\t},\r\n\r\n\t_move: function () {\r\n\t\t// Children override\r\n\t},\r\n\r\n\t_resize: function () {\r\n\t\t// Children override\r\n\t}\r\n});\r\n\r\n\r\nL.Edit = L.Edit || {};\r\n\r\nL.Edit.Rectangle = L.Edit.SimpleShape.extend({\r\n\t_createMoveMarker: function () {\r\n\t\tvar bounds = this._shape.getBounds(),\r\n\t\t\tcenter = bounds.getCenter();\r\n\r\n\t\tthis._moveMarker = this._createMarker(center, this.options.moveIcon);\r\n\t},\r\n\r\n\t_createResizeMarker: function () {\r\n\t\tvar corners = this._getCorners();\r\n\r\n\t\tthis._resizeMarkers = [];\r\n\r\n\t\tfor (var i = 0, l = corners.length; i < l; i++) {\r\n\t\t\tthis._resizeMarkers.push(this._createMarker(corners[i], this.options.resizeIcon));\r\n\t\t\t// Monkey in the corner index as we will need to know this for dragging\r\n\t\t\tthis._resizeMarkers[i]._cornerIndex = i;\r\n\t\t}\r\n\t},\r\n\r\n\t_onMarkerDragStart: function (e) {\r\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);\r\n\r\n\t\t// Save a reference to the opposite point\r\n\t\tvar corners = this._getCorners(),\r\n\t\t\tmarker = e.target,\r\n\t\t\tcurrentCornerIndex = marker._cornerIndex;\r\n\r\n\t\tthis._oppositeCorner = corners[(currentCornerIndex + 2) % 4];\r\n\r\n\t\tthis._toggleCornerMarkers(0, currentCornerIndex);\r\n\t},\r\n\r\n\t_onMarkerDragEnd: function (e) {\r\n\t\tvar marker = e.target,\r\n\t\t\tbounds, center;\r\n\r\n\t\t// Reset move marker position to the center\r\n\t\tif (marker === this._moveMarker) {\r\n\t\t\tbounds = this._shape.getBounds();\r\n\t\t\tcenter = bounds.getCenter();\r\n\r\n\t\t\tmarker.setLatLng(center);\r\n\t\t}\r\n\r\n\t\tthis._toggleCornerMarkers(1);\r\n\r\n\t\tthis._repositionCornerMarkers();\r\n\r\n\t\tL.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this, e);\r\n\t},\r\n\r\n\t_move: function (newCenter) {\r\n\t\tvar latlngs = this._shape.getLatLngs(),\r\n\t\t\tbounds = this._shape.getBounds(),\r\n\t\t\tcenter = bounds.getCenter(),\r\n\t\t\toffset, newLatLngs = [];\r\n\r\n\t\t// Offset the latlngs to the new center\r\n\t\tfor (var i = 0, l = latlngs.length; i < l; i++) {\r\n\t\t\toffset = [latlngs[i].lat - center.lat, latlngs[i].lng - center.lng];\r\n\t\t\tnewLatLngs.push([newCenter.lat + offset[0], newCenter.lng + offset[1]]);\r\n\t\t}\r\n\r\n\t\tthis._shape.setLatLngs(newLatLngs);\r\n\r\n\t\t// Reposition the resize markers\r\n\t\tthis._repositionCornerMarkers();\r\n\t},\r\n\r\n\t_resize: function (latlng) {\r\n\t\tvar bounds;\r\n\r\n\t\t// Update the shape based on the current position of this corner and the opposite point\r\n\t\tthis._shape.setBounds(L.latLngBounds(latlng, this._oppositeCorner));\r\n\r\n\t\t// Reposition the move marker\r\n\t\tbounds = this._shape.getBounds();\r\n\t\tthis._moveMarker.setLatLng(bounds.getCenter());\r\n\t},\r\n\r\n\t_getCorners: function () {\r\n\t\tvar bounds = this._shape.getBounds(),\r\n\t\t\tnw = bounds.getNorthWest(),\r\n\t\t\tne = bounds.getNorthEast(),\r\n\t\t\tse = bounds.getSouthEast(),\r\n\t\t\tsw = bounds.getSouthWest();\r\n\r\n\t\treturn [nw, ne, se, sw];\r\n\t},\r\n\r\n\t_toggleCornerMarkers: function (opacity) {\r\n\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\r\n\t\t\tthis._resizeMarkers[i].setOpacity(opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_repositionCornerMarkers: function () {\r\n\t\tvar corners = this._getCorners();\r\n\r\n\t\tfor (var i = 0, l = this._resizeMarkers.length; i < l; i++) {\r\n\t\t\tthis._resizeMarkers[i].setLatLng(corners[i]);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Rectangle.addInitHook(function () {\r\n\tif (L.Edit.Rectangle) {\r\n\t\tthis.editing = new L.Edit.Rectangle(this);\r\n\r\n\t\tif (this.options.editable) {\r\n\t\t\tthis.editing.enable();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nL.Edit = L.Edit || {};\r\n\r\nL.Edit.Circle = L.Edit.SimpleShape.extend({\r\n\t_createMoveMarker: function () {\r\n\t\tvar center = this._shape.getLatLng();\r\n\r\n\t\tthis._moveMarker = this._createMarker(center, this.options.moveIcon);\r\n\t},\r\n\r\n\t_createResizeMarker: function () {\r\n\t\tvar center = this._shape.getLatLng(),\r\n\t\t\tresizemarkerPoint = this._getResizeMarkerPoint(center);\r\n\r\n\t\tthis._resizeMarkers = [];\r\n\t\tthis._resizeMarkers.push(this._createMarker(resizemarkerPoint, this.options.resizeIcon));\r\n\t},\r\n\r\n\t_getResizeMarkerPoint: function (latlng) {\r\n\t\t// From L.shape.getBounds()\r\n\t\tvar delta = this._shape._radius * Math.cos(Math.PI / 4),\r\n\t\t\tpoint = this._map.project(latlng);\r\n\t\treturn this._map.unproject([point.x + delta, point.y - delta]);\r\n\t},\r\n\r\n\t_move: function (latlng) {\r\n\t\tvar resizemarkerPoint = this._getResizeMarkerPoint(latlng);\r\n\r\n\t\t// Move the resize marker\r\n\t\tthis._resizeMarkers[0].setLatLng(resizemarkerPoint);\r\n\r\n\t\t// Move the circle\r\n\t\tthis._shape.setLatLng(latlng);\r\n\t},\r\n\r\n\t_resize: function (latlng) {\r\n\t\tvar moveLatLng = this._moveMarker.getLatLng(),\r\n\t\t\tradius = moveLatLng.distanceTo(latlng);\r\n\r\n\t\tthis._shape.setRadius(radius);\r\n\t}\r\n});\r\n\r\nL.Circle.addInitHook(function () {\r\n\tif (L.Edit.Circle) {\r\n\t\tthis.editing = new L.Edit.Circle(this);\r\n\r\n\t\tif (this.options.editable) {\r\n\t\t\tthis.editing.enable();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.on('add', function () {\r\n\t\tif (this.editing && this.editing.enabled()) {\r\n\t\t\tthis.editing.addHooks();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('remove', function () {\r\n\t\tif (this.editing && this.editing.enabled()) {\r\n\t\t\tthis.editing.removeHooks();\r\n\t\t}\r\n\t});\r\n});\r\n\r\n/*\r\n * L.LatLngUtil contains different utility functions for LatLngs.\r\n */\r\n\r\nL.LatLngUtil = {\r\n\t// Clones a LatLngs[], returns [][]\r\n\tcloneLatLngs: function (latlngs) {\r\n\t\tvar clone = [];\r\n\t\tfor (var i = 0, l = latlngs.length; i < l; i++) {\r\n\t\t\tclone.push(this.cloneLatLng(latlngs[i]));\r\n\t\t}\r\n\t\treturn clone;\r\n\t},\r\n\r\n\tcloneLatLng: function (latlng) {\r\n\t\treturn L.latLng(latlng.lat, latlng.lng);\r\n\t}\r\n};\r\n\r\nL.GeometryUtil = L.extend(L.GeometryUtil || {}, {\r\n\t// Ported from the OpenLayers implementation. See https://github.com/openlayers/openlayers/blob/master/lib/OpenLayers/Geometry/LinearRing.js#L270\r\n\tgeodesicArea: function (latLngs) {\r\n\t\tvar pointsCount = latLngs.length,\r\n\t\t\tarea = 0.0,\r\n\t\t\td2r = L.LatLng.DEG_TO_RAD,\r\n\t\t\tp1, p2;\r\n\r\n\t\tif (pointsCount > 2) {\r\n\t\t\tfor (var i = 0; i < pointsCount; i++) {\r\n\t\t\t\tp1 = latLngs[i];\r\n\t\t\t\tp2 = latLngs[(i + 1) % pointsCount];\r\n\t\t\t\tarea += ((p2.lng - p1.lng) * d2r) *\r\n\t\t\t\t\t\t(2 + Math.sin(p1.lat * d2r) + Math.sin(p2.lat * d2r));\r\n\t\t\t}\r\n\t\t\tarea = area * 6378137.0 * 6378137.0 / 2.0;\r\n\t\t}\r\n\r\n\t\treturn Math.abs(area);\r\n\t},\r\n\r\n\treadableArea: function (area, isMetric) {\r\n\t\tvar areaStr;\r\n\r\n\t\tif (isMetric) {\r\n\t\t\tif (area >= 10000) {\r\n\t\t\t\tareaStr = (area * 0.0001).toFixed(2) + ' ha';\r\n\t\t\t} else {\r\n\t\t\t\tareaStr = area.toFixed(2) + ' m&sup2;';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tarea /= 0.836127; // Square yards in 1 meter\r\n\r\n\t\t\tif (area >= 3097600) { //3097600 square yards in 1 square mile\r\n\t\t\t\tareaStr = (area / 3097600).toFixed(2) + ' mi&sup2;';\r\n\t\t\t} else if (area >= 4840) {//48040 square yards in 1 acre\r\n\t\t\t\tareaStr = (area / 4840).toFixed(2) + ' acres';\r\n\t\t\t} else {\r\n\t\t\t\tareaStr = Math.ceil(area) + ' yd&sup2;';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn areaStr;\r\n\t},\r\n\r\n\treadableDistance: function (distance, isMetric) {\r\n\t\tvar distanceStr;\r\n\r\n\t\tif (isMetric) {\r\n\t\t\t// show metres when distance is < 1km, then show km\r\n\t\t\tif (distance > 1000) {\r\n\t\t\t\tdistanceStr = (distance  / 1000).toFixed(2) + ' km';\r\n\t\t\t} else {\r\n\t\t\t\tdistanceStr = Math.ceil(distance) + ' m';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdistance *= 1.09361;\r\n\r\n\t\t\tif (distance > 1760) {\r\n\t\t\t\tdistanceStr = (distance / 1760).toFixed(2) + ' miles';\r\n\t\t\t} else {\r\n\t\t\t\tdistanceStr = Math.ceil(distance) + ' yd';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn distanceStr;\r\n\t}\r\n});\r\n\r\nL.Util.extend(L.LineUtil, {\r\n\t// Checks to see if two line segments intersect. Does not handle degenerate cases.\r\n\t// http://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf\r\n\tsegmentsIntersect: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2, /*Point*/ p3) {\r\n\t\treturn\tthis._checkCounterclockwise(p, p2, p3) !==\r\n\t\t\t\tthis._checkCounterclockwise(p1, p2, p3) &&\r\n\t\t\t\tthis._checkCounterclockwise(p, p1, p2) !==\r\n\t\t\t\tthis._checkCounterclockwise(p, p1, p3);\r\n\t},\r\n\r\n\t// check to see if points are in counterclockwise order\r\n\t_checkCounterclockwise: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {\r\n\t\treturn (p2.y - p.y) * (p1.x - p.x) > (p1.y - p.y) * (p2.x - p.x);\r\n\t}\r\n});\r\n\r\nL.Polyline.include({\r\n\t// Check to see if this polyline has any linesegments that intersect.\r\n\t// NOTE: does not support detecting intersection for degenerate cases.\r\n\tintersects: function () {\r\n\t\tvar points = this._originalPoints,\r\n\t\t\tlen = points ? points.length : 0,\r\n\t\t\ti, p, p1;\r\n\r\n\t\tif (this._tooFewPointsForIntersection()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor (i = len - 1; i >= 3; i--) {\r\n\t\t\tp = points[i - 1];\r\n\t\t\tp1 = points[i];\r\n\r\n\r\n\t\t\tif (this._lineSegmentsIntersectsRange(p, p1, i - 2)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\r\n\t// Check for intersection if new latlng was added to this polyline.\r\n\t// NOTE: does not support detecting intersection for degenerate cases.\r\n\tnewLatLngIntersects: function (latlng, skipFirst) {\r\n\t\t// Cannot check a polyline for intersecting lats/lngs when not added to the map\r\n\t\tif (!this._map) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this.newPointIntersects(this._map.latLngToLayerPoint(latlng), skipFirst);\r\n\t},\r\n\r\n\t// Check for intersection if new point was added to this polyline.\r\n\t// newPoint must be a layer point.\r\n\t// NOTE: does not support detecting intersection for degenerate cases.\r\n\tnewPointIntersects: function (newPoint, skipFirst) {\r\n\t\tvar points = this._originalPoints,\r\n\t\t\tlen = points ? points.length : 0,\r\n\t\t\tlastPoint = points ? points[len - 1] : null,\r\n\t\t\t// The previous previous line segment. Previous line segment doesn't need testing.\r\n\t\t\tmaxIndex = len - 2;\r\n\r\n\t\tif (this._tooFewPointsForIntersection(1)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this._lineSegmentsIntersectsRange(lastPoint, newPoint, maxIndex, skipFirst ? 1 : 0);\r\n\t},\r\n\r\n\t// Polylines with 2 sides can only intersect in cases where points are collinear (we don't support detecting these).\r\n\t// Cannot have intersection when < 3 line segments (< 4 points)\r\n\t_tooFewPointsForIntersection: function (extraPoints) {\r\n\t\tvar points = this._originalPoints,\r\n\t\t\tlen = points ? points.length : 0;\r\n\t\t// Increment length by extraPoints if present\r\n\t\tlen += extraPoints || 0;\r\n\r\n\t\treturn !this._originalPoints || len <= 3;\r\n\t},\r\n\r\n\t// Checks a line segment intersections with any line segments before its predecessor.\r\n\t// Don't need to check the predecessor as will never intersect.\r\n\t_lineSegmentsIntersectsRange: function (p, p1, maxIndex, minIndex) {\r\n\t\tvar points = this._originalPoints,\r\n\t\t\tp2, p3;\r\n\r\n\t\tminIndex = minIndex || 0;\r\n\r\n\t\t// Check all previous line segments (beside the immediately previous) for intersections\r\n\t\tfor (var j = maxIndex; j > minIndex; j--) {\r\n\t\t\tp2 = points[j - 1];\r\n\t\t\tp3 = points[j];\r\n\r\n\t\t\tif (L.LineUtil.segmentsIntersect(p, p1, p2, p3)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\n\r\nL.Polygon.include({\r\n\t// Checks a polygon for any intersecting line segments. Ignores holes.\r\n\tintersects: function () {\r\n\t\tvar polylineIntersects,\r\n\t\t\tpoints = this._originalPoints,\r\n\t\t\tlen, firstPoint, lastPoint, maxIndex;\r\n\r\n\t\tif (this._tooFewPointsForIntersection()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tpolylineIntersects = L.Polyline.prototype.intersects.call(this);\r\n\r\n\t\t// If already found an intersection don't need to check for any more.\r\n\t\tif (polylineIntersects) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tlen = points.length;\r\n\t\tfirstPoint = points[0];\r\n\t\tlastPoint = points[len - 1];\r\n\t\tmaxIndex = len - 2;\r\n\r\n\t\t// Check the line segment between last and first point. Don't need to check the first line segment (minIndex = 1)\r\n\t\treturn this._lineSegmentsIntersectsRange(lastPoint, firstPoint, maxIndex, 1);\r\n\t}\r\n});\r\n\r\nL.Control.Draw = L.Control.extend({\r\n\r\n\toptions: {\r\n\t\tposition: 'topleft',\r\n\t\tdraw: {},\r\n\t\tedit: false\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tif (L.version < '0.7') {\r\n\t\t\tthrow new Error('Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/');\r\n\t\t}\r\n\r\n\t\tL.Control.prototype.initialize.call(this, options);\r\n\r\n\t\tvar toolbar;\r\n\r\n\t\tthis._toolbars = {};\r\n\r\n\t\t// Initialize toolbars\r\n\t\tif (L.DrawToolbar && this.options.draw) {\r\n\t\t\ttoolbar = new L.DrawToolbar(this.options.draw);\r\n\r\n\t\t\tthis._toolbars[L.DrawToolbar.TYPE] = toolbar;\r\n\r\n\t\t\t// Listen for when toolbar is enabled\r\n\t\t\tthis._toolbars[L.DrawToolbar.TYPE].on('enable', this._toolbarEnabled, this);\r\n\t\t}\r\n\r\n\t\tif (L.EditToolbar && this.options.edit) {\r\n\t\t\ttoolbar = new L.EditToolbar(this.options.edit);\r\n\r\n\t\t\tthis._toolbars[L.EditToolbar.TYPE] = toolbar;\r\n\r\n\t\t\t// Listen for when toolbar is enabled\r\n\t\t\tthis._toolbars[L.EditToolbar.TYPE].on('enable', this._toolbarEnabled, this);\r\n\t\t}\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tvar container = L.DomUtil.create('div', 'leaflet-draw'),\r\n\t\t\taddedTopClass = false,\r\n\t\t\ttopClassName = 'leaflet-draw-toolbar-top',\r\n\t\t\ttoolbarContainer;\r\n\r\n\t\tfor (var toolbarId in this._toolbars) {\r\n\t\t\tif (this._toolbars.hasOwnProperty(toolbarId)) {\r\n\t\t\t\ttoolbarContainer = this._toolbars[toolbarId].addToolbar(map);\r\n\r\n\t\t\t\tif (toolbarContainer) {\r\n\t\t\t\t\t// Add class to the first toolbar to remove the margin\r\n\t\t\t\t\tif (!addedTopClass) {\r\n\t\t\t\t\t\tif (!L.DomUtil.hasClass(toolbarContainer, topClassName)) {\r\n\t\t\t\t\t\t\tL.DomUtil.addClass(toolbarContainer.childNodes[0], topClassName);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taddedTopClass = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontainer.appendChild(toolbarContainer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tonRemove: function () {\r\n\t\tfor (var toolbarId in this._toolbars) {\r\n\t\t\tif (this._toolbars.hasOwnProperty(toolbarId)) {\r\n\t\t\t\tthis._toolbars[toolbarId].removeToolbar();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetDrawingOptions: function (options) {\r\n\t\tfor (var toolbarId in this._toolbars) {\r\n\t\t\tif (this._toolbars[toolbarId] instanceof L.DrawToolbar) {\r\n\t\t\t\tthis._toolbars[toolbarId].setOptions(options);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_toolbarEnabled: function (e) {\r\n\t\tvar enabledToolbar = e.target;\r\n\r\n\t\tfor (var toolbarId in this._toolbars) {\r\n\t\t\tif (this._toolbars[toolbarId] !== enabledToolbar) {\r\n\t\t\t\tthis._toolbars[toolbarId].disable();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nL.Map.mergeOptions({\r\n\tdrawControlTooltips: true,\r\n\tdrawControl: false\r\n});\r\n\r\nL.Map.addInitHook(function () {\r\n\tif (this.options.drawControl) {\r\n\t\tthis.drawControl = new L.Control.Draw();\r\n\t\tthis.addControl(this.drawControl);\r\n\t}\r\n});\r\n\r\n\r\nL.Toolbar = L.Class.extend({\r\n\tincludes: [L.Mixin.Events],\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._modes = {};\r\n\t\tthis._actionButtons = [];\r\n\t\tthis._activeMode = null;\r\n\t},\r\n\r\n\tenabled: function () {\r\n\t\treturn this._activeMode !== null;\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this.enabled()) { return; }\r\n\r\n\t\tthis._activeMode.handler.disable();\r\n\t},\r\n\r\n\taddToolbar: function (map) {\r\n\t\tvar container = L.DomUtil.create('div', 'leaflet-draw-section'),\r\n\t\t\tbuttonIndex = 0,\r\n\t\t\tbuttonClassPrefix = this._toolbarClass || '',\r\n\t\t\tmodeHandlers = this.getModeHandlers(map),\r\n\t\t\ti;\r\n\r\n\t\tthis._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');\r\n\t\tthis._map = map;\r\n\r\n\t\tfor (i = 0; i < modeHandlers.length; i++) {\r\n\t\t\tif (modeHandlers[i].enabled) {\r\n\t\t\t\tthis._initModeHandler(\r\n\t\t\t\t\tmodeHandlers[i].handler,\r\n\t\t\t\t\tthis._toolbarContainer,\r\n\t\t\t\t\tbuttonIndex++,\r\n\t\t\t\t\tbuttonClassPrefix,\r\n\t\t\t\t\tmodeHandlers[i].title\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if no buttons were added, do not add the toolbar\r\n\t\tif (!buttonIndex) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Save button index of the last button, -1 as we would have ++ after the last button\r\n\t\tthis._lastButtonIndex = --buttonIndex;\r\n\r\n\t\t// Create empty actions part of the toolbar\r\n\t\tthis._actionsContainer = L.DomUtil.create('ul', 'leaflet-draw-actions');\r\n\r\n\t\t// Add draw and cancel containers to the control container\r\n\t\tcontainer.appendChild(this._toolbarContainer);\r\n\t\tcontainer.appendChild(this._actionsContainer);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tremoveToolbar: function () {\r\n\t\t// Dispose each handler\r\n\t\tfor (var handlerId in this._modes) {\r\n\t\t\tif (this._modes.hasOwnProperty(handlerId)) {\r\n\t\t\t\t// Unbind handler button\r\n\t\t\t\tthis._disposeButton(\r\n\t\t\t\t\tthis._modes[handlerId].button,\r\n\t\t\t\t\tthis._modes[handlerId].handler.enable,\r\n\t\t\t\t\tthis._modes[handlerId].handler\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Make sure is disabled\r\n\t\t\t\tthis._modes[handlerId].handler.disable();\r\n\r\n\t\t\t\t// Unbind handler\r\n\t\t\t\tthis._modes[handlerId].handler\r\n\t\t\t\t\t.off('enabled', this._handlerActivated, this)\r\n\t\t\t\t\t.off('disabled', this._handlerDeactivated, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._modes = {};\r\n\r\n\t\t// Dispose the actions toolbar\r\n\t\tfor (var i = 0, l = this._actionButtons.length; i < l; i++) {\r\n\t\t\tthis._disposeButton(\r\n\t\t\t\tthis._actionButtons[i].button,\r\n\t\t\t\tthis._actionButtons[i].callback,\r\n\t\t\t\tthis\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis._actionButtons = [];\r\n\t\tthis._actionsContainer = null;\r\n\t},\r\n\r\n\t_initModeHandler: function (handler, container, buttonIndex, classNamePredix, buttonTitle) {\r\n\t\tvar type = handler.type;\r\n\r\n\t\tthis._modes[type] = {};\r\n\r\n\t\tthis._modes[type].handler = handler;\r\n\r\n\t\tthis._modes[type].button = this._createButton({\r\n\t\t\ttitle: buttonTitle,\r\n\t\t\tclassName: classNamePredix + '-' + type,\r\n\t\t\tcontainer: container,\r\n\t\t\tcallback: this._modes[type].handler.enable,\r\n\t\t\tcontext: this._modes[type].handler\r\n\t\t});\r\n\r\n\t\tthis._modes[type].buttonIndex = buttonIndex;\r\n\r\n\t\tthis._modes[type].handler\r\n\t\t\t.on('enabled', this._handlerActivated, this)\r\n\t\t\t.on('disabled', this._handlerDeactivated, this);\r\n\t},\r\n\r\n\t_createButton: function (options) {\r\n\t\tvar link = L.DomUtil.create('a', options.className || '', options.container);\r\n\t\tlink.href = '#';\r\n\r\n\t\tif (options.text) {\r\n\t\t\tlink.innerHTML = options.text;\r\n\t\t}\r\n\r\n\t\tif (options.title) {\r\n\t\t\tlink.title = options.title;\r\n\t\t}\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.on(link, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.on(link, 'mousedown', L.DomEvent.stopPropagation)\r\n\t\t\t.on(link, 'dblclick', L.DomEvent.stopPropagation)\r\n\t\t\t.on(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.on(link, 'click', options.callback, options.context);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_disposeButton: function (button, callback) {\r\n\t\tL.DomEvent\r\n\t\t\t.off(button, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.off(button, 'mousedown', L.DomEvent.stopPropagation)\r\n\t\t\t.off(button, 'dblclick', L.DomEvent.stopPropagation)\r\n\t\t\t.off(button, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.off(button, 'click', callback);\r\n\t},\r\n\r\n\t_handlerActivated: function (e) {\r\n\t\t// Disable active mode (if present)\r\n\t\tthis.disable();\r\n\r\n\t\t// Cache new active feature\r\n\t\tthis._activeMode = this._modes[e.handler];\r\n\r\n\t\tL.DomUtil.addClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\r\n\r\n\t\tthis._showActionsToolbar();\r\n\r\n\t\tthis.fire('enable');\r\n\t},\r\n\r\n\t_handlerDeactivated: function () {\r\n\t\tthis._hideActionsToolbar();\r\n\r\n\t\tL.DomUtil.removeClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\r\n\r\n\t\tthis._activeMode = null;\r\n\r\n\t\tthis.fire('disable');\r\n\t},\r\n\r\n\t_createActions: function (handler) {\r\n\t\tvar container = this._actionsContainer,\r\n\t\t\tbuttons = this.getActions(handler),\r\n\t\t\tl = buttons.length,\r\n\t\t\tli, di, dl, button;\r\n\r\n\t\t// Dispose the actions toolbar (todo: dispose only not used buttons)\r\n\t\tfor (di = 0, dl = this._actionButtons.length; di < dl; di++) {\r\n\t\t\tthis._disposeButton(this._actionButtons[di].button, this._actionButtons[di].callback);\r\n\t\t}\r\n\t\tthis._actionButtons = [];\r\n\r\n\t\t// Remove all old buttons\r\n\t\twhile (container.firstChild) {\r\n\t\t\tcontainer.removeChild(container.firstChild);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < l; i++) {\r\n\t\t\tif ('enabled' in buttons[i] && !buttons[i].enabled) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tli = L.DomUtil.create('li', '', container);\r\n\r\n\t\t\tbutton = this._createButton({\r\n\t\t\t\ttitle: buttons[i].title,\r\n\t\t\t\ttext: buttons[i].text,\r\n\t\t\t\tcontainer: li,\r\n\t\t\t\tcallback: buttons[i].callback,\r\n\t\t\t\tcontext: buttons[i].context\r\n\t\t\t});\r\n\r\n\t\t\tthis._actionButtons.push({\r\n\t\t\t\tbutton: button,\r\n\t\t\t\tcallback: buttons[i].callback\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t_showActionsToolbar: function () {\r\n\t\tvar buttonIndex = this._activeMode.buttonIndex,\r\n\t\t\tlastButtonIndex = this._lastButtonIndex,\r\n\t\t\ttoolbarPosition = this._activeMode.button.offsetTop - 1;\r\n\r\n\t\t// Recreate action buttons on every click\r\n\t\tthis._createActions(this._activeMode.handler);\r\n\r\n\t\t// Correctly position the cancel button\r\n\t\tthis._actionsContainer.style.top = toolbarPosition + 'px';\r\n\r\n\t\tif (buttonIndex === 0) {\r\n\t\t\tL.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\r\n\t\t\tL.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-top');\r\n\t\t}\r\n\r\n\t\tif (buttonIndex === lastButtonIndex) {\r\n\t\t\tL.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\r\n\t\t\tL.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\r\n\t\t}\r\n\r\n\t\tthis._actionsContainer.style.display = 'block';\r\n\t},\r\n\r\n\t_hideActionsToolbar: function () {\r\n\t\tthis._actionsContainer.style.display = 'none';\r\n\r\n\t\tL.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\r\n\t\tL.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\r\n\t\tL.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-top');\r\n\t\tL.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\r\n\t}\r\n});\r\n\r\n\r\nL.Tooltip = L.Class.extend({\r\n\tinitialize: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._popupPane = map._panes.popupPane;\r\n\r\n\t\tthis._container = map.options.drawControlTooltips ? L.DomUtil.create('div', 'leaflet-draw-tooltip', this._popupPane) : null;\r\n\t\tthis._singleLineLabel = false;\r\n\t},\r\n\r\n\tdispose: function () {\r\n\t\tif (this._container) {\r\n\t\t\tthis._popupPane.removeChild(this._container);\r\n\t\t\tthis._container = null;\r\n\t\t}\r\n\t},\r\n\r\n\tupdateContent: function (labelText) {\r\n\t\tif (!this._container) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tlabelText.subtext = labelText.subtext || '';\r\n\r\n\t\t// update the vertical position (only if changed)\r\n\t\tif (labelText.subtext.length === 0 && !this._singleLineLabel) {\r\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-draw-tooltip-single');\r\n\t\t\tthis._singleLineLabel = true;\r\n\t\t}\r\n\t\telse if (labelText.subtext.length > 0 && this._singleLineLabel) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-draw-tooltip-single');\r\n\t\t\tthis._singleLineLabel = false;\r\n\t\t}\r\n\r\n\t\tthis._container.innerHTML =\r\n\t\t\t(labelText.subtext.length > 0 ? '<span class=\"leaflet-draw-tooltip-subtext\">' + labelText.subtext + '</span>' + '<br />' : '') +\r\n\t\t\t'<span>' + labelText.text + '</span>';\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdatePosition: function (latlng) {\r\n\t\tvar pos = this._map.latLngToLayerPoint(latlng),\r\n\t\t\ttooltipContainer = this._container;\r\n\r\n\t\tif (this._container) {\r\n\t\t\ttooltipContainer.style.visibility = 'inherit';\r\n\t\t\tL.DomUtil.setPosition(tooltipContainer, pos);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tshowAsError: function () {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-error-draw-tooltip');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tremoveError: function () {\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-error-draw-tooltip');\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nL.DrawToolbar = L.Toolbar.extend({\r\n\r\n\tstatics: {\r\n\t\tTYPE: 'draw'\r\n\t},\r\n\r\n\toptions: {\r\n\t\tpolyline: {},\r\n\t\tpolygon: {},\r\n\t\trectangle: {},\r\n\t\tcircle: {},\r\n\t\tmarker: {}\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\t// Ensure that the options are merged correctly since L.extend is only shallow\r\n\t\tfor (var type in this.options) {\r\n\t\t\tif (this.options.hasOwnProperty(type)) {\r\n\t\t\t\tif (options[type]) {\r\n\t\t\t\t\toptions[type] = L.extend({}, this.options[type], options[type]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._toolbarClass = 'leaflet-draw-draw';\r\n\t\tL.Toolbar.prototype.initialize.call(this, options);\r\n\t},\r\n\r\n\tgetModeHandlers: function (map) {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.polyline,\r\n\t\t\t\thandler: new L.Draw.Polyline(map, this.options.polyline),\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.polyline\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.polygon,\r\n\t\t\t\thandler: new L.Draw.Polygon(map, this.options.polygon),\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.polygon\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.rectangle,\r\n\t\t\t\thandler: new L.Draw.Rectangle(map, this.options.rectangle),\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.rectangle\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.circle,\r\n\t\t\t\thandler: new L.Draw.Circle(map, this.options.circle),\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.circle\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.marker,\r\n\t\t\t\thandler: new L.Draw.Marker(map, this.options.marker),\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.buttons.marker\r\n\t\t\t}\r\n\t\t];\r\n\t},\r\n\r\n\t// Get the actions part of the toolbar\r\n\tgetActions: function (handler) {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tenabled: handler.deleteLastVertex,\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.undo.title,\r\n\t\t\t\ttext: L.drawLocal.draw.toolbar.undo.text,\r\n\t\t\t\tcallback: handler.deleteLastVertex,\r\n\t\t\t\tcontext: handler\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttitle: L.drawLocal.draw.toolbar.actions.title,\r\n\t\t\t\ttext: L.drawLocal.draw.toolbar.actions.text,\r\n\t\t\t\tcallback: this.disable,\r\n\t\t\t\tcontext: this\r\n\t\t\t}\r\n\t\t];\r\n\t},\r\n\r\n\tsetOptions: function (options) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tfor (var type in this._modes) {\r\n\t\t\tif (this._modes.hasOwnProperty(type) && options.hasOwnProperty(type)) {\r\n\t\t\t\tthis._modes[type].handler.setOptions(options[type]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n/*L.Map.mergeOptions({\r\n\teditControl: true\r\n});*/\r\n\r\nL.EditToolbar = L.Toolbar.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'edit'\r\n\t},\r\n\r\n\toptions: {\r\n\t\tedit: {\r\n\t\t\tselectedPathOptions: {\r\n\t\t\t\tcolor: '#fe57a1', /* Hot pink all the things! */\r\n\t\t\t\topacity: 0.6,\r\n\t\t\t\tdashArray: '10, 10',\r\n\r\n\t\t\t\tfill: true,\r\n\t\t\t\tfillColor: '#fe57a1',\r\n\t\t\t\tfillOpacity: 0.1,\r\n\r\n\t\t\t\t// Whether to user the existing layers color\r\n\t\t\t\tmaintainColor: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tremove: {},\r\n\t\tfeatureGroup: null /* REQUIRED! TODO: perhaps if not set then all layers on the map are selectable? */\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\t// Need to set this manually since null is an acceptable value here\r\n\t\tif (options.edit) {\r\n\t\t\tif (typeof options.edit.selectedPathOptions === 'undefined') {\r\n\t\t\t\toptions.edit.selectedPathOptions = this.options.edit.selectedPathOptions;\r\n\t\t\t}\r\n\t\t\toptions.edit.selectedPathOptions = L.extend({}, this.options.edit.selectedPathOptions, options.edit.selectedPathOptions);\r\n\t\t}\r\n\r\n\t\tif (options.remove) {\r\n\t\t\toptions.remove = L.extend({}, this.options.remove, options.remove);\r\n\t\t}\r\n\r\n\t\tthis._toolbarClass = 'leaflet-draw-edit';\r\n\t\tL.Toolbar.prototype.initialize.call(this, options);\r\n\r\n\t\tthis._selectedFeatureCount = 0;\r\n\t},\r\n\r\n\tgetModeHandlers: function (map) {\r\n\t\tvar featureGroup = this.options.featureGroup;\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.edit,\r\n\t\t\t\thandler: new L.EditToolbar.Edit(map, {\r\n\t\t\t\t\tfeatureGroup: featureGroup,\r\n\t\t\t\t\tselectedPathOptions: this.options.edit.selectedPathOptions\r\n\t\t\t\t}),\r\n\t\t\t\ttitle: L.drawLocal.edit.toolbar.buttons.edit\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tenabled: this.options.remove,\r\n\t\t\t\thandler: new L.EditToolbar.Delete(map, {\r\n\t\t\t\t\tfeatureGroup: featureGroup\r\n\t\t\t\t}),\r\n\t\t\t\ttitle: L.drawLocal.edit.toolbar.buttons.remove\r\n\t\t\t}\r\n\t\t];\r\n\t},\r\n\r\n\tgetActions: function () {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\ttitle: L.drawLocal.edit.toolbar.actions.save.title,\r\n\t\t\t\ttext: L.drawLocal.edit.toolbar.actions.save.text,\r\n\t\t\t\tcallback: this._save,\r\n\t\t\t\tcontext: this\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttitle: L.drawLocal.edit.toolbar.actions.cancel.title,\r\n\t\t\t\ttext: L.drawLocal.edit.toolbar.actions.cancel.text,\r\n\t\t\t\tcallback: this.disable,\r\n\t\t\t\tcontext: this\r\n\t\t\t}\r\n\t\t];\r\n\t},\r\n\r\n\taddToolbar: function (map) {\r\n\t\tvar container = L.Toolbar.prototype.addToolbar.call(this, map);\r\n\r\n\t\tthis._checkDisabled();\r\n\r\n\t\tthis.options.featureGroup.on('layeradd layerremove', this._checkDisabled, this);\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\tremoveToolbar: function () {\r\n\t\tthis.options.featureGroup.off('layeradd layerremove', this._checkDisabled, this);\r\n\r\n\t\tL.Toolbar.prototype.removeToolbar.call(this);\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this.enabled()) { return; }\r\n\r\n\t\tthis._activeMode.handler.revertLayers();\r\n\r\n\t\tL.Toolbar.prototype.disable.call(this);\r\n\t},\r\n\r\n\t_save: function () {\r\n\t\tthis._activeMode.handler.save();\r\n\t\tthis._activeMode.handler.disable();\r\n\t},\r\n\r\n\t_checkDisabled: function () {\r\n\t\tvar featureGroup = this.options.featureGroup,\r\n\t\t\thasLayers = featureGroup.getLayers().length !== 0,\r\n\t\t\tbutton;\r\n\r\n\t\tif (this.options.edit) {\r\n\t\t\tbutton = this._modes[L.EditToolbar.Edit.TYPE].button;\r\n\r\n\t\t\tif (hasLayers) {\r\n\t\t\t\tL.DomUtil.removeClass(button, 'leaflet-disabled');\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(button, 'leaflet-disabled');\r\n\t\t\t}\r\n\r\n\t\t\tbutton.setAttribute(\r\n\t\t\t\t'title',\r\n\t\t\t\thasLayers ?\r\n\t\t\t\tL.drawLocal.edit.toolbar.buttons.edit\r\n\t\t\t\t: L.drawLocal.edit.toolbar.buttons.editDisabled\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.options.remove) {\r\n\t\t\tbutton = this._modes[L.EditToolbar.Delete.TYPE].button;\r\n\r\n\t\t\tif (hasLayers) {\r\n\t\t\t\tL.DomUtil.removeClass(button, 'leaflet-disabled');\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(button, 'leaflet-disabled');\r\n\t\t\t}\r\n\r\n\t\t\tbutton.setAttribute(\r\n\t\t\t\t'title',\r\n\t\t\t\thasLayers ?\r\n\t\t\t\tL.drawLocal.edit.toolbar.buttons.remove\r\n\t\t\t\t: L.drawLocal.edit.toolbar.buttons.removeDisabled\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nL.EditToolbar.Edit = L.Handler.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'edit'\r\n\t},\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tinitialize: function (map, options) {\r\n\t\tL.Handler.prototype.initialize.call(this, map);\r\n\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\t// Store the selectable layer group for ease of access\r\n\t\tthis._featureGroup = options.featureGroup;\r\n\r\n\t\tif (!(this._featureGroup instanceof L.FeatureGroup)) {\r\n\t\t\tthrow new Error('options.featureGroup must be a L.FeatureGroup');\r\n\t\t}\r\n\r\n\t\tthis._uneditedLayerProps = {};\r\n\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.EditToolbar.Edit.TYPE;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled || !this._hasAvailableLayers()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.fire('enabled', {handler: this.type});\r\n\t\t\t//this disable other handlers\r\n\r\n\t\tthis._map.fire('draw:editstart', { handler: this.type });\r\n\t\t\t//allow drawLayer to be updated before beginning edition.\r\n\r\n\t\tL.Handler.prototype.enable.call(this);\r\n\t\tthis._featureGroup\r\n\t\t\t.on('layeradd', this._enableLayerEdit, this)\r\n\t\t\t.on('layerremove', this._disableLayerEdit, this);\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\t\tthis._featureGroup\r\n\t\t\t.off('layeradd', this._enableLayerEdit, this)\r\n\t\t\t.off('layerremove', this._disableLayerEdit, this);\r\n\t\tL.Handler.prototype.disable.call(this);\r\n\t\tthis._map.fire('draw:editstop', { handler: this.type });\r\n\t\tthis.fire('disabled', {handler: this.type});\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.getContainer().focus();\r\n\r\n\t\t\tthis._featureGroup.eachLayer(this._enableLayerEdit, this);\r\n\r\n\t\t\tthis._tooltip = new L.Tooltip(this._map);\r\n\t\t\tthis._tooltip.updateContent({\r\n\t\t\t\ttext: L.drawLocal.edit.handlers.edit.tooltip.text,\r\n\t\t\t\tsubtext: L.drawLocal.edit.handlers.edit.tooltip.subtext\r\n\t\t\t});\r\n\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tif (this._map) {\r\n\t\t\t// Clean up selected layers.\r\n\t\t\tthis._featureGroup.eachLayer(this._disableLayerEdit, this);\r\n\r\n\t\t\t// Clear the backups of the original layers\r\n\t\t\tthis._uneditedLayerProps = {};\r\n\r\n\t\t\tthis._tooltip.dispose();\r\n\t\t\tthis._tooltip = null;\r\n\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\trevertLayers: function () {\r\n\t\tthis._featureGroup.eachLayer(function (layer) {\r\n\t\t\tthis._revertLayer(layer);\r\n\t\t}, this);\r\n\t},\r\n\r\n\tsave: function () {\r\n\t\tvar editedLayers = new L.LayerGroup();\r\n\t\tthis._featureGroup.eachLayer(function (layer) {\r\n\t\t\tif (layer.edited) {\r\n\t\t\t\teditedLayers.addLayer(layer);\r\n\t\t\t\tlayer.edited = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._map.fire('draw:edited', {layers: editedLayers});\r\n\t},\r\n\r\n\t_backupLayer: function (layer) {\r\n\t\tvar id = L.Util.stamp(layer);\r\n\r\n\t\tif (!this._uneditedLayerProps[id]) {\r\n\t\t\t// Polyline, Polygon or Rectangle\r\n\t\t\tif (layer instanceof L.Polyline || layer instanceof L.Polygon || layer instanceof L.Rectangle) {\r\n\t\t\t\tthis._uneditedLayerProps[id] = {\r\n\t\t\t\t\tlatlngs: L.LatLngUtil.cloneLatLngs(layer.getLatLngs())\r\n\t\t\t\t};\r\n\t\t\t} else if (layer instanceof L.Circle) {\r\n\t\t\t\tthis._uneditedLayerProps[id] = {\r\n\t\t\t\t\tlatlng: L.LatLngUtil.cloneLatLng(layer.getLatLng()),\r\n\t\t\t\t\tradius: layer.getRadius()\r\n\t\t\t\t};\r\n\t\t\t} else if (layer instanceof L.Marker) { // Marker\r\n\t\t\t\tthis._uneditedLayerProps[id] = {\r\n\t\t\t\t\tlatlng: L.LatLngUtil.cloneLatLng(layer.getLatLng())\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_revertLayer: function (layer) {\r\n\t\tvar id = L.Util.stamp(layer);\r\n\t\tlayer.edited = false;\r\n\t\tif (this._uneditedLayerProps.hasOwnProperty(id)) {\r\n\t\t\t// Polyline, Polygon or Rectangle\r\n\t\t\tif (layer instanceof L.Polyline || layer instanceof L.Polygon || layer instanceof L.Rectangle) {\r\n\t\t\t\tlayer.setLatLngs(this._uneditedLayerProps[id].latlngs);\r\n\t\t\t} else if (layer instanceof L.Circle) {\r\n\t\t\t\tlayer.setLatLng(this._uneditedLayerProps[id].latlng);\r\n\t\t\t\tlayer.setRadius(this._uneditedLayerProps[id].radius);\r\n\t\t\t} else if (layer instanceof L.Marker) { // Marker\r\n\t\t\t\tlayer.setLatLng(this._uneditedLayerProps[id].latlng);\r\n\t\t\t}\r\n\r\n\t\t\tlayer.fire('revert-edited', { layer: layer });\r\n\t\t}\r\n\t},\r\n\r\n\t_enableLayerEdit: function (e) {\r\n\t\tvar layer = e.layer || e.target || e,\r\n\t\t\tpathOptions;\r\n\r\n\t\t// Back up this layer (if haven't before)\r\n\t\tthis._backupLayer(layer);\r\n\r\n\t\t// Set different style for editing mode\r\n\t\tif (this.options.selectedPathOptions) {\r\n\t\t\tpathOptions = L.Util.extend({}, this.options.selectedPathOptions);\r\n\r\n\t\t\t// Use the existing color of the layer\r\n\t\t\tif (pathOptions.maintainColor) {\r\n\t\t\t\tpathOptions.color = layer.options.color;\r\n\t\t\t\tpathOptions.fillColor = layer.options.fillColor;\r\n\t\t\t}\r\n\r\n\t\t\tlayer.options.original = L.extend({}, layer.options);\r\n\t\t\tlayer.options.editing = pathOptions;\r\n\t\t}\r\n\r\n\t\tlayer.editing.enable();\r\n\t},\r\n\r\n\t_disableLayerEdit: function (e) {\r\n\t\tvar layer = e.layer || e.target || e;\r\n\r\n\t\tlayer.edited = false;\r\n\t\tlayer.editing.disable();\r\n\r\n\t\tdelete layer.options.editing;\r\n\t\tdelete layer.options.original;\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tthis._tooltip.updatePosition(e.latlng);\r\n\t},\r\n\r\n\t_hasAvailableLayers: function () {\r\n\t\treturn this._featureGroup.getLayers().length !== 0;\r\n\t}\r\n});\r\n\r\n\r\nL.EditToolbar.Delete = L.Handler.extend({\r\n\tstatics: {\r\n\t\tTYPE: 'remove' // not delete as delete is reserved in js\r\n\t},\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\tinitialize: function (map, options) {\r\n\t\tL.Handler.prototype.initialize.call(this, map);\r\n\r\n\t\tL.Util.setOptions(this, options);\r\n\r\n\t\t// Store the selectable layer group for ease of access\r\n\t\tthis._deletableLayers = this.options.featureGroup;\r\n\r\n\t\tif (!(this._deletableLayers instanceof L.FeatureGroup)) {\r\n\t\t\tthrow new Error('options.featureGroup must be a L.FeatureGroup');\r\n\t\t}\r\n\r\n\t\t// Save the type so super can fire, need to do this as cannot do this.TYPE :(\r\n\t\tthis.type = L.EditToolbar.Delete.TYPE;\r\n\t},\r\n\r\n\tenable: function () {\r\n\t\tif (this._enabled || !this._hasAvailableLayers()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.fire('enabled', { handler: this.type});\r\n\r\n\t\tthis._map.fire('draw:deletestart', { handler: this.type });\r\n\r\n\t\tL.Handler.prototype.enable.call(this);\r\n\r\n\t\tthis._deletableLayers\r\n\t\t\t.on('layeradd', this._enableLayerDelete, this)\r\n\t\t\t.on('layerremove', this._disableLayerDelete, this);\r\n\t},\r\n\r\n\tdisable: function () {\r\n\t\tif (!this._enabled) { return; }\r\n\r\n\t\tthis._deletableLayers\r\n\t\t\t.off('layeradd', this._enableLayerDelete, this)\r\n\t\t\t.off('layerremove', this._disableLayerDelete, this);\r\n\r\n\t\tL.Handler.prototype.disable.call(this);\r\n\r\n\t\tthis._map.fire('draw:deletestop', { handler: this.type });\r\n\r\n\t\tthis.fire('disabled', { handler: this.type});\r\n\t},\r\n\r\n\taddHooks: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tmap.getContainer().focus();\r\n\r\n\t\t\tthis._deletableLayers.eachLayer(this._enableLayerDelete, this);\r\n\t\t\tthis._deletedLayers = new L.LayerGroup();\r\n\r\n\t\t\tthis._tooltip = new L.Tooltip(this._map);\r\n\t\t\tthis._tooltip.updateContent({ text: L.drawLocal.edit.handlers.remove.tooltip.text });\r\n\r\n\t\t\tthis._map.on('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\tremoveHooks: function () {\r\n\t\tif (this._map) {\r\n\t\t\tthis._deletableLayers.eachLayer(this._disableLayerDelete, this);\r\n\t\t\tthis._deletedLayers = null;\r\n\r\n\t\t\tthis._tooltip.dispose();\r\n\t\t\tthis._tooltip = null;\r\n\r\n\t\t\tthis._map.off('mousemove', this._onMouseMove, this);\r\n\t\t}\r\n\t},\r\n\r\n\trevertLayers: function () {\r\n\t\t// Iterate of the deleted layers and add them back into the featureGroup\r\n\t\tthis._deletedLayers.eachLayer(function (layer) {\r\n\t\t\tthis._deletableLayers.addLayer(layer);\r\n\t\t\tlayer.fire('revert-deleted', { layer: layer });\r\n\t\t}, this);\r\n\t},\r\n\r\n\tsave: function () {\r\n\t\tthis._map.fire('draw:deleted', { layers: this._deletedLayers });\r\n\t},\r\n\r\n\t_enableLayerDelete: function (e) {\r\n\t\tvar layer = e.layer || e.target || e;\r\n\r\n\t\tlayer.on('click', this._removeLayer, this);\r\n\t},\r\n\r\n\t_disableLayerDelete: function (e) {\r\n\t\tvar layer = e.layer || e.target || e;\r\n\r\n\t\tlayer.off('click', this._removeLayer, this);\r\n\r\n\t\t// Remove from the deleted layers so we can't accidently revert if the user presses cancel\r\n\t\tthis._deletedLayers.removeLayer(layer);\r\n\t},\r\n\r\n\t_removeLayer: function (e) {\r\n\t\tvar layer = e.layer || e.target || e;\r\n\r\n\t\tthis._deletableLayers.removeLayer(layer);\r\n\r\n\t\tthis._deletedLayers.addLayer(layer);\r\n\r\n\t\tlayer.fire('deleted');\r\n\t},\r\n\r\n\t_onMouseMove: function (e) {\r\n\t\tthis._tooltip.updatePosition(e.latlng);\r\n\t},\r\n\r\n\t_hasAvailableLayers: function () {\r\n\t\treturn this._deletableLayers.getLayers().length !== 0;\r\n\t}\r\n});\r\n\r\n\r\n}(window, document));","L.Polyline.Measure = L.Draw.Polyline.extend({\r\n    addHooks: function() {\r\n        L.Draw.Polyline.prototype.addHooks.call(this);\r\n        if (this._map) {\r\n            this._markerGroup = new L.LayerGroup();\r\n            this._map.addLayer(this._markerGroup);\r\n\r\n            this._markers = [];\r\n            this._map.on('click', this._onClick, this);\r\n            this._startShape();\r\n        }\r\n    },\r\n\r\n    removeHooks: function () {\r\n\r\n        this._clearHideErrorTimeout();\r\n\r\n        //!\\ Still useful when control is disabled before any drawing (refactor needed?)\r\n        this._map\r\n            .off('pointermove', this._onMouseMove, this)\r\n            .off('mousemove', this._onMouseMove, this)\r\n            .off('click', this._onClick, this);\r\n\r\n        this._clearGuides();\r\n        this._container.style.cursor = '';\r\n\r\n        this._removeShape();\r\n        L.Draw.Polyline.prototype.removeHooks.call(this);\r\n    },\r\n\r\n    _startShape: function() {\r\n        this._drawing = true;\r\n        this._poly = new L.Polyline([], this.options.shapeOptions);\r\n        //this is added as a placeholder, if leaflet doesn't recieve this when the tool is turned off all onclick events are removed\r\n        this._poly._onClick = function() {};\r\n        \r\n        this._container.style.cursor = 'crosshair';\r\n\r\n        this._updateTooltip();\r\n        map.off('click',L.TileLayer.BetterWMS.getFeatureInfo);\r\n        this._map\r\n            .on('pointermove', this._onMouseMove, this)\r\n            .on('mousemove', this._onMouseMove, this)\r\n            .on('click', this._onClick, this);\r\n    },\r\n\r\n    _finishShape: function () {\r\n        this._drawing = false;\r\n\r\n        this._cleanUpShape();\r\n        this._clearGuides();\r\n\r\n        this._updateTooltip();\r\n\r\n        var map=this._map;\r\n    \tthis._map.eachLayer(function(layer) {\r\n\t\t\tif (layer.options\r\n\t\t\t\t\t&& layer.options.tipus == \"wms\") {\r\n\t\t\t\tmap.on('click',layer.getFeatureInfo,layer);\r\n\t\t\t}\r\n\r\n\t\t});\r\n       \r\n        this._map\r\n            .off('pointermove', this._onMouseMove, this)\r\n            .off('mousemove', this._onMouseMove, this)\r\n            .off('click', this._onClick, this);\r\n        \r\n        this._container.style.cursor = '';\r\n    },\r\n\r\n    _removeShape: function() {\r\n        if (!this._poly)\r\n            return;\r\n        this._map.removeLayer(this._poly);\r\n        delete this._poly;\r\n        this._markers.splice(0);\r\n        this._markerGroup.clearLayers();\r\n    },\r\n\r\n    _onClick: function(e) {\r\n        if (!this._drawing) {\r\n            this._removeShape();\r\n            this._startShape();\r\n            return;\r\n        }\r\n    },\r\n\r\n    _getTooltipText: function() {\r\n        var labelText = L.Draw.Polyline.prototype._getTooltipText.call(this);\r\n        if (!this._drawing) {\r\n            labelText.text = '';\r\n        }\r\n        return labelText;\r\n    }\r\n});\r\n\r\nL.Control.MeasureControl = L.Control.extend({\r\n\r\n    statics: {\r\n        TITLE: 'Mesurar distància'\r\n    },\r\n    options: {\r\n        position: 'topleft',\r\n        handler: {\r\n            shapeOptions: {\r\n                fill: true,\r\n                fillOpacity: 0.2\r\n            }\r\n        }\r\n    },\r\n\r\n    toggle: function() {\r\n        if (this.handler.enabled()) {\r\n            this.handler.disable.call(this.handler);\r\n        } else {\r\n            this.handler.enable.call(this.handler);\r\n        }\r\n    },\r\n\r\n    onAdd: function(map) {\r\n        var className = 'leaflet-control-draw';\r\n\r\n        this._container = L.DomUtil.create('div', 'leaflet-bar');\r\n\r\n        this.handler = new L.Polyline.Measure(map, this.options.handler);\r\n\r\n        this.handler.on('enabled', function () {\r\n            this.enabled = true;\r\n            L.DomUtil.addClass(this._container, 'enabled');\r\n        }, this);\r\n\r\n        this.handler.on('disabled', function () {\r\n            delete this.enabled;\r\n            L.DomUtil.removeClass(this._container, 'enabled');\r\n        }, this);\r\n\r\n        var link = L.DomUtil.create('a', className+'-measure', this._container);\r\n        link.href = '#';\r\n\t\tlink.lang = 'ca';\r\n        link.title = L.Control.MeasureControl.TITLE;\r\n\r\n        L.DomEvent\r\n            .addListener(link, 'click', L.DomEvent.stopPropagation)\r\n            .addListener(link, 'click', L.DomEvent.preventDefault)\r\n            .addListener(link, 'click', this.toggle, this);\r\n\r\n        return this._container;\r\n    }\r\n});\r\n\r\n\r\nL.Map.mergeOptions({\r\n    measureControl: false\r\n});\r\n\r\n\r\nL.Map.addInitHook(function () {\r\n    if (this.options.measureControl) {\r\n        this.measureControl = L.Control.measureControl().addTo(this);\r\n    }\r\n});\r\n\r\n\r\nL.Control.measureControl = function (options) {\r\n    return new L.Control.MeasureControl(options);\r\n};\r\n\r\n","/*\n  Leaflet.AwesomeMarkers, a plugin that adds colorful iconic markers for Leaflet, based on the Font Awesome icons\n  (c) 2012-2013, Lennard Voogdt\n\n  http://leafletjs.com\n  https://github.com/lvoogdt\n*/\n\n/*global L*/\n\n(function (window, document, undefined) {\n    \"use strict\";\n    /*\n     * Leaflet.AwesomeMarkers assumes that you have already included the Leaflet library.\n     */\n\n    L.AwesomeMarkers = {};\n\n    L.AwesomeMarkers.version = '2.0.1';\n\n    L.AwesomeMarkers.Icon = L.Icon.extend({\n        options: {\n            iconSize: [35, 45],\n            iconAnchor:   [17, 42],\n            popupAnchor: [1, -32],\n            shadowAnchor: [10, 12],\n            shadowSize: [36, 16],\n            className: 'awesome-marker',\n\t\t\tdivColor:'transparent',\n            prefix: 'glyphicon',\n            spinClass: 'fa-spin',\n            icon: 'home',\n            markerColor: 'blue',\n            iconColor: 'white'\n        },\n\n        initialize: function (options) {\n            options = L.Util.setOptions(this, options);\n        },\n\n        createIcon: function () {\n            var div = document.createElement('div'),\n                options = this.options;\n\n            if (options.icon) {\n                div.innerHTML = this._createInner();\n            }\n\n            if (options.bgPos) {\n                div.style.backgroundPosition =\n                    (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';\n            }\n\n            this._setIconStyles(div, 'icon-' + options.markerColor);\n            return div;\n        },\n\n        _createInner: function() {\n            var iconClass, iconSpinClass = \"\", iconColorClass = \"\", iconColorStyle = \"\", options = this.options;\n\n            if(options.icon.slice(0,options.prefix.length+1) === options.prefix + \"-\") {\n                iconClass = options.icon;\n            } else {\n                iconClass = options.prefix + \"-\" + options.icon;\n            }\n\n            if(options.spin && typeof options.spinClass === \"string\") {\n                iconSpinClass = options.spinClass;\n            }\n\n            if(options.iconColor) {\n                if(options.iconColor === 'white' || options.iconColor === 'black') {\n                    iconColorClass = \"icon-\" + options.iconColor;\n                } else {\n                    iconColorStyle = \"style='color: \" + options.iconColor + \"' \";\n                }\n            }\n\n            return \"<i \" + iconColorStyle + \"class='\" + options.prefix + \" \" + iconClass + \" \" + iconSpinClass + \" \" + iconColorClass + \"'></i>\";\n        },\n\n        _setIconStyles: function (img, name) {\n            var options = this.options,\n                size = L.point(options[name === 'shadow' ? 'shadowSize' : 'iconSize']),\n                anchor;\n\n            if (name === 'shadow') {\n                anchor = L.point(options.shadowAnchor || options.iconAnchor);\n            } else {\n                anchor = L.point(options.iconAnchor);\n            }\n\n            if (!anchor && size) {\n                anchor = size.divideBy(2, true);\n            }\n\n            img.className = 'awesome-marker-' + name + ' ' + options.className;\n\n\t\t\timg.style.backgroundColor=options.divColor;\n\t\t\t\n            if (anchor) {\n                img.style.marginLeft = (-anchor.x) + 'px';\n                img.style.marginTop  = (-anchor.y) + 'px';\n            }\n\n            if (size) {\n                img.style.width  = size.x + 'px';\n                img.style.height = size.y + 'px';\n            }\n        },\n\n        createShadow: function () {\n            var div = document.createElement('div');\n\n            this._setIconStyles(div, 'shadow');\n            return div;\n      }\n    });\n        \n    L.AwesomeMarkers.icon = function (options) {\n        return new L.AwesomeMarkers.Icon(options);\n    };\n\n}(this, document));\n\n\n\n","///*\n// (c) 2014, Vladimir Agafonkin\n// simpleheat, a tiny JavaScript library for drawing heatmaps with Canvas\n// https://github.com/mourner/simpleheat\n//*/\n//!function(){\"use strict\";function t(i){return this instanceof t?(this._canvas=i=\"string\"==typeof i?document.getElementById(i):i,this._ctx=i.getContext(\"2d\"),this._width=i.width,this._height=i.height,this._max=1,void this.clear()):new t(i)}t.prototype={defaultRadius:25,defaultGradient:{.4:\"blue\",.6:\"cyan\",.7:\"lime\",.8:\"yellow\",1:\"red\"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,i){i=i||15;var a=this._circle=document.createElement(\"canvas\"),e=a.getContext(\"2d\"),s=this._r=t+i;return a.width=a.height=2*s,e.shadowOffsetX=e.shadowOffsetY=200,e.shadowBlur=i,e.shadowColor=\"black\",e.beginPath(),e.arc(s-200,s-200,t,0,2*Math.PI,!0),e.closePath(),e.fill(),this},gradient:function(t){\n//\tvar i=document.createElement(\"canvas\"),\n//\ta=i.getContext(\"2d\"),\n//\te=a.createLinearGradient(0,0,0,256);\n//\ti.width=1,i.height=256;\n//\tfor(var s in t)e.addColorStop(s,t[s]);return a.fillStyle=e,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){\n//\t\tthis._circle||this.radius(this.defaultRadius),\n//\t\tthis._grad||this.gradient(this.defaultGradient);\n//\t\tvar i=this._ctx;i.clearRect(0,0,this._width,this._height);for(var a,e=0,s=this._data.length;s>e;e++)a=this._data[e],i.globalAlpha=Math.max(a[2]/this._max,t||.2),i.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var n=i.getImageData(0,0,this._width,this._height);return this._colorize(n.data,this._grad),i.putImageData(n,0,0),this},_colorize:function(t,i){for(var a,e=3,s=t.length;s>e;e+=4)a=4*t[e],a&&(t[e-3]=i[a],t[e-2]=i[a+1],t[e-1]=i[a+2])}},window.simpleheat=t}(),/*\n// (c) 2014, Vladimir Agafonkin\n// Leaflet.heat, a tiny and fast heatmap plugin for Leaflet.\n// https://github.com/Leaflet/Leaflet.heat\n//*/\n//L.HeatLayer=L.Class.extend({initialize:function(t,i){this._latlngs=t,L.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return this._heat&&!this._frame&&(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on(\"moveend\",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on(\"zoomanim\",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off(\"moveend\",this._reset,this),t.options.zoomAnimation&&t.off(\"zoomanim\",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create(\"canvas\",\"leaflet-heatmap-layer\"),i=this._map.getSize();t.width=i.x,t.height=i.y;var a=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,\"leaflet-zoom-\"+(a?\"animated\":\"hide\")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){var t,i,a,e,s,n,h,o,r,d=[],_=this._heat._r,l=this._map.getSize(),m=new L.LatLngBounds(this._map.containerPointToLatLng(L.point([-_,-_])),this._map.containerPointToLatLng(l.add([_,_]))),c=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,u=1/Math.pow(2,Math.max(0,Math.min(c-this._map.getZoom(),12))),g=_/2,f=[],p=this._map._getMapPanePos(),v=p.x%g,w=p.y%g;for(t=0,i=this._latlngs.length;i>t;t++)m.contains(this._latlngs[t])&&(a=this._map.latLngToContainerPoint(this._latlngs[t]),s=Math.floor((a.x-v)/g)+2,n=Math.floor((a.y-w)/g)+2,r=(this._latlngs[t].alt||1)*u,f[n]=f[n]||[],e=f[n][s],e?(e[0]=(e[0]*e[2]+a.x*r)/(e[2]+r),e[1]=(e[1]*e[2]+a.y*r)/(e[2]+r),e[2]+=r):f[n][s]=[a.x,a.y,r]);for(t=0,i=f.length;i>t;t++)if(f[t])for(h=0,o=f[t].length;o>h;h++)e=f[t][h],e&&d.push([Math.round(e[0]),Math.round(e[1]),Math.min(e[2],1)]);this._heat.data(d).draw(),this._frame=null},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+\" scale(\"+i+\")\"}}),L.heatLayer=function(t,i){return new L.HeatLayer(t,i)};\n\n\n/*\n (c) 2014, Vladimir Agafonkin\n simpleheat, a tiny JavaScript library for drawing heatmaps with Canvas\n https://github.com/mourner/simpleheat\n*/\n!function(){\"use strict\";function t(i){return this instanceof t?(this._canvas=i=\"string\"==typeof i?document.getElementById(i):i,this._ctx=i.getContext(\"2d\"),this._width=i.width,this._height=i.height,this._max=1,void this.clear()):new t(i)}t.prototype={defaultRadius:25,defaultGradient:{.4:\"blue\",.6:\"cyan\",.7:\"lime\",.8:\"yellow\",1:\"red\"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,i){i=i||15;var a=this._circle=document.createElement(\"canvas\"),e=a.getContext(\"2d\"),s=this._r=t+i;return a.width=a.height=2*s,e.shadowOffsetX=e.shadowOffsetY=200,e.shadowBlur=i,e.shadowColor=\"black\",e.beginPath(),e.arc(s-200,s-200,t,0,2*Math.PI,!0),e.closePath(),e.fill(),this},gradient:function(t){var i=document.createElement(\"canvas\"),a=i.getContext(\"2d\"),e=a.createLinearGradient(0,0,0,256);i.width=1,i.height=256;for(var s in t)e.addColorStop(s,t[s]);return a.fillStyle=e,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var i=this._ctx;i.clearRect(0,0,this._width,this._height);for(var a,e=0,s=this._data.length;s>e;e++)a=this._data[e],i.globalAlpha=Math.max(a[2]/this._max,t||.25),i.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var n=i.getImageData(0,0,this._width,this._height);return this._colorize(n.data,this._grad),i.putImageData(n,0,0),this},_colorize:function(t,i){for(var a,e=3,s=t.length;s>e;e+=4)a=4*t[e],a&&(t[e-3]=i[a],t[e-2]=i[a+1],t[e-1]=i[a+2])}},window.simpleheat=t}(),/*\n (c) 2014, Vladimir Agafonkin\n Leaflet.heat, a tiny and fast heatmap plugin for Leaflet.\n https://github.com/Leaflet/Leaflet.heat\n*/\nL.HeatLayer=L.Class.extend({initialize:function(t,i){this._latlngs=t,L.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on(\"moveend\",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on(\"zoomanim\",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off(\"moveend\",this._reset,this),t.options.zoomAnimation&&t.off(\"zoomanim\",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create(\"canvas\",\"leaflet-heatmap-layer leaflet-layer\"),i=this._map.getSize();t.width=i.x,t.height=i.y;var a=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,\"leaflet-zoom-\"+(a?\"animated\":\"hide\")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){var t,i,a,e,s,n,h,o,r,_=[],d=this._heat._r,l=this._map.getSize(),m=new L.LatLngBounds(this._map.containerPointToLatLng(L.point([-d,-d])),this._map.containerPointToLatLng(l.add([d,d]))),c=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,u=1/Math.pow(2,Math.max(0,Math.min(c-this._map.getZoom(),12))),g=d/2,f=[],p=this._map._getMapPanePos(),v=p.x%g,w=p.y%g;for(t=0,i=this._latlngs.length;i>t;t++)m.contains(this._latlngs[t])&&(a=this._map.latLngToContainerPoint(this._latlngs[t]),s=Math.floor((a.x-v)/g)+2,n=Math.floor((a.y-w)/g)+2,r=(this._latlngs[t].alt||1)*u,f[n]=f[n]||[],e=f[n][s],e?(e[0]=(e[0]*e[2]+a.x*r)/(e[2]+r),e[1]=(e[1]*e[2]+a.y*r)/(e[2]+r),e[2]+=r):f[n][s]=[a.x,a.y,r]);for(t=0,i=f.length;i>t;t++)if(f[t])for(h=0,o=f[t].length;o>h;h++)e=f[t][h],e&&_.push([Math.round(e[0]),Math.round(e[1]),Math.min(e[2],1)]);this._heat.data(_).draw(),this._frame=null},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+\" scale(\"+i+\")\"}}),L.heatLayer=function(t,i){return new L.HeatLayer(t,i)};","(function(){/*\r\n OverlappingMarkerSpiderfier\r\nhttps://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet\r\nCopyright (c) 2011 - 2012 George MacKerron\r\nReleased under the MIT licence: http://opensource.org/licenses/mit-license\r\nNote: The Leaflet maps API must be included *before* this code\r\n*/\r\n(function(){var q={}.hasOwnProperty,r=[].slice;null!=this.L&&(this.OverlappingMarkerSpiderfier=function(){function n(c,b){var a,e,g,f,d=this;this.map=c;null==b&&(b={});for(a in b)q.call(b,a)&&(e=b[a],this[a]=e);this.initMarkerArrays();this.listeners={};f=[\"click\",\"zoomend\"];e=0;for(g=f.length;e<g;e++)a=f[e],this.map.addEventListener(a,function(){return d.unspiderfy()})}var d,k;d=n.prototype;d.VERSION=\"0.2.6\";k=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=\r\n25;d.circleStartAngle=k/12;d.spiralFootSeparation=28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legWeight=1.5;d.legColors={usual:\"#222\",highlighted:\"#f00\"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(c){var b,a=this;if(null!=c._oms)return this;c._oms=!0;b=function(){return a.spiderListener(c)};c.addEventListener(\"click\",b);this.markerListeners.push(b);this.markers.push(c);return this};d.getMarkers=function(){return this.markers.slice(0)};\r\nd.removeMarker=function(c){var b,a;null!=c._omsData&&this.unspiderfy();b=this.arrIndexOf(this.markers,c);if(0>b)return this;a=this.markerListeners.splice(b,1)[0];c.removeEventListener(\"click\",a);delete c._oms;this.markers.splice(b,1);return this};d.clearMarkers=function(){var c,b,a,e,g;this.unspiderfy();g=this.markers;c=a=0;for(e=g.length;a<e;c=++a)b=g[c],c=this.markerListeners[c],b.removeEventListener(\"click\",c),delete b._oms;this.initMarkerArrays();return this};d.addListener=function(c,b){var a,\r\ne;(null!=(e=(a=this.listeners)[c])?e:a[c]=[]).push(b);return this};d.removeListener=function(c,b){var a;a=this.arrIndexOf(this.listeners[c],b);0>a||this.listeners[c].splice(a,1);return this};d.clearListeners=function(c){this.listeners[c]=[];return this};d.trigger=function(){var c,b,a,e,g,f;b=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];b=null!=(a=this.listeners[b])?a:[];f=[];e=0;for(g=b.length;e<g;e++)a=b[e],f.push(a.apply(null,c));return f};d.generatePtsCircle=function(c,b){var a,e,\r\ng,f,d;g=this.circleFootSeparation*(2+c)/k;e=k/c;d=[];for(a=f=0;0<=c?f<c:f>c;a=0<=c?++f:--f)a=this.circleStartAngle+a*e,d.push(new L.Point(b.x+g*Math.cos(a),b.y+g*Math.sin(a)));return d};d.generatePtsSpiral=function(c,b){var a,e,g,f,d;g=this.spiralLengthStart;a=0;d=[];for(e=f=0;0<=c?f<c:f>c;e=0<=c?++f:--f)a+=this.spiralFootSeparation/g+5E-4*e,e=new L.Point(b.x+g*Math.cos(a),b.y+g*Math.sin(a)),g+=k*this.spiralLengthFactor/a,d.push(e);return d};d.spiderListener=function(c){var b,a,e,g,f,d,h,k,l;(b=null!=\r\nc._omsData)&&this.keepSpiderfied||this.unspiderfy();if(b)return this.trigger(\"click\",c);g=[];f=[];d=this.nearbyDistance*this.nearbyDistance;e=this.map.latLngToLayerPoint(c.getLatLng());l=this.markers;h=0;for(k=l.length;h<k;h++)b=l[h],this.map.hasLayer(b)&&(a=this.map.latLngToLayerPoint(b.getLatLng()),this.ptDistanceSq(a,e)<d?g.push({marker:b,markerPt:a}):f.push(b));return 1===g.length?this.trigger(\"click\",c):this.spiderfy(g,f)};d.makeHighlightListeners=function(c){var b=this;return{highlight:function(){return c._omsData.leg.setStyle({color:b.legColors.highlighted})},\r\nunhighlight:function(){return c._omsData.leg.setStyle({color:b.legColors.usual})}}};d.spiderfy=function(c,b){var a,e,g,d,p,h,k,l,n,m;this.spiderfying=!0;m=c.length;a=this.ptAverage(function(){var a,b,e;e=[];a=0;for(b=c.length;a<b;a++)k=c[a],e.push(k.markerPt);return e}());d=m>=this.circleSpiralSwitchover?this.generatePtsSpiral(m,a).reverse():this.generatePtsCircle(m,a);a=function(){var a,b,k,m=this;k=[];a=0;for(b=d.length;a<b;a++)g=d[a],e=this.map.layerPointToLatLng(g),n=this.minExtract(c,function(a){return m.ptDistanceSq(a.markerPt,\r\ng)}),h=n.marker,p=new L.Polyline([h.getLatLng(),e],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.map.addLayer(p),h._omsData={usualPosition:h.getLatLng(),leg:p},this.legColors.highlighted!==this.legColors.usual&&(l=this.makeHighlightListeners(h),h._omsData.highlightListeners=l,h.addEventListener(\"mouseover\",l.highlight),h.addEventListener(\"mouseout\",l.unhighlight)),h.setLatLng(e);if(h.setZIndexOffset){h.setZIndexOffset(1E6)};k.push(h);return k}.call(this);delete this.spiderfying;this.spiderfied=!0;\r\nreturn this.trigger(\"spiderfy\",a,b)};d.unspiderfy=function(c){var b,a,e,d,f,k,h;null==c&&(c=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;d=[];e=[];h=this.markers;f=0;for(k=h.length;f<k;f++)b=h[f],null!=b._omsData?(this.map.removeLayer(b._omsData.leg),b!==c&&b.setLatLng(b._omsData.usualPosition),(b.setZIndexOffset ? b.setZIndexOffset(0) : b),a=b._omsData.highlightListeners,null!=a&&(b.removeEventListener(\"mouseover\",a.highlight),b.removeEventListener(\"mouseout\",a.unhighlight)),delete b._omsData,d.push(b)):\r\ne.push(b);delete this.unspiderfying;delete this.spiderfied;this.trigger(\"unspiderfy\",d,e);return this};d.ptDistanceSq=function(c,b){var a,e;a=c.x-b.x;e=c.y-b.y;return a*a+e*e};d.ptAverage=function(c){var b,a,e,d,f;d=a=e=0;for(f=c.length;d<f;d++)b=c[d],a+=b.x,e+=b.y;c=c.length;return new L.Point(a/c,e/c)};d.minExtract=function(c,b){var a,d,g,f,k,h;g=k=0;for(h=c.length;k<h;g=++k)if(f=c[g],f=b(f),\"undefined\"===typeof a||null===a||f<d)d=f,a=g;return c.splice(a,1)[0]};d.arrIndexOf=function(c,b){var a,\r\nd,g,f;if(null!=c.indexOf)return c.indexOf(b);a=g=0;for(f=c.length;g<f;a=++g)if(d=c[a],d===b)return a;return-1};return n}())}).call(this);}).call(this);\r\n/* Mon 14 Oct 2013 10:54:59 BST */\r\n","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.turf = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nfunction simpleFeature(e,r){return{type:\"Feature\",geometry:e,properties:r}}var simplify=require(\"simplify-js\");module.exports=function(e,r,t){if(\"LineString\"===e.geometry.type){var i={type:\"LineString\",coordinates:[]},o=e.geometry.coordinates.map(function(e){return{x:e[0],y:e[1]}});return i.coordinates=simplify(o,r,t).map(function(e){return[e.x,e.y]}),simpleFeature(i,e.properties)}if(\"Polygon\"===e.geometry.type){var n={type:\"Polygon\",coordinates:[]};return e.geometry.coordinates.forEach(function(e){var i=e.map(function(e){return{x:e[0],y:e[1]}}),o=simplify(i,r,t).map(function(e){return[e.x,e.y]});n.coordinates.push(o)}),simpleFeature(n,e.properties)}};\n\n},{\"simplify-js\":2}],2:[function(require,module,exports){\n!function(){\"use strict\";function n(n,e){var r=n.x-e.x,f=n.y-e.y;return r*r+f*f}function e(n,e,r){var f=e.x,t=e.y,i=r.x-f,u=r.y-t;if(0!==i||0!==u){var o=((n.x-f)*i+(n.y-t)*u)/(i*i+u*u);o>1?(f=r.x,t=r.y):o>0&&(f+=i*o,t+=u*o)}return i=n.x-f,u=n.y-t,i*i+u*u}function r(e,r){for(var f,t=e[0],i=[t],u=1,o=e.length;o>u;u++)f=e[u],n(f,t)>r&&(i.push(f),t=f);return t!==f&&i.push(f),i}function f(n,r){var f,t,i,u,o=n.length,y=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,p=new y(o),d=0,s=o-1,a=[],c=[];for(p[d]=p[s]=1;s;){for(t=0,f=d+1;s>f;f++)i=e(n[f],n[d],n[s]),i>t&&(u=f,t=i);t>r&&(p[u]=1,a.push(d,u,u,s)),s=a.pop(),d=a.pop()}for(f=0;o>f;f++)p[f]&&c.push(n[f]);return c}function t(n,e,t){var i=void 0!==e?e*e:1;return n=t?n:r(n,i),n=f(n,i)}\"function\"==typeof define&&define.amd?define(function(){return t}):\"undefined\"!=typeof module?module.exports=t:\"undefined\"!=typeof self?self.simplify=t:window.simplify=t}();\n\n},{}],3:[function(require,module,exports){\nmodule.exports={simplify:require(\"turf-simplify\")};\n},{\"turf-simplify\":1}]},{},[3])(3)\n});","/*\r\n Copyright (c) 2012, Smartrak, David Leaver\r\n Leaflet.utfgrid is an open-source JavaScript library that provides utfgrid interaction on leaflet powered maps.\r\n https://github.com/danzel/Leaflet.utfgrid\r\n*/\r\n(function (window, undefined) {\r\n\r\nL.Util.ajaxGrid = function (url, cb) {\r\n\t// the following is from JavaScript: The Definitive Guide\r\n\t// and https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest/Using_XMLHttpRequest_in_IE6\r\n\tif (window.XMLHttpRequest === undefined) {\r\n\t\twindow.XMLHttpRequest = function () {\r\n\t\t\t/*global ActiveXObject:true */\r\n\t\t\ttry {\r\n\t\t\t\treturn new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t\t}\r\n\t\t\tcatch  (e) {\r\n\t\t\t\tthrow new Error(\"XMLHttpRequest is not supported\");\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tvar response, request = new XMLHttpRequest();\r\n\trequest.open(\"GET\", url);\r\n\trequest.onreadystatechange = function () {\r\n\t\t/*jshint evil: true */\r\n\t\tif (request.readyState === 4 && request.status === 200) {\r\n\t\t\tif (window.JSON) {\r\n\t\t\t\tif(request.responseText.toLowerCase().indexOf(\"error\")!=-1){\r\n\t\t\t\t\tconsole.debug(\"ResponseText WMS error:\"+request.responseText);\r\n\t\t\t\t}\r\n\t\t\t\telse if (request.responseText.toLowerCase().indexOf(\"mapserver message\")!=-1){\r\n\t\t\t\t\tconsole.debug(\"MapServer Message:\"+request.responseText);\r\n\t\t\t\t}\r\n\t\t\t\telse response = JSON.parse(request.responseText);\r\n\t\t\t} else {\r\n\t\t\t\tresponse = eval(\"(\" + request.responseText + \")\");\r\n\t\t\t}\r\n\t\t\tcb(response);\r\n\t\t}\r\n\t};\r\n\trequest.send();\r\n};\r\n\r\n\r\nL.UtfGrid = L.Class.extend({\r\n\tincludes: L.Mixin.Events,\r\n\toptions: {\r\n\t\tsubdomains: 'abc',\r\n\r\n\t\tminZoom: 0,\r\n\t\tmaxZoom: 18,\r\n\t\ttileSize: 256,\r\n\r\n\t\tresolution: 4,\r\n\r\n\t\tuseJsonP: false,\r\n\t\tpointerCursor: true\r\n\t},\r\n\tdefaultWmsParams: {\r\n\t\tservice: 'WMS',\r\n\t\trequest: 'GetMap',\r\n\t\tversion: '1.1.1',\r\n\t\tlayers: '',\r\n\t\tstyles: '',\r\n\t\tformat: 'utfgrid',\r\n\t\ttransparent: false\r\n\t},\r\n\r\n\t//The thing the mouse is currently on\r\n\t_mouseOn: null,\r\n\r\n\tinitialize: function (url, options) {\r\n\t\t\r\n\t\tthis._url = url;\r\n\t\tthis._cache = {};\r\n\r\n\t\t//Find a unique id in window we can use for our callbacks\r\n\t\t//Required for jsonP\r\n\t\tvar i = 0;\r\n\t\twhile (window['lu' + i]) {\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tthis._windowKey = 'lu' + i;\r\n\t\twindow[this._windowKey] = {};\r\n\r\n\t\tvar subdomains = this.options.subdomains;\r\n\t\tif (typeof this.options.subdomains === 'string') {\r\n\t\t\tthis.options.subdomains = subdomains.split('');\r\n\t\t}\r\n\t\tvar wmsParams = L.Util.extend({}, this.defaultWmsParams);\r\n\t\twmsParams.width = wmsParams.height = this.options.tileSize;\r\n\r\n\t\tfor (var i in options) {\r\n\t\t\t// all keys that are not TileLayer options go to WMS params\r\n\t\t\tif (!this.options.hasOwnProperty(i)) {\r\n\t\t\t\twmsParams[i] = options[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.wmsParams = wmsParams;\r\n\r\n\t\tL.Util.setOptions(this, options);\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\t\tthis._container = this._map._container;\r\n\r\n\t\tthis._update();\r\n\r\n\t\tvar zoom = this._map.getZoom();\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tmap.on('click', this._click, this);\r\n\t\tmap.on('mousemove', this._move, this);\r\n\t\tmap.on('moveend', this._update, this);\r\n\t},\r\n\r\n\tonRemove: function () {\r\n\t\tvar map = this._map;\r\n\t\tmap.off('click', this._click, this);\r\n\t\tmap.off('mousemove', this._move, this);\r\n\t\tmap.off('moveend', this._update, this);\r\n\t\tif (this.options.pointerCursor) {\r\n\t\t\tthis._container.style.cursor = '';\r\n\t\t}\r\n\t},\r\n\r\n\t_click: function (e) {\r\n\t\tthis.fire('click', this._objectForEvent(e));\r\n\t},\r\n\t_move: function (e) {\r\n\t\tvar on = this._objectForEvent(e);\r\n\r\n\t\tif (on.data !== this._mouseOn) {\r\n\t\t\tif (this._mouseOn) {\r\n\t\t\t\tthis.fire('mouseout', { latlng: e.latlng, data: this._mouseOn });\r\n\t\t\t\tif (this.options.pointerCursor) {\r\n\t\t\t\t\tthis._container.style.cursor = '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (on.data) {\r\n\t\t\t\tthis.fire('mouseover', on);\r\n\t\t\t\tif (this.options.pointerCursor) {\r\n\t\t\t\t\tthis._container.style.cursor = 'pointer';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseOn = on.data;\r\n\t\t} else if (on.data) {\r\n\t\t\tthis.fire('mousemove', on);\r\n\t\t}\r\n\t},\r\n\r\n\t_objectForEvent: function (e) {\r\n\t\tvar map = this._map,\r\n\t\t    point = map.project(e.latlng),\r\n\t\t    tileSize = this.options.tileSize,\r\n\t\t    resolution = this.options.resolution,\r\n\t\t    x = Math.floor(point.x / tileSize),\r\n\t\t    y = Math.floor(point.y / tileSize),\r\n\t\t    gridX = Math.floor((point.x - (x * tileSize)) / resolution),\r\n\t\t    gridY = Math.floor((point.y - (y * tileSize)) / resolution),\r\n\t\t\tmax = map.options.crs.scale(map.getZoom()) / tileSize;\r\n\r\n\t\tx = (x + max) % max;\r\n\t\ty = (y + max) % max;\r\n\t\t\r\n\t\tvar data = this._cache[map.getZoom() + '_' + x + '_' + y];\r\n\t\tif (!data) {\r\n\t\t\treturn { latlng: e.latlng, data: null };\r\n\t\t}\r\n\r\n\t\tvar idx = this._utfDecode(data.grid[gridY].charCodeAt(gridX)),\r\n\t\t    key = data.keys[idx],\r\n\t\t    result = data.data[key];\r\n\r\n\t\tif (!data.data.hasOwnProperty(key)) {\r\n\t\t\tresult = null;\r\n\t\t}\r\n\r\n\t\treturn { latlng: e.latlng, data: result};\r\n\t},\r\n\r\n\t//Load up all required json grid files\r\n\t//TODO: Load from center etc\r\n\t_update: function () {\r\n\t\tvar bounds = this._map.getPixelBounds(),\r\n\t\t    zoom = this._map.getZoom(),\r\n\t\t    tileSize = this.options.tileSize;\r\n\r\n\t\tif (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar nwTilePoint = new L.Point(\r\n\t\t\t\tMath.floor(bounds.min.x / tileSize),\r\n\t\t\t\tMath.floor(bounds.min.y / tileSize)),\r\n\t\t\tseTilePoint = new L.Point(\r\n\t\t\t\tMath.floor(bounds.max.x / tileSize),\r\n\t\t\t\tMath.floor(bounds.max.y / tileSize)),\r\n\t\t\t\tmax = this._map.options.crs.scale(zoom) / tileSize;\r\n\r\n\t\t//Load all required ones\r\n\t\tfor (var x = nwTilePoint.x; x <= seTilePoint.x; x++) {\r\n\t\t\tfor (var y = nwTilePoint.y; y <= seTilePoint.y; y++) {\r\n\r\n\t\t\t\tvar xw = (x + max) % max, yw = (y + max) % max;\r\n\t\t\t\tvar key = zoom + '_' + xw + '_' + yw;\r\n\r\n\t\t\t\tif (!this._cache.hasOwnProperty(key)) {\r\n\t\t\t\t\tthis._cache[key] = null;\r\n\r\n\t\t\t\t\tif (this.options.useJsonP) {\r\n\t\t\t\t\t\tthis._loadTileP(zoom, xw, yw);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._loadTile(zoom, xw, yw);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_loadTileP: function (zoom, x, y) {\r\n\t\tvar head = document.getElementsByTagName('head')[0],\r\n\t\t    key = zoom + '_' + x + '_' + y,\r\n\t\t    functionName = 'lu_' + key,\r\n\t\t    wk = this._windowKey,\r\n\t\t    self = this;\r\n\r\n\t\tvar url = L.Util.template(this._url, L.Util.extend({\r\n\t\t\ts: L.TileLayer.prototype._getSubdomain.call(this, { x: x, y: y }),\r\n\t\t\tz: zoom,\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tcb: wk + '.' + functionName\r\n\t\t}, this.options));\r\n\r\n\t\t\r\n\t\t/*var map = this._map,\r\n\t\tcrs = map.options.crs,\r\n\r\n\t\ttileSize = this.options.tileSize,\r\n\r\n\t\r\n\t\t\r\n\t\tbounds = this._map.getBounds();\r\n\t\tvar SRS=\"EPSG:4326\";\r\n\t\tvar bbox=bounds.toBBoxString();\r\n\t\tif(SRS.indexOf('3857')!=-1){\r\n\t\t\t\tvar NW = L.CRS.EPSG3857.project(bounds.getNorthWest());\r\n\t\t\t\tvar SE = L.CRS.EPSG3857.project(bounds.getSouthEast());\r\n\t\t\t\t  \r\n\t\t\t\t bbox=NW.x+\",\"+SE.y+\",\"+SE.x+\",\"+NW.y;\r\n\t\t\t\r\n\t\t\t}\r\n\t\t*/\r\n\t\tvar tilePoint = new L.Point(x,y);\r\n\t\t\t\t\r\n\t\t  var map = this._map,\r\n\t          crs = map.options.crs,\r\n\t          tileSize = this.options.tileSize,\r\n\t\t  nwPoint = tilePoint.multiplyBy(tileSize),\r\n\t\t  sePoint = nwPoint.add([tileSize, tileSize]),\r\n\r\n\t\t  //nw = crs.project(map.unproject(nwPoint, zoom)),\r\n\t\t  //se = crs.project(map.unproject(sePoint, zoom)),\r\n\r\n\t\t  bbox = [nwPoint.x, sePoint.y, sePoint.x, nwPoint.y].join(','),\r\n\t\t\t\r\n\t\turl = url + (L.Util.getParamString(this.wmsParams)).replace(\"?\",\"\") + \"&bbox=\" + bbox;\r\n\t\t\r\n\t\t\t\t\r\n\t\tvar script = document.createElement('script');\r\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\r\n\t\tscript.setAttribute(\"src\", url);\r\n\r\n\t\twindow[wk][functionName] = function (data) {\r\n\t\t\tself._cache[key] = data;\r\n\t\t\tdelete window[wk][functionName];\r\n\t\t\t//head.removeChild(script);\r\n\t\t};\r\n\r\n\t\thead.appendChild(script);\r\n\t},\r\n\r\n\t_loadTile: function (zoom, x, y) {\r\n\t\tvar url = L.Util.template(this._url, L.Util.extend({\r\n\t\t\ts: L.TileLayer.prototype._getSubdomain.call(this, { x: x, y: y }),\r\n\t\t\tz: zoom,\r\n\t\t\tx: x,\r\n\t\t\ty: y\r\n\t\t}, this.options));\r\n\t\t\r\n\t\t\r\n\t\t/*bounds = this._map.getBounds();\r\n\t\tvar SRS=\"EPSG:4326\";\r\n\t\tvar bbox=bounds.toBBoxString();\r\n\t\tif(SRS.indexOf('3857')!=-1){\r\n\t\t\t\tvar NW = L.CRS.EPSG3857.project(bounds.getNorthWest());\r\n\t\t\t\tvar SE = L.CRS.EPSG3857.project(bounds.getSouthEast());\r\n\t\t\t\t  \r\n\t\t\t\t bbox=NW.x+\",\"+SE.y+\",\"+SE.x+\",\"+NW.y;\r\n\t\t\t\r\n\t\t\t}\r\n\t\t*/\r\n\r\n\r\n\t\t  \r\n\t\t  \r\n\t\t  var tilePoint = new L.Point(x,y);\r\n\t\t  var tileSize = this.options.tileSize,\r\n          nwPoint = tilePoint.multiplyBy(tileSize),\r\n          sePoint = nwPoint.add([tileSize, tileSize]),\r\n          nw = this._map.unproject(nwPoint),\r\n          se = this._map.unproject(sePoint);\r\n\t\t  \r\n\t\t  var my_crs = this._map.options.crs; // get the CRS\r\n\t\t  var my_proj = my_crs.projection; // get the projection\r\n\t\t  // transform the lat lon Point to a utm point\r\n\t\t  var nw_utm = my_proj.project(nw); \r\n\t\t  var se_utm = my_proj.project(se); \r\n          bbox = [nw.lng, se.lat, se.lng, nw.lat].join(','),\r\n\t\t\t\r\n\t\turl = url + (L.Util.getParamString(this.wmsParams)).replace(\"?\",\"\") + \"&bbox=\" + bbox;\r\n\r\n\t\t\r\n\t\tvar key = zoom + '_' + x + '_' + y;\r\n\t\tvar self = this;\r\n\t\tL.Util.ajaxGrid(url, function (data) {\r\n\t\t\tself._cache[key] = data;\r\n\t\t});\r\n\t},\r\n\r\n\t_utfDecode: function (c) {\r\n\t\tif (c >= 93) {\r\n\t\t\tc--;\r\n\t\t}\r\n\t\tif (c >= 35) {\r\n\t\t\tc--;\r\n\t\t}\r\n\t\treturn c - 32;\r\n\t},\r\n\topenPopUp: function(data){\r\n\t\t\r\n//\t\tjQuery('#bt_info_geojsonvt_close').on('click', function (e) {\r\n////\t\t\tjQuery('#info_geojsonvt .div_popup_visor').html('');\r\n//\t\t\tjQuery('#info_geojsonvt').hide();\r\n//\t\t});\r\n\t\t\r\n\t\tvar html ='';\r\n\t\thtml+='<div class=\"popup_pres\">';\r\n\t\t$.each( data, function( key, value ) {\r\n\t\t\tif(value!=undefined && value!=null && value != \" \"){\r\n\t\t\t\thtml+='<div class=\"popup_data_row\">';\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(key.indexOf(\"ANY_ANTIC\")!=-1) key = \"ANY CONSTRUCCI&Oacute; LOCAL PRINCIPAL\";\r\n\t\t\t\t\telse if(key.indexOf(\"TIPOLOGIA4\")!=-1) key = \"TIPOLOGIA\";\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\thtml+='<div class=\"popup_data_key\">'+key+'</div>';\r\n\t\t\t\t\thtml+='<div class=\"popup_data_value\">'+value+'</div>';\r\n\t\t\t\thtml+= '</div>';\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\thtml+= '</div>';\r\n\t\t\r\n\t\tjQuery('#info_utfgrid .div_popup').html(html);\r\n\t\tjQuery('#info_utfgrid').css(\"border\", \"none\");\r\n\t\tjQuery('#info_utfgrid').show();\t\t\r\n\t\t\r\n\t}\r\n\t\r\n});\r\n\r\n\r\nL.utfGrid = function (url, options) {\r\n\treturn new L.UtfGrid(url, options);\r\n};\r\n\r\n\r\n}(this));\r\n","// Panoramio plugin for Leaflet\n// https://github.com/shurshur/Leaflet.Panoramio\n\nL.Panoramio = L.FeatureGroup.extend({\n\toptions: {\n\t\tmaxLoad: 100, // max photos loaded in one request (should be less or equal 100)\n\t\tmaxTotal: 300 // max total photos\n\t},\n\n\tinitialize: function(options) {\n\t\tL.FeatureGroup.prototype.initialize.call(this);\n\t\tL.Util.setOptions(this, options);\n\t},\n\n\tonAdd: function(map, insertAtTheBottom) {\n\t\tthis._map = map;\n\t\tthis._insertAtTheBottom = insertAtTheBottom;\n\t\tthis._update('map');\n\t\tmap.on('moveend', this._update, this);\n\t\tthis.fire('add');\n\t},\n\n\tonRemove: function(map) {\n\t\tmap.off('moveend', this._update, this);\n\t\tthis.eachLayer(map.removeLayer, map);\n\t\tthis.fire('remove');\n\t},\n\n\t_load: function(data) {\n\t\tfor (var i = 0; i < data.photos.length; i++) {\n\t\t\tvar p = data.photos[i];\n\t\t\tvar ico = new L.Icon({\n\t\t\t\ticonUrl: 'http://www.panoramio.com/img/panoramio-marker.png',\n\t\t\t\tshadowUrl: null,\n\t\t\t\ticonAnchor: [9,9],\n\t\t\t\tpopupAnchor: [0,-10]\n\t\t\t});\n\t\t\tvar m = new L.Marker([p.latitude,p.longitude], {icon: ico});\n\t\t\tm.bindPopup('<img src=\"http://www.panoramio.com/img/glass/components/logo_bar/panoramio.png\"><br/>'+p.photo_title+'<br/><a id=\"'+p.photo_id+'\" title=\"'+p.photo_title+'\" rel=\"pano\" href=\"'+p.photo_url+'\" target=\"_new\"><img src=\"'+p.photo_file_url +'\" alt=\"'+p.photo_title+'\" width=\"167\"/></a><br/>&copy;&nbsp;<a href=\"'+p.owner_url+'\" target=\"_new\">'+p.owner_name+'</a>, '+p.upload_date);\n\t\t\tthis.fire('addlayer', {\n\t\t\t\tlayer: m\n\t\t\t});\n\t\t\tthis.addLayer(m);\n\t\t}\n\t\tvar ks = [];\n\t\tfor(var key in this._layers)\n\t\t\tks.push(key);\n\t\tfor(var i = 0; i < ks.length-this.options.maxTotal; i++)\n\t\t\tthis.removeLayer(this._layers[ks[i]]);\n\t\t//this.fire(\"loaded\");\n\t},\n\n\t_update: function() {\n\t\tvar zoom = this._map.getZoom();\n\t\tvar bounds = this._map.getBounds();\n\t\tvar minll = bounds.getSouthWest();\n\t\tvar maxll = bounds.getNorthEast();\n  \t\tif(this._zoom && this._bbox)\n    \t\t\tif(this._zoom == zoom && minll.lng >= this._bbox[0] && minll.lat >= this._bbox[1] && maxll.lng <= this._bbox[2] && maxll.lat <= this._bbox[3])\n      \t\t\t\treturn;\n  \t\tvar bbox = [];\n  \t\tbbox[0] = minll.lng;\n  \t\tbbox[1] = minll.lat;\n  \t\tbbox[2] = maxll.lng;\n  \t\tbbox[3] = maxll.lat;\n\t\tthis._bbox = bbox;\n\t\tthis._zoom = zoom;\n\t\tvar _this = this;\n\t\tvar cbid = '_leaflet_panoramio';\n\t\twindow[cbid] = function (json) {\n\t\t\t_this.json = json;\n\t\t\twindow[cbid] = undefined;\n\t\t\tvar e = document.getElementById(cbid);\n\t\t\te.parentNode.removeChild(e);\n\t\t\t_this._load(json);\n\t\t};\n\t\tvar url = 'http://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to='+this.options.maxLoad+'&minx='+\n\t\t  minll.lng+'&miny='+minll.lat+'&maxx='+maxll.lng+'&maxy='+maxll.lat+'&size=small&mapfilter=true&callback='+cbid;\n\t\tvar script = document.createElement(\"script\");\n\t\tscript.type = \"text/javascript\";\n\t\tscript.src = url;\n\t\tscript.id = cbid;\n\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n});\n","// Panoramio plugin for Leaflet\n// https://github.com/shurshur/Leaflet.Panoramio\n\nL.Panoramio.custom = L.Panoramio.extend({\n\n\t_load: function(data) {\n\t\tfor (var i = 0; i < data.photos.length; i++) {\n\t\t\tvar p = data.photos[i];\n\t\t\tvar ico = new L.Icon({\n\t\t\t\ticonUrl: p.photo_file_url,//'http://www.panoramio.com/img/panoramio-marker.png',\n\t\t\t\tshadowUrl: null,\n\t\t\t\ticonAnchor: [9,9],\n\t\t\t\tpopupAnchor: [0,-10],\n\t\t\t\tclassName: 'photo-panoramio'\n\t\t\t});\n\t\t\tvar m = new L.Marker([p.latitude,p.longitude], {icon: ico});\n\t\t\tm.bindPopup('<img src=\"http://www.panoramio.com/img/glass/components/logo_bar/panoramio.png\"><br/>'+p.photo_title+'<br/><a id=\"'+p.photo_id+'\" title=\"'+p.photo_title+'\" rel=\"pano\" href=\"'+p.photo_url+'\" target=\"_new\"><img src=\"'+p.photo_file_url +'\" alt=\"'+p.photo_title+'\" width=\"167\"/></a><br/>&copy;&nbsp;<a href=\"'+p.owner_url+'\" target=\"_new\">'+p.owner_name+'</a>, '+p.upload_date);\n\t\t\tthis.fire('addlayer', {\n\t\t\t\tlayer: m\n\t\t\t});\n\t\t\tthis.addLayer(m);\n\t\t}\n\t\tvar ks = [];\n\t\tfor(var key in this._layers)\n\t\t\tks.push(key);\n\t\tfor(var i = 0; i < ks.length-this.options.maxTotal; i++)\n\t\t\tthis.removeLayer(this._layers[ks[i]]);\n\t\tthis.fire(\"loaded\");\n\t},\n\n\t_update: function() {\n\t\tvar zoom = this._map.getZoom();\n\t\tvar bounds = this._map.getBounds();\n\t\tvar minll = bounds.getSouthWest();\n\t\tvar maxll = bounds.getNorthEast();\n  \t\t/*if(this._zoom && this._bbox)\n    \t\t\tif(this._zoom == zoom && minll.lng >= this._bbox[0] && minll.lat >= this._bbox[1] && maxll.lng <= this._bbox[2] && maxll.lat <= this._bbox[3])\n      \t\t\t\treturn;*/\n\t\t\n\t\t//Abans de recarregar elimino tots els markers\n\t\tthis.clearLayers();  \t\t\n\t\t\n\t\tvar bbox = [];\n  \t\tbbox[0] = minll.lng;\n  \t\tbbox[1] = minll.lat;\n  \t\tbbox[2] = maxll.lng;\n  \t\tbbox[3] = maxll.lat;\n  \t\t\n\t\tthis._bbox = bbox;\n\t\tthis._zoom = zoom;\n\t\tvar _this = this;\n\t\tvar cbid = '_leaflet_panoramio';\n\t\twindow[cbid] = function (json) {\n\t\t\t_this.json = json;\n\t\t\twindow[cbid] = undefined;\n\t\t\tvar e = document.getElementById(cbid);\n\t\t\te.parentNode.removeChild(e);\n\t\t\t_this._load(json);\n\t\t};\n\t\t\n\t\tvar url = 'http://www.panoramio.com/map/get_panoramas.php?order=upload_date&set=public&from=0&to='+this.options.maxLoad+'&minx='+\n\t\t  minll.lng+'&miny='+minll.lat+'&maxx='+maxll.lng+'&maxy='+maxll.lat+'&size=small&mapfilter=true&callback='+cbid;\n\t\t\n\t\tvar boundsICGC = L.latLngBounds(L.latLng(41.368060902971166, 2.1521562337875366), \n\t\t\t\t\t L.latLng(41.37156735542552, 2.158936858177185));\n\t\t \n\t\tif(boundsICGC.contains(bounds)){\n\t\t\tconsole.info(\"geostarters!\");\n\t\t\tvar url = 'http://www.panoramio.com/map/get_panoramas.php?order=upload_date&set=8024775&from=0&to='+this.options.maxLoad+'&minx='+\n\t\t\t  minll.lng+'&miny='+minll.lat+'&maxx='+maxll.lng+'&maxy='+maxll.lat+'&size=medium&mapfilter=true&callback='+cbid;\t\t\t\n\t\t}\n\t\t//var url = 'http://api.geonames.org/wikipediaBoundingBox?north=43.25320494908846&south=39.554883059924016&east=4.6142578125&west=-2.3291015625&username=geostarters&callback=_leaflet_panoramio';\n\t\t\n\t\tvar script = document.createElement(\"script\");\n\t\tscript.type = \"text/javascript\";\n\t\tscript.src = url;\n\t\tscript.id = cbid;\n\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n});\n","/*\r\n\tLeaflet.label, a plugin that adds labels to markers and vectors for Leaflet powered maps.\r\n\t(c) 2012-2013, Jacob Toye, Smartrak\r\n\r\n\thttps://github.com/Leaflet/Leaflet.label\r\n\thttp://leafletjs.com\r\n\thttps://github.com/jacobtoye\r\n*/\r\n(function (window, document, undefined) {\r\nvar L = window.L;/*\r\n * Leaflet.label assumes that you have already included the Leaflet library.\r\n */\r\n\r\nL.labelVersion = '0.2.2-dev';\r\n\r\nL.Label = L.Class.extend({\r\n\r\n\tincludes: L.Mixin.Events,\r\n\r\n\toptions: {\r\n\t\tclassName: '',\r\n\t\tclickable: false,\r\n\t\tdirection: 'right',\r\n\t\tnoHide: false,\r\n\t\toffset: [12, -15], // 6 (width of the label triangle) + 6 (padding)\r\n\t\topacity: 1,\r\n\t\tzoomAnimation: true\r\n\t},\r\n\r\n\tinitialize: function (options, source) {\r\n\t\tL.setOptions(this, options);\r\n\r\n\t\tthis._source = source;\r\n\t\tthis._animated = L.Browser.any3d && this.options.zoomAnimation;\r\n\t\tthis._isOpen = false;\r\n\t},\r\n\r\n\tonAdd: function (map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tthis._pane = this.options.pane ? map._panes[this.options.pane] :\r\n\t\t\tthis._source instanceof L.Marker ? map._panes.markerPane : map._panes.popupPane;\r\n\r\n\t\tif (!this._container) {\r\n\t\t\tthis._initLayout();\r\n\t\t}\r\n\r\n\t\tthis._pane.appendChild(this._container);\r\n\r\n\t\tthis._initInteraction();\r\n\r\n\t\tthis._update();\r\n\r\n\t\tthis.setOpacity(this.options.opacity);\r\n\r\n\t\tmap\r\n\t\t\t.on('moveend', this._onMoveEnd, this)\r\n\t\t\t.on('viewreset', this._onViewReset, this);\r\n\r\n\t\tif (this._animated) {\r\n\t\t\tmap.on('zoomanim', this._zoomAnimation, this);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.touch && !this.options.noHide) {\r\n\t\t\tL.DomEvent.on(this._container, 'click', this.close, this);\r\n\t\t\tmap.on('click', this.close, this);\r\n\t\t}\r\n\t},\r\n\r\n\tonRemove: function (map) {\r\n\t\tthis._pane.removeChild(this._container);\r\n\r\n\t\tmap.off({\r\n\t\t\tzoomanim: this._zoomAnimation,\r\n\t\t\tmoveend: this._onMoveEnd,\r\n\t\t\tviewreset: this._onViewReset\r\n\t\t}, this);\r\n\r\n\t\tthis._removeInteraction();\r\n\r\n\t\tthis._map = null;\r\n\t},\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tthis._latlng = L.latLng(latlng);\r\n\t\tif (this._map) {\r\n\t\t\tthis._updatePosition();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetContent: function (content) {\r\n\t\t// Backup previous content and store new content\r\n\t\tthis._previousContent = this._content;\r\n\t\tthis._content = content;\r\n\r\n\t\tthis._updateContent();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclose: function () {\r\n\t\tvar map = this._map;\r\n\r\n\t\tif (map) {\r\n\t\t\tif (L.Browser.touch && !this.options.noHide) {\r\n\t\t\t\tL.DomEvent.off(this._container, 'click', this.close);\r\n\t\t\t\tmap.off('click', this.close, this);\r\n\t\t\t}\r\n\r\n\t\t\tmap.removeLayer(this);\r\n\t\t}\r\n\t},\r\n\r\n\tupdateZIndex: function (zIndex) {\r\n\t\tthis._zIndex = zIndex;\r\n\r\n\t\tif (this._container && this._zIndex) {\r\n\t\t\tthis._container.style.zIndex = zIndex;\r\n\t\t}\r\n\t},\r\n\r\n\tsetOpacity: function (opacity) {\r\n\t\tthis.options.opacity = opacity;\r\n\r\n\t\tif (this._container) {\r\n\t\t\tL.DomUtil.setOpacity(this._container, opacity);\r\n\t\t}\r\n\t},\r\n\r\n\t_initLayout: function () {\r\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-label ' + this.options.className + ' leaflet-zoom-animated');\r\n\t\tthis.updateZIndex(this._zIndex);\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._map) { return; }\r\n\r\n\t\tthis._container.style.visibility = 'hidden';\r\n\r\n\t\tthis._updateContent();\r\n\t\tthis._updatePosition();\r\n\r\n\t\tthis._container.style.visibility = '';\r\n\t},\r\n\r\n\t_updateContent: function () {\r\n\t\tif (!this._content || !this._map || this._prevContent === this._content) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof this._content === 'string') {\r\n\t\t\tthis._container.innerHTML = this._content;\r\n\r\n\t\t\tthis._prevContent = this._content;\r\n\r\n\t\t\tthis._labelWidth = this._container.offsetWidth;\r\n\t\t\tthis._labelHeight = this._container.offsetHeight;\r\n\t\t}\r\n\t},\r\n\r\n\t_updatePosition: function () {\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng);\r\n\r\n\t\tthis._setPosition(pos);\r\n\t},\r\n\r\n\t_setPosition: function (pos) {\r\n\t\tvar map = this._map,\r\n\t\t\tcontainer = this._container,\r\n\t\t\tcenterPoint = map.latLngToContainerPoint(map.getCenter()),\r\n\t\t\tlabelPoint = map.layerPointToContainerPoint(pos),\r\n\t\t\tdirection = this.options.direction,\r\n\t\t\tlabelWidth = this._labelWidth,\r\n\t\t\tlabelHeight = this._labelHeight,\r\n\t\t\toffset = L.point(this.options.offset);\r\n\r\n\t\t// position to the right (right or auto & needs to)\r\n\t\tif (direction === 'center') {\r\n\t\t\t\tL.DomUtil.addClass(container, 'leaflet-label-center');\r\n\t\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-left');\r\n\t\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-right');\r\n\t\t\t\tpos = pos.add(L.point(-offset.x - (labelWidth / 2), offset.y));\r\n\t\t}\r\n\t\telse if (direction === 'right' || direction === 'auto' && labelPoint.x < centerPoint.x) {\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-label-right');\r\n\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-left');\r\n\r\n\t\t\tpos = pos.add(offset);\r\n\t\t} else if (direction === 'left') { // position to the left\r\n\t\t\tL.DomUtil.addClass(container, 'leaflet-label-left');\r\n\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-right');\r\n\r\n\t\t\tpos = pos.add(L.point(-offset.x - labelWidth, offset.y));\r\n\t\t} else { // position to the left\r\n\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-left');\r\n\t\t\tL.DomUtil.removeClass(container, 'leaflet-label-right');\r\n\t\t\tpos = pos.add(L.point(-offset.x - (labelWidth / 2), labelHeight));\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\t\t//console.debug(pos);\r\n\t\tL.DomUtil.setPosition(container, pos);\r\n\t},\r\n\r\n\t_zoomAnimation: function (opt) {\r\n\t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n\t\tthis._setPosition(pos);\r\n\t},\r\n\r\n\t_onMoveEnd: function () {\r\n\t\tif (!this._animated || this.options.direction === 'auto') {\r\n\t\t\tthis._updatePosition();\r\n\t\t}\r\n\t},\r\n\r\n\t_onViewReset: function (e) {\r\n\t\t/* if map resets hard, we must update the label */\r\n\t\tif (e && e.hard) {\r\n\t\t\tthis._update();\r\n\t\t}\r\n\t},\r\n\r\n\t_initInteraction: function () {\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\tvar container = this._container,\r\n\t\t\tevents = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.addClass(container, 'leaflet-clickable');\r\n\t\tL.DomEvent.on(container, 'click', this._onMouseClick, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.on(container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeInteraction: function () {\r\n\t\tif (!this.options.clickable) { return; }\r\n\r\n\t\tvar container = this._container,\r\n\t\t\tevents = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];\r\n\r\n\t\tL.DomUtil.removeClass(container, 'leaflet-clickable');\r\n\t\tL.DomEvent.off(container, 'click', this._onMouseClick, this);\r\n\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tL.DomEvent.off(container, events[i], this._fireMouseEvent, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_onMouseClick: function (e) {\r\n\t\tthis._source.openPopup();\r\n\t\t e.stopPropagation();\r\n\t\t  e.preventDefault();\r\n\t\tif (this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n       \t \r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\t},\r\n\r\n\t_fireMouseEvent: function (e) {\r\n\t\tthis.fire(e.type, {\r\n\t\t\toriginalEvent: e\r\n\t\t});\r\n\r\n\t\t// TODO proper custom event propagation\r\n\t\t// this line will always be called if marker is in a FeatureGroup\r\n\t\tif (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t\tif (e.type !== 'mousedown') {\r\n\t\t\tL.DomEvent.stopPropagation(e);\r\n\t\t} else {\r\n\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\n// This object is a mixin for L.Marker and L.CircleMarker. We declare it here as both need to include the contents.\r\nL.BaseMarkerMethods = {\r\n\tshowLabel: function () {\r\n\t\tif (this.label && this._map) {\r\n\t\t\tthis.label.setLatLng(this._latlng);\r\n\t\t\tthis._map.showLabel(this.label);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\thideLabel: function () {\r\n\t\tif (this.label) {\r\n\t\t\tthis.label.close();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetLabelNoHide: function (noHide) {\r\n\t\tif (this._labelNoHide === noHide) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._labelNoHide = noHide;\r\n\r\n\t\tif (noHide) {\r\n\t\t\tthis._removeLabelRevealHandlers();\r\n\t\t\tthis.showLabel();\r\n\t\t} else {\r\n\t\t\tthis._addLabelRevealHandlers();\r\n\t\t\tthis.hideLabel();\r\n\t\t}\r\n\t},\r\n\r\n\tbindLabel: function (content, options) {\r\n\t\tvar labelAnchor = this.options.icon ? this.options.icon.options.labelAnchor : this.options.labelAnchor,\r\n\t\t\tanchor = L.point(labelAnchor) || L.point(0, 0);\r\n\r\n\t\tanchor = anchor.add(L.Label.prototype.options.offset);\r\n\r\n\t\tif (options && options.offset) {\r\n\t\t\tanchor = anchor.add(options.offset);\r\n\t\t}\r\n\r\n\t\toptions = L.Util.extend({offset: anchor}, options);\r\n\r\n\t\tthis._labelNoHide = options.noHide;\r\n\r\n\t\tif (!this.label) {\r\n\t\t\tif (!this._labelNoHide) {\r\n\t\t\t\tthis._addLabelRevealHandlers();\r\n\t\t\t}\r\n\r\n\t\t\tthis\r\n\t\t\t\t.on('remove', this.hideLabel, this)\r\n\t\t\t\t.on('move', this._moveLabel, this)\r\n\t\t\t\t.on('add', this._onMarkerAdd, this);\r\n\r\n\t\t\tthis._hasLabelHandlers = true;\r\n\t\t}\r\n\r\n\t\tthis.label = new L.Label(options, this)\r\n\t\t\t.setContent(content);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindLabel: function () {\r\n\t\tif (this.label) {\r\n\t\t\tthis.hideLabel();\r\n\r\n\t\t\tthis.label = null;\r\n\r\n\t\t\tif (this._hasLabelHandlers) {\r\n\t\t\t\tif (!this._labelNoHide) {\r\n\t\t\t\t\tthis._removeLabelRevealHandlers();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis\r\n\t\t\t\t\t.off('remove', this.hideLabel, this)\r\n\t\t\t\t\t.off('move', this._moveLabel, this)\r\n\t\t\t\t\t.off('add', this._onMarkerAdd, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._hasLabelHandlers = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateLabelContent: function (content) {\r\n\t\tif (this.label) {\r\n\t\t\tthis.label.setContent(content);\r\n\t\t}\r\n\t},\r\n\r\n\tgetLabel: function () {\r\n\t\treturn this.label;\r\n\t},\r\n\r\n\t_onMarkerAdd: function () {\r\n\t\tif (this._labelNoHide) {\r\n\t\t\tthis.showLabel();\r\n\t\t}\r\n\t},\r\n\r\n\t_addLabelRevealHandlers: function () {\r\n\t\tthis\r\n\t\t\t.on('mouseover', this.showLabel, this)\r\n\t\t\t.on('mouseout', this.hideLabel, this);\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tthis.on('click', this.showLabel, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeLabelRevealHandlers: function () {\r\n\t\tthis\r\n\t\t\t.off('mouseover', this.showLabel, this)\r\n\t\t\t.off('mouseout', this.hideLabel, this);\r\n\r\n\t\tif (L.Browser.touch) {\r\n\t\t\tthis.off('click', this.showLabel, this);\r\n\t\t}\r\n\t},\r\n\r\n\t_moveLabel: function (e) {\r\n\t\tthis.label.setLatLng(e.latlng);\r\n\t}\r\n};\r\n\r\n// Add in an option to icon that is used to set where the label anchor is\r\nL.Icon.Default.mergeOptions({\r\n\tlabelAnchor: new L.Point(9, -20)\r\n});\r\n\r\n// Have to do this since Leaflet is loaded before this plugin and initializes\r\n// L.Marker.options.icon therefore missing our mixin above.\r\nL.Marker.mergeOptions({\r\n\ticon: new L.Icon.Default()\r\n});\r\n\r\nL.Marker.include(L.BaseMarkerMethods);\r\nL.Marker.include({\r\n\t_originalUpdateZIndex: L.Marker.prototype._updateZIndex,\r\n\r\n\t_updateZIndex: function (offset) {\r\n\t\tvar zIndex = this._zIndex + offset;\r\n\r\n\t\tthis._originalUpdateZIndex(offset);\r\n\r\n\t\tif (this.label) {\r\n\t\t\tthis.label.updateZIndex(zIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_originalSetOpacity: L.Marker.prototype.setOpacity,\r\n\r\n\tsetOpacity: function (opacity, labelHasSemiTransparency) {\r\n\t\tthis.options.labelHasSemiTransparency = labelHasSemiTransparency;\r\n\r\n\t\tthis._originalSetOpacity(opacity);\r\n\t},\r\n\r\n\t_originalUpdateOpacity: L.Marker.prototype._updateOpacity,\r\n\r\n\t_updateOpacity: function () {\r\n\t\tvar absoluteOpacity = this.options.opacity === 0 ? 0 : 1;\r\n\r\n\t\tthis._originalUpdateOpacity();\r\n\r\n\t\t/*if (this.label) {\r\n\t\t\tthis.label.setOpacity(this.options.labelHasSemiTransparency ? this.options.opacity : absoluteOpacity);\r\n\t\t}*/\r\n\t},\r\n\r\n\t_originalSetLatLng: L.Marker.prototype.setLatLng,\r\n\r\n\tsetLatLng: function (latlng) {\r\n\t\tif (this.label && !this._labelNoHide) {\r\n\t\t\tthis.hideLabel();\r\n\t\t}\r\n\r\n\t\treturn this._originalSetLatLng(latlng);\r\n\t}\r\n});\r\n\r\n// Add in an option to icon that is used to set where the label anchor is\r\nL.CircleMarker.mergeOptions({\r\n\tlabelAnchor: new L.Point(0, 0)\r\n});\r\n\r\n\r\nL.CircleMarker.include(L.BaseMarkerMethods);\r\n\r\nL.Path.include({\r\n\tbindLabel: function (content, options) {\r\n\t\tif (!this.label || this.label.options !== options) {\r\n\t\t\tthis.label = new L.Label(options, this);\r\n\t\t}\r\n\r\n\t\tthis.label.setContent(content);\r\n\r\n\t\tif (!this._showLabelAdded) {\r\n\t\t\tthis\r\n\t\t\t\t.on('mouseover', this._showLabel, this)\r\n\t\t\t\t.on('mousemove', this._moveLabel, this)\r\n\t\t\t\t.on('mouseout remove', this._hideLabel, this);\r\n\r\n\t\t\tif (L.Browser.touch) {\r\n\t\t\t\tthis.on('click', this._showLabel, this);\r\n\t\t\t}\r\n\t\t\tthis._showLabelAdded = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tunbindLabel: function () {\r\n\t\tif (this.label) {\r\n\t\t\tthis._hideLabel();\r\n\t\t\tthis.label = null;\r\n\t\t\tthis._showLabelAdded = false;\r\n\t\t\tthis\r\n\t\t\t\t.off('mouseover', this._showLabel, this)\r\n\t\t\t\t.off('mousemove', this._moveLabel, this)\r\n\t\t\t\t.off('mouseout remove', this._hideLabel, this);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\tupdateLabelContent: function (content) {\r\n\t\tif (this.label) {\r\n\t\t\tthis.label.setContent(content);\r\n\t\t}\r\n\t},\r\n\r\n\t_showLabel: function (e) {\r\n\t\tthis.label.setLatLng(e.latlng);\r\n\t\tthis._map.showLabel(this.label);\r\n\t},\r\n\r\n\t_moveLabel: function (e) {\r\n\t\tthis.label.setLatLng(e.latlng);\r\n\t},\r\n\r\n\t_hideLabel: function () {\r\n\t\tthis.label.close();\r\n\t}\r\n});\r\n\r\nL.Map.include({\r\n\tshowLabel: function (label) {\r\n\t\treturn this.addLayer(label);\r\n\t}\r\n});\r\n\r\nL.FeatureGroup.include({\r\n\t// TODO: remove this when AOP is supported in Leaflet, need this as we cannot put code in removeLayer()\r\n\tclearLayers: function () {\r\n\t\tthis.unbindLabel();\r\n\t\tthis.eachLayer(this.removeLayer, this);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tbindLabel: function (content, options) {\r\n\t\treturn this.invoke('bindLabel', content, options);\r\n\t},\r\n\r\n\tunbindLabel: function () {\r\n\t\treturn this.invoke('unbindLabel');\r\n\t},\r\n\r\n\tupdateLabelContent: function (content) {\r\n\t\tthis.invoke('updateLabelContent', content);\r\n\t}\r\n});\r\n\r\n\r\n\r\n}(window, document));","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.geojsonvt = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nmodule.exports = clip;\n\n/* clip features between two axis-parallel lines:\n *     |        |\n *  ___|___     |     /\n * /   |   \\____|____/\n *     |        |\n */\n\nfunction clip(features, scale, k1, k2, axis, intersect) {\n\n    k1 /= scale;\n    k2 /= scale;\n\n    var clipped = [];\n\n    for (var i = 0; i < features.length; i++) {\n\n        var feature = features[i],\n            geometry = feature.geometry,\n            type = feature.type,\n            min, max;\n\n        if (feature.min) {\n            min = feature.min[axis];\n            max = feature.max[axis];\n\n            if (min >= k1 && max <= k2) { // trivial accept\n                clipped.push(feature);\n                continue;\n            } else if (min > k2 || max < k1) continue; // trivial reject\n        }\n\n        var slices = type === 1 ?\n                clipPoints(geometry, k1, k2, axis) :\n                clipGeometry(geometry, k1, k2, axis, intersect, type === 3);\n\n        if (slices.length) {\n            // if a feature got clipped, it will likely get clipped on the next zoom level as well,\n            // so there's no need to recalculate bboxes\n            clipped.push({\n                geometry: slices,\n                type: type,\n                tags: features[i].tags || null\n            });\n        }\n    }\n\n    return clipped.length ? clipped : null;\n}\n\nfunction clipPoints(geometry, k1, k2, axis) {\n    var slice = [];\n\n    for (var i = 0; i < geometry.length; i++) {\n        var a = geometry[i],\n            ak = a[axis];\n\n        if (ak >= k1 && ak <= k2) slice.push(a);\n    }\n    return slice;\n}\n\nfunction clipGeometry(geometry, k1, k2, axis, intersect, closed) {\n\n    var slices = [];\n\n    for (var i = 0; i < geometry.length; i++) {\n\n        var ak = 0,\n            bk = 0,\n            b = null,\n            points = geometry[i],\n            area = points.area,\n            dist = points.dist,\n            len = points.length,\n            a, j;\n\n        var slice = [];\n\n        for (j = 0; j < len - 1; j++) {\n            a = b || points[j];\n            b = points[j + 1];\n            ak = bk || a[axis];\n            bk = b[axis];\n\n            if (ak < k1) {\n\n                if ((bk > k2)) { // ---|-----|-->\n                    slice.push(intersect(a, b, k1), intersect(a, b, k2));\n                    if (!closed) slice = newSlice(slices, slice, area, dist);\n\n                } else if (bk >= k1) slice.push(intersect(a, b, k1)); // ---|-->  |\n\n            } else if (ak > k2) {\n\n                if ((bk < k1)) { // <--|-----|---\n                    slice.push(intersect(a, b, k2), intersect(a, b, k1));\n                    if (!closed) slice = newSlice(slices, slice, area, dist);\n\n                } else if (bk <= k2) slice.push(intersect(a, b, k2)); // |  <--|---\n\n            } else {\n\n                slice.push(a);\n\n                if (bk < k1) { // <--|---  |\n                    slice.push(intersect(a, b, k1));\n                    if (!closed) slice = newSlice(slices, slice, area, dist);\n\n                } else if (bk > k2) { // |  ---|-->\n                    slice.push(intersect(a, b, k2));\n                    if (!closed) slice = newSlice(slices, slice, area, dist);\n                }\n                // | --> |\n            }\n        }\n\n        // add the last point\n        a = points[len - 1];\n        ak = a[axis];\n        if (ak >= k1 && ak <= k2) slice.push(a);\n\n        // close the polygon if its endpoints are not the same after clipping\n        if (closed && slice[0] !== slice[slice.length - 1]) slice.push(slice[0]);\n\n        // add the final slice\n        newSlice(slices, slice, area, dist);\n    }\n\n    return slices;\n}\n\nfunction newSlice(slices, slice, area, dist) {\n    if (slice.length) {\n        // we don't recalculate the area/length of the unclipped geometry because the case where it goes\n        // below the visibility threshold as a result of clipping is rare, so we avoid doing unnecessary work\n        slice.area = area;\n        slice.dist = dist;\n\n        slices.push(slice);\n    }\n    return [];\n}\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nmodule.exports = convert;\n\nvar simplify = require('./simplify');\n\n// converts GeoJSON feature into an intermediate projected JSON vector format with simplification data\n\nfunction convert(data, tolerance) {\n    var features = [];\n\n    if (data.type === 'FeatureCollection') {\n        for (var i = 0; i < data.features.length; i++) {\n            convertFeature(features, data.features[i], tolerance);\n        }\n    } else if (data.type === 'Feature') {\n        convertFeature(features, data, tolerance);\n\n    } else {\n        // single geometry or a geometry collection\n        convertFeature(features, {geometry: data}, tolerance);\n    }\n    return features;\n}\n\nfunction convertFeature(features, feature, tolerance) {\n    var geom = feature.geometry,\n        type = geom.type,\n        coords = geom.coordinates,\n        tags = feature.properties,\n        i, j, rings;\n\n    if (type === 'Point') {\n        features.push(create(tags, 1, [projectPoint(coords)]));\n\n    } else if (type === 'MultiPoint') {\n        features.push(create(tags, 1, project(coords)));\n\n    } else if (type === 'LineString') {\n        features.push(create(tags, 2, [project(coords, tolerance)]));\n\n    } else if (type === 'MultiLineString' || type === 'Polygon') {\n        rings = [];\n        for (i = 0; i < coords.length; i++) {\n            rings.push(project(coords[i], tolerance));\n        }\n        features.push(create(tags, type === 'Polygon' ? 3 : 2, rings));\n\n    } else if (type === 'MultiPolygon') {\n        rings = [];\n        for (i = 0; i < coords.length; i++) {\n            for (j = 0; j < coords[i].length; j++) {\n                rings.push(project(coords[i][j], tolerance));\n            }\n        }\n        features.push(create(tags, 3, rings));\n\n    } else if (type === 'GeometryCollection') {\n        for (i = 0; i < geom.geometries.length; i++) {\n            convertFeature(features, {\n                geometry: geom.geometries[i],\n                properties: tags\n            }, tolerance);\n        }\n\n    } else {\n        console.warn('Unsupported GeoJSON type: ' + geom.type);\n    }\n}\n\nfunction create(tags, type, geometry) {\n    var feature = {\n        geometry: geometry,\n        type: type,\n        tags: tags || null,\n        min: [1, 1], // initial bbox values;\n        max: [0, 0]  // note that all coords are in [0..1] range\n    };\n    calcBBox(feature);\n    return feature;\n}\n\nfunction project(lonlats, tolerance) {\n    var projected = [];\n    for (var i = 0; i < lonlats.length; i++) {\n        projected.push(projectPoint(lonlats[i]));\n    }\n    if (tolerance) {\n        simplify(projected, tolerance);\n        calcSize(projected);\n    }\n    return projected;\n}\n\nfunction projectPoint(p) {\n    var sin = Math.sin(p[1] * Math.PI / 180),\n        x = (p[0] / 360 + 0.5),\n        y = (0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI);\n    return [x, y, 0];\n}\n\n// calculate area and length of the poly\nfunction calcSize(points) {\n    var area = 0,\n        dist = 0;\n\n    for (var i = 0, a, b; i < points.length - 1; i++) {\n        a = b || points[i];\n        b = points[i + 1];\n\n        area += a[0] * b[1] - b[0] * a[1];\n\n        // use Manhattan distance instead of Euclidian one to avoid expensive square root computation\n        dist += Math.abs(b[0] - a[0]) + Math.abs(b[1] - a[1]);\n    }\n    points.area = Math.abs(area / 2);\n    points.dist = dist;\n}\n\n// calculate the feature bounding box for faster clipping later\nfunction calcBBox(feature) {\n    var geometry = feature.geometry,\n        min = feature.min,\n        max = feature.max;\n\n    if (feature.type === 1) calcRingBBox(min, max, geometry);\n    else for (var i = 0; i < geometry.length; i++) calcRingBBox(min, max, geometry[i]);\n\n    return feature;\n}\n\nfunction calcRingBBox(min, max, points) {\n    for (var i = 0, p; i < points.length; i++) {\n        p = points[i];\n        min[0] = Math.min(p[0], min[0]);\n        max[0] = Math.max(p[0], max[0]);\n        min[1] = Math.min(p[1], min[1]);\n        max[1] = Math.max(p[1], max[1]);\n    }\n}\n\n},{\"./simplify\":4}],3:[function(require,module,exports){\n'use strict';\n\nmodule.exports = geojsonvt;\n\nvar convert = require('./convert'), // GeoJSON conversion and preprocessing\n    clip = require('./clip'),       // stripe clipping algorithm\n    createTile = require('./tile'); // final simplified tile generation\n\n\nfunction geojsonvt(data, options) {\n    return new GeoJSONVT(data, options);\n}\n\nfunction GeoJSONVT(data, options) {\n    options = this.options = extend(Object.create(this.options), options);\n\n    var debug = options.debug;\n\n    if (debug) console.time('preprocess data');\n\n    var z2 = 1 << options.maxZoom, // 2^z\n        features = convert(data, options.tolerance / (z2 * options.extent));\n\n    this.tiles = {};\n\n    if (debug) {\n        console.timeEnd('preprocess data');\n        console.log('index: maxZoom: %d, maxPoints: %d', options.indexMaxZoom, options.indexMaxPoints);\n        console.time('generate tiles');\n        this.stats = {};\n        this.total = 0;\n    }\n\n    // start slicing from the top tile down\n    this.splitTile(features, 0, 0, 0);\n\n    if (debug) {\n        console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n        console.timeEnd('generate tiles');\n        console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n    }\n}\n\nGeoJSONVT.prototype.options = {\n    maxZoom: 14,            // max zoom to preserve detail on\n    indexMaxZoom: 5,        // max zoom in the tile index\n    indexMaxPoints: 100000, // max number of points per tile in the tile index\n    tolerance: 3,           // simplification tolerance (higher means simpler)\n    extent: 4096,           // tile extent\n    buffer: 64,             // tile buffer on each side\n    debug: 0                // logging level (0, 1 or 2)\n};\n\nGeoJSONVT.prototype.splitTile = function (features, z, x, y, cz, cx, cy) {\n\n    var stack = [features, z, x, y],\n        options = this.options,\n        debug = options.debug,\n        extent = options.extent,\n        buffer = options.buffer;\n\n    // avoid recursion by using a processing queue\n    while (stack.length) {\n        features = stack.shift();\n        z = stack.shift();\n        x = stack.shift();\n        y = stack.shift();\n\n        var z2 = 1 << z,\n            id = toID(z, x, y),\n            tile = this.tiles[id],\n            tileTolerance = z === options.maxZoom ? 0 : options.tolerance / (z2 * extent);\n\n        if (!tile) {\n            if (debug > 1) console.time('creation');\n\n            tile = this.tiles[id] = createTile(features, z2, x, y, tileTolerance, z === options.maxZoom);\n\n            if (debug) {\n                if (debug > 1) {\n                    console.log('tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n                        z, x, y, tile.numFeatures, tile.numPoints, tile.numSimplified);\n                    console.timeEnd('creation');\n                }\n                var key = 'z' + z;\n                this.stats[key] = (this.stats[key] || 0) + 1;\n                this.total++;\n            }\n        }\n\n        // save reference to original geometry in tile so that we can drill down later if we stop now\n        tile.source = features;\n\n        // stop tiling if the tile is degenerate\n        if (isClippedSquare(tile.features, extent, buffer)) continue;\n\n        // if it's the first-pass tiling\n        if (!cz) {\n            // stop tiling if we reached max zoom, or if the tile is too simple\n            if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n\n        // if a drilldown to a specific tile\n        } else {\n            // stop tiling if we reached base zoom or our target tile zoom\n            if (z === options.maxZoom || z === cz) continue;\n\n            // stop tiling if it's not an ancestor of the target tile\n            var m = 1 << (cz - z);\n            if (x !== Math.floor(cx / m) && y !== Math.floor(cy / m)) continue;\n        }\n\n        // if we slice further down, no need to keep source geometry\n        tile.source = null;\n\n        if (debug > 1) console.time('clipping');\n\n        // values we'll use for clipping\n        var k1 = 0.5 * buffer / extent,\n            k2 = 0.5 - k1,\n            k3 = 0.5 + k1,\n            k4 = 1 + k1,\n            tl, bl, tr, br, left, right;\n\n        tl = bl = tr = br = null;\n\n        left  = clip(features, z2, x - k1, x + k3, 0, intersectX);\n        right = clip(features, z2, x + k2, x + k4, 0, intersectX);\n\n        if (left) {\n            tl = clip(left, z2, y - k1, y + k3, 1, intersectY);\n            bl = clip(left, z2, y + k2, y + k4, 1, intersectY);\n        }\n\n        if (right) {\n            tr = clip(right, z2, y - k1, y + k3, 1, intersectY);\n            br = clip(right, z2, y + k2, y + k4, 1, intersectY);\n        }\n\n        if (debug > 1) console.timeEnd('clipping');\n\n        if (tl) stack.push(tl, z + 1, x * 2,     y * 2);\n        if (bl) stack.push(bl, z + 1, x * 2,     y * 2 + 1);\n        if (tr) stack.push(tr, z + 1, x * 2 + 1, y * 2);\n        if (br) stack.push(br, z + 1, x * 2 + 1, y * 2 + 1);\n    }\n};\n\nGeoJSONVT.prototype.getTile = function (z, x, y) {\n    var options = this.options,\n        extent = options.extent,\n        debug = options.debug;\n\n    var id = toID(z, x, y);\n    if (this.tiles[id]) return transformTile(this.tiles[id], extent);\n\n    if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n    var z0 = z,\n        x0 = x,\n        y0 = y,\n        parent;\n\n    while (!parent && z0 > 0) {\n        z0--;\n        x0 = Math.floor(x0 / 2);\n        y0 = Math.floor(y0 / 2);\n        parent = this.tiles[toID(z0, x0, y0)];\n    }\n\n    if (debug > 1) console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n\n    // if we found a parent tile containing the original geometry, we can drill down from it\n    if (parent.source) {\n        if (isClippedSquare(parent.features, options.extent, options.buffer)) return transformTile(parent, extent);\n\n        if (debug > 1) console.time('drilling down');\n        this.splitTile(parent.source, z0, x0, y0, z, x, y);\n        if (debug > 1) console.timeEnd('drilling down');\n    }\n\n    return transformTile(this.tiles[id], extent);\n};\n\nfunction transformTile(tile, extent) {\n    if (!tile || tile.transformed) return tile;\n\n    var z2 = tile.z2,\n        tx = tile.x,\n        ty = tile.y,\n        i, j, k;\n\n    for (i = 0; i < tile.features.length; i++) {\n        var feature = tile.features[i],\n            geom = feature.geometry,\n            type = feature.type;\n\n        if (type === 1) {\n            for (j = 0; j < geom.length; j++) geom[j] = transformPoint(geom[j], extent, z2, tx, ty);\n\n        } else {\n            for (j = 0; j < geom.length; j++) {\n                var ring = geom[j];\n                for (k = 0; k < ring.length; k++) ring[k] = transformPoint(ring[k], extent, z2, tx, ty);\n            }\n        }\n    }\n\n    tile.transformed = true;\n\n    return tile;\n}\n\nfunction transformPoint(p, extent, z2, tx, ty) {\n    var x = Math.round(extent * (p[0] * z2 - tx)),\n        y = Math.round(extent * (p[1] * z2 - ty));\n    return [x, y];\n}\n\n// checks whether a tile is a whole-area fill after clipping; if it is, there's no sense slicing it further\nfunction isClippedSquare(features, extent, buffer) {\n    if (features.length !== 1) return false;\n\n    var feature = features[0];\n    if (feature.type !== 3 || feature.geometry.length > 1) return false;\n\n    for (var i = 0; i < feature.geometry[0].length; i++) {\n        var p = feature.geometry[0][i];\n        if ((p[0] !== -buffer && p[0] !== extent + buffer) ||\n            (p[1] !== -buffer && p[1] !== extent + buffer)) return false;\n    }\n    return true;\n}\n\nfunction toID(z, x, y) {\n    return (((1 << z) * y + x) * 32) + z;\n}\n\nfunction intersectX(a, b, x) {\n    return [x, (x - a[0]) * (b[1] - a[1]) / (b[0] - a[0]) + a[1], 1];\n}\nfunction intersectY(a, b, y) {\n    return [(y - a[1]) * (b[0] - a[0]) / (b[1] - a[1]) + a[0], y, 1];\n}\n\nfunction extend(dest, src) {\n    for (var i in src) dest[i] = src[i];\n    return dest;\n}\n\n},{\"./clip\":1,\"./convert\":2,\"./tile\":5}],4:[function(require,module,exports){\n'use strict';\n\nmodule.exports = simplify;\n\n// calculate simplification data using optimized Douglas-Peucker algorithm\n\nfunction simplify(points, tolerance) {\n\n    var sqTolerance = tolerance * tolerance,\n        len = points.length,\n        first = 0,\n        last = len - 1,\n        stack = [],\n        i, maxSqDist, sqDist, index;\n\n    // always retain the endpoints (1 is the max value)\n    points[first][2] = 1;\n    points[last][2] = 1;\n\n    // avoid recursion by using a stack\n    while (last) {\n\n        maxSqDist = 0;\n\n        for (i = first + 1; i < last; i++) {\n            sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n            if (sqDist > maxSqDist) {\n                index = i;\n                maxSqDist = sqDist;\n            }\n        }\n\n        if (maxSqDist > sqTolerance) {\n            points[index][2] = maxSqDist; // save the point importance in squared pixels as a z coordinate\n            stack.push(first);\n            stack.push(index);\n            first = index;\n\n        } else {\n            last = stack.pop();\n            first = stack.pop();\n        }\n    }\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(p, a, b) {\n\n    var x = a[0], y = a[1],\n        bx = b[0], by = b[1],\n        px = p[0], py = p[1],\n        dx = bx - x,\n        dy = by - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = bx;\n            y = by;\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n\n},{}],5:[function(require,module,exports){\n'use strict';\n\nmodule.exports = createTile;\n\nfunction createTile(features, z2, tx, ty, tolerance, noSimplify) {\n    var tile = {\n        features: [],\n        numPoints: 0,\n        numSimplified: 0,\n        numFeatures: 0,\n        source: null,\n        x: tx,\n        y: ty,\n        z2: z2,\n        transformed: false\n    };\n    for (var i = 0; i < features.length; i++) {\n        tile.numFeatures++;\n        addFeature(tile, features[i], tolerance, noSimplify);\n    }\n    return tile;\n}\n\nfunction addFeature(tile, feature, tolerance, noSimplify) {\n\n    var geom = feature.geometry,\n        type = feature.type,\n        simplified = [],\n        sqTolerance = tolerance * tolerance,\n        i, j, ring, p;\n\n    if (type === 1) {\n        for (i = 0; i < geom.length; i++) {\n            simplified.push(geom[i]);\n            tile.numPoints++;\n            tile.numSimplified++;\n        }\n\n    } else {\n\n        // simplify and transform projected coordinates for tile geometry\n        for (i = 0; i < geom.length; i++) {\n            ring = geom[i];\n\n            // filter out tiny polylines & polygons\n            if (!noSimplify && ((type === 2 && ring.dist < tolerance) ||\n                                (type === 3 && ring.area < sqTolerance))) {\n                tile.numPoints += ring.length;\n                continue;\n            }\n\n            var simplifiedRing = [];\n\n            for (j = 0; j < ring.length; j++) {\n                p = ring[j];\n                // keep points with importance > tolerance\n                if (noSimplify || p[2] > sqTolerance) {\n                    simplifiedRing.push(p);\n                    tile.numSimplified++;\n                }\n                tile.numPoints++;\n            }\n\n            simplified.push(simplifiedRing);\n        }\n    }\n\n    if (simplified.length) {\n        tile.features.push({\n            geometry: simplified,\n            type: type,\n            tags: feature.tags || null\n        });\n    }\n}\n\n},{}]},{},[3])(3)\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xpcC5qcyIsInNyYy9jb252ZXJ0LmpzIiwic3JjL2luZGV4LmpzIiwic3JjL3NpbXBsaWZ5LmpzIiwic3JjL3RpbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxubW9kdWxlLmV4cG9ydHMgPSBjbGlwO1xuXG4vKiBjbGlwIGZlYXR1cmVzIGJldHdlZW4gdHdvIGF4aXMtcGFyYWxsZWwgbGluZXM6XG4gKiAgICAgfCAgICAgICAgfFxuICogIF9fX3xfX18gICAgIHwgICAgIC9cbiAqIC8gICB8ICAgXFxfX19ffF9fX18vXG4gKiAgICAgfCAgICAgICAgfFxuICovXG5cbmZ1bmN0aW9uIGNsaXAoZmVhdHVyZXMsIHNjYWxlLCBrMSwgazIsIGF4aXMsIGludGVyc2VjdCkge1xuXG4gICAgazEgLz0gc2NhbGU7XG4gICAgazIgLz0gc2NhbGU7XG5cbiAgICB2YXIgY2xpcHBlZCA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmZWF0dXJlcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIHZhciBmZWF0dXJlID0gZmVhdHVyZXNbaV0sXG4gICAgICAgICAgICBnZW9tZXRyeSA9IGZlYXR1cmUuZ2VvbWV0cnksXG4gICAgICAgICAgICB0eXBlID0gZmVhdHVyZS50eXBlLFxuICAgICAgICAgICAgbWluLCBtYXg7XG5cbiAgICAgICAgaWYgKGZlYXR1cmUubWluKSB7XG4gICAgICAgICAgICBtaW4gPSBmZWF0dXJlLm1pbltheGlzXTtcbiAgICAgICAgICAgIG1heCA9IGZlYXR1cmUubWF4W2F4aXNdO1xuXG4gICAgICAgICAgICBpZiAobWluID49IGsxICYmIG1heCA8PSBrMikgeyAvLyB0cml2aWFsIGFjY2VwdFxuICAgICAgICAgICAgICAgIGNsaXBwZWQucHVzaChmZWF0dXJlKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWluID4gazIgfHwgbWF4IDwgazEpIGNvbnRpbnVlOyAvLyB0cml2aWFsIHJlamVjdFxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNsaWNlcyA9IHR5cGUgPT09IDEgP1xuICAgICAgICAgICAgICAgIGNsaXBQb2ludHMoZ2VvbWV0cnksIGsxLCBrMiwgYXhpcykgOlxuICAgICAgICAgICAgICAgIGNsaXBHZW9tZXRyeShnZW9tZXRyeSwgazEsIGsyLCBheGlzLCBpbnRlcnNlY3QsIHR5cGUgPT09IDMpO1xuXG4gICAgICAgIGlmIChzbGljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBpZiBhIGZlYXR1cmUgZ290IGNsaXBwZWQsIGl0IHdpbGwgbGlrZWx5IGdldCBjbGlwcGVkIG9uIHRoZSBuZXh0IHpvb20gbGV2ZWwgYXMgd2VsbCxcbiAgICAgICAgICAgIC8vIHNvIHRoZXJlJ3Mgbm8gbmVlZCB0byByZWNhbGN1bGF0ZSBiYm94ZXNcbiAgICAgICAgICAgIGNsaXBwZWQucHVzaCh7XG4gICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHNsaWNlcyxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgIHRhZ3M6IGZlYXR1cmVzW2ldLnRhZ3MgfHwgbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2xpcHBlZC5sZW5ndGggPyBjbGlwcGVkIDogbnVsbDtcbn1cblxuZnVuY3Rpb24gY2xpcFBvaW50cyhnZW9tZXRyeSwgazEsIGsyLCBheGlzKSB7XG4gICAgdmFyIHNsaWNlID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdlb21ldHJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBhID0gZ2VvbWV0cnlbaV0sXG4gICAgICAgICAgICBhayA9IGFbYXhpc107XG5cbiAgICAgICAgaWYgKGFrID49IGsxICYmIGFrIDw9IGsyKSBzbGljZS5wdXNoKGEpO1xuICAgIH1cbiAgICByZXR1cm4gc2xpY2U7XG59XG5cbmZ1bmN0aW9uIGNsaXBHZW9tZXRyeShnZW9tZXRyeSwgazEsIGsyLCBheGlzLCBpbnRlcnNlY3QsIGNsb3NlZCkge1xuXG4gICAgdmFyIHNsaWNlcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW9tZXRyeS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIHZhciBhayA9IDAsXG4gICAgICAgICAgICBiayA9IDAsXG4gICAgICAgICAgICBiID0gbnVsbCxcbiAgICAgICAgICAgIHBvaW50cyA9IGdlb21ldHJ5W2ldLFxuICAgICAgICAgICAgYXJlYSA9IHBvaW50cy5hcmVhLFxuICAgICAgICAgICAgZGlzdCA9IHBvaW50cy5kaXN0LFxuICAgICAgICAgICAgbGVuID0gcG9pbnRzLmxlbmd0aCxcbiAgICAgICAgICAgIGEsIGo7XG5cbiAgICAgICAgdmFyIHNsaWNlID0gW107XG5cbiAgICAgICAgZm9yIChqID0gMDsgaiA8IGxlbiAtIDE7IGorKykge1xuICAgICAgICAgICAgYSA9IGIgfHwgcG9pbnRzW2pdO1xuICAgICAgICAgICAgYiA9IHBvaW50c1tqICsgMV07XG4gICAgICAgICAgICBhayA9IGJrIHx8IGFbYXhpc107XG4gICAgICAgICAgICBiayA9IGJbYXhpc107XG5cbiAgICAgICAgICAgIGlmIChhayA8IGsxKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoKGJrID4gazIpKSB7IC8vIC0tLXwtLS0tLXwtLT5cbiAgICAgICAgICAgICAgICAgICAgc2xpY2UucHVzaChpbnRlcnNlY3QoYSwgYiwgazEpLCBpbnRlcnNlY3QoYSwgYiwgazIpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjbG9zZWQpIHNsaWNlID0gbmV3U2xpY2Uoc2xpY2VzLCBzbGljZSwgYXJlYSwgZGlzdCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJrID49IGsxKSBzbGljZS5wdXNoKGludGVyc2VjdChhLCBiLCBrMSkpOyAvLyAtLS18LS0+ICB8XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWsgPiBrMikge1xuXG4gICAgICAgICAgICAgICAgaWYgKChiayA8IGsxKSkgeyAvLyA8LS18LS0tLS18LS0tXG4gICAgICAgICAgICAgICAgICAgIHNsaWNlLnB1c2goaW50ZXJzZWN0KGEsIGIsIGsyKSwgaW50ZXJzZWN0KGEsIGIsIGsxKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2xvc2VkKSBzbGljZSA9IG5ld1NsaWNlKHNsaWNlcywgc2xpY2UsIGFyZWEsIGRpc3QpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiayA8PSBrMikgc2xpY2UucHVzaChpbnRlcnNlY3QoYSwgYiwgazIpKTsgLy8gfCAgPC0tfC0tLVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgc2xpY2UucHVzaChhKTtcblxuICAgICAgICAgICAgICAgIGlmIChiayA8IGsxKSB7IC8vIDwtLXwtLS0gIHxcbiAgICAgICAgICAgICAgICAgICAgc2xpY2UucHVzaChpbnRlcnNlY3QoYSwgYiwgazEpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjbG9zZWQpIHNsaWNlID0gbmV3U2xpY2Uoc2xpY2VzLCBzbGljZSwgYXJlYSwgZGlzdCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJrID4gazIpIHsgLy8gfCAgLS0tfC0tPlxuICAgICAgICAgICAgICAgICAgICBzbGljZS5wdXNoKGludGVyc2VjdChhLCBiLCBrMikpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNsb3NlZCkgc2xpY2UgPSBuZXdTbGljZShzbGljZXMsIHNsaWNlLCBhcmVhLCBkaXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfCAtLT4gfFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkIHRoZSBsYXN0IHBvaW50XG4gICAgICAgIGEgPSBwb2ludHNbbGVuIC0gMV07XG4gICAgICAgIGFrID0gYVtheGlzXTtcbiAgICAgICAgaWYgKGFrID49IGsxICYmIGFrIDw9IGsyKSBzbGljZS5wdXNoKGEpO1xuXG4gICAgICAgIC8vIGNsb3NlIHRoZSBwb2x5Z29uIGlmIGl0cyBlbmRwb2ludHMgYXJlIG5vdCB0aGUgc2FtZSBhZnRlciBjbGlwcGluZ1xuICAgICAgICBpZiAoY2xvc2VkICYmIHNsaWNlWzBdICE9PSBzbGljZVtzbGljZS5sZW5ndGggLSAxXSkgc2xpY2UucHVzaChzbGljZVswXSk7XG5cbiAgICAgICAgLy8gYWRkIHRoZSBmaW5hbCBzbGljZVxuICAgICAgICBuZXdTbGljZShzbGljZXMsIHNsaWNlLCBhcmVhLCBkaXN0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2xpY2VzO1xufVxuXG5mdW5jdGlvbiBuZXdTbGljZShzbGljZXMsIHNsaWNlLCBhcmVhLCBkaXN0KSB7XG4gICAgaWYgKHNsaWNlLmxlbmd0aCkge1xuICAgICAgICAvLyB3ZSBkb24ndCByZWNhbGN1bGF0ZSB0aGUgYXJlYS9sZW5ndGggb2YgdGhlIHVuY2xpcHBlZCBnZW9tZXRyeSBiZWNhdXNlIHRoZSBjYXNlIHdoZXJlIGl0IGdvZXNcbiAgICAgICAgLy8gYmVsb3cgdGhlIHZpc2liaWxpdHkgdGhyZXNob2xkIGFzIGEgcmVzdWx0IG9mIGNsaXBwaW5nIGlzIHJhcmUsIHNvIHdlIGF2b2lkIGRvaW5nIHVubmVjZXNzYXJ5IHdvcmtcbiAgICAgICAgc2xpY2UuYXJlYSA9IGFyZWE7XG4gICAgICAgIHNsaWNlLmRpc3QgPSBkaXN0O1xuXG4gICAgICAgIHNsaWNlcy5wdXNoKHNsaWNlKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbnZlcnQ7XG5cbnZhciBzaW1wbGlmeSA9IHJlcXVpcmUoJy4vc2ltcGxpZnknKTtcblxuLy8gY29udmVydHMgR2VvSlNPTiBmZWF0dXJlIGludG8gYW4gaW50ZXJtZWRpYXRlIHByb2plY3RlZCBKU09OIHZlY3RvciBmb3JtYXQgd2l0aCBzaW1wbGlmaWNhdGlvbiBkYXRhXG5cbmZ1bmN0aW9uIGNvbnZlcnQoZGF0YSwgdG9sZXJhbmNlKSB7XG4gICAgdmFyIGZlYXR1cmVzID0gW107XG5cbiAgICBpZiAoZGF0YS50eXBlID09PSAnRmVhdHVyZUNvbGxlY3Rpb24nKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5mZWF0dXJlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29udmVydEZlYXR1cmUoZmVhdHVyZXMsIGRhdGEuZmVhdHVyZXNbaV0sIHRvbGVyYW5jZSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ0ZlYXR1cmUnKSB7XG4gICAgICAgIGNvbnZlcnRGZWF0dXJlKGZlYXR1cmVzLCBkYXRhLCB0b2xlcmFuY2UpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gc2luZ2xlIGdlb21ldHJ5IG9yIGEgZ2VvbWV0cnkgY29sbGVjdGlvblxuICAgICAgICBjb252ZXJ0RmVhdHVyZShmZWF0dXJlcywge2dlb21ldHJ5OiBkYXRhfSwgdG9sZXJhbmNlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZlYXR1cmVzO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0RmVhdHVyZShmZWF0dXJlcywgZmVhdHVyZSwgdG9sZXJhbmNlKSB7XG4gICAgdmFyIGdlb20gPSBmZWF0dXJlLmdlb21ldHJ5LFxuICAgICAgICB0eXBlID0gZ2VvbS50eXBlLFxuICAgICAgICBjb29yZHMgPSBnZW9tLmNvb3JkaW5hdGVzLFxuICAgICAgICB0YWdzID0gZmVhdHVyZS5wcm9wZXJ0aWVzLFxuICAgICAgICBpLCBqLCByaW5ncztcblxuICAgIGlmICh0eXBlID09PSAnUG9pbnQnKSB7XG4gICAgICAgIGZlYXR1cmVzLnB1c2goY3JlYXRlKHRhZ3MsIDEsIFtwcm9qZWN0UG9pbnQoY29vcmRzKV0pKTtcblxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ011bHRpUG9pbnQnKSB7XG4gICAgICAgIGZlYXR1cmVzLnB1c2goY3JlYXRlKHRhZ3MsIDEsIHByb2plY3QoY29vcmRzKSkpO1xuXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnTGluZVN0cmluZycpIHtcbiAgICAgICAgZmVhdHVyZXMucHVzaChjcmVhdGUodGFncywgMiwgW3Byb2plY3QoY29vcmRzLCB0b2xlcmFuY2UpXSkpO1xuXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnTXVsdGlMaW5lU3RyaW5nJyB8fCB0eXBlID09PSAnUG9seWdvbicpIHtcbiAgICAgICAgcmluZ3MgPSBbXTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcmluZ3MucHVzaChwcm9qZWN0KGNvb3Jkc1tpXSwgdG9sZXJhbmNlKSk7XG4gICAgICAgIH1cbiAgICAgICAgZmVhdHVyZXMucHVzaChjcmVhdGUodGFncywgdHlwZSA9PT0gJ1BvbHlnb24nID8gMyA6IDIsIHJpbmdzKSk7XG5cbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdNdWx0aVBvbHlnb24nKSB7XG4gICAgICAgIHJpbmdzID0gW107XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjb29yZHNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICByaW5ncy5wdXNoKHByb2plY3QoY29vcmRzW2ldW2pdLCB0b2xlcmFuY2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmZWF0dXJlcy5wdXNoKGNyZWF0ZSh0YWdzLCAzLCByaW5ncykpO1xuXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnR2VvbWV0cnlDb2xsZWN0aW9uJykge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZ2VvbS5nZW9tZXRyaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb252ZXJ0RmVhdHVyZShmZWF0dXJlcywge1xuICAgICAgICAgICAgICAgIGdlb21ldHJ5OiBnZW9tLmdlb21ldHJpZXNbaV0sXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczogdGFnc1xuICAgICAgICAgICAgfSwgdG9sZXJhbmNlKTtcbiAgICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdVbnN1cHBvcnRlZCBHZW9KU09OIHR5cGU6ICcgKyBnZW9tLnR5cGUpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlKHRhZ3MsIHR5cGUsIGdlb21ldHJ5KSB7XG4gICAgdmFyIGZlYXR1cmUgPSB7XG4gICAgICAgIGdlb21ldHJ5OiBnZW9tZXRyeSxcbiAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgdGFnczogdGFncyB8fCBudWxsLFxuICAgICAgICBtaW46IFsxLCAxXSwgLy8gaW5pdGlhbCBiYm94IHZhbHVlcztcbiAgICAgICAgbWF4OiBbMCwgMF0gIC8vIG5vdGUgdGhhdCBhbGwgY29vcmRzIGFyZSBpbiBbMC4uMV0gcmFuZ2VcbiAgICB9O1xuICAgIGNhbGNCQm94KGZlYXR1cmUpO1xuICAgIHJldHVybiBmZWF0dXJlO1xufVxuXG5mdW5jdGlvbiBwcm9qZWN0KGxvbmxhdHMsIHRvbGVyYW5jZSkge1xuICAgIHZhciBwcm9qZWN0ZWQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxvbmxhdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcHJvamVjdGVkLnB1c2gocHJvamVjdFBvaW50KGxvbmxhdHNbaV0pKTtcbiAgICB9XG4gICAgaWYgKHRvbGVyYW5jZSkge1xuICAgICAgICBzaW1wbGlmeShwcm9qZWN0ZWQsIHRvbGVyYW5jZSk7XG4gICAgICAgIGNhbGNTaXplKHByb2plY3RlZCk7XG4gICAgfVxuICAgIHJldHVybiBwcm9qZWN0ZWQ7XG59XG5cbmZ1bmN0aW9uIHByb2plY3RQb2ludChwKSB7XG4gICAgdmFyIHNpbiA9IE1hdGguc2luKHBbMV0gKiBNYXRoLlBJIC8gMTgwKSxcbiAgICAgICAgeCA9IChwWzBdIC8gMzYwICsgMC41KSxcbiAgICAgICAgeSA9ICgwLjUgLSAwLjI1ICogTWF0aC5sb2coKDEgKyBzaW4pIC8gKDEgLSBzaW4pKSAvIE1hdGguUEkpO1xuICAgIHJldHVybiBbeCwgeSwgMF07XG59XG5cbi8vIGNhbGN1bGF0ZSBhcmVhIGFuZCBsZW5ndGggb2YgdGhlIHBvbHlcbmZ1bmN0aW9uIGNhbGNTaXplKHBvaW50cykge1xuICAgIHZhciBhcmVhID0gMCxcbiAgICAgICAgZGlzdCA9IDA7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgYSwgYjsgaSA8IHBvaW50cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgYSA9IGIgfHwgcG9pbnRzW2ldO1xuICAgICAgICBiID0gcG9pbnRzW2kgKyAxXTtcblxuICAgICAgICBhcmVhICs9IGFbMF0gKiBiWzFdIC0gYlswXSAqIGFbMV07XG5cbiAgICAgICAgLy8gdXNlIE1hbmhhdHRhbiBkaXN0YW5jZSBpbnN0ZWFkIG9mIEV1Y2xpZGlhbiBvbmUgdG8gYXZvaWQgZXhwZW5zaXZlIHNxdWFyZSByb290IGNvbXB1dGF0aW9uXG4gICAgICAgIGRpc3QgKz0gTWF0aC5hYnMoYlswXSAtIGFbMF0pICsgTWF0aC5hYnMoYlsxXSAtIGFbMV0pO1xuICAgIH1cbiAgICBwb2ludHMuYXJlYSA9IE1hdGguYWJzKGFyZWEgLyAyKTtcbiAgICBwb2ludHMuZGlzdCA9IGRpc3Q7XG59XG5cbi8vIGNhbGN1bGF0ZSB0aGUgZmVhdHVyZSBib3VuZGluZyBib3ggZm9yIGZhc3RlciBjbGlwcGluZyBsYXRlclxuZnVuY3Rpb24gY2FsY0JCb3goZmVhdHVyZSkge1xuICAgIHZhciBnZW9tZXRyeSA9IGZlYXR1cmUuZ2VvbWV0cnksXG4gICAgICAgIG1pbiA9IGZlYXR1cmUubWluLFxuICAgICAgICBtYXggPSBmZWF0dXJlLm1heDtcblxuICAgIGlmIChmZWF0dXJlLnR5cGUgPT09IDEpIGNhbGNSaW5nQkJveChtaW4sIG1heCwgZ2VvbWV0cnkpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IDA7IGkgPCBnZW9tZXRyeS5sZW5ndGg7IGkrKykgY2FsY1JpbmdCQm94KG1pbiwgbWF4LCBnZW9tZXRyeVtpXSk7XG5cbiAgICByZXR1cm4gZmVhdHVyZTtcbn1cblxuZnVuY3Rpb24gY2FsY1JpbmdCQm94KG1pbiwgbWF4LCBwb2ludHMpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgcDsgaSA8IHBvaW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBwID0gcG9pbnRzW2ldO1xuICAgICAgICBtaW5bMF0gPSBNYXRoLm1pbihwWzBdLCBtaW5bMF0pO1xuICAgICAgICBtYXhbMF0gPSBNYXRoLm1heChwWzBdLCBtYXhbMF0pO1xuICAgICAgICBtaW5bMV0gPSBNYXRoLm1pbihwWzFdLCBtaW5bMV0pO1xuICAgICAgICBtYXhbMV0gPSBNYXRoLm1heChwWzFdLCBtYXhbMV0pO1xuICAgIH1cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxubW9kdWxlLmV4cG9ydHMgPSBnZW9qc29udnQ7XG5cbnZhciBjb252ZXJ0ID0gcmVxdWlyZSgnLi9jb252ZXJ0JyksIC8vIEdlb0pTT04gY29udmVyc2lvbiBhbmQgcHJlcHJvY2Vzc2luZ1xuICAgIGNsaXAgPSByZXF1aXJlKCcuL2NsaXAnKSwgICAgICAgLy8gc3RyaXBlIGNsaXBwaW5nIGFsZ29yaXRobVxuICAgIGNyZWF0ZVRpbGUgPSByZXF1aXJlKCcuL3RpbGUnKTsgLy8gZmluYWwgc2ltcGxpZmllZCB0aWxlIGdlbmVyYXRpb25cblxuXG5mdW5jdGlvbiBnZW9qc29udnQoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgR2VvSlNPTlZUKGRhdGEsIG9wdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBHZW9KU09OVlQoZGF0YSwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPSBleHRlbmQoT2JqZWN0LmNyZWF0ZSh0aGlzLm9wdGlvbnMpLCBvcHRpb25zKTtcblxuICAgIHZhciBkZWJ1ZyA9IG9wdGlvbnMuZGVidWc7XG5cbiAgICBpZiAoZGVidWcpIGNvbnNvbGUudGltZSgncHJlcHJvY2VzcyBkYXRhJyk7XG5cbiAgICB2YXIgejIgPSAxIDw8IG9wdGlvbnMubWF4Wm9vbSwgLy8gMl56XG4gICAgICAgIGZlYXR1cmVzID0gY29udmVydChkYXRhLCBvcHRpb25zLnRvbGVyYW5jZSAvICh6MiAqIG9wdGlvbnMuZXh0ZW50KSk7XG5cbiAgICB0aGlzLnRpbGVzID0ge307XG5cbiAgICBpZiAoZGVidWcpIHtcbiAgICAgICAgY29uc29sZS50aW1lRW5kKCdwcmVwcm9jZXNzIGRhdGEnKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2luZGV4OiBtYXhab29tOiAlZCwgbWF4UG9pbnRzOiAlZCcsIG9wdGlvbnMuaW5kZXhNYXhab29tLCBvcHRpb25zLmluZGV4TWF4UG9pbnRzKTtcbiAgICAgICAgY29uc29sZS50aW1lKCdnZW5lcmF0ZSB0aWxlcycpO1xuICAgICAgICB0aGlzLnN0YXRzID0ge307XG4gICAgICAgIHRoaXMudG90YWwgPSAwO1xuICAgIH1cblxuICAgIC8vIHN0YXJ0IHNsaWNpbmcgZnJvbSB0aGUgdG9wIHRpbGUgZG93blxuICAgIHRoaXMuc3BsaXRUaWxlKGZlYXR1cmVzLCAwLCAwLCAwKTtcblxuICAgIGlmIChkZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZygnZmVhdHVyZXM6ICVkLCBwb2ludHM6ICVkJywgdGhpcy50aWxlc1swXS5udW1GZWF0dXJlcywgdGhpcy50aWxlc1swXS5udW1Qb2ludHMpO1xuICAgICAgICBjb25zb2xlLnRpbWVFbmQoJ2dlbmVyYXRlIHRpbGVzJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0aWxlcyBnZW5lcmF0ZWQ6JywgdGhpcy50b3RhbCwgSlNPTi5zdHJpbmdpZnkodGhpcy5zdGF0cykpO1xuICAgIH1cbn1cblxuR2VvSlNPTlZULnByb3RvdHlwZS5vcHRpb25zID0ge1xuICAgIG1heFpvb206IDE0LCAgICAgICAgICAgIC8vIG1heCB6b29tIHRvIHByZXNlcnZlIGRldGFpbCBvblxuICAgIGluZGV4TWF4Wm9vbTogNSwgICAgICAgIC8vIG1heCB6b29tIGluIHRoZSB0aWxlIGluZGV4XG4gICAgaW5kZXhNYXhQb2ludHM6IDEwMDAwMCwgLy8gbWF4IG51bWJlciBvZiBwb2ludHMgcGVyIHRpbGUgaW4gdGhlIHRpbGUgaW5kZXhcbiAgICB0b2xlcmFuY2U6IDMsICAgICAgICAgICAvLyBzaW1wbGlmaWNhdGlvbiB0b2xlcmFuY2UgKGhpZ2hlciBtZWFucyBzaW1wbGVyKVxuICAgIGV4dGVudDogNDA5NiwgICAgICAgICAgIC8vIHRpbGUgZXh0ZW50XG4gICAgYnVmZmVyOiA2NCwgICAgICAgICAgICAgLy8gdGlsZSBidWZmZXIgb24gZWFjaCBzaWRlXG4gICAgZGVidWc6IDAgICAgICAgICAgICAgICAgLy8gbG9nZ2luZyBsZXZlbCAoMCwgMSBvciAyKVxufTtcblxuR2VvSlNPTlZULnByb3RvdHlwZS5zcGxpdFRpbGUgPSBmdW5jdGlvbiAoZmVhdHVyZXMsIHosIHgsIHksIGN6LCBjeCwgY3kpIHtcblxuICAgIHZhciBzdGFjayA9IFtmZWF0dXJlcywgeiwgeCwgeV0sXG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsXG4gICAgICAgIGRlYnVnID0gb3B0aW9ucy5kZWJ1ZyxcbiAgICAgICAgZXh0ZW50ID0gb3B0aW9ucy5leHRlbnQsXG4gICAgICAgIGJ1ZmZlciA9IG9wdGlvbnMuYnVmZmVyO1xuXG4gICAgLy8gYXZvaWQgcmVjdXJzaW9uIGJ5IHVzaW5nIGEgcHJvY2Vzc2luZyBxdWV1ZVxuICAgIHdoaWxlIChzdGFjay5sZW5ndGgpIHtcbiAgICAgICAgZmVhdHVyZXMgPSBzdGFjay5zaGlmdCgpO1xuICAgICAgICB6ID0gc3RhY2suc2hpZnQoKTtcbiAgICAgICAgeCA9IHN0YWNrLnNoaWZ0KCk7XG4gICAgICAgIHkgPSBzdGFjay5zaGlmdCgpO1xuXG4gICAgICAgIHZhciB6MiA9IDEgPDwgeixcbiAgICAgICAgICAgIGlkID0gdG9JRCh6LCB4LCB5KSxcbiAgICAgICAgICAgIHRpbGUgPSB0aGlzLnRpbGVzW2lkXSxcbiAgICAgICAgICAgIHRpbGVUb2xlcmFuY2UgPSB6ID09PSBvcHRpb25zLm1heFpvb20gPyAwIDogb3B0aW9ucy50b2xlcmFuY2UgLyAoejIgKiBleHRlbnQpO1xuXG4gICAgICAgIGlmICghdGlsZSkge1xuICAgICAgICAgICAgaWYgKGRlYnVnID4gMSkgY29uc29sZS50aW1lKCdjcmVhdGlvbicpO1xuXG4gICAgICAgICAgICB0aWxlID0gdGhpcy50aWxlc1tpZF0gPSBjcmVhdGVUaWxlKGZlYXR1cmVzLCB6MiwgeCwgeSwgdGlsZVRvbGVyYW5jZSwgeiA9PT0gb3B0aW9ucy5tYXhab29tKTtcblxuICAgICAgICAgICAgaWYgKGRlYnVnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRlYnVnID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndGlsZSB6JWQtJWQtJWQgKGZlYXR1cmVzOiAlZCwgcG9pbnRzOiAlZCwgc2ltcGxpZmllZDogJWQpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHosIHgsIHksIHRpbGUubnVtRmVhdHVyZXMsIHRpbGUubnVtUG9pbnRzLCB0aWxlLm51bVNpbXBsaWZpZWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnRpbWVFbmQoJ2NyZWF0aW9uJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSAneicgKyB6O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHNba2V5XSA9ICh0aGlzLnN0YXRzW2tleV0gfHwgMCkgKyAxO1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWwrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNhdmUgcmVmZXJlbmNlIHRvIG9yaWdpbmFsIGdlb21ldHJ5IGluIHRpbGUgc28gdGhhdCB3ZSBjYW4gZHJpbGwgZG93biBsYXRlciBpZiB3ZSBzdG9wIG5vd1xuICAgICAgICB0aWxlLnNvdXJjZSA9IGZlYXR1cmVzO1xuXG4gICAgICAgIC8vIHN0b3AgdGlsaW5nIGlmIHRoZSB0aWxlIGlzIGRlZ2VuZXJhdGVcbiAgICAgICAgaWYgKGlzQ2xpcHBlZFNxdWFyZSh0aWxlLmZlYXR1cmVzLCBleHRlbnQsIGJ1ZmZlcikpIGNvbnRpbnVlO1xuXG4gICAgICAgIC8vIGlmIGl0J3MgdGhlIGZpcnN0LXBhc3MgdGlsaW5nXG4gICAgICAgIGlmICghY3opIHtcbiAgICAgICAgICAgIC8vIHN0b3AgdGlsaW5nIGlmIHdlIHJlYWNoZWQgbWF4IHpvb20sIG9yIGlmIHRoZSB0aWxlIGlzIHRvbyBzaW1wbGVcbiAgICAgICAgICAgIGlmICh6ID09PSBvcHRpb25zLmluZGV4TWF4Wm9vbSB8fCB0aWxlLm51bVBvaW50cyA8PSBvcHRpb25zLmluZGV4TWF4UG9pbnRzKSBjb250aW51ZTtcblxuICAgICAgICAvLyBpZiBhIGRyaWxsZG93biB0byBhIHNwZWNpZmljIHRpbGVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHN0b3AgdGlsaW5nIGlmIHdlIHJlYWNoZWQgYmFzZSB6b29tIG9yIG91ciB0YXJnZXQgdGlsZSB6b29tXG4gICAgICAgICAgICBpZiAoeiA9PT0gb3B0aW9ucy5tYXhab29tIHx8IHogPT09IGN6KSBjb250aW51ZTtcblxuICAgICAgICAgICAgLy8gc3RvcCB0aWxpbmcgaWYgaXQncyBub3QgYW4gYW5jZXN0b3Igb2YgdGhlIHRhcmdldCB0aWxlXG4gICAgICAgICAgICB2YXIgbSA9IDEgPDwgKGN6IC0geik7XG4gICAgICAgICAgICBpZiAoeCAhPT0gTWF0aC5mbG9vcihjeCAvIG0pICYmIHkgIT09IE1hdGguZmxvb3IoY3kgLyBtKSkgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB3ZSBzbGljZSBmdXJ0aGVyIGRvd24sIG5vIG5lZWQgdG8ga2VlcCBzb3VyY2UgZ2VvbWV0cnlcbiAgICAgICAgdGlsZS5zb3VyY2UgPSBudWxsO1xuXG4gICAgICAgIGlmIChkZWJ1ZyA+IDEpIGNvbnNvbGUudGltZSgnY2xpcHBpbmcnKTtcblxuICAgICAgICAvLyB2YWx1ZXMgd2UnbGwgdXNlIGZvciBjbGlwcGluZ1xuICAgICAgICB2YXIgazEgPSAwLjUgKiBidWZmZXIgLyBleHRlbnQsXG4gICAgICAgICAgICBrMiA9IDAuNSAtIGsxLFxuICAgICAgICAgICAgazMgPSAwLjUgKyBrMSxcbiAgICAgICAgICAgIGs0ID0gMSArIGsxLFxuICAgICAgICAgICAgdGwsIGJsLCB0ciwgYnIsIGxlZnQsIHJpZ2h0O1xuXG4gICAgICAgIHRsID0gYmwgPSB0ciA9IGJyID0gbnVsbDtcblxuICAgICAgICBsZWZ0ICA9IGNsaXAoZmVhdHVyZXMsIHoyLCB4IC0gazEsIHggKyBrMywgMCwgaW50ZXJzZWN0WCk7XG4gICAgICAgIHJpZ2h0ID0gY2xpcChmZWF0dXJlcywgejIsIHggKyBrMiwgeCArIGs0LCAwLCBpbnRlcnNlY3RYKTtcblxuICAgICAgICBpZiAobGVmdCkge1xuICAgICAgICAgICAgdGwgPSBjbGlwKGxlZnQsIHoyLCB5IC0gazEsIHkgKyBrMywgMSwgaW50ZXJzZWN0WSk7XG4gICAgICAgICAgICBibCA9IGNsaXAobGVmdCwgejIsIHkgKyBrMiwgeSArIGs0LCAxLCBpbnRlcnNlY3RZKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyaWdodCkge1xuICAgICAgICAgICAgdHIgPSBjbGlwKHJpZ2h0LCB6MiwgeSAtIGsxLCB5ICsgazMsIDEsIGludGVyc2VjdFkpO1xuICAgICAgICAgICAgYnIgPSBjbGlwKHJpZ2h0LCB6MiwgeSArIGsyLCB5ICsgazQsIDEsIGludGVyc2VjdFkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlYnVnID4gMSkgY29uc29sZS50aW1lRW5kKCdjbGlwcGluZycpO1xuXG4gICAgICAgIGlmICh0bCkgc3RhY2sucHVzaCh0bCwgeiArIDEsIHggKiAyLCAgICAgeSAqIDIpO1xuICAgICAgICBpZiAoYmwpIHN0YWNrLnB1c2goYmwsIHogKyAxLCB4ICogMiwgICAgIHkgKiAyICsgMSk7XG4gICAgICAgIGlmICh0cikgc3RhY2sucHVzaCh0ciwgeiArIDEsIHggKiAyICsgMSwgeSAqIDIpO1xuICAgICAgICBpZiAoYnIpIHN0YWNrLnB1c2goYnIsIHogKyAxLCB4ICogMiArIDEsIHkgKiAyICsgMSk7XG4gICAgfVxufTtcblxuR2VvSlNPTlZULnByb3RvdHlwZS5nZXRUaWxlID0gZnVuY3Rpb24gKHosIHgsIHkpIHtcbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgZXh0ZW50ID0gb3B0aW9ucy5leHRlbnQsXG4gICAgICAgIGRlYnVnID0gb3B0aW9ucy5kZWJ1ZztcblxuICAgIHZhciBpZCA9IHRvSUQoeiwgeCwgeSk7XG4gICAgaWYgKHRoaXMudGlsZXNbaWRdKSByZXR1cm4gdHJhbnNmb3JtVGlsZSh0aGlzLnRpbGVzW2lkXSwgZXh0ZW50KTtcblxuICAgIGlmIChkZWJ1ZyA+IDEpIGNvbnNvbGUubG9nKCdkcmlsbGluZyBkb3duIHRvIHolZC0lZC0lZCcsIHosIHgsIHkpO1xuXG4gICAgdmFyIHowID0geixcbiAgICAgICAgeDAgPSB4LFxuICAgICAgICB5MCA9IHksXG4gICAgICAgIHBhcmVudDtcblxuICAgIHdoaWxlICghcGFyZW50ICYmIHowID4gMCkge1xuICAgICAgICB6MC0tO1xuICAgICAgICB4MCA9IE1hdGguZmxvb3IoeDAgLyAyKTtcbiAgICAgICAgeTAgPSBNYXRoLmZsb29yKHkwIC8gMik7XG4gICAgICAgIHBhcmVudCA9IHRoaXMudGlsZXNbdG9JRCh6MCwgeDAsIHkwKV07XG4gICAgfVxuXG4gICAgaWYgKGRlYnVnID4gMSkgY29uc29sZS5sb2coJ2ZvdW5kIHBhcmVudCB0aWxlIHolZC0lZC0lZCcsIHowLCB4MCwgeTApO1xuXG4gICAgLy8gaWYgd2UgZm91bmQgYSBwYXJlbnQgdGlsZSBjb250YWluaW5nIHRoZSBvcmlnaW5hbCBnZW9tZXRyeSwgd2UgY2FuIGRyaWxsIGRvd24gZnJvbSBpdFxuICAgIGlmIChwYXJlbnQuc291cmNlKSB7XG4gICAgICAgIGlmIChpc0NsaXBwZWRTcXVhcmUocGFyZW50LmZlYXR1cmVzLCBvcHRpb25zLmV4dGVudCwgb3B0aW9ucy5idWZmZXIpKSByZXR1cm4gdHJhbnNmb3JtVGlsZShwYXJlbnQsIGV4dGVudCk7XG5cbiAgICAgICAgaWYgKGRlYnVnID4gMSkgY29uc29sZS50aW1lKCdkcmlsbGluZyBkb3duJyk7XG4gICAgICAgIHRoaXMuc3BsaXRUaWxlKHBhcmVudC5zb3VyY2UsIHowLCB4MCwgeTAsIHosIHgsIHkpO1xuICAgICAgICBpZiAoZGVidWcgPiAxKSBjb25zb2xlLnRpbWVFbmQoJ2RyaWxsaW5nIGRvd24nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJhbnNmb3JtVGlsZSh0aGlzLnRpbGVzW2lkXSwgZXh0ZW50KTtcbn07XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybVRpbGUodGlsZSwgZXh0ZW50KSB7XG4gICAgaWYgKCF0aWxlIHx8IHRpbGUudHJhbnNmb3JtZWQpIHJldHVybiB0aWxlO1xuXG4gICAgdmFyIHoyID0gdGlsZS56MixcbiAgICAgICAgdHggPSB0aWxlLngsXG4gICAgICAgIHR5ID0gdGlsZS55LFxuICAgICAgICBpLCBqLCBrO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IHRpbGUuZmVhdHVyZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGZlYXR1cmUgPSB0aWxlLmZlYXR1cmVzW2ldLFxuICAgICAgICAgICAgZ2VvbSA9IGZlYXR1cmUuZ2VvbWV0cnksXG4gICAgICAgICAgICB0eXBlID0gZmVhdHVyZS50eXBlO1xuXG4gICAgICAgIGlmICh0eXBlID09PSAxKSB7XG4gICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZ2VvbS5sZW5ndGg7IGorKykgZ2VvbVtqXSA9IHRyYW5zZm9ybVBvaW50KGdlb21bal0sIGV4dGVudCwgejIsIHR4LCB0eSk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBnZW9tLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJpbmcgPSBnZW9tW2pdO1xuICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCByaW5nLmxlbmd0aDsgaysrKSByaW5nW2tdID0gdHJhbnNmb3JtUG9pbnQocmluZ1trXSwgZXh0ZW50LCB6MiwgdHgsIHR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRpbGUudHJhbnNmb3JtZWQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRpbGU7XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybVBvaW50KHAsIGV4dGVudCwgejIsIHR4LCB0eSkge1xuICAgIHZhciB4ID0gTWF0aC5yb3VuZChleHRlbnQgKiAocFswXSAqIHoyIC0gdHgpKSxcbiAgICAgICAgeSA9IE1hdGgucm91bmQoZXh0ZW50ICogKHBbMV0gKiB6MiAtIHR5KSk7XG4gICAgcmV0dXJuIFt4LCB5XTtcbn1cblxuLy8gY2hlY2tzIHdoZXRoZXIgYSB0aWxlIGlzIGEgd2hvbGUtYXJlYSBmaWxsIGFmdGVyIGNsaXBwaW5nOyBpZiBpdCBpcywgdGhlcmUncyBubyBzZW5zZSBzbGljaW5nIGl0IGZ1cnRoZXJcbmZ1bmN0aW9uIGlzQ2xpcHBlZFNxdWFyZShmZWF0dXJlcywgZXh0ZW50LCBidWZmZXIpIHtcbiAgICBpZiAoZmVhdHVyZXMubGVuZ3RoICE9PSAxKSByZXR1cm4gZmFsc2U7XG5cbiAgICB2YXIgZmVhdHVyZSA9IGZlYXR1cmVzWzBdO1xuICAgIGlmIChmZWF0dXJlLnR5cGUgIT09IDMgfHwgZmVhdHVyZS5nZW9tZXRyeS5sZW5ndGggPiAxKSByZXR1cm4gZmFsc2U7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZlYXR1cmUuZ2VvbWV0cnlbMF0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHAgPSBmZWF0dXJlLmdlb21ldHJ5WzBdW2ldO1xuICAgICAgICBpZiAoKHBbMF0gIT09IC1idWZmZXIgJiYgcFswXSAhPT0gZXh0ZW50ICsgYnVmZmVyKSB8fFxuICAgICAgICAgICAgKHBbMV0gIT09IC1idWZmZXIgJiYgcFsxXSAhPT0gZXh0ZW50ICsgYnVmZmVyKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gdG9JRCh6LCB4LCB5KSB7XG4gICAgcmV0dXJuICgoKDEgPDwgeikgKiB5ICsgeCkgKiAzMikgKyB6O1xufVxuXG5mdW5jdGlvbiBpbnRlcnNlY3RYKGEsIGIsIHgpIHtcbiAgICByZXR1cm4gW3gsICh4IC0gYVswXSkgKiAoYlsxXSAtIGFbMV0pIC8gKGJbMF0gLSBhWzBdKSArIGFbMV0sIDFdO1xufVxuZnVuY3Rpb24gaW50ZXJzZWN0WShhLCBiLCB5KSB7XG4gICAgcmV0dXJuIFsoeSAtIGFbMV0pICogKGJbMF0gLSBhWzBdKSAvIChiWzFdIC0gYVsxXSkgKyBhWzBdLCB5LCAxXTtcbn1cblxuZnVuY3Rpb24gZXh0ZW5kKGRlc3QsIHNyYykge1xuICAgIGZvciAodmFyIGkgaW4gc3JjKSBkZXN0W2ldID0gc3JjW2ldO1xuICAgIHJldHVybiBkZXN0O1xufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHNpbXBsaWZ5O1xuXG4vLyBjYWxjdWxhdGUgc2ltcGxpZmljYXRpb24gZGF0YSB1c2luZyBvcHRpbWl6ZWQgRG91Z2xhcy1QZXVja2VyIGFsZ29yaXRobVxuXG5mdW5jdGlvbiBzaW1wbGlmeShwb2ludHMsIHRvbGVyYW5jZSkge1xuXG4gICAgdmFyIHNxVG9sZXJhbmNlID0gdG9sZXJhbmNlICogdG9sZXJhbmNlLFxuICAgICAgICBsZW4gPSBwb2ludHMubGVuZ3RoLFxuICAgICAgICBmaXJzdCA9IDAsXG4gICAgICAgIGxhc3QgPSBsZW4gLSAxLFxuICAgICAgICBzdGFjayA9IFtdLFxuICAgICAgICBpLCBtYXhTcURpc3QsIHNxRGlzdCwgaW5kZXg7XG5cbiAgICAvLyBhbHdheXMgcmV0YWluIHRoZSBlbmRwb2ludHMgKDEgaXMgdGhlIG1heCB2YWx1ZSlcbiAgICBwb2ludHNbZmlyc3RdWzJdID0gMTtcbiAgICBwb2ludHNbbGFzdF1bMl0gPSAxO1xuXG4gICAgLy8gYXZvaWQgcmVjdXJzaW9uIGJ5IHVzaW5nIGEgc3RhY2tcbiAgICB3aGlsZSAobGFzdCkge1xuXG4gICAgICAgIG1heFNxRGlzdCA9IDA7XG5cbiAgICAgICAgZm9yIChpID0gZmlyc3QgKyAxOyBpIDwgbGFzdDsgaSsrKSB7XG4gICAgICAgICAgICBzcURpc3QgPSBnZXRTcVNlZ0Rpc3QocG9pbnRzW2ldLCBwb2ludHNbZmlyc3RdLCBwb2ludHNbbGFzdF0pO1xuXG4gICAgICAgICAgICBpZiAoc3FEaXN0ID4gbWF4U3FEaXN0KSB7XG4gICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIG1heFNxRGlzdCA9IHNxRGlzdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXhTcURpc3QgPiBzcVRvbGVyYW5jZSkge1xuICAgICAgICAgICAgcG9pbnRzW2luZGV4XVsyXSA9IG1heFNxRGlzdDsgLy8gc2F2ZSB0aGUgcG9pbnQgaW1wb3J0YW5jZSBpbiBzcXVhcmVkIHBpeGVscyBhcyBhIHogY29vcmRpbmF0ZVxuICAgICAgICAgICAgc3RhY2sucHVzaChmaXJzdCk7XG4gICAgICAgICAgICBzdGFjay5wdXNoKGluZGV4KTtcbiAgICAgICAgICAgIGZpcnN0ID0gaW5kZXg7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxhc3QgPSBzdGFjay5wb3AoKTtcbiAgICAgICAgICAgIGZpcnN0ID0gc3RhY2sucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIHNxdWFyZSBkaXN0YW5jZSBmcm9tIGEgcG9pbnQgdG8gYSBzZWdtZW50XG5mdW5jdGlvbiBnZXRTcVNlZ0Rpc3QocCwgYSwgYikge1xuXG4gICAgdmFyIHggPSBhWzBdLCB5ID0gYVsxXSxcbiAgICAgICAgYnggPSBiWzBdLCBieSA9IGJbMV0sXG4gICAgICAgIHB4ID0gcFswXSwgcHkgPSBwWzFdLFxuICAgICAgICBkeCA9IGJ4IC0geCxcbiAgICAgICAgZHkgPSBieSAtIHk7XG5cbiAgICBpZiAoZHggIT09IDAgfHwgZHkgIT09IDApIHtcblxuICAgICAgICB2YXIgdCA9ICgocHggLSB4KSAqIGR4ICsgKHB5IC0geSkgKiBkeSkgLyAoZHggKiBkeCArIGR5ICogZHkpO1xuXG4gICAgICAgIGlmICh0ID4gMSkge1xuICAgICAgICAgICAgeCA9IGJ4O1xuICAgICAgICAgICAgeSA9IGJ5O1xuXG4gICAgICAgIH0gZWxzZSBpZiAodCA+IDApIHtcbiAgICAgICAgICAgIHggKz0gZHggKiB0O1xuICAgICAgICAgICAgeSArPSBkeSAqIHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkeCA9IHB4IC0geDtcbiAgICBkeSA9IHB5IC0geTtcblxuICAgIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVUaWxlO1xuXG5mdW5jdGlvbiBjcmVhdGVUaWxlKGZlYXR1cmVzLCB6MiwgdHgsIHR5LCB0b2xlcmFuY2UsIG5vU2ltcGxpZnkpIHtcbiAgICB2YXIgdGlsZSA9IHtcbiAgICAgICAgZmVhdHVyZXM6IFtdLFxuICAgICAgICBudW1Qb2ludHM6IDAsXG4gICAgICAgIG51bVNpbXBsaWZpZWQ6IDAsXG4gICAgICAgIG51bUZlYXR1cmVzOiAwLFxuICAgICAgICBzb3VyY2U6IG51bGwsXG4gICAgICAgIHg6IHR4LFxuICAgICAgICB5OiB0eSxcbiAgICAgICAgejI6IHoyLFxuICAgICAgICB0cmFuc2Zvcm1lZDogZmFsc2VcbiAgICB9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmVhdHVyZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGlsZS5udW1GZWF0dXJlcysrO1xuICAgICAgICBhZGRGZWF0dXJlKHRpbGUsIGZlYXR1cmVzW2ldLCB0b2xlcmFuY2UsIG5vU2ltcGxpZnkpO1xuICAgIH1cbiAgICByZXR1cm4gdGlsZTtcbn1cblxuZnVuY3Rpb24gYWRkRmVhdHVyZSh0aWxlLCBmZWF0dXJlLCB0b2xlcmFuY2UsIG5vU2ltcGxpZnkpIHtcblxuICAgIHZhciBnZW9tID0gZmVhdHVyZS5nZW9tZXRyeSxcbiAgICAgICAgdHlwZSA9IGZlYXR1cmUudHlwZSxcbiAgICAgICAgc2ltcGxpZmllZCA9IFtdLFxuICAgICAgICBzcVRvbGVyYW5jZSA9IHRvbGVyYW5jZSAqIHRvbGVyYW5jZSxcbiAgICAgICAgaSwgaiwgcmluZywgcDtcblxuICAgIGlmICh0eXBlID09PSAxKSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBnZW9tLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBzaW1wbGlmaWVkLnB1c2goZ2VvbVtpXSk7XG4gICAgICAgICAgICB0aWxlLm51bVBvaW50cysrO1xuICAgICAgICAgICAgdGlsZS5udW1TaW1wbGlmaWVkKys7XG4gICAgICAgIH1cblxuICAgIH0gZWxzZSB7XG5cbiAgICAgICAgLy8gc2ltcGxpZnkgYW5kIHRyYW5zZm9ybSBwcm9qZWN0ZWQgY29vcmRpbmF0ZXMgZm9yIHRpbGUgZ2VvbWV0cnlcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGdlb20ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHJpbmcgPSBnZW9tW2ldO1xuXG4gICAgICAgICAgICAvLyBmaWx0ZXIgb3V0IHRpbnkgcG9seWxpbmVzICYgcG9seWdvbnNcbiAgICAgICAgICAgIGlmICghbm9TaW1wbGlmeSAmJiAoKHR5cGUgPT09IDIgJiYgcmluZy5kaXN0IDwgdG9sZXJhbmNlKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PT0gMyAmJiByaW5nLmFyZWEgPCBzcVRvbGVyYW5jZSkpKSB7XG4gICAgICAgICAgICAgICAgdGlsZS5udW1Qb2ludHMgKz0gcmluZy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzaW1wbGlmaWVkUmluZyA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcmluZy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHAgPSByaW5nW2pdO1xuICAgICAgICAgICAgICAgIC8vIGtlZXAgcG9pbnRzIHdpdGggaW1wb3J0YW5jZSA+IHRvbGVyYW5jZVxuICAgICAgICAgICAgICAgIGlmIChub1NpbXBsaWZ5IHx8IHBbMl0gPiBzcVRvbGVyYW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBzaW1wbGlmaWVkUmluZy5wdXNoKHApO1xuICAgICAgICAgICAgICAgICAgICB0aWxlLm51bVNpbXBsaWZpZWQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGlsZS5udW1Qb2ludHMrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2ltcGxpZmllZC5wdXNoKHNpbXBsaWZpZWRSaW5nKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzaW1wbGlmaWVkLmxlbmd0aCkge1xuICAgICAgICB0aWxlLmZlYXR1cmVzLnB1c2goe1xuICAgICAgICAgICAgZ2VvbWV0cnk6IHNpbXBsaWZpZWQsXG4gICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgdGFnczogZmVhdHVyZS50YWdzIHx8IG51bGxcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19\n","/* \r\n * Leaflet TimeDimension v0.1.6 - 2015-11-12 \r\n * \r\n * Copyright 2015 Biel Frontera (ICTS SOCIB) \r\n * datacenter@socib.es \r\n * http://www.socib.es/ \r\n * \r\n * Licensed under the MIT license. \r\n * \r\n * Demos: \r\n * http://apps.socib.es/Leaflet.TimeDimension/ \r\n * \r\n * Source: \r\n * git@github.com:socib/Leaflet.TimeDimension.git \r\n * \r\n */\r\n(function($){/*\r\n * L.TimeDimension: TimeDimension object manages the time component of a layer.\r\n * It can be shared among different layers and it can be added to a map, and become\r\n * the default timedimension component for any layer added to the map.\r\n */\r\n\r\nL.TimeDimension = L.Class.extend({\r\n\r\n    includes: L.Mixin.Events,\r\n\r\n    initialize: function(options) {\r\n        L.setOptions(this, options);\r\n        // _availableTimes is an array with all the available times in ms.\r\n        this._availableTimes = this._generateAvailableTimes();\r\n        this._currentTimeIndex = -1;\r\n        this._loadingTimeIndex = -1;\r\n        this._loadingTimeout = this.options.loadingTimeout || 3000;\r\n        this._syncedLayers = [];\r\n        this._global_dateFormat=\"YYYY\";\r\n        if (this._availableTimes.length > 0) {\r\n            this.setCurrentTime(this.options.currentTime || this._getDefaultCurrentTime());\r\n        }\r\n    },\r\n\r\n    getAvailableTimes: function() {\r\n        return this._availableTimes;\r\n    },\r\n\r\n    getCurrentTimeIndex: function() {\r\n        if (this._currentTimeIndex == -1) {\r\n            return this._availableTimes.length - 1;\r\n        }\r\n        return this._currentTimeIndex;\r\n    },\r\n\r\n    getCurrentTime: function() {\r\n        var index = -1;\r\n        if (this._loadingTimeIndex != -1) {\r\n            index = this._loadingTimeIndex;\r\n        } else {\r\n            index = this.getCurrentTimeIndex();\r\n        }\r\n        if (index >= 0) {\r\n            return this._availableTimes[index];\r\n        } else {\r\n            return 0;\r\n        }\r\n    },\r\n\r\n    isLoading: function() {\r\n        return (this._loadingTimeIndex != -1);\r\n    },\r\n\r\n    setCurrentTimeIndex: function(newIndex) {\r\n        if (newIndex >= this._availableTimes.length) {\r\n            newIndex = this._availableTimes.length - 1;\r\n        }\r\n        if (newIndex < 0) {\r\n            return;\r\n        }\r\n        this._loadingTimeIndex = newIndex;\r\n        var newTime = this._availableTimes[newIndex];\r\n        \r\n        if (this._checkSyncedLayersReady(this._availableTimes[this._loadingTimeIndex])) {\r\n            this._newTimeIndexLoaded();\r\n        } else {\r\n            this.fire('timeloading', {\r\n                time: newTime\r\n            });\r\n            // add timeout of 3 seconds if layers doesn't response\r\n            setTimeout((function(index) {\r\n                if (index == this._loadingTimeIndex) {\r\n                    \r\n                    this._newTimeIndexLoaded();\r\n                }\r\n            }).bind(this, newIndex), this._loadingTimeout);\r\n        }\r\n\r\n    },\r\n\r\n    _newTimeIndexLoaded: function() {\r\n        if (this._loadingTimeIndex == -1) {\r\n            return;\r\n        }\r\n        var time = this._availableTimes[this._loadingTimeIndex];\r\n        \r\n        ////console.warn(\"TIME*********\");\r\n        ////console.warn(time);\r\n        \r\n        \r\n        this._currentTimeIndex = this._loadingTimeIndex;\r\n        this.fire('timeload', {\r\n            time: time\r\n        });\r\n        this._loadingTimeIndex = -1;\r\n    },\r\n\r\n    _checkSyncedLayersReady: function(time) {\r\n        for (var i = 0, len = this._syncedLayers.length; i < len; i++) {\r\n            if (this._syncedLayers[i].isReady) {\r\n                if (!this._syncedLayers[i].isReady(time)) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n\r\n    setCurrentTime: function(time) {\r\n        var newIndex = this._seekNearestTimeIndex(time);\r\n        this.setCurrentTimeIndex(newIndex);\r\n    },\r\n\r\n    seekNearestTime: function(time) {\r\n        var index = this._seekNearestTimeIndex(time);\r\n        return this._availableTimes[index];\r\n    },    \r\n\r\n    nextTime: function(numSteps, loop) {\r\n        if (numSteps === undefined) {\r\n            numSteps = 1;\r\n        }\r\n        if (loop === undefined) {\r\n            loop = false;\r\n        }\r\n\r\n        var newIndex = this._currentTimeIndex;\r\n        if (this._loadingTimeIndex > -1)\r\n            newIndex = this._loadingTimeIndex;\r\n        newIndex = newIndex + numSteps;\r\n        if (newIndex >= this._availableTimes.length) {            \r\n            if (loop){\r\n                newIndex = 0;\r\n            }else{\r\n                // nextTime out of range\r\n                return;                \r\n            }\r\n        }\r\n        this.setCurrentTimeIndex(newIndex);\r\n    },\r\n\r\n    prepareNextTimes: function(numSteps, howmany) {\r\n        if (numSteps === undefined) {\r\n            numSteps = 1;\r\n        }\r\n\r\n        var newIndex = this._currentTimeIndex;\r\n        if (this._loadingTimeIndex > -1)\r\n            newIndex = this._loadingTimeIndex;\r\n        // assure synced layers have a buffer/cache of at least howmany elements\r\n        for (var i = 0, len = this._syncedLayers.length; i < len; i++) {\r\n            if (this._syncedLayers[i].setMinimumForwardCache) {\r\n                this._syncedLayers[i].setMinimumForwardCache(howmany);\r\n            }\r\n        }\r\n        var count = howmany;\r\n        while (count > 0) {\r\n            newIndex = newIndex + numSteps;\r\n            if (newIndex >= this._availableTimes.length) {\r\n                break;\r\n            }\r\n            this.fire('timeloading', {\r\n                time: this._availableTimes[newIndex]\r\n            });\r\n            count--;\r\n        }\r\n    },\r\n\r\n    getNumberNextTimesReady: function(numSteps, howmany) {\r\n        if (numSteps === undefined) {\r\n            numSteps = 1;\r\n        }\r\n\r\n        var newIndex = this._currentTimeIndex;\r\n        if (this._loadingTimeIndex > -1)\r\n            newIndex = this._loadingTimeIndex;\r\n        var count = howmany;\r\n        var ready = 0;\r\n        while (count > 0) {\r\n            newIndex = newIndex + numSteps;\r\n            if (newIndex >= this._availableTimes.length) {\r\n                count = 0;\r\n                ready = howmany;\r\n                break;\r\n            }            \r\n            var time = this._availableTimes[newIndex];\r\n            if (this._checkSyncedLayersReady(time)){\r\n                ready++;\r\n            }\r\n            count--;\r\n        }\r\n        return ready;\r\n    },\r\n\r\n    previousTime: function(numSteps) {\r\n        if (numSteps === undefined) {\r\n            numSteps = 1;\r\n        }\r\n        var newIndex = this._currentTimeIndex;\r\n        if (this._loadingTimeIndex > -1)\r\n            newIndex = this._loadingTimeIndex;\r\n        newIndex = newIndex - numSteps;\r\n        if (newIndex < 0) {\r\n            newIndex = 0;\r\n        }\r\n        this.setCurrentTimeIndex(newIndex);\r\n    },\r\n\r\n    registerSyncedLayer: function(layer) {\r\n        this._syncedLayers.push(layer);\r\n        layer.on(\"timeload\", this._onSyncedLayerLoaded, this);\r\n    },\r\n\r\n    unregisterSyncedLayer: function(layer) {\r\n        var index = this._syncedLayers.indexOf(layer);\r\n        if (index != -1) {\r\n            this._syncedLayers.splice(index, 1);\r\n        }\r\n        layer.off(\"timeload\", this._onSyncedLayerLoaded, this);\r\n    },\r\n\r\n    _onSyncedLayerLoaded: function(e) {\r\n    \t\r\n    \t\r\n    \t\r\n        if (e.time == this._availableTimes[this._loadingTimeIndex] && this._checkSyncedLayersReady(e.time)) {\r\n            this._newTimeIndexLoaded();\r\n        }\r\n    },\r\n\r\n    _generateAvailableTimes: function() {\r\n        if (this.options.times) {\r\n            return L.TimeDimension.Util.parseTimesExpression(this.options.times);\r\n        } else if (this.options.timeInterval) {\r\n            var tiArray = L.TimeDimension.Util.parseTimeInterval(this.options.timeInterval);\r\n            var period = this.options.period || \"P1D\";\r\n            var validTimeRange = this.options.validTimeRange || undefined; \r\n            return L.TimeDimension.Util.explodeTimeRange(tiArray[0], tiArray[1], period, validTimeRange);\r\n        } else {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    _getDefaultCurrentTime: function() {\r\n        var index = this._seekNearestTimeIndex(new Date().getTime());\r\n        return this._availableTimes[index];\r\n    },\r\n\r\n    _seekNearestTimeIndex: function(time) {\r\n        var newIndex = 0;\r\n        var len = this._availableTimes.length;\r\n        for (; newIndex < len; newIndex++) {\r\n            if (time < this._availableTimes[newIndex]) {\r\n                break;\r\n            }\r\n        }\r\n        // We've found the first index greater than the time. Return the previous\r\n        if (newIndex > 0) {\r\n            newIndex--;\r\n        }\r\n        return newIndex;\r\n    },\r\n\r\n    setAvailableTimes: function(times, mode) {\r\n        var currentTime = this.getCurrentTime();\r\n        if (mode == 'extremes') {\r\n            var period = this.options.period || \"P1D\";\r\n            this._availableTimes = L.TimeDimension.Util.explodeTimeRange(new Date(times[0]), new Date(times[times.length - 1]), period);\r\n        } else {\r\n            var parsedTimes = L.TimeDimension.Util.parseTimesExpression(times);\r\n            if (this._availableTimes.length == 0) {\r\n                this._availableTimes = parsedTimes;\r\n            } else if (mode == 'intersect') {\r\n                this._availableTimes = L.TimeDimension.Util.intersect_arrays(parsedTimes, this._availableTimes);\r\n            } else if (mode == 'union') {\r\n                this._availableTimes = L.TimeDimension.Util.union_arrays(parsedTimes, this._availableTimes);\r\n            } else if (mode == 'replace') {\r\n                this._availableTimes = parsedTimes;\r\n            } else {\r\n                throw \"Merge available times mode not implemented: \" + mode;\r\n            }\r\n        }\r\n        this.setCurrentTime(currentTime);\r\n        this.fire('availabletimeschanged', {});\r\n        \r\n    }\r\n});\r\n\r\nL.Map.addInitHook(function() {\r\n    if (this.options.timeDimension) {\r\n        this.timeDimension = L.timeDimension(this.options.timeDimensionOptions || {});\r\n    }\r\n});\r\n\r\nL.timeDimension = function(options) {\r\n    return new L.TimeDimension(options);\r\n};\r\n/*\r\n * L.TimeDimension.Util\r\n */\r\n\r\nL.TimeDimension.Util = {\r\n    getTimeDuration: function(ISODuration) {\r\n        if (nezasa === undefined) {\r\n            throw \"iso8601-js-period library is required for Leatlet.TimeDimension: https://github.com/nezasa/iso8601-js-period\";\r\n        }\r\n        return nezasa.iso8601.Period.parse(ISODuration, true);\r\n    },\r\n\r\n    addTimeDuration: function(date, duration, utc) {\r\n        if (utc === undefined) {\r\n            utc = true;\r\n        }\r\n        if (typeof duration == 'string' || duration instanceof String) {\r\n            duration = this.getTimeDuration(duration);\r\n        }\r\n        var l = duration.length;\r\n        var get = utc ? \"getUTC\" : \"get\";\r\n        var set = utc ? \"setUTC\" : \"set\";\r\n\r\n        if (l > 0 && duration[0] != 0) {\r\n            date[set + \"FullYear\"](date[get + \"FullYear\"]() + duration[0]);\r\n        }\r\n        if (l > 1 && duration[1] != 0) {\r\n            date[set + \"Month\"](date[get + \"Month\"]() + duration[1]);\r\n        }\r\n        if (l > 2 && duration[2] != 0) {\r\n            // weeks\r\n            date[set + \"Date\"](date[get + \"Date\"]() + (duration[2] * 7));\r\n        }\r\n        if (l > 3 && duration[3] != 0) {\r\n            date[set + \"Date\"](date[get + \"Date\"]() + duration[3]);\r\n        }\r\n        if (l > 4 && duration[4] != 0) {\r\n            date[set + \"Hours\"](date[get + \"Hours\"]() + duration[4]);\r\n        }\r\n        if (l > 5 && duration[5] != 0) {\r\n            date[set + \"Minutes\"](date[get + \"Minutes\"]() + duration[5]);\r\n        }\r\n        if (l > 6 && duration[6] != 0) {\r\n            date[set + \"Seconds\"](date[get + \"Seconds\"]() + duration[6]);\r\n        }\r\n    },\r\n\r\n    subtractTimeDuration: function(date, duration, utc) {\r\n        if (typeof duration == 'string' || duration instanceof String) {\r\n            duration = this.getTimeDuration(duration);\r\n        }\r\n        var subDuration = [];\r\n        for (var i = 0, l = duration.length; i < l; i++) {\r\n            subDuration.push(-duration[i]);\r\n        }\r\n        this.addTimeDuration(date, subDuration, utc);\r\n    },\r\n\r\n    parseAndExplodeTimeRange: function(timeRange) {\r\n        var tr = timeRange.split('/');\r\n        var startTime = new Date(Date.parse(tr[0]));\r\n        var endTime = new Date(Date.parse(tr[1]));\r\n        var duration = tr.length > 2 ? tr[2] : \"P1D\";\r\n\r\n        return this.explodeTimeRange(startTime, endTime, duration);\r\n    },\r\n\r\n    explodeTimeRange: function(startTime, endTime, ISODuration, validTimeRange) {\r\n        var duration = this.getTimeDuration(ISODuration);\r\n        var result = [];\r\n        var currentTime = new Date(startTime.getTime());\r\n        var minHour = null,\r\n            minMinutes = null,\r\n            maxHour = null,\r\n            maxMinutes = null;\r\n        if (validTimeRange !== undefined) {\r\n            var validTimeRangeArray = validTimeRange.split('/');\r\n            minHour = validTimeRangeArray[0].split(':')[0];\r\n            minMinutes = validTimeRangeArray[0].split(':')[1];\r\n            maxHour = validTimeRangeArray[1].split(':')[0];\r\n            maxMinutes = validTimeRangeArray[1].split(':')[1];\r\n        }\r\n        while (currentTime < endTime) {\r\n            if (validTimeRange === undefined ||\r\n                (currentTime.getUTCHours() >= minHour && currentTime.getUTCHours() <= maxHour)\r\n            ) {\r\n                if ((currentTime.getUTCHours() != minHour || currentTime.getUTCMinutes() >= minMinutes) &&\r\n                    (currentTime.getUTCHours() != maxHour || currentTime.getUTCMinutes() <= maxMinutes)) {\r\n                    result.push(currentTime.getTime());\r\n                }\r\n            }\r\n            this.addTimeDuration(currentTime, duration);\r\n        }\r\n        if (currentTime >= endTime){\r\n            result.push(endTime.getTime());\r\n        }\r\n        return result;\r\n    },\r\n\r\n    parseTimeInterval: function(timeInterval) {\r\n        var parts = timeInterval.split(\"/\");\r\n        if (parts.length != 2) {\r\n            throw \"Incorrecte ISO9601 Interval: \" + timeInterval;\r\n        }\r\n        var startTime = Date.parse(parts[0]);\r\n        var endTime = null;\r\n        var duration = null;\r\n        if (isNaN(startTime)) {\r\n            // -> format duration/endTime\r\n            duration = this.getTimeDuration(parts[0]);\r\n            endTime = Date.parse(parts[1]);\r\n            startTime = new Date(endTime);\r\n            this.subtractTimeDuration(startTime, duration, true);\r\n            endTime = new Date(endTime);\r\n        } else {\r\n            endTime = Date.parse(parts[1]);\r\n            if (isNaN(endTime)) {\r\n                // -> format startTime/duration                \r\n                duration = this.getTimeDuration(parts[1]);\r\n                endTime = new Date(startTime);\r\n                this.addTimeDuration(endTime, duration, true);\r\n            } else {\r\n                // -> format startTime/endTime\r\n                endTime = new Date(endTime);\r\n            }\r\n            startTime = new Date(startTime);\r\n        }\r\n        return [startTime, endTime];\r\n    },\r\n\r\n    parseTimesExpression: function(times) {\r\n        var result = [];\r\n        if (!times) {\r\n            return result;\r\n        }\r\n        if (typeof times == 'string' || times instanceof String) {\r\n            var testTimeRange = times.split(\"/\");\r\n            if (testTimeRange.length == 3) {\r\n                result = this.parseAndExplodeTimeRange(times);\r\n            } else {\r\n            \t\r\n            \ttimes = times.replace(/\\s/g, \"\");\r\n                var dates = times.split(\",\");\r\n              \r\n                var time;\r\n                for (var i = 0, l = dates.length; i < l; i++) {\r\n                    time = Date.parse(dates[i]);\r\n                   \r\n                    if (!isNaN(time)) {\r\n                        result.push(time);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            result = times;\r\n        }\r\n        return result.sort(function(a, b) {\r\n            return a - b;\r\n        });\r\n    },\r\n\r\n    intersect_arrays: function(arrayA, arrayB) {\r\n        var a = arrayA.slice(0);\r\n        var b = arrayB.slice(0);\r\n        var result = [];\r\n        while (a.length > 0 && b.length > 0) {\r\n            if (a[0] < b[0]) {\r\n                a.shift();\r\n            } else if (a[0] > b[0]) {\r\n                b.shift();\r\n            } else /* they're equal */ {\r\n                result.push(a.shift());\r\n                b.shift();\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n\r\n    union_arrays: function(arrayA, arrayB) {\r\n        var a = arrayA.slice(0);\r\n        var b = arrayB.slice(0);\r\n        var result = [];\r\n        while (a.length > 0 && b.length > 0) {\r\n            if (a[0] < b[0]) {\r\n                result.push(a.shift());\r\n            } else if (a[0] > b[0]) {\r\n                result.push(b.shift());\r\n            } else /* they're equal */ {\r\n                result.push(a.shift());\r\n                b.shift();\r\n            }\r\n        }\r\n        if (a.length > 0) {\r\n            result = result.concat(a);\r\n        } else if (b.length > 0) {\r\n            result = result.concat(b);\r\n        }\r\n        return result;\r\n    }\r\n\r\n};\r\n/*\r\n * L.TimeDimension.Layer:  an abstract Layer that can be managed/synchronized with a TimeDimension. \r\n * The constructor recieves a layer (of any kind) and options.\r\n * Any children class should implement `_onNewTimeLoading`, `isReady` and `_update` functions \r\n * to react to time changes.\r\n */\r\n\r\nL.TimeDimension.Layer = (L.Layer || L.Class).extend({\r\n\r\n    includes: L.Mixin.Events,\r\n\r\n    initialize: function(layer, options) {\r\n        L.setOptions(this, options || {});\r\n        this._map = null;\r\n        this._baseLayer = layer;\r\n        this._currentLayer = null;\r\n        this._global_dateFormat=\"YYYY\";\r\n        this._timeDimension = this.options.timeDimension || null;\r\n    },\r\n\r\n    addTo: function(map) {\r\n        map.addLayer(this);\r\n        return this;\r\n    },\r\n\r\n    onAdd: function(map) {\r\n        this._map = map;\r\n        if (!this._timeDimension && map.timeDimension) {\r\n            this._timeDimension = map.timeDimension;\r\n        }\r\n        this._timeDimension.on(\"timeloading\", this._onNewTimeLoading, this);\r\n        this._timeDimension.on(\"timeload\", this._update, this);\r\n        this._timeDimension.registerSyncedLayer(this);\r\n        this._update();\r\n    },\r\n\r\n    onRemove: function(map) {\r\n        this._timeDimension.unregisterSyncedLayer(this);\r\n        this._timeDimension.off(\"timeloading\", this._onNewTimeLoading, this);\r\n        this._timeDimension.off(\"timeload\", this._update, this);\r\n        this.eachLayer(map.removeLayer, map);\r\n        this._map = null;\r\n    },\r\n\r\n    eachLayer: function(method, context) {\r\n        method.call(context, this._baseLayer);\r\n        return this;\r\n    },\r\n\r\n    setZIndex: function(zIndex) {\r\n        if (this._baseLayer.setZIndex) {\r\n            this._baseLayer.setZIndex(zIndex);\r\n        }\r\n        if (this._currentLayer && this._currentLayer.setZIndex) {\r\n            this._currentLayer.setZIndex(zIndex);\r\n        }\r\n    },\r\n\r\n    bringToBack: function() {\r\n        if (!this._currentLayer) {\r\n            return;\r\n        }\r\n        this._currentLayer.bringToBack();\r\n    },\r\n\r\n    bringToFront: function() {\r\n        if (!this._currentLayer) {\r\n            return;\r\n        }\r\n        this._currentLayer.bringToFront();\r\n    },\r\n\r\n    _onNewTimeLoading: function(ev) {\r\n        // to be implemented for each type of layer\r\n        this.fire('timeload', {\r\n            time: ev.time\r\n        });\r\n        return;\r\n    },\r\n\r\n    isReady: function(time) {\r\n        // to be implemented for each type of layer\r\n        return true;\r\n    },\r\n\r\n    _update: function() {\r\n        // to be implemented for each type of layer\r\n        return true;\r\n    },\r\n\r\n    getBaseLayer: function(){\r\n        return this._baseLayer;\r\n    }\r\n\r\n});\r\n\r\nL.timeDimension.layer = function(layer, options) {\r\n    return new L.TimeDimension.Layer(layer, options);\r\n};\r\n/*\r\n * L.TimeDimension.Layer.WMS: wms Layer associated to a TimeDimension\r\n */\r\n\r\nL.TimeDimension.Layer.WMS = L.TimeDimension.Layer.extend({\r\n\r\n    initialize: function(layer, options) {\r\n        L.TimeDimension.Layer.prototype.initialize.call(this, layer, options);\r\n        this._timeCacheBackward = this.options.cacheBackward || this.options.cache || 0;\r\n        this._timeCacheForward = this.options.cacheForward || this.options.cache || 0;\r\n        this._wmsVersion = this.options.wmsVersion || \"1.1.1\";\r\n        this._proxy = this.options.proxy || null;\r\n        this._updateTimeDimension = this.options.updateTimeDimension || false;\r\n\t\t\r\n        this._setDefaultTime = this.options.setDefaultTime || false;\r\n        this._updateTimeDimensionMode = this.options.updateTimeDimensionMode || 'intersect'; // 'union' or 'replace'\r\n        this._layers = {};\r\n        this._defaultTime = 0;\r\n        this._availableTimes = [];\r\n        this._capabilitiesRequested = false;\r\n\t\tthis._firstDateAvailable = \"\";\r\n        if (this._updateTimeDimension || this.options.requestTimeFromCapabilities) {\r\n            this._requestTimeDimensionFromCapabilities();\r\n        }\r\n\r\n        this._baseLayer.on('load', (function() {\r\n            this._baseLayer.setLoaded(true);\r\n            this.fire('timeload', {\r\n                time: this._defaultTime\r\n            });\r\n        }).bind(this));\r\n    },\r\n\r\n    eachLayer: function(method, context) {\r\n        for (var prop in this._layers) {\r\n            if (this._layers.hasOwnProperty(prop)) {\r\n                method.call(context, this._layers[prop]);\r\n            }\r\n        }\r\n        return L.TimeDimension.Layer.prototype.eachLayer.call(this, method, context);\r\n    },\r\n\r\n    _onNewTimeLoading: function(ev) {\r\n        // \r\n        var layer = this._getLayerForTime(ev.time);\r\n        if (!this._map.hasLayer(layer)) {\r\n            this._map.addLayer(layer);\r\n            // \r\n        }\r\n    },\r\n\r\n    isReady: function(time) {\r\n        var layer = this._getLayerForTime(time);\r\n        return layer.isLoaded();\r\n    },\r\n\r\n    onAdd: function(map) {\r\n        L.TimeDimension.Layer.prototype.onAdd.call(this, map);\r\n        if (this._availableTimes.length == 0) {\r\n            this._requestTimeDimensionFromCapabilities();\r\n        } else {\r\n            this._updateTimeDimensionAvailableTimes();\r\n        }\r\n    },\r\n\r\n    _update: function() {\r\n        if (!this._map)\r\n            return;\r\n        var time = this._timeDimension.getCurrentTime();\r\n        // It will get the layer for this time (create or get)\r\n        // Then, the layer will be loaded if necessary, adding it to the map (and show it after loading).\r\n        // If it already on the map (but probably hidden), it will be shown\r\n\t\t//////console.info(time);\r\n        var layer = this._getLayerForTime(time);\r\n        if (this._currentLayer == null) {\r\n            this._currentLayer = layer;\r\n        }\r\n        if (!this._map.hasLayer(layer)) {\r\n            this._map.addLayer(layer);\r\n        } else {\r\n            this._showLayer(layer, time);\r\n        }\r\n    },\r\n\r\n    setParams: function(params, noRedraw) {\r\n        L.extend(this._baseLayer.options, params);\r\n        this._baseLayer.setParams(params, noRedraw);\r\n        if (this._currentLayer) {\r\n            this._currentLayer.setParams(params, noRedraw);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    _showLayer: function(layer, time) {\r\n        if (this._currentLayer && this._currentLayer !== layer) {\r\n            this._currentLayer.hide();\r\n        }\r\n        layer.show();\r\n        if (this._currentLayer && this._currentLayer === layer) {\r\n            return;\r\n        }\r\n        this._currentLayer = layer;\r\n        \r\n        // Cache management        \r\n        var times = this._getLoadedTimes();\r\n        var strTime = String(time);\r\n\t\t//////console.info(strTime);\r\n        var index = times.indexOf(strTime);\r\n        var remove = [];\r\n        // remove times before current time\r\n        if (this._timeCacheBackward > -1) {\r\n            var objectsToRemove = index - this._timeCacheBackward;\r\n            if (objectsToRemove > 0) {\r\n                remove = times.splice(0, objectsToRemove);\r\n                this._removeLayers(remove);\r\n            }\r\n        }\r\n        if (this._timeCacheForward > -1) {\r\n            index = times.indexOf(strTime);\r\n            var objectsToRemove = times.length - index - this._timeCacheForward - 1;\r\n            if (objectsToRemove > 0) {\r\n                remove = times.splice(index + this._timeCacheForward + 1, objectsToRemove);\r\n                this._removeLayers(remove);\r\n            }\r\n        }\r\n    },\r\n\r\n    _getLayerForTime: function(time) {\r\n    \t\r\n    \r\n    \t\r\n        if (time == 0 || time == this._defaultTime) {\r\n            return this._baseLayer;\r\n        }\r\n        if (this._layers.hasOwnProperty(time)) {\r\n            return this._layers[time];\r\n        }\r\n        var nearestTime = this._getNearestTime(time);\r\n        if (this._layers.hasOwnProperty(nearestTime)) {\r\n            return this._layers[nearestTime];\r\n        }\r\n\r\n        var wmsParams = this._baseLayer.options;\r\n\t\t\r\n\t\tif(this._global_dateFormat){\r\n\t\t\t\r\n\t\t\r\n\r\n\t\t\tif(this._global_dateFormat=='YYYY'){\r\n\t\t\t\t\r\n\t\t\t\twmsParams.time = new Date(nearestTime).getFullYear();\r\n\t\t\t\t\r\n\r\n\t\t\t}else if(this._global_dateFormat=='YYYY-MM'){\r\n\t\t\t\t\r\n\t\t\t\tvar _TM=new Date(nearestTime);\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\twmsParams.time = _TM.getFullYear() +\"-\"+eval(_TM.getMonth()+1) ;\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t}else if(this._global_dateFormat=='YYYY-MM-DD'){\r\n\t\t\t\t\r\n\t\t\t\tvar _TM=new Date(nearestTime);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\twmsParams.time = _TM.getFullYear() +\"-\"+eval(_TM.getMonth()+1) +\"-\"+_TM.getDate() ;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\r\n\t\t\twmsParams.time = new Date(nearestTime).toISOString();\r\n\t\t\t\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t}else{\r\n\t\t\twmsParams.time = new Date(nearestTime).toISOString();\r\n\t\t\r\n\t\t}\r\n\t\r\n\t\t\t\t\r\n        //wmsParams.time = new Date(nearestTime).toISOString();\r\n\t\t\r\n\t\t//***********************\r\n\t\t//* Patch ICGC Sentinel\r\n\t\t//* El format del param time ha de ser YYYY-MM\r\n\t\t var firstYearMonth = this._firstDateAvailable.split(\"-\");\r\n\t\t if(parseInt(firstYearMonth[0]) < 2100 && parseInt(firstYearMonth[1]) < 13){\r\n\t\t\t // La data del capabilities es en format Sentinel2 ICGC => 2016-03\r\n\t\t\t // cal que la data enviada al geoservei estigui en el mateix format yyyy-mm\r\n\t\t\t \r\n\t\t\t\r\n\t\t\t wmsParams.time = wmsParams.time.substr(0,7);\r\n\t\t }else{\r\n\t\t\t \r\n\t\t\t //else YYYY\r\n\t\t\t \r\n\t\t\t wmsParams.time = wmsParams.time.substr(0,4);\r\n\t\t } \r\n\t\t//***\r\n\t\t\r\n        var newLayer = null;\r\n        if (this._baseLayer instanceof L.TileLayer) {\r\n            newLayer = L.tileLayer.wms(this._baseLayer.getURL(), wmsParams);\r\n        } else {\r\n            newLayer = L.nonTiledLayer.wms(this._baseLayer.getURL(), wmsParams);\r\n        }\r\n        this._layers[time] = newLayer;\r\n\r\n        newLayer.on('load', (function(layer, time) {\r\n            layer.setLoaded(true);\r\n            if (this._timeDimension && time == this._timeDimension.getCurrentTime() && !this._timeDimension.isLoading()) {\r\n                this._showLayer(layer, time);\r\n            }\r\n            // \r\n            this.fire('timeload', {\r\n                time: time\r\n            });\r\n        }).bind(this, newLayer, time));\r\n\r\n       \r\n        newLayer.onAdd = (function(map) {\r\n            Object.getPrototypeOf(this).onAdd.call(this, map);\r\n            this.hide();\r\n        }).bind(newLayer);\r\n        return newLayer;\r\n    },\r\n\r\n    _getLoadedTimes: function() {\r\n        var result = [];\r\n        for (var prop in this._layers) {\r\n            if (this._layers.hasOwnProperty(prop)) {\r\n                result.push(prop);\r\n            }\r\n        }\r\n        return result.sort(function(a, b) {\r\n            return a - b;\r\n        });\r\n    },\r\n\r\n    _removeLayers: function(times) {\r\n        for (var i = 0, l = times.length; i < l; i++) {\r\n            this._map.removeLayer(this._layers[times[i]]);\r\n            delete this._layers[times[i]];\r\n        }\r\n    },\r\n\r\n    setMinimumForwardCache: function(value) {\r\n        if (value > this._timeCacheForward) {\r\n            this._timeCacheForward = value;\r\n        }\r\n    },\r\n\r\n    _requestTimeDimensionFromCapabilities: function() {\r\n        if (this._capabilitiesRequested) {\r\n            return;\r\n        }\r\n        this._capabilitiesRequested = true;\r\n        var wms = this._baseLayer.getURL();\r\n        var interro=\"?\";\r\n        if(wms.indexOf('?')>-1){\r\n        \tinterro=\"\";\r\n        \t\r\n        }\r\n        var url = wms +interro+\"service=WMS&version=\" +\r\n            this._wmsVersion + \"&request=GetCapabilities\";\r\n        if (this._proxy) {\r\n            url = this._proxy  +'?url=' + encodeURIComponent(url);\r\n        }\r\n        $.get(url, (function(data) {\r\n\t\t\t\r\n            this._defaultTime = Date.parse(this._getDefaultTimeFromCapabilities(data));\t\t\t\r\n\t\t\t\r\n            this._setDefaultTime = this._setDefaultTime || (this._timeDimension && this._timeDimension.getAvailableTimes().length == 0);\r\n            this.setAvailableTimes(this._parseTimeDimensionFromCapabilities(data));\r\n                     \r\n            if (this._setDefaultTime && this._timeDimension) {\r\n\t\t\t\t\r\n\t\t\r\n                this._timeDimension.setCurrentTime(this._defaultTime);\r\n            }\r\n        }).bind(this));\r\n    },\r\n\r\n    _parseTimeDimensionFromCapabilities: function(xml) {\r\n        var layers = $(xml).find('Layer[queryable=\"1\"]');\r\n        var layerName = this._baseLayer.wmsParams.layers;\r\n        var layerNameElement = layers.find(\"Name\").filter(function(index) {\r\n            return $(this).text() === layerName;\r\n        });\r\n        var times = null;\r\n        if (layerNameElement) {        \t       \t\r\n            var layer = layerNameElement.parent();                     \r\n            times = this._getTimesFromLayerCapabilities(layer);            \r\n            if (!times) {\r\n                times = this._getTimesFromLayerCapabilities(layer.parent());\r\n            }\r\n        }\r\n\t\tvar yearmonth = times.split(\",\");\r\n\t\tthis._firstDateAvailable = yearmonth[0];\r\n        return times;\r\n    },\r\n\r\n    _getTimesFromLayerCapabilities: function(layer) {\r\n    \t\r\n        var times = null;\r\n        var dimension = layer.find(\"Dimension[name='time']\");\r\n        if (dimension && dimension.length && dimension[0].textContent.length) {\r\n            times = dimension[0].textContent.trim();\r\n        } else {\r\n            var extent = layer.find(\"Extent[name='time']\");\r\n            if (extent && extent.length && extent[0].textContent.length) {\r\n                times = extent[0].textContent.trim();\r\n            }\r\n        }\r\n        \r\n       \r\n        return times;\r\n    },\r\n\r\n    _getDefaultTimeFromCapabilities: function(xml) {\r\n        var layers = $(xml).find('Layer[queryable=\"0\"]');\r\n        var layerName = this._baseLayer.wmsParams.layers;\r\n        var layerNameElement = layers.find(\"Name\").filter(function(index) {\r\n            return $(this).text() === layerName;\r\n        });\r\n        var defaultTime = 0;\r\n        if (layerNameElement) {\r\n        \t\r\n        \t\r\n            var layer = layerNameElement.parent();\r\n            defaultTime = this._getDefaultTimeFromLayerCapabilities(layer);\r\n\t\t\t\r\n           \r\n            if(defaultTime.length ==4){\r\n            \t\r\n            \tthis._global_dateFormat=\"YYYY\";\r\n            \r\n            }else if (defaultTime.length ==7){\r\n            \t\r\n            \tthis._global_dateFormat=\"YYYY-MM\";\t\r\n            \t\t\r\n            }else if (defaultTime.length ==10){\r\n            \t\r\n            \tthis._global_dateFormat=\"YYYY-MM-DD\";\r\n            \r\n            }else if (defaultTime.length ==0){\r\n            \t\r\n            \tthis._global_dateFormat=\"YYYY\";\r\n            \t\r\n            \t\r\n            }else{\r\n            \t            \t\r\n            \tthis._global_dateFormat=\"YYYY-MM-DD:HHSS\";            \t           \t            \t\r\n            \t\r\n            }\r\n\t\t\t\r\n\t\t\tif (defaultTime == 0) {\r\n                defaultTime = this._getDefaultTimeFromLayerCapabilities(layer.parent());\r\n               // this._global_dateFormat=\"YYYY\";\r\n\t\t\t\r\n            }\r\n\t\t\t//console.info(defaultTime);\r\n        }\r\n        \r\n        \r\n        return defaultTime;\r\n    },\r\n\r\n    _getDefaultTimeFromLayerCapabilities: function(layer) {\r\n        var defaultTime = 0;\r\n        var dimension = layer.find(\"Dimension[name='time']\");\r\n       \r\n        if (dimension && dimension.attr(\"default\")) {\r\n            defaultTime = dimension.attr(\"default\");\r\n        } else {\r\n            var extent = layer.find(\"Extent[name='time']\");\r\n            if (extent && extent.attr(\"default\")) {\r\n                defaultTime = extent.attr(\"default\");\r\n            }\r\n        }\r\n        \r\n      \r\n        return defaultTime;\r\n    },\r\n\r\n\r\n    setAvailableTimes: function(times) {\r\n    \t\r\n    \t\r\n        this._availableTimes = L.TimeDimension.Util.parseTimesExpression(times);\r\n      \r\n        this._updateTimeDimensionAvailableTimes();\r\n    },\r\n\r\n    _updateTimeDimensionAvailableTimes: function() {\r\n        if ((this._timeDimension && this._updateTimeDimension) ||\r\n            (this._timeDimension && this._timeDimension.getAvailableTimes().length == 0)) {\r\n            this._timeDimension.setAvailableTimes(this._availableTimes, this._updateTimeDimensionMode);\r\n            if (this._defaultTime > 0) {\r\n                this._timeDimension.setCurrentTime(this._defaultTime);\r\n            }\r\n        }\r\n    },\r\n\r\n    _getNearestTime: function(time) {\r\n        if (this._layers.hasOwnProperty(time)) {\r\n            return time;\r\n        }\r\n        if (this._availableTimes.length == 0) {\r\n            return time;\r\n        }\r\n        var index = 0;\r\n        var len = this._availableTimes.length;\r\n        for (; index < len; index++) {\r\n            if (time < this._availableTimes[index]) {\r\n                break;\r\n            }\r\n        }\r\n        // We've found the first index greater than the time. Get the previous\r\n        if (index > 0) {\r\n            index--;\r\n        }\r\n        if (time != this._availableTimes[index]) {\r\n            \r\n            \r\n        }\r\n        return this._availableTimes[index];\r\n    },\r\n\r\n});\r\n\r\nif (!L.NonTiledLayer) {\r\n    L.NonTiledLayer = L.Class.extend({});\r\n}\r\n\r\nL.NonTiledLayer.include({\r\n    _visible: true,\r\n    _loaded: false,\r\n\r\n    _originalUpdate: L.NonTiledLayer.prototype._update,\r\n\r\n    _update: function() {\r\n        if (!this._visible && this._loaded) {\r\n            return;\r\n        }\r\n        this._originalUpdate();\r\n    },\r\n\r\n    setLoaded: function(loaded) {\r\n        this._loaded = loaded;\r\n    },\r\n\r\n    isLoaded: function() {\r\n        return this._loaded;\r\n    },\r\n\r\n    hide: function() {\r\n        this._visible = false;\r\n        this._div.style.display = 'none';\r\n    },\r\n\r\n    show: function() {\r\n        this._visible = true;\r\n        this._div.style.display = 'block';\r\n    },\r\n\r\n    getURL: function() {\r\n        return this._wmsUrl;\r\n    }\r\n\r\n});\r\n\r\nL.TileLayer.include({\r\n    _visible: true,\r\n    _loaded: false,\r\n\r\n    _originalUpdate: L.TileLayer.prototype._update,\r\n\r\n    _update: function() {\r\n        if (!this._visible && this._loaded) {\r\n            return;\r\n        }\r\n        this._originalUpdate();\r\n    },\r\n\r\n    setLoaded: function(loaded) {\r\n        this._loaded = loaded;\r\n    },\r\n\r\n    isLoaded: function() {\r\n        return this._loaded;\r\n    },\r\n\r\n    hide: function() {\r\n        this._visible = false;\r\n        if (this._container) {\r\n            this._container.style.display = 'none';\r\n        }\r\n    },\r\n\r\n    show: function() {\r\n        this._visible = true;\r\n        if (this._container) {\r\n            this._container.style.display = 'block';\r\n        }\r\n    },\r\n\r\n    getURL: function() {\r\n        return this._url;\r\n    }\r\n\r\n});\r\n\r\nL.timeDimension.layer.wms = function(layer, options) {\r\n    return new L.TimeDimension.Layer.WMS(layer, options);\r\n};\r\n/*\r\n * L.TimeDimension.Layer.GeoJson:\r\n */\r\n\r\nL.TimeDimension.Layer.GeoJson = L.TimeDimension.Layer.extend({\r\n\r\n    initialize: function(layer, options) {\r\n        L.TimeDimension.Layer.prototype.initialize.call(this, layer, options);\r\n        this._updateTimeDimension = this.options.updateTimeDimension || false;\r\n        this._updateTimeDimensionMode = this.options.updateTimeDimensionMode || 'extremes'; // 'union', 'replace' or extremes\r\n        this._duration = this.options.duration || null;\r\n        this._addlastPoint = this.options.addlastPoint || false;\r\n        this._waitForReady = this.options.waitForReady || false;\r\n        this._defaultTime = 0;\r\n        this._availableTimes = [];\r\n        this._loaded = false;\r\n        if (this._baseLayer.getLayers().length == 0) {\r\n            if (this._waitForReady){\r\n                this._baseLayer.on(\"ready\", this._onReadyBaseLayer, this);                \r\n            }else{\r\n                this._loaded = true;                \r\n            }\r\n        } else {\r\n            this._loaded = true;\r\n            this._setAvailableTimes();\r\n        }\r\n    },\r\n\r\n    onAdd: function(map) {\r\n        L.TimeDimension.Layer.prototype.onAdd.call(this, map);\r\n        if (this._loaded) {\r\n            this._setAvailableTimes();\r\n        }\r\n    },\r\n\r\n    eachLayer: function(method, context) {\r\n        if (this._currentLayer) {\r\n            method.call(context, this._currentLayer);\r\n        }\r\n        return L.TimeDimension.Layer.prototype.eachLayer.call(this, method, context);\r\n    },      \r\n\r\n    isReady: function(time) {\r\n        return this._loaded;\r\n    },\r\n\r\n    _update: function() {\r\n        if (!this._map)\r\n            return;\r\n        if (!this._loaded) {\r\n            return;\r\n        }\r\n\r\n        var time = this._timeDimension.getCurrentTime();\r\n\r\n        var maxTime = this._timeDimension.getCurrentTime(),\r\n            minTime = 0;\r\n        if (this._duration) {\r\n            var date = new Date(maxTime);\r\n            L.TimeDimension.Util.subtractTimeDuration(date, this._duration, true);\r\n            minTime = date.getTime();\r\n        }\r\n\r\n        // new coordinates:\r\n        var layer = L.geoJson(null, this._baseLayer.options);\r\n        var layers = this._baseLayer.getLayers();\r\n        for (var i = 0, l = layers.length; i < l; i++) {\r\n            var feature = this._getFeatureBetweenDates(layers[i].feature, minTime, maxTime);\r\n            if (feature) {\r\n                layer.addData(feature);\r\n                if (this._addlastPoint && feature.geometry.type == \"LineString\") {\r\n                    if (feature.geometry.coordinates.length > 0) {\r\n                        var properties = feature.properties;                        \r\n                        properties.last = true;\r\n                        layer.addData({\r\n                            type: 'Feature',\r\n                            properties: properties,\r\n                            geometry: {\r\n                                type: 'Point',\r\n                                coordinates: feature.geometry.coordinates[feature.geometry.coordinates.length - 1]\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._currentLayer) {\r\n            this._map.removeLayer(this._currentLayer);\r\n        }\r\n        if (layer.getLayers().length) {\r\n            layer.addTo(this._map);\r\n            this._currentLayer = layer;\r\n        }\r\n    },\r\n\r\n    _setAvailableTimes: function() {\r\n        var times = [];\r\n        this._availableTimes = [];\r\n        var layers = this._baseLayer.getLayers();\r\n        for (var i = 0, l = layers.length; i < l; i++) {\r\n            if (layers[i].feature) {\r\n                times = L.TimeDimension.Util.union_arrays(\r\n                    times,\r\n                    this._getFeatureTimes(layers[i].feature)\r\n                );\r\n            }\r\n        }\r\n        // String dates to ms\r\n        for (var i = 0, l = times.length; i < l; i++) {\r\n            var time = times[i]\r\n            if (typeof time == 'string' || time instanceof String) {\r\n                time = Date.parse(time.trim());\r\n            }\r\n            this._availableTimes.push(time);\r\n        }\r\n        if (this._timeDimension && (this._updateTimeDimension || this._timeDimension.getAvailableTimes().length == 0)) {\r\n            this._timeDimension.setAvailableTimes(this._availableTimes, this._updateTimeDimensionMode);\r\n            this._timeDimension.setCurrentTime(this._availableTimes[0]);\r\n        }\r\n    },\r\n\r\n    _getFeatureTimes: function(feature) {\r\n        if (!feature.properties) {\r\n            return [];\r\n        }\r\n        if (feature.properties.hasOwnProperty('coordTimes')) {\r\n            return feature.properties.coordTimes;\r\n        }\r\n        if (feature.properties.hasOwnProperty('times')) {\r\n            return feature.properties.times;\r\n        }\r\n        if (feature.properties.hasOwnProperty('linestringTimestamps')) {\r\n            return feature.properties.linestringTimestamps;\r\n        }\r\n        if (feature.properties.hasOwnProperty('time')) {\r\n            return [feature.properties.time];\r\n        }\r\n        return [];\r\n    },\r\n\r\n    _getFeatureBetweenDates: function(feature, minTime, maxTime) {\r\n        var featureStringTimes = this._getFeatureTimes(feature);\r\n        if (featureStringTimes.length == 0) {\r\n            return feature;\r\n        }\r\n        var featureTimes = [];\r\n        for (var i = 0, l = featureStringTimes.length; i < l; i++) {\r\n            var time = featureStringTimes[i]\r\n            if (typeof time == 'string' || time instanceof String) {\r\n                time = Date.parse(time.trim());\r\n            }\r\n            featureTimes.push(time);\r\n        }\r\n\r\n        if (featureTimes[0] > maxTime || featureTimes[l - 1] < minTime) {\r\n            return null;\r\n        }\r\n        var index_min = null,\r\n            index_max = null,\r\n            l = featureTimes.length;\r\n        if (featureTimes[l - 1] > minTime) {\r\n            for (var i = 0; i < l; i++) {\r\n                if (index_min === null && featureTimes[i] > minTime) {\r\n                    // set index_min the first time that current time is greater the minTime\r\n                    index_min = i;\r\n                }\r\n                if (featureTimes[i] > maxTime) {\r\n                    index_max = i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (index_min === null) {\r\n            index_min = 0;\r\n        }\r\n        if (index_max === null) {\r\n            index_max = l;\r\n        }\r\n        var new_coordinates = [];\r\n        if (feature.geometry.coordinates[0].length) {\r\n            new_coordinates = feature.geometry.coordinates.slice(index_min, index_max);\r\n        } else {\r\n            new_coordinates = feature.geometry.coordinates;\r\n        }\r\n        return {\r\n            type: 'Feature',\r\n            properties: feature.properties,\r\n            geometry: {\r\n                type: feature.geometry.type,\r\n                coordinates: new_coordinates\r\n            }\r\n        };\r\n    },\r\n\r\n    _onReadyBaseLayer: function() {\r\n        this._loaded = true;\r\n        this._setAvailableTimes();\r\n        this._update();\r\n    },\r\n\r\n});\r\n\r\nL.timeDimension.layer.geoJson = function(layer, options) {\r\n    return new L.TimeDimension.Layer.GeoJson(layer, options);\r\n};\r\n/*\r\n * L.TimeDimension.Player \r\n */\r\n\r\nL.TimeDimension.Player = L.Class.extend({\r\n\r\n    initialize: function(options, timeDimension) {\r\n        L.setOptions(this, options);\r\n        this._timeDimension = timeDimension;\r\n        this._paused = false;\r\n        this._transitionTime = this.options.transitionTime || 1000;\r\n        this._buffer = this.options.buffer || 5;\r\n        this._minBufferReady = this.options.minBufferReady || 1;\r\n        this._waitingForBuffer = false;\r\n        this._loop = this.options.loop || false;\r\n        this._steps = 1;\r\n        this._timeDimension.on('timeload', (function(data){            \r\n            this.continue();  // free clock\r\n        }).bind(this));        \r\n    },\r\n\r\n\r\n    _tick: function(self) {\r\n        if (self._timeDimension.getCurrentTimeIndex() >= self._timeDimension.getAvailableTimes().length - 1) {\r\n            if (!self._loop){\r\n                clearInterval(self._intervalID);\r\n                self._timeDimension.fire('timeanimationfinished');                \r\n                return;\r\n            }\r\n        }\r\n        if (self._paused) {\r\n            return;\r\n        }\r\n        var numberNextTimesReady = 0;\r\n        if (self._minBufferReady > 0){\r\n            numberNextTimesReady = self._timeDimension.getNumberNextTimesReady(self._steps, self._buffer);            \r\n            // If the player was waiting, check if all times are loaded\r\n            if (self._waitingForBuffer){\r\n                if (numberNextTimesReady < self._buffer){\r\n                    \r\n                    self._timeDimension.fire('timeanimationwaiting', {percent: numberNextTimesReady/self._buffer});\r\n                    return;\r\n                }else{\r\n                    // all times loaded\r\n                    \r\n                    self._timeDimension.fire('timeanimationrunning');\r\n                    self._waitingForBuffer = false;\r\n                }\r\n            } else{\r\n                // check if player has to stop to wait and force to full all the buffer\r\n                if (numberNextTimesReady < self._minBufferReady){\r\n                    \r\n                    self._waitingForBuffer = true;\r\n                    self._timeDimension.fire('timeanimationwaiting', {percent: numberNextTimesReady/self._buffer});\r\n                    self._timeDimension.prepareNextTimes(self._steps, self._buffer);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        self.pause();\r\n        self._timeDimension.nextTime(self._steps, self._loop);\r\n        if (self._buffer > 0){\r\n            self._timeDimension.prepareNextTimes(self._steps, self._buffer);\r\n        }\r\n    },\r\n\r\n    start: function(numSteps) {\r\n        if (this._intervalID) return;\r\n        this._steps = numSteps || 1;\r\n        this._waitingForBuffer = false;\r\n        this._intervalID = window.setInterval(\r\n            this._tick,\r\n            this._transitionTime,\r\n            this);\r\n        this._tick(this);\r\n    },\r\n\r\n    stop: function() {\r\n        if (!this._intervalID) return;\r\n        clearInterval(this._intervalID);\r\n        this._intervalID = null;        \r\n    },\r\n\r\n    pause: function() {\r\n        this._paused = true;\r\n    },\r\n\r\n    continue: function() {\r\n        this._paused = false;\r\n    },\r\n\r\n    getTransitionTime: function() {\r\n        return this._transitionTime;\r\n    },\r\n\r\n    isPlaying: function() {\r\n        return this._intervalID ? true : false;\r\n    },\r\n\r\n    isWaiting: function() {\r\n        return this._waitingForBuffer;\r\n    },\r\n\r\n    setTransitionTime: function(transitionTime) {\r\n        this._transitionTime = transitionTime;\r\n        if (this._intervalID) {\r\n            this.stop();\r\n            this.start();\r\n        }\r\n    }    \r\n});\r\n/*\r\n * L.Control.TimeDimension: Leaflet control to manage a timeDimension\r\n */\r\n\r\nL.Control.TimeDimension = L.Control.extend({\r\n\toptions: {\r\n\t\tposition: 'bottomleft',\r\n\t\ttitle: 'Time Control',\r\n\t\tbackwardButton: true,\r\n\t\tforwardButton: true,\r\n\t\tplayButton: true,\r\n\t\tdisplayDate: true,\r\n\t\ttimeSlider: true,\r\n\t\tspeedSlider: true,\r\n\t\ttimeSteps: 1,\r\n\t\tautoPlay: false,\r\n\t\tplayerOptions:{\r\n\t\t\ttransitionTime: 1000\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\tinitialize: function (options) {\r\n\t\tL.Control.prototype.initialize.call(this, options);\r\n\t\tthis._dateUTC = true;\r\n\t\tthis._timeDimension = this.options.timeDimension || null;\t\t\t\t\r\n\t},\t\r\n\r\n\tonAdd: function(map) {\r\n        if (!this._timeDimension && map.timeDimension){\r\n            this._timeDimension = map.timeDimension;\r\n        }\r\n\t\tvar className = 'leaflet-control-timecontrol',\r\n\t\t\tcontainer;\r\n\r\n\t\tcontainer = L.DomUtil.create('div', 'leaflet-bar leaflet-bar-horizontal leaflet-bar-timecontrol barra_temps');\r\n\r\n\t\tif (this.options.backwardButton)\r\n\t\t\tthis._buttonBackward = this._createBackwardButton(className + \" timecontrol-backward\", container);\r\n\t\tif (this.options.playButton)\r\n\t\t\tthis._buttonPlayPause = this._createPlayPauseButton(className + \" timecontrol-play\", container);\r\n\t\tif (this.options.forwardButton)\r\n\t\t\tthis._buttonForward = this._createForwardButton(className + \" timecontrol-forward\", container);\r\n\t\tif (this.options.displayDate)\r\n\t\t\tthis._displayDate = this._createDisplayDate(className + \" timecontrol-date\", container);\r\n\t\tif (this.options.timeSlider)\r\n\t\t\tthis._slider = this._createSlider(className + \" timecontrol-slider\", container);\r\n\t\tif (this.options.speedSlider)\r\n\t\t\tthis._sliderSpeed = this._createSliderSpeed(className + \" timecontrol-slider timecontrol-speed\", container);\r\n\r\n\t\tthis._steps = this.options.timeSteps || 1;\r\n\r\n\t\tthis._timeDimension.on('timeload', (function(data){\t\t\t\t\t\t\r\n        \tthis._update();\r\n    \t}).bind(this));\r\n\r\n\t\tthis._timeDimension.on('timeloading', (function(data){\r\n\t\t\tif(data.time == this._timeDimension.getCurrentTime()){\r\n\t\t\t\tif (this._displayDate && this._displayDate.className.indexOf(' timecontrol-loading') == -1){\r\n\t\t\t\t\tthis._displayDate.className += \" timecontrol-loading\";\t\t\t\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n    \t}).bind(this));\r\n\r\n    \tthis._timeDimension.on('timeanimationwaiting', (function(data){\r\n\t\t\tif (this._buttonPlayPause){\r\n        \t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-play-loading';\r\n        \t\tthis._buttonPlayPause.innerHTML = '<span>' + Math.floor(data.percent*100) + '%</span>';\r\n\t\t\t}\r\n\r\n    \t}).bind(this));\r\n\r\n    \tthis._timeDimension.on('timeanimationrunning', (function(data){\r\n\t\t\tif (this._buttonPlayPause){\r\n\t\t\t\tthis._buttonPlayPause.innerHTML = '';\r\n\t\t\t\tif (this._player.isPlaying()){\t\t\t\r\n\t\t\t\t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-pause';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-play';\r\n\t\t\t\t}\r\n\t\t\t}\r\n    \t}).bind(this));\r\n\r\n\t\tthis._timeDimension.on('timeanimationfinished', (function(data){\r\n\t\t\tif (this._buttonPlayPause)\r\n        \t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-play';\r\n    \t}).bind(this));\r\n\r\n\t\tthis._timeDimension.on('availabletimeschanged', (function(data){\r\n\t\t\tif (this._slider)\r\n        \t\tthis._slider.slider(\"option\", \"max\", this._timeDimension.getAvailableTimes().length - 1);\r\n    \t}).bind(this));\r\n\r\n\t\t// Disable dragging and zoom when user's cursor enters the element\r\n\t\tcontainer.addEventListener('mouseover', function() {\r\n\t\t\tmap.dragging.disable();\r\n\t\t\tmap.doubleClickZoom.disable();\r\n\t\t\t// map.off('mousemove'); \r\n\t\t});\r\n\r\n\t\t// Re-enable dragging and zoom when user's cursor leaves the element\r\n\t\tcontainer.addEventListener('mouseout', function() {\r\n\t\t\tmap.dragging.enable();\r\n\t\t\tmap.doubleClickZoom.enable();\t\t\t\r\n\t\t});\r\n\t\tthis._update();\r\n\t\tif (this.options.autoPlay && this._buttonPlayPause){\r\n\t\t\tthis._buttonPlayPauseClicked();\r\n\t\t}\r\n\t\treturn container;\r\n\t},\r\n\r\n\t_update: function () {\r\n\t\tif (!this._timeDimension){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar time = this._timeDimension.getCurrentTime();\r\n\t\tif (time > 0){\r\n\t\t\tvar date = new Date(time);\r\n\t\t\tif (this._displayDate){\r\n\t\t\t\tthis._displayDate.className = this._displayDate.className.replace(' timecontrol-loading', '');\r\n\t\t\t\tthis._displayDate.innerHTML = this._getDisplayDateFormat(date);\r\n\t\t\t}\r\n\t\t\tif (this._slider){\r\n\t        \tthis._slider.slider( \"value\", this._timeDimension.getCurrentTimeIndex());\t\t\t\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif (this._displayDate){\r\n\t\t\t\tthis._displayDate.innerHTML = \"Temps no disponible\";\r\n\t\t\t}\r\n\t\t\tif (this._slider){\r\n\t        \tthis._slider.slider( \"value\", 0);\r\n\t        }\r\n\t\t}\r\n\t},\r\n\r\n\t_createBackwardButton: function(className, container) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.href = '#';\r\n\t\tlink.title = 'Enrrera';\r\n\t\t// link.innerHTML = '<span class=\"glyphicon glyphicon-backward\"></span>';\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(link, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.addListener(link, 'click', this._buttonBackwardClicked, this);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_createForwardButton: function(className, container) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.href = '#';\r\n\t\tlink.title = 'Endavant';\r\n\t\t// link.innerHTML = '<span class=\"glyphicon glyphicon-forward\"></span>';\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(link, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.addListener(link, 'click', this._buttonForwardClicked, this);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_createPlayPauseButton: function(className, container) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\r\n\t\tlink.href = '#';\r\n\t\tlink.title = 'Iniciar';\r\n\t\t// link.innerHTML = '<span class=\"glyphicon glyphicon-play\"></span>';\r\n\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(link, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.addListener(link, 'click', this._buttonPlayPauseClicked, this);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_createDisplayDate: function(className, container) {\r\n\t\tvar link = L.DomUtil.create('a', className, container);\t\t\r\n\t\tlink.href = '#';\r\n\t\tlink.title = 'UTC Temps';\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(link, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(link, 'click', L.DomEvent.preventDefault)\r\n\t\t\t.addListener(link, 'click', this._toggleDateUTC, this);\r\n\r\n\t\treturn link;\r\n\t},\r\n\r\n\t_createSlider: function(className, container) {\r\n\t\tvar _slider = L.DomUtil.create('a', className, container);\r\n\t\t_slider.href = '#';\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(_slider, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(_slider, 'click', L.DomEvent.preventDefault);\r\n\r\n\t\t_slider.innerHTML = '<div class=\"slider\"></div>';\r\n\t\tvar slider = $(_slider).find('.slider');\r\n\t\tvar max = this._timeDimension.getAvailableTimes().length - 1;\r\n\t\tslider.slider({\r\n      \t\tmin: 0,\r\n      \t\tmax: max,\r\n      \t\trange: \"min\",\r\n      \t\tstop: (function( event, ui ) {\r\n        \t\tthis._sliderValueChanged(ui.value);\r\n        \t}).bind(this),\r\n        \tslide: (function( event, ui ) {        \t\t\r\n\t\t\t\tvar date = new Date(this._timeDimension.getAvailableTimes()[ui.value]);\r\n\t\t\t\tthis._displayDate.innerHTML = this._getDisplayDateFormat(date);\r\n        \t}).bind(this),\r\n\r\n      \t});\r\n\t\treturn slider;\r\n\t},\r\n\r\n\t_createSliderSpeed: function(className, container) {\r\n\t\tvar _slider = L.DomUtil.create('a', className, container);\r\n\t\t_slider.href = '#';\r\n\t\tL.DomEvent\r\n\t\t\t.addListener(_slider, 'click', L.DomEvent.stopPropagation)\r\n\t\t\t.addListener(_slider, 'click', L.DomEvent.preventDefault);\r\n\r\n\t\tvar currentSpeed = 1;\r\n\t\tif (this._player){\r\n\t\t\tcurrentSpeed = 1000/this._playerOptions.getTransitionTime();\r\n\t\t}else{\r\n\t\t\tcurrentSpeed = Math.round(10000/(this.options.playerOptions.transitionTime||1000))/10;\r\n\t\t}\r\n\t\t_slider.innerHTML = '<span class=\"speed\">' +  currentSpeed  + 'fps</span><div class=\"slider\"></div>';\r\n\t\tvar slider = $(_slider).find('.slider');\t\t\r\n\t\tslider.slider({\r\n      \t\tmin: 0.1,\r\n      \t\tmax: 10,\r\n      \t\tvalue: currentSpeed,\r\n      \t\tstep: 0.1,\r\n      \t\trange: \"min\",\r\n      \t\tstop: (function(sliderContainer, event, ui ) {\r\n        \t\tvar speed = $(sliderContainer).find('.speed')[0];\r\n\t\t\t\tspeed.innerHTML = ui.value + \"fps\";      \t\t\t\r\n        \t\tthis._sliderSpeedValueChanged(ui.value);\r\n        \t}).bind(this, _slider),\r\n        \tslide: (function(sliderContainer, event, ui ) {        \t\t\r\n        \t\tvar speed = $(sliderContainer).find('.speed')[0];\r\n\t\t\t\tspeed.innerHTML = ui.value + \"fps\";\r\n        \t}).bind(this, _slider),\r\n\r\n      \t});\r\n\t\treturn slider;\r\n\t},\r\n\r\n\t_buttonBackwardClicked: function(event) {\r\n\t\tthis._timeDimension.previousTime(this._steps);\r\n\t},\r\n\r\n\t_buttonForwardClicked: function(event) {\r\n\t\tthis._timeDimension.nextTime(this._steps);\r\n\t},\r\n\r\n\t_buttonPlayPauseClicked: function(event) {\r\n\t\tif (!this._player){\r\n\t\t    this._player = new L.TimeDimension.Player(this.options.playerOptions, this._timeDimension);\r\n\t\t}\r\n\t\tif (this._player.isPlaying()){\r\n\t\t\tif (this._player.isWaiting()){\r\n\t\t\t\t// force start\r\n\t\t\t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-pause';\r\n\t\t\t\tthis._buttonPlayPause.innerHTML = '';\r\n\t\t\t\tthis._player.stop();\r\n\t\t\t\tthis._player.start(this._steps);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-play';\r\n\t\t\t\tthis._player.stop();\r\n\t\t\t\tthis._buttonPlayPause.innerHTML = '';\t\t\t\t\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._buttonPlayPause.className = 'leaflet-control-timecontrol timecontrol-pause';\r\n\t\t\tthis._player.start(this._steps);\r\n\t\t}\r\n\t},\t\r\n\r\n\t_sliderValueChanged: function(newValue) {\r\n\t\tthis._timeDimension.setCurrentTimeIndex(newValue);\r\n\t},\r\n\r\n\t_sliderSpeedValueChanged: function(newValue){\r\n\t\tif (this._player){\t\t\t\r\n\t\t    this._player.setTransitionTime(1000/newValue);\r\n\t\t}\r\n\t},\r\n\r\n\t_toggleDateUTC: function(event){\r\n\t\tif (this._dateUTC){\r\n\t\t\tthis._displayDate.title = 'Local Temps';\r\n\t\t}else{\r\n\t\t\tthis._displayDate.title = 'UTC Temps';\r\n\t\t}\r\n\t\tthis._dateUTC = !this._dateUTC;\r\n\t\tthis._update();\r\n\t},\r\n\r\n\t_getDisplayDateFormat: function(date){\r\n\t\t\r\n\t\r\n\t\t\r\n\t\tif(this._global_dateFormat=='YYYY'){\r\n\t\t\treturn this._dateUTC ? date.getFullYear() : date.toLocaleString();\r\n\t\t\r\n\t\t}else if(this._global_dateFormat=='YYYY-MM'){\r\n\t\t\t\r\n\t\t\treturn this._dateUTC ? date.getFullYear() : date.toLocaleString();\r\n\t\t\t\r\n\t\t\t\r\n\t\t}else if(this._global_dateFormat=='YYYY-MM-DD'){\r\n\t\t\t\r\n\t\t\treturn this._dateUTC ? date.getFullYear() : date.toLocaleString();\r\n\t\t\r\n\t\t}else{\r\n\r\n\t\t\treturn this._dateUTC ? date.getFullYear() : date.toLocaleString();\r\n\t\t}\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t//return this._dateUTC ? date.toISOString() : date.toLocaleString();\r\n\t\t//return this._dateUTC ? date.getFullYear() : date.toLocaleString();\r\n\t\t\r\n\t}\r\n\r\n});\r\n\r\nL.Map.addInitHook(function() {\r\n\tif (this.options.timeDimensionControl) {\r\n\t\tthis.timeDimensionControl = L.control.timeDimension(this.options.timeDimensionControlOptions || {});\r\n\t\tthis.addControl(this.timeDimensionControl);\r\n\t}\r\n});\r\n\r\nL.control.timeDimension = function(options) {\r\n\treturn new L.Control.TimeDimension(options);\r\n};\r\n})(jQuery);","/*! leaflet-routing-machine - v3.2.0 - 2016-10-07\n * Copyright (c) 2013-2016 Per Liedman\n * Distributed under the ISC license */\n\n\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}(g.L || (g.L = {})).Routing = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nfunction corslite(url, callback, cors) {\n    var sent = false;\n\n    if (typeof window.XMLHttpRequest === 'undefined') {\n        return callback(Error('Browser not supported'));\n    }\n\n    if (typeof cors === 'undefined') {\n        var m = url.match(/^\\s*https?:\\/\\/[^\\/]*/);\n        cors = m && (m[0] !== location.protocol + '//' + location.hostname +\n                (location.port ? ':' + location.port : ''));\n    }\n\n    var x = new window.XMLHttpRequest();\n\n    function isSuccessful(status) {\n        return status >= 200 && status < 300 || status === 304;\n    }\n\n    if (cors && !('withCredentials' in x)) {\n        // IE8-9\n        x = new window.XDomainRequest();\n\n        // Ensure callback is never called synchronously, i.e., before\n        // x.send() returns (this has been observed in the wild).\n        // See https://github.com/mapbox/mapbox.js/issues/472\n        var original = callback;\n        callback = function() {\n            if (sent) {\n                original.apply(this, arguments);\n            } else {\n                var that = this, args = arguments;\n                setTimeout(function() {\n                    original.apply(that, args);\n                }, 0);\n            }\n        }\n    }\n\n    function loaded() {\n        if (\n            // XDomainRequest\n            x.status === undefined ||\n            // modern browsers\n            isSuccessful(x.status)) callback.call(x, null, x);\n        else callback.call(x, x, null);\n    }\n\n    // Both `onreadystatechange` and `onload` can fire. `onreadystatechange`\n    // has [been supported for longer](http://stackoverflow.com/a/9181508/229001).\n    if ('onload' in x) {\n        x.onload = loaded;\n    } else {\n        x.onreadystatechange = function readystate() {\n            if (x.readyState === 4) {\n                loaded();\n            }\n        };\n    }\n\n    // Call the callback with the XMLHttpRequest object as an error and prevent\n    // it from ever being called again by reassigning it to `noop`\n    x.onerror = function error(evt) {\n        // XDomainRequest provides no evt parameter\n        callback.call(this, evt || true, null);\n        callback = function() { };\n    };\n\n    // IE9 must have onprogress be set to a unique function.\n    x.onprogress = function() { };\n\n    x.ontimeout = function(evt) {\n        callback.call(this, evt, null);\n        callback = function() { };\n    };\n\n    x.onabort = function(evt) {\n        callback.call(this, evt, null);\n        callback = function() { };\n    };\n\n    // GET is the only supported HTTP Verb by XDomainRequest and is the\n    // only one supported here.\n    x.open('GET', url, true);\n\n    // Send the request. Sending data is not supported.\n    x.send(null);\n    sent = true;\n\n    return x;\n}\n\nif (typeof module !== 'undefined') module.exports = corslite;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\n/**\n * Based off of [the offical Google document](https://developers.google.com/maps/documentation/utilities/polylinealgorithm)\n *\n * Some parts from [this implementation](http://facstaff.unca.edu/mcmcclur/GoogleMaps/EncodePolyline/PolylineEncoder.js)\n * by [Mark McClure](http://facstaff.unca.edu/mcmcclur/)\n *\n * @module polyline\n */\n\nvar polyline = {};\n\nfunction encode(coordinate, factor) {\n    coordinate = Math.round(coordinate * factor);\n    coordinate <<= 1;\n    if (coordinate < 0) {\n        coordinate = ~coordinate;\n    }\n    var output = '';\n    while (coordinate >= 0x20) {\n        output += String.fromCharCode((0x20 | (coordinate & 0x1f)) + 63);\n        coordinate >>= 5;\n    }\n    output += String.fromCharCode(coordinate + 63);\n    return output;\n}\n\n/**\n * Decodes to a [latitude, longitude] coordinates array.\n *\n * This is adapted from the implementation in Project-OSRM.\n *\n * @param {String} str\n * @param {Number} precision\n * @returns {Array}\n *\n * @see https://github.com/Project-OSRM/osrm-frontend/blob/master/WebContent/routing/OSRM.RoutingGeometry.js\n */\npolyline.decode = function(str, precision) {\n    var index = 0,\n        lat = 0,\n        lng = 0,\n        coordinates = [],\n        shift = 0,\n        result = 0,\n        byte = null,\n        latitude_change,\n        longitude_change,\n        factor = Math.pow(10, precision || 5);\n\n    // Coordinates have variable length when encoded, so just keep\n    // track of whether we've hit the end of the string. In each\n    // loop iteration, a single coordinate is decoded.\n    while (index < str.length) {\n\n        // Reset shift, result, and byte\n        byte = null;\n        shift = 0;\n        result = 0;\n\n        do {\n            byte = str.charCodeAt(index++) - 63;\n            result |= (byte & 0x1f) << shift;\n            shift += 5;\n        } while (byte >= 0x20);\n\n        latitude_change = ((result & 1) ? ~(result >> 1) : (result >> 1));\n\n        shift = result = 0;\n\n        do {\n            byte = str.charCodeAt(index++) - 63;\n            result |= (byte & 0x1f) << shift;\n            shift += 5;\n        } while (byte >= 0x20);\n\n        longitude_change = ((result & 1) ? ~(result >> 1) : (result >> 1));\n\n        lat += latitude_change;\n        lng += longitude_change;\n\n        coordinates.push([lat / factor, lng / factor]);\n    }\n\n    return coordinates;\n};\n\n/**\n * Encodes the given [latitude, longitude] coordinates array.\n *\n * @param {Array.<Array.<Number>>} coordinates\n * @param {Number} precision\n * @returns {String}\n */\npolyline.encode = function(coordinates, precision) {\n    if (!coordinates.length) { return ''; }\n\n    var factor = Math.pow(10, precision || 5),\n        output = encode(coordinates[0][0], factor) + encode(coordinates[0][1], factor);\n\n    for (var i = 1; i < coordinates.length; i++) {\n        var a = coordinates[i], b = coordinates[i - 1];\n        output += encode(a[0] - b[0], factor);\n        output += encode(a[1] - b[1], factor);\n    }\n\n    return output;\n};\n\nfunction flipped(coords) {\n    var flipped = [];\n    for (var i = 0; i < coords.length; i++) {\n        flipped.push(coords[i].slice().reverse());\n    }\n    return flipped;\n}\n\n/**\n * Encodes a GeoJSON LineString feature/geometry.\n *\n * @param {Object} geojson\n * @param {Number} precision\n * @returns {String}\n */\npolyline.fromGeoJSON = function(geojson, precision) {\n    if (geojson && geojson.type === 'Feature') {\n        geojson = geojson.geometry;\n    }\n    if (!geojson || geojson.type !== 'LineString') {\n        throw new Error('Input must be a GeoJSON LineString');\n    }\n    return polyline.encode(flipped(geojson.coordinates), precision);\n};\n\n/**\n * Decodes to a GeoJSON LineString geometry.\n *\n * @param {String} str\n * @param {Number} precision\n * @returns {Object}\n */\npolyline.toGeoJSON = function(str, precision) {\n    var coords = polyline.decode(str, precision);\n    return {\n        type: 'LineString',\n        coordinates: flipped(coords)\n    };\n};\n\nif (typeof module === 'object' && module.exports) {\n    module.exports = polyline;\n}\n\n},{}],3:[function(require,module,exports){\n(function() {\n\t'use strict';\n\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.Autocomplete = L.Class.extend({\n\t\toptions: {\n\t\t\ttimeout: 500,\n\t\t\tblurTimeout: 100,\n\t\t\tnoResultsMessage: 'No results found.'\n\t\t},\n\n\t\tinitialize: function(elem, callback, context, options) {\n\t\t\tL.setOptions(this, options);\n\n\t\t\tthis._elem = elem;\n\t\t\tthis._resultFn = options.resultFn ? L.Util.bind(options.resultFn, options.resultContext) : null;\n\t\t\tthis._autocomplete = options.autocompleteFn ? L.Util.bind(options.autocompleteFn, options.autocompleteContext) : null;\n\t\t\tthis._selectFn = L.Util.bind(callback, context);\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-routing-geocoder-result');\n\t\t\tthis._resultTable = L.DomUtil.create('table', '', this._container);\n\n\t\t\t// TODO: looks a bit like a kludge to register same for input and keypress -\n\t\t\t// browsers supporting both will get duplicate events; just registering\n\t\t\t// input will not catch enter, though.\n\t\t\tL.DomEvent.addListener(this._elem, 'input', this._keyPressed, this);\n\t\t\tL.DomEvent.addListener(this._elem, 'keypress', this._keyPressed, this);\n\t\t\tL.DomEvent.addListener(this._elem, 'keydown', this._keyDown, this);\n\t\t\tL.DomEvent.addListener(this._elem, 'blur', function() {\n\t\t\t\tif (this._isOpen) {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}, this);\n\t\t},\n\n\t\tclose: function() {\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-routing-geocoder-result-open');\n\t\t\tthis._isOpen = false;\n\t\t},\n\n\t\t_open: function() {\n\t\t\tvar rect = this._elem.getBoundingClientRect();\n\t\t\tif (!this._container.parentElement) {\n\t\t\t\t// See notes section under https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollX\n\t\t\t\t// This abomination is required to support all flavors of IE\n\t\t\t\tvar scrollX = (window.pageXOffset !== undefined) ? window.pageXOffset\n\t\t\t\t\t: (document.documentElement || document.body.parentNode || document.body).scrollLeft;\n\t\t\t\tvar scrollY = (window.pageYOffset !== undefined) ? window.pageYOffset\n\t\t\t\t\t: (document.documentElement || document.body.parentNode || document.body).scrollTop;\n\t\t\t\tthis._container.style.left = (rect.left + scrollX) + 'px';\n\t\t\t\tthis._container.style.top = (rect.bottom + scrollY) + 'px';\n\t\t\t\tthis._container.style.width = (rect.right - rect.left) + 'px';\n\t\t\t\tdocument.body.appendChild(this._container);\n\t\t\t}\n\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-routing-geocoder-result-open');\n\t\t\tthis._isOpen = true;\n\t\t},\n\n\t\t_setResults: function(results) {\n\t\t\tvar i,\n\t\t\t    tr,\n\t\t\t    td,\n\t\t\t    text;\n\n\t\t\tdelete this._selection;\n\t\t\tthis._results = results;\n\n\t\t\twhile (this._resultTable.firstChild) {\n\t\t\t\tthis._resultTable.removeChild(this._resultTable.firstChild);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < results.length; i++) {\n\t\t\t\ttr = L.DomUtil.create('tr', '', this._resultTable);\n\t\t\t\ttr.setAttribute('data-result-index', i);\n\t\t\t\ttd = L.DomUtil.create('td', '', tr);\n\t\t\t\ttext = document.createTextNode(results[i].name);\n\t\t\t\ttd.appendChild(text);\n\t\t\t\t// mousedown + click because:\n\t\t\t\t// http://stackoverflow.com/questions/10652852/jquery-fire-click-before-blur-event\n\t\t\t\tL.DomEvent.addListener(td, 'mousedown', L.DomEvent.preventDefault);\n\t\t\t\tL.DomEvent.addListener(td, 'click', this._createClickListener(results[i]));\n\t\t\t}\n\n\t\t\tif (!i) {\n\t\t\t\ttr = L.DomUtil.create('tr', '', this._resultTable);\n\t\t\t\ttd = L.DomUtil.create('td', 'leaflet-routing-geocoder-no-results', tr);\n\t\t\t\ttd.innerHTML = this.options.noResultsMessage;\n\t\t\t}\n\n\t\t\tthis._open();\n\n\t\t\tif (results.length > 0) {\n\t\t\t\t// Select the first entry\n\t\t\t\tthis._select(1);\n\t\t\t}\n\t\t},\n\n\t\t_createClickListener: function(r) {\n\t\t\tvar resultSelected = this._resultSelected(r);\n\t\t\treturn L.bind(function() {\n\t\t\t\tthis._elem.blur();\n\t\t\t\tresultSelected();\n\t\t\t}, this);\n\t\t},\n\n\t\t_resultSelected: function(r) {\n\t\t\treturn L.bind(function() {\n\t\t\t\tthis.close();\n\t\t\t\tthis._elem.value = r.name;\n\t\t\t\tthis._lastCompletedText = r.name;\n\t\t\t\tthis._selectFn(r);\n\t\t\t}, this);\n\t\t},\n\n\t\t_keyPressed: function(e) {\n\t\t\tvar index;\n\n\t\t\tif (this._isOpen && e.keyCode === 13 && this._selection) {\n\t\t\t\tindex = parseInt(this._selection.getAttribute('data-result-index'), 10);\n\t\t\t\tthis._resultSelected(this._results[index])();\n\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\tthis._complete(this._resultFn, true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._autocomplete && document.activeElement === this._elem) {\n\t\t\t\tif (this._timer) {\n\t\t\t\t\tclearTimeout(this._timer);\n\t\t\t\t}\n\t\t\t\tthis._timer = setTimeout(L.Util.bind(function() { this._complete(this._autocomplete); }, this),\n\t\t\t\t\tthis.options.timeout);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._unselect();\n\t\t},\n\n\t\t_select: function(dir) {\n\t\t\tvar sel = this._selection;\n\t\t\tif (sel) {\n\t\t\t\tL.DomUtil.removeClass(sel.firstChild, 'leaflet-routing-geocoder-selected');\n\t\t\t\tsel = sel[dir > 0 ? 'nextSibling' : 'previousSibling'];\n\t\t\t}\n\t\t\tif (!sel) {\n\t\t\t\tsel = this._resultTable[dir > 0 ? 'firstChild' : 'lastChild'];\n\t\t\t}\n\n\t\t\tif (sel) {\n\t\t\t\tL.DomUtil.addClass(sel.firstChild, 'leaflet-routing-geocoder-selected');\n\t\t\t\tthis._selection = sel;\n\t\t\t}\n\t\t},\n\n\t\t_unselect: function() {\n\t\t\tif (this._selection) {\n\t\t\t\tL.DomUtil.removeClass(this._selection.firstChild, 'leaflet-routing-geocoder-selected');\n\t\t\t}\n\t\t\tdelete this._selection;\n\t\t},\n\n\t\t_keyDown: function(e) {\n\t\t\tif (this._isOpen) {\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t// Escape\n\t\t\t\tcase 27:\n\t\t\t\t\tthis.close();\n\t\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\t\treturn;\n\t\t\t\t// Up\n\t\t\t\tcase 38:\n\t\t\t\t\tthis._select(-1);\n\t\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\t\treturn;\n\t\t\t\t// Down\n\t\t\t\tcase 40:\n\t\t\t\t\tthis._select(1);\n\t\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_complete: function(completeFn, trySelect) {\n\t\t\tvar v = this._elem.value;\n\t\t\tfunction completeResults(results) {\n\t\t\t\tthis._lastCompletedText = v;\n\t\t\t\tif (trySelect && results.length === 1) {\n\t\t\t\t\tthis._resultSelected(results[0])();\n\t\t\t\t} else {\n\t\t\t\t\tthis._setResults(results);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!v) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (v !== this._lastCompletedText) {\n\t\t\t\tcompleteFn(v, completeResults, this);\n\t\t\t} else if (trySelect) {\n\t\t\t\tcompleteResults.call(this, this._results);\n\t\t\t}\n\t\t}\n\t});\n})();\n\n},{}],4:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.Itinerary'));\n\tL.extend(L.Routing, require('./L.Routing.Line'));\n\tL.extend(L.Routing, require('./L.Routing.Plan'));\n\tL.extend(L.Routing, require('./L.Routing.OSRMv1'));\n\tL.extend(L.Routing, require('./L.Routing.Mapbox'));\n\tL.extend(L.Routing, require('./L.Routing.ErrorControl'));\n\n\tL.Routing.Control = L.Routing.Itinerary.extend({\n\t\toptions: {\n\t\t\tfitSelectedRoutes: 'smart',\n\t\t\trouteLine: function(route, options) { return L.Routing.line(route, options); },\n\t\t\tautoRoute: true,\n\t\t\trouteWhileDragging: false,\n\t\t\trouteDragInterval: 500,\n\t\t\twaypointMode: 'connect',\n\t\t\tshowAlternatives: false,\n\t\t\tdefaultErrorHandler: function(e) {\n\t\t\t\tconsole.error('Routing error:', e.error);\n\t\t\t}\n\t\t},\n\n\t\tinitialize: function(options) {\n\t\t\tL.Util.setOptions(this, options);\n\n\t\t\tthis._router = this.options.router || new L.Routing.OSRMv1(options);\n\t\t\tthis._plan = this.options.plan || L.Routing.plan(this.options.waypoints, options);\n\t\t\tthis._requestCount = 0;\n\n\t\t\tL.Routing.Itinerary.prototype.initialize.call(this, options);\n\n\t\t\tthis.on('routeselected', this._routeSelected, this);\n\t\t\tif (this.options.defaultErrorHandler) {\n\t\t\t\tthis.on('routingerror', this.options.defaultErrorHandler);\n\t\t\t}\n\t\t\tthis._plan.on('waypointschanged', this._onWaypointsChanged, this);\n\t\t\tif (options.routeWhileDragging) {\n\t\t\t\tthis._setupRouteDragging();\n\t\t\t}\n\n\t\t\tif (this.options.autoRoute) {\n\t\t\t\tthis.route();\n\t\t\t}\n\t\t},\n\n\t\tonAdd: function(map) {\n\t\t\tvar container = L.Routing.Itinerary.prototype.onAdd.call(this, map);\n\n\t\t\tthis._map = map;\n\t\t\tthis._map.addLayer(this._plan);\n\n\t\t\tthis._map.on('zoomend', function() {\n\t\t\t\tif (!this._selectedRoute ||\n\t\t\t\t\t!this._router.requiresMoreDetail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar map = this._map;\n\t\t\t\tif (this._router.requiresMoreDetail(this._selectedRoute,\n\t\t\t\t\t\tmap.getZoom(), map.getBounds())) {\n\t\t\t\t\tthis.route({\n\t\t\t\t\t\tcallback: L.bind(function(err, routes) {\n\t\t\t\t\t\t\tvar i;\n\t\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < routes.length; i++) {\n\t\t\t\t\t\t\t\t\tthis._routes[i].properties = routes[i].properties;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis._updateLineCallback(err, routes);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}, this),\n\t\t\t\t\t\tsimplifyGeometry: false,\n\t\t\t\t\t\tgeometryOnly: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tif (this._plan.options.geocoder) {\n\t\t\t\tcontainer.insertBefore(this._plan.createGeocoders(), container.firstChild);\n\t\t\t}\n\n\t\t\treturn container;\n\t\t},\n\n\t\tonRemove: function(map) {\n\t\t\tif (this._line) {\n\t\t\t\tmap.removeLayer(this._line);\n\t\t\t}\n\t\t\tmap.removeLayer(this._plan);\n\t\t\tif (this._alternatives && this._alternatives.length > 0) {\n\t\t\t\tfor (var i = 0, len = this._alternatives.length; i < len; i++) {\n\t\t\t\t\tmap.removeLayer(this._alternatives[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn L.Routing.Itinerary.prototype.onRemove.call(this, map);\n\t\t},\n\n\t\tgetWaypoints: function() {\n\t\t\treturn this._plan.getWaypoints();\n\t\t},\n\n\t\tsetWaypoints: function(waypoints) {\n\t\t\tthis._plan.setWaypoints(waypoints);\n\t\t\treturn this;\n\t\t},\n\n\t\tspliceWaypoints: function() {\n\t\t\tvar removed = this._plan.spliceWaypoints.apply(this._plan, arguments);\n\t\t\treturn removed;\n\t\t},\n\n\t\tgetPlan: function() {\n\t\t\treturn this._plan;\n\t\t},\n\n\t\tgetRouter: function() {\n\t\t\treturn this._router;\n\t\t},\n\n\t\t_routeSelected: function(e) {\n\t\t\tvar route = this._selectedRoute = e.route,\n\t\t\t\talternatives = this.options.showAlternatives && e.alternatives,\n\t\t\t\tfitMode = this.options.fitSelectedRoutes,\n\t\t\t\tfitBounds =\n\t\t\t\t\t(fitMode === 'smart' && !this._waypointsVisible()) ||\n\t\t\t\t\t(fitMode !== 'smart' && fitMode);\n\n\t\t\tthis._updateLines({route: route, alternatives: alternatives});\n\n\t\t\tif (fitBounds) {\n\t\t\t\tthis._map.fitBounds(this._line.getBounds());\n\t\t\t}\n\n\t\t\tif (this.options.waypointMode === 'snap') {\n\t\t\t\tthis._plan.off('waypointschanged', this._onWaypointsChanged, this);\n\t\t\t\tthis.setWaypoints(route.waypoints);\n\t\t\t\tthis._plan.on('waypointschanged', this._onWaypointsChanged, this);\n\t\t\t}\n\t\t},\n\n\t\t_waypointsVisible: function() {\n\t\t\tvar wps = this.getWaypoints(),\n\t\t\t\tmapSize,\n\t\t\t\tbounds,\n\t\t\t\tboundsSize,\n\t\t\t\ti,\n\t\t\t\tp;\n\n\t\t\ttry {\n\t\t\t\tmapSize = this._map.getSize();\n\n\t\t\t\tfor (i = 0; i < wps.length; i++) {\n\t\t\t\t\tp = this._map.latLngToLayerPoint(wps[i].latLng);\n\n\t\t\t\t\tif (bounds) {\n\t\t\t\t\t\tbounds.extend(p);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbounds = L.bounds([p]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tboundsSize = bounds.getSize();\n\t\t\t\treturn (boundsSize.x > mapSize.x / 5 ||\n\t\t\t\t\tboundsSize.y > mapSize.y / 5) && this._waypointsInViewport();\n\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t_waypointsInViewport: function() {\n\t\t\tvar wps = this.getWaypoints(),\n\t\t\t\tmapBounds,\n\t\t\t\ti;\n\n\t\t\ttry {\n\t\t\t\tmapBounds = this._map.getBounds();\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < wps.length; i++) {\n\t\t\t\tif (mapBounds.contains(wps[i].latLng)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_updateLines: function(routes) {\n\t\t\tvar addWaypoints = this.options.addWaypoints !== undefined ?\n\t\t\t\tthis.options.addWaypoints : true;\n\t\t\tthis._clearLines();\n\n\t\t\t// add alternatives first so they lie below the main route\n\t\t\tthis._alternatives = [];\n\t\t\tif (routes.alternatives) routes.alternatives.forEach(function(alt, i) {\n\t\t\t\tthis._alternatives[i] = this.options.routeLine(alt,\n\t\t\t\t\tL.extend({\n\t\t\t\t\t\tisAlternative: true\n\t\t\t\t\t}, this.options.altLineOptions || this.options.lineOptions));\n\t\t\t\tthis._alternatives[i].addTo(this._map);\n\t\t\t\tthis._hookAltEvents(this._alternatives[i]);\n\t\t\t}, this);\n\n\t\t\tthis._line = this.options.routeLine(routes.route,\n\t\t\t\tL.extend({\n\t\t\t\t\taddWaypoints: addWaypoints,\n\t\t\t\t\textendToWaypoints: this.options.waypointMode === 'connect'\n\t\t\t\t}, this.options.lineOptions));\n\t\t\tthis._line.addTo(this._map);\n\t\t\tthis._hookEvents(this._line);\n\t\t},\n\n\t\t_hookEvents: function(l) {\n\t\t\tl.on('linetouched', function(e) {\n\t\t\t\tthis._plan.dragNewWaypoint(e);\n\t\t\t}, this);\n\t\t},\n\n\t\t_hookAltEvents: function(l) {\n\t\t\tl.on('linetouched', function(e) {\n\t\t\t\tvar alts = this._routes.slice();\n\t\t\t\tvar selected = alts.splice(e.target._route.routesIndex, 1)[0];\n\t\t\t\tthis.fire('routeselected', {route: selected, alternatives: alts});\n\t\t\t}, this);\n\t\t},\n\n\t\t_onWaypointsChanged: function(e) {\n\t\t\tif (this.options.autoRoute) {\n\t\t\t\tthis.route({});\n\t\t\t}\n\t\t\tif (!this._plan.isReady()) {\n\t\t\t\tthis._clearLines();\n\t\t\t\tthis._clearAlts();\n\t\t\t}\n\t\t\tthis.fire('waypointschanged', {waypoints: e.waypoints});\n\t\t},\n\n\t\t_setupRouteDragging: function() {\n\t\t\tvar timer = 0,\n\t\t\t\twaypoints;\n\n\t\t\tthis._plan.on('waypointdrag', L.bind(function(e) {\n\t\t\t\twaypoints = e.waypoints;\n\n\t\t\t\tif (!timer) {\n\t\t\t\t\ttimer = setTimeout(L.bind(function() {\n\t\t\t\t\t\tthis.route({\n\t\t\t\t\t\t\twaypoints: waypoints,\n\t\t\t\t\t\t\tgeometryOnly: true,\n\t\t\t\t\t\t\tcallback: L.bind(this._updateLineCallback, this)\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttimer = undefined;\n\t\t\t\t\t}, this), this.options.routeDragInterval);\n\t\t\t\t}\n\t\t\t}, this));\n\t\t\tthis._plan.on('waypointdragend', function() {\n\t\t\t\tif (timer) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = undefined;\n\t\t\t\t}\n\t\t\t\tthis.route();\n\t\t\t}, this);\n\t\t},\n\n\t\t_updateLineCallback: function(err, routes) {\n\t\t\tif (!err) {\n\t\t\t\troutes = routes.slice();\n\t\t\t\tvar selected = routes.splice(this._selectedRoute.routesIndex, 1)[0];\n\t\t\t\tthis._updateLines({route: selected, alternatives: routes });\n\t\t\t} else if (err.type !== 'abort') {\n\t\t\t\tthis._clearLines();\n\t\t\t}\n\t\t},\n\n\t\troute: function(options) {\n\t\t\tvar ts = ++this._requestCount,\n\t\t\t\twps;\n\n\t\t\tif (this._pendingRequest && this._pendingRequest.abort) {\n\t\t\t\tthis._pendingRequest.abort();\n\t\t\t\tthis._pendingRequest = null;\n\t\t\t}\n\n\t\t\toptions = options || {};\n\n\t\t\tif (this._plan.isReady()) {\n\t\t\t\tif (this.options.useZoomParameter) {\n\t\t\t\t\toptions.z = this._map && this._map.getZoom();\n\t\t\t\t}\n\n\t\t\t\twps = options && options.waypoints || this._plan.getWaypoints();\n\t\t\t\tthis.fire('routingstart', {waypoints: wps});\n\t\t\t\tthis._pendingRequest = this._router.route(wps, function(err, routes) {\n\t\t\t\t\tthis._pendingRequest = null;\n\n\t\t\t\t\tif (options.callback) {\n\t\t\t\t\t\treturn options.callback.call(this, err, routes);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Prevent race among multiple requests,\n\t\t\t\t\t// by checking the current request's count\n\t\t\t\t\t// against the last request's; ignore result if\n\t\t\t\t\t// this isn't the last request.\n\t\t\t\t\tif (ts === this._requestCount) {\n\t\t\t\t\t\tthis._clearLines();\n\t\t\t\t\t\tthis._clearAlts();\n\t\t\t\t\t\tif (err && err.type !== 'abort') {\n\t\t\t\t\t\t\tthis.fire('routingerror', {error: err});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\troutes.forEach(function(route, i) { route.routesIndex = i; });\n\n\t\t\t\t\t\tif (!options.geometryOnly) {\n\t\t\t\t\t\t\tthis.fire('routesfound', {waypoints: wps, routes: routes});\n\t\t\t\t\t\t\tthis.setAlternatives(routes);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar selectedRoute = routes.splice(0,1)[0];\n\t\t\t\t\t\t\tthis._routeSelected({route: selectedRoute, alternatives: routes});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, this, options);\n\t\t\t}\n\t\t},\n\n\t\t_clearLines: function() {\n\t\t\tif (this._line) {\n\t\t\t\tthis._map.removeLayer(this._line);\n\t\t\t\tdelete this._line;\n\t\t\t}\n\t\t\tif (this._alternatives && this._alternatives.length) {\n\t\t\t\tfor (var i in this._alternatives) {\n\t\t\t\t\tthis._map.removeLayer(this._alternatives[i]);\n\t\t\t\t}\n\t\t\t\tthis._alternatives = [];\n\t\t\t}\n\t\t}\n\t});\n\n\tL.Routing.control = function(options) {\n\t\treturn new L.Routing.Control(options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.ErrorControl\":5,\"./L.Routing.Itinerary\":8,\"./L.Routing.Line\":10,\"./L.Routing.Mapbox\":12,\"./L.Routing.OSRMv1\":13,\"./L.Routing.Plan\":14}],5:[function(require,module,exports){\n(function() {\n\t'use strict';\n\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.ErrorControl = L.Control.extend({\n\t\toptions: {\n\t\t\theader: 'Routing error',\n\t\t\tformatMessage: function(error) {\n\t\t\t\tif (error.status < 0) {\n\t\t\t\t\treturn 'Calculating the route caused an error. Technical description follows: <code><pre>' +\n\t\t\t\t\t\terror.message + '</pre></code';\n\t\t\t\t} else {\n\t\t\t\t\treturn 'The route could not be calculated. ' +\n\t\t\t\t\t\terror.message;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tinitialize: function(routingControl, options) {\n\t\t\tL.Control.prototype.initialize.call(this, options);\n\t\t\troutingControl\n\t\t\t\t.on('routingerror', L.bind(function(e) {\n\t\t\t\t\tif (this._element) {\n\t\t\t\t\t\tthis._element.children[1].innerHTML = this.options.formatMessage(e.error);\n\t\t\t\t\t\tthis._element.style.visibility = 'visible';\n\t\t\t\t\t}\n\t\t\t\t}, this))\n\t\t\t\t.on('routingstart', L.bind(function() {\n\t\t\t\t\tif (this._element) {\n\t\t\t\t\t\tthis._element.style.visibility = 'hidden';\n\t\t\t\t\t}\n\t\t\t\t}, this));\n\t\t},\n\n\t\tonAdd: function() {\n\t\t\tvar header,\n\t\t\t\tmessage;\n\n\t\t\tthis._element = L.DomUtil.create('div', 'leaflet-bar leaflet-routing-error');\n\t\t\tthis._element.style.visibility = 'hidden';\n\n\t\t\theader = L.DomUtil.create('h3', null, this._element);\n\t\t\tmessage = L.DomUtil.create('span', null, this._element);\n\n\t\t\theader.innerHTML = this.options.header;\n\n\t\t\treturn this._element;\n\t\t},\n\n\t\tonRemove: function() {\n\t\t\tdelete this._element;\n\t\t}\n\t});\n\n\tL.Routing.errorControl = function(routingControl, options) {\n\t\treturn new L.Routing.ErrorControl(routingControl, options);\n\t};\n})();\n\n},{}],6:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\n\tL.Routing = L.Routing || {};\n\n\tL.extend(L.Routing, require('./L.Routing.Localization'));\n\n\tL.Routing.Formatter = L.Class.extend({\n\t\toptions: {\n\t\t\tunits: 'metric',\n\t\t\tunitNames: null,\n\t\t\tlanguage: 'en',\n\t\t\troundingSensitivity: 1,\n\t\t\tdistanceTemplate: '{value} {unit}'\n\t\t},\n\n\t\tinitialize: function(options) {\n\t\t\tL.setOptions(this, options);\n\n\t\t\tvar langs = L.Util.isArray(this.options.language) ?\n\t\t\t\tthis.options.language :\n\t\t\t\t[this.options.language, 'en'];\n\t\t\tthis._localization = new L.Routing.Localization(langs);\n\t\t},\n\n\t\tformatDistance: function(d /* Number (meters) */, sensitivity) {\n\t\t\tvar un = this.options.unitNames || this._localization.localize('units'),\n\t\t\t\tsimpleRounding = sensitivity <= 0,\n\t\t\t\tround = simpleRounding ? function(v) { return v; } : L.bind(this._round, this),\n\t\t\t    v,\n\t\t\t    yards,\n\t\t\t\tdata,\n\t\t\t\tpow10;\n\n\t\t\tif (this.options.units === 'imperial') {\n\t\t\t\tyards = d / 0.9144;\n\t\t\t\tif (yards >= 1000) {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\tvalue: round(d / 1609.344, sensitivity),\n\t\t\t\t\t\tunit: un.miles\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\tvalue: round(yards, sensitivity),\n\t\t\t\t\t\tunit: un.yards\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tv = round(d, sensitivity);\n\t\t\t\tdata = {\n\t\t\t\t\tvalue: v >= 1000 ? (v / 1000) : v,\n\t\t\t\t\tunit: v >= 1000 ? un.kilometers : un.meters\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (simpleRounding) {\n\t\t\t\tdata.value = data.value.toFixed(-sensitivity);\n\t\t\t}\n\n\t\t\treturn L.Util.template(this.options.distanceTemplate, data);\n\t\t},\n\n\t\t_round: function(d, sensitivity) {\n\t\t\tvar s = sensitivity || this.options.roundingSensitivity,\n\t\t\t\tpow10 = Math.pow(10, (Math.floor(d / s) + '').length - 1),\n\t\t\t\tr = Math.floor(d / pow10),\n\t\t\t\tp = (r > 5) ? pow10 : pow10 / 2;\n\n\t\t\treturn Math.round(d / p) * p;\n\t\t},\n\n\t\tformatTime: function(t /* Number (seconds) */) {\n\t\t\tvar un = this.options.unitNames || this._localization.localize('units');\n\t\t\t// More than 30 seconds precision looks ridiculous\n\t\t\tt = Math.round(t / 30) * 30;\n\n\t\t\tif (t > 86400) {\n\t\t\t\treturn Math.round(t / 3600) + ' ' + un.hours;\n\t\t\t} else if (t > 3600) {\n\t\t\t\treturn Math.floor(t / 3600) + ' ' + un.hours + ' ' +\n\t\t\t\t\tMath.round((t % 3600) / 60) + ' ' + un.minutes;\n\t\t\t} else if (t > 300) {\n\t\t\t\treturn Math.round(t / 60) + ' ' + un.minutes;\n\t\t\t} else if (t > 60) {\n\t\t\t\treturn Math.floor(t / 60) + ' ' + un.minutes +\n\t\t\t\t\t(t % 60 !== 0 ? ' ' + (t % 60) + ' ' + un.seconds : '');\n\t\t\t} else {\n\t\t\t\treturn t + ' ' + un.seconds;\n\t\t\t}\n\t\t},\n\n\t\tformatInstruction: function(instr, i) {\n\t\t\tif (instr.text === undefined) {\n\t\t\t\treturn this.capitalize(L.Util.template(this._getInstructionTemplate(instr, i),\n\t\t\t\t\tL.extend({}, instr, {\n\t\t\t\t\t\texitStr: instr.exit ? this._localization.localize('formatOrder')(instr.exit) : '',\n\t\t\t\t\t\tdir: this._localization.localize(['directions', instr.direction]),\n\t\t\t\t\t\tmodifier: this._localization.localize(['directions', instr.modifier])\n\t\t\t\t\t})));\n\t\t\t} else {\n\t\t\t\treturn instr.text;\n\t\t\t}\n\t\t},\n\n\t\tgetIconName: function(instr, i) {\n\t\t\tswitch (instr.type) {\n\t\t\tcase 'Head':\n\t\t\t\tif (i === 0) {\n\t\t\t\t\treturn 'depart';\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'WaypointReached':\n\t\t\t\treturn 'via';\n\t\t\tcase 'Roundabout':\n\t\t\t\treturn 'enter-roundabout';\n\t\t\tcase 'DestinationReached':\n\t\t\t\treturn 'arrive';\n\t\t\t}\n\n\t\t\tswitch (instr.modifier) {\n\t\t\tcase 'Straight':\n\t\t\t\treturn 'continue';\n\t\t\tcase 'SlightRight':\n\t\t\t\treturn 'bear-right';\n\t\t\tcase 'Right':\n\t\t\t\treturn 'turn-right';\n\t\t\tcase 'SharpRight':\n\t\t\t\treturn 'sharp-right';\n\t\t\tcase 'TurnAround':\n\t\t\tcase 'Uturn':\n\t\t\t\treturn 'u-turn';\n\t\t\tcase 'SharpLeft':\n\t\t\t\treturn 'sharp-left';\n\t\t\tcase 'Left':\n\t\t\t\treturn 'turn-left';\n\t\t\tcase 'SlightLeft':\n\t\t\t\treturn 'bear-left';\n\t\t\t}\n\t\t},\n\n\t\tcapitalize: function(s) {\n\t\t\treturn s.charAt(0).toUpperCase() + s.substring(1);\n\t\t},\n\n\t\t_getInstructionTemplate: function(instr, i) {\n\t\t\tvar type = instr.type === 'Straight' ? (i === 0 ? 'Head' : 'Continue') : instr.type,\n\t\t\t\tstrings = this._localization.localize(['instructions', type]);\n\n\t\t\tif (!strings) {\n\t\t\t\tstrings = [\n\t\t\t\t\tthis._localization.localize(['directions', type]),\n\t\t\t\t\t' ' + this._localization.localize(['instructions', 'Onto'])\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn strings[0] + (strings.length > 1 && instr.road ? strings[1] : '');\n\t\t}\n\t});\n\n\tmodule.exports = L.Routing;\n})();\n\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.Localization\":11}],7:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.Autocomplete'));\n\n\tfunction selectInputText(input) {\n\t\tif (input.setSelectionRange) {\n\t\t\t// On iOS, select() doesn't work\n\t\t\tinput.setSelectionRange(0, 9999);\n\t\t} else {\n\t\t\t// On at least IE8, setSeleectionRange doesn't exist\n\t\t\tinput.select();\n\t\t}\n\t}\n\n\tL.Routing.GeocoderElement = L.Class.extend({\n\t\tincludes: L.Mixin.Events,\n\n\t\toptions: {\n\t\t\tcreateGeocoder: function(i, nWps, options) {\n\t\t\t\tvar container = L.DomUtil.create('div', 'leaflet-routing-geocoder'),\n\t\t\t\t\tinput = L.DomUtil.create('input', '', container),\n\t\t\t\t\tremove = options.addWaypoints ? L.DomUtil.create('span', 'leaflet-routing-remove-waypoint', container) : undefined;\n\n\t\t\t\tinput.disabled = !options.addWaypoints;\n\n\t\t\t\treturn {\n\t\t\t\t\tcontainer: container,\n\t\t\t\t\tinput: input,\n\t\t\t\t\tcloseButton: remove\n\t\t\t\t};\n\t\t\t},\n\t\t\tgeocoderPlaceholder: function(i, numberWaypoints, geocoderElement) {\n\t\t\t\tvar l = new L.Routing.Localization(geocoderElement.options.language).localize('ui');\n\t\t\t\treturn i === 0 ?\n\t\t\t\t\tl.startPlaceholder :\n\t\t\t\t\t(i < numberWaypoints - 1 ?\n\t\t\t\t\t\tL.Util.template(l.viaPlaceholder, {viaNumber: i}) :\n\t\t\t\t\t\tl.endPlaceholder);\n\t\t\t},\n\n\t\t\tgeocoderClass: function() {\n\t\t\t\treturn '';\n\t\t\t},\n\n\t\t\twaypointNameFallback: function(latLng) {\n\t\t\t\tvar ns = latLng.lat < 0 ? 'S' : 'N',\n\t\t\t\t\tew = latLng.lng < 0 ? 'W' : 'E',\n\t\t\t\t\tlat = (Math.round(Math.abs(latLng.lat) * 10000) / 10000).toString(),\n\t\t\t\t\tlng = (Math.round(Math.abs(latLng.lng) * 10000) / 10000).toString();\n\t\t\t\treturn ns + lat + ', ' + ew + lng;\n\t\t\t},\n\t\t\tmaxGeocoderTolerance: 200,\n\t\t\tautocompleteOptions: {},\n\t\t\tlanguage: 'en',\n\t\t},\n\n\t\tinitialize: function(wp, i, nWps, options) {\n\t\t\tL.setOptions(this, options);\n\n\t\t\tvar g = this.options.createGeocoder(i, nWps, this.options),\n\t\t\t\tcloseButton = g.closeButton,\n\t\t\t\tgeocoderInput = g.input;\n\t\t\tgeocoderInput.setAttribute('placeholder', this.options.geocoderPlaceholder(i, nWps, this));\n\t\t\tgeocoderInput.className = this.options.geocoderClass(i, nWps);\n\n\t\t\tthis._element = g;\n\t\t\tthis._waypoint = wp;\n\n\t\t\tthis.update();\n\t\t\t// This has to be here, or geocoder's value will not be properly\n\t\t\t// initialized.\n\t\t\t// TODO: look into why and make _updateWaypointName fix this.\n\t\t\tgeocoderInput.value = wp.name;\n\n\t\t\tL.DomEvent.addListener(geocoderInput, 'click', function() {\n\t\t\t\tselectInputText(this);\n\t\t\t}, geocoderInput);\n\n\t\t\tif (closeButton) {\n\t\t\t\tL.DomEvent.addListener(closeButton, 'click', function() {\n\t\t\t\t\tthis.fire('delete', { waypoint: this._waypoint });\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tnew L.Routing.Autocomplete(geocoderInput, function(r) {\n\t\t\t\t\tgeocoderInput.value = r.name;\n\t\t\t\t\twp.name = r.name;\n\t\t\t\t\twp.latLng = r.center;\n\t\t\t\t\tthis.fire('geocoded', { waypoint: wp, value: r });\n\t\t\t\t}, this, L.extend({\n\t\t\t\t\tresultFn: this.options.geocoder.geocode,\n\t\t\t\t\tresultContext: this.options.geocoder,\n\t\t\t\t\tautocompleteFn: this.options.geocoder.suggest,\n\t\t\t\t\tautocompleteContext: this.options.geocoder\n\t\t\t\t}, this.options.autocompleteOptions));\n\t\t},\n\n\t\tgetContainer: function() {\n\t\t\treturn this._element.container;\n\t\t},\n\n\t\tsetValue: function(v) {\n\t\t\tthis._element.input.value = v;\n\t\t},\n\n\t\tupdate: function(force) {\n\t\t\tvar wp = this._waypoint,\n\t\t\t\twpCoords;\n\n\t\t\twp.name = wp.name || '';\n\n\t\t\tif (wp.latLng && (force || !wp.name)) {\n\t\t\t\twpCoords = this.options.waypointNameFallback(wp.latLng);\n\t\t\t\tif (this.options.geocoder && this.options.geocoder.reverse) {\n\t\t\t\t\tthis.options.geocoder.reverse(wp.latLng, 67108864 /* zoom 18 */, function(rs) {\n\t\t\t\t\t\tif (rs.length > 0 && rs[0].center.distanceTo(wp.latLng) < this.options.maxGeocoderTolerance) {\n\t\t\t\t\t\t\twp.name = rs[0].name;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twp.name = wpCoords;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._update();\n\t\t\t\t\t}, this);\n\t\t\t\t} else {\n\t\t\t\t\twp.name = wpCoords;\n\t\t\t\t\tthis._update();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tfocus: function() {\n\t\t\tvar input = this._element.input;\n\t\t\tinput.focus();\n\t\t\tselectInputText(input);\n\t\t},\n\n\t\t_update: function() {\n\t\t\tvar wp = this._waypoint,\n\t\t\t    value = wp && wp.name ? wp.name : '';\n\t\t\tthis.setValue(value);\n\t\t\tthis.fire('reversegeocoded', {waypoint: wp, value: value});\n\t\t}\n\t});\n\n\tL.Routing.geocoderElement = function(wp, i, nWps, plan) {\n\t\treturn new L.Routing.GeocoderElement(wp, i, nWps, plan);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.Autocomplete\":3}],8:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.Formatter'));\n\tL.extend(L.Routing, require('./L.Routing.ItineraryBuilder'));\n\n\tL.Routing.Itinerary = L.Control.extend({\n\t\tincludes: L.Mixin.Events,\n\n\t\toptions: {\n\t\t\tpointMarkerStyle: {\n\t\t\t\tradius: 5,\n\t\t\t\tcolor: '#03f',\n\t\t\t\tfillColor: 'white',\n\t\t\t\topacity: 1,\n\t\t\t\tfillOpacity: 0.7\n\t\t\t},\n\t\t\tsummaryTemplate: '<h2>{name}</h2><h3>{distance}, {time}</h3>',\n\t\t\ttimeTemplate: '{time}',\n\t\t\tcontainerClassName: '',\n\t\t\talternativeClassName: '',\n\t\t\tminimizedClassName: '',\n\t\t\titineraryClassName: '',\n\t\t\ttotalDistanceRoundingSensitivity: -1,\n\t\t\tshow: true,\n\t\t\tcollapsible: undefined,\n\t\t\tcollapseBtn: function(itinerary) {\n\t\t\t\tvar collapseBtn = L.DomUtil.create('span', itinerary.options.collapseBtnClass);\n\t\t\t\tL.DomEvent.on(collapseBtn, 'click', itinerary._toggle, itinerary);\n\t\t\t\titinerary._container.insertBefore(collapseBtn, itinerary._container.firstChild);\n\t\t\t},\n\t\t\tcollapseBtnClass: 'leaflet-routing-collapse-btn'\n\t\t},\n\n\t\tinitialize: function(options) {\n\t\t\tL.setOptions(this, options);\n\t\t\tthis._formatter = this.options.formatter || new L.Routing.Formatter(this.options);\n\t\t\tthis._itineraryBuilder = this.options.itineraryBuilder || new L.Routing.ItineraryBuilder({\n\t\t\t\tcontainerClassName: this.options.itineraryClassName\n\t\t\t});\n\t\t},\n\n\t\tonAdd: function(map) {\n\t\t\tvar collapsible = this.options.collapsible;\n\n\t\t\tcollapsible = collapsible || (collapsible === undefined && map.getSize().x <= 640);\n\n\t\t\tthis._container = L.DomUtil.create('div', 'leaflet-routing-container leaflet-bar ' +\n\t\t\t\t(!this.options.show ? 'leaflet-routing-container-hide ' : '') +\n\t\t\t\t(collapsible ? 'leaflet-routing-collapsible ' : '') +\n\t\t\t\tthis.options.containerClassName);\n\t\t\tthis._altContainer = this.createAlternativesContainer();\n\t\t\tthis._container.appendChild(this._altContainer);\n\t\t\tL.DomEvent.disableClickPropagation(this._container);\n\t\t\tL.DomEvent.addListener(this._container, 'mousewheel', function(e) {\n\t\t\t\tL.DomEvent.stopPropagation(e);\n\t\t\t});\n\n\t\t\tif (collapsible) {\n\t\t\t\tthis.options.collapseBtn(this);\n\t\t\t}\n\n\t\t\treturn this._container;\n\t\t},\n\n\t\tonRemove: function() {\n\t\t},\n\n\t\tcreateAlternativesContainer: function() {\n\t\t\treturn L.DomUtil.create('div', 'leaflet-routing-alternatives-container');\n\t\t},\n\n\t\tsetAlternatives: function(routes) {\n\t\t\tvar i,\n\t\t\t    alt,\n\t\t\t    altDiv;\n\n\t\t\tthis._clearAlts();\n\n\t\t\tthis._routes = routes;\n\n\t\t\tfor (i = 0; i < this._routes.length; i++) {\n\t\t\t\talt = this._routes[i];\n\t\t\t\taltDiv = this._createAlternative(alt, i);\n\t\t\t\tthis._altContainer.appendChild(altDiv);\n\t\t\t\tthis._altElements.push(altDiv);\n\t\t\t}\n\n\t\t\tthis._selectRoute({route: this._routes[0], alternatives: this._routes.slice(1)});\n\n\t\t\treturn this;\n\t\t},\n\n\t\tshow: function() {\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-routing-container-hide');\n\t\t},\n\n\t\thide: function() {\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-routing-container-hide');\n\t\t},\n\n\t\t_toggle: function() {\n\t\t\tvar collapsed = L.DomUtil.hasClass(this._container, 'leaflet-routing-container-hide');\n\t\t\tthis[collapsed ? 'show' : 'hide']();\n\t\t},\n\n\t\t_createAlternative: function(alt, i) {\n\t\t\tvar altDiv = L.DomUtil.create('div', 'leaflet-routing-alt ' +\n\t\t\t\tthis.options.alternativeClassName +\n\t\t\t\t(i > 0 ? ' leaflet-routing-alt-minimized ' + this.options.minimizedClassName : '')),\n\t\t\t\ttemplate = this.options.summaryTemplate,\n\t\t\t\tdata = L.extend({\n\t\t\t\t\tname: alt.name,\n\t\t\t\t\tdistance: this._formatter.formatDistance(alt.summary.totalDistance, this.options.totalDistanceRoundingSensitivity),\n\t\t\t\t\ttime: this._formatter.formatTime(alt.summary.totalTime)\n\t\t\t\t}, alt);\n\t\t\taltDiv.innerHTML = typeof(template) === 'function' ? template(data) : L.Util.template(template, data);\n\t\t\tL.DomEvent.addListener(altDiv, 'click', this._onAltClicked, this);\n\t\t\tthis.on('routeselected', this._selectAlt, this);\n\n\t\t\taltDiv.appendChild(this._createItineraryContainer(alt));\n\t\t\treturn altDiv;\n\t\t},\n\n\t\t_clearAlts: function() {\n\t\t\tvar el = this._altContainer;\n\t\t\twhile (el && el.firstChild) {\n\t\t\t\tel.removeChild(el.firstChild);\n\t\t\t}\n\n\t\t\tthis._altElements = [];\n\t\t},\n\n\t\t_createItineraryContainer: function(r) {\n\t\t\tvar container = this._itineraryBuilder.createContainer(),\n\t\t\t    steps = this._itineraryBuilder.createStepsContainer(),\n\t\t\t    i,\n\t\t\t    instr,\n\t\t\t    step,\n\t\t\t    distance,\n\t\t\t    text,\n\t\t\t    icon;\n\n\t\t\tcontainer.appendChild(steps);\n\n\t\t\tfor (i = 0; i < r.instructions.length; i++) {\n\t\t\t\tinstr = r.instructions[i];\n\t\t\t\ttext = this._formatter.formatInstruction(instr, i);\n\t\t\t\tdistance = this._formatter.formatDistance(instr.distance);\n\t\t\t\ticon = this._formatter.getIconName(instr, i);\n\t\t\t\tstep = this._itineraryBuilder.createStep(text, distance, icon, steps);\n\n\t\t\t\tthis._addRowListeners(step, r.coordinates[instr.index]);\n\t\t\t}\n\n\t\t\treturn container;\n\t\t},\n\n\t\t_addRowListeners: function(row, coordinate) {\n\t\t\tL.DomEvent.addListener(row, 'mouseover', function() {\n\t\t\t\tthis._marker = L.circleMarker(coordinate,\n\t\t\t\t\tthis.options.pointMarkerStyle).addTo(this._map);\n\t\t\t}, this);\n\t\t\tL.DomEvent.addListener(row, 'mouseout', function() {\n\t\t\t\tif (this._marker) {\n\t\t\t\t\tthis._map.removeLayer(this._marker);\n\t\t\t\t\tdelete this._marker;\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\tL.DomEvent.addListener(row, 'click', function(e) {\n\t\t\t\tthis._map.panTo(coordinate);\n\t\t\t\tL.DomEvent.stopPropagation(e);\n\t\t\t}, this);\n\t\t},\n\n\t\t_onAltClicked: function(e) {\n\t\t\tvar altElem = e.target || window.event.srcElement;\n\t\t\twhile (!L.DomUtil.hasClass(altElem, 'leaflet-routing-alt')) {\n\t\t\t\taltElem = altElem.parentElement;\n\t\t\t}\n\n\t\t\tvar j = this._altElements.indexOf(altElem);\n\t\t\tvar alts = this._routes.slice();\n\t\t\tvar route = alts.splice(j, 1)[0];\n\n\t\t\tthis.fire('routeselected', {\n\t\t\t\troute: route,\n\t\t\t\talternatives: alts\n\t\t\t});\n\t\t},\n\n\t\t_selectAlt: function(e) {\n\t\t\tvar altElem,\n\t\t\t    j,\n\t\t\t    n,\n\t\t\t    classFn;\n\n\t\t\taltElem = this._altElements[e.route.routesIndex];\n\n\t\t\tif (L.DomUtil.hasClass(altElem, 'leaflet-routing-alt-minimized')) {\n\t\t\t\tfor (j = 0; j < this._altElements.length; j++) {\n\t\t\t\t\tn = this._altElements[j];\n\t\t\t\t\tclassFn = j === e.route.routesIndex ? 'removeClass' : 'addClass';\n\t\t\t\t\tL.DomUtil[classFn](n, 'leaflet-routing-alt-minimized');\n\t\t\t\t\tif (this.options.minimizedClassName) {\n\t\t\t\t\t\tL.DomUtil[classFn](n, this.options.minimizedClassName);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (j !== e.route.routesIndex) n.scrollTop = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tL.DomEvent.stop(e);\n\t\t},\n\n\t\t_selectRoute: function(routes) {\n\t\t\tif (this._marker) {\n\t\t\t\tthis._map.removeLayer(this._marker);\n\t\t\t\tdelete this._marker;\n\t\t\t}\n\t\t\tthis.fire('routeselected', routes);\n\t\t}\n\t});\n\n\tL.Routing.itinerary = function(options) {\n\t\treturn new L.Routing.Itinerary(options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.Formatter\":6,\"./L.Routing.ItineraryBuilder\":9}],9:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.ItineraryBuilder = L.Class.extend({\n\t\toptions: {\n\t\t\tcontainerClassName: ''\n\t\t},\n\n\t\tinitialize: function(options) {\n\t\t\tL.setOptions(this, options);\n\t\t},\n\n\t\tcreateContainer: function(className) {\n\t\t\tvar table = L.DomUtil.create('table', className || ''),\n\t\t\t\tcolgroup = L.DomUtil.create('colgroup', '', table);\n\n\t\t\tL.DomUtil.create('col', 'leaflet-routing-instruction-icon', colgroup);\n\t\t\tL.DomUtil.create('col', 'leaflet-routing-instruction-text', colgroup);\n\t\t\tL.DomUtil.create('col', 'leaflet-routing-instruction-distance', colgroup);\n\n\t\t\treturn table;\n\t\t},\n\n\t\tcreateStepsContainer: function() {\n\t\t\treturn L.DomUtil.create('tbody', '');\n\t\t},\n\n\t\tcreateStep: function(text, distance, icon, steps) {\n\t\t\tvar row = L.DomUtil.create('tr', '', steps),\n\t\t\t\tspan,\n\t\t\t\ttd;\n\t\t\ttd = L.DomUtil.create('td', '', row);\n\t\t\tspan = L.DomUtil.create('span', 'leaflet-routing-icon leaflet-routing-icon-'+icon, td);\n\t\t\ttd.appendChild(span);\n\t\t\ttd = L.DomUtil.create('td', '', row);\n\t\t\ttd.appendChild(document.createTextNode(text));\n\t\t\ttd = L.DomUtil.create('td', '', row);\n\t\t\ttd.appendChild(document.createTextNode(distance));\n\t\t\treturn row;\n\t\t}\n\t});\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],10:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.Line = L.LayerGroup.extend({\n\t\tincludes: L.Mixin.Events,\n\n\t\toptions: {\n\t\t\tstyles: [\n\t\t\t\t{color: 'black', opacity: 0.15, weight: 9},\n\t\t\t\t{color: 'white', opacity: 0.8, weight: 6},\n\t\t\t\t{color: 'red', opacity: 1, weight: 2}\n\t\t\t],\n\t\t\tmissingRouteStyles: [\n\t\t\t\t{color: 'black', opacity: 0.15, weight: 7},\n\t\t\t\t{color: 'white', opacity: 0.6, weight: 4},\n\t\t\t\t{color: 'gray', opacity: 0.8, weight: 2, dashArray: '7,12'}\n\t\t\t],\n\t\t\taddWaypoints: true,\n\t\t\textendToWaypoints: true,\n\t\t\tmissingRouteTolerance: 10\n\t\t},\n\n\t\tinitialize: function(route, options) {\n\t\t\tL.setOptions(this, options);\n\t\t\tL.LayerGroup.prototype.initialize.call(this, options);\n\t\t\tthis._route = route;\n\n\t\t\tif (this.options.extendToWaypoints) {\n\t\t\t\tthis._extendToWaypoints();\n\t\t\t}\n\n\t\t\tthis._addSegment(\n\t\t\t\troute.coordinates,\n\t\t\t\tthis.options.styles,\n\t\t\t\tthis.options.addWaypoints);\n\t\t},\n\t\t\n\t\tgetBounds: function() {\n\t\t\treturn L.latLngBounds(this._route.coordinates);\n\t\t},\n\n\t\t_findWaypointIndices: function() {\n\t\t\tvar wps = this._route.inputWaypoints,\n\t\t\t    indices = [],\n\t\t\t    i;\n\t\t\tfor (i = 0; i < wps.length; i++) {\n\t\t\t\tindices.push(this._findClosestRoutePoint(wps[i].latLng));\n\t\t\t}\n\n\t\t\treturn indices;\n\t\t},\n\n\t\t_findClosestRoutePoint: function(latlng) {\n\t\t\tvar minDist = Number.MAX_VALUE,\n\t\t\t\tminIndex,\n\t\t\t    i,\n\t\t\t    d;\n\n\t\t\tfor (i = this._route.coordinates.length - 1; i >= 0 ; i--) {\n\t\t\t\t// TODO: maybe do this in pixel space instead?\n\t\t\t\td = latlng.distanceTo(this._route.coordinates[i]);\n\t\t\t\tif (d < minDist) {\n\t\t\t\t\tminIndex = i;\n\t\t\t\t\tminDist = d;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn minIndex;\n\t\t},\n\n\t\t_extendToWaypoints: function() {\n\t\t\tvar wps = this._route.inputWaypoints,\n\t\t\t\twpIndices = this._getWaypointIndices(),\n\t\t\t    i,\n\t\t\t    wpLatLng,\n\t\t\t    routeCoord;\n\n\t\t\tfor (i = 0; i < wps.length; i++) {\n\t\t\t\twpLatLng = wps[i].latLng;\n\t\t\t\trouteCoord = L.latLng(this._route.coordinates[wpIndices[i]]);\n\t\t\t\tif (wpLatLng.distanceTo(routeCoord) >\n\t\t\t\t\tthis.options.missingRouteTolerance) {\n\t\t\t\t\tthis._addSegment([wpLatLng, routeCoord],\n\t\t\t\t\t\tthis.options.missingRouteStyles);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_addSegment: function(coords, styles, mouselistener) {\n\t\t\tvar i,\n\t\t\t\tpl;\n\n\t\t\tfor (i = 0; i < styles.length; i++) {\n\t\t\t\tpl = L.polyline(coords, styles[i]);\n\t\t\t\tthis.addLayer(pl);\n\t\t\t\tif (mouselistener) {\n\t\t\t\t\tpl.on('mousedown', this._onLineTouched, this);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_findNearestWpBefore: function(i) {\n\t\t\tvar wpIndices = this._getWaypointIndices(),\n\t\t\t\tj = wpIndices.length - 1;\n\t\t\twhile (j >= 0 && wpIndices[j] > i) {\n\t\t\t\tj--;\n\t\t\t}\n\n\t\t\treturn j;\n\t\t},\n\n\t\t_onLineTouched: function(e) {\n\t\t\tvar afterIndex = this._findNearestWpBefore(this._findClosestRoutePoint(e.latlng));\n\t\t\tthis.fire('linetouched', {\n\t\t\t\tafterIndex: afterIndex,\n\t\t\t\tlatlng: e.latlng\n\t\t\t});\n\t\t},\n\n\t\t_getWaypointIndices: function() {\n\t\t\tif (!this._wpIndices) {\n\t\t\t\tthis._wpIndices = this._route.waypointIndices || this._findWaypointIndices();\n\t\t\t}\n\n\t\t\treturn this._wpIndices;\n\t\t}\n\t});\n\n\tL.Routing.line = function(route, options) {\n\t\treturn new L.Routing.Line(route, options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],11:[function(require,module,exports){\n(function() {\n\t'use strict';\n\n\tvar spanish = {\n\t\tdirections: {\n\t\t\tN: 'norte',\n\t\t\tNE: 'noreste',\n\t\t\tE: 'este',\n\t\t\tSE: 'sureste',\n\t\t\tS: 'sur',\n\t\t\tSW: 'suroeste',\n\t\t\tW: 'oeste',\n\t\t\tNW: 'noroeste',\n\t\t\tSlightRight: 'leve giro a la derecha',\n\t\t\tRight: 'derecha',\n\t\t\tSharpRight: 'giro pronunciado a la derecha',\n\t\t\tSlightLeft: 'leve giro a la izquierda',\n\t\t\tLeft: 'izquierda',\n\t\t\tSharpLeft: 'giro pronunciado a la izquierda',\n\t\t\tUturn: 'media vuelta'\n\t\t},\n\t\tinstructions: {\n\t\t\t// instruction, postfix if the road is named\n\t\t\t'Head':\n\t\t\t\t['Derecho {dir}', ' sobre {road}'],\n\t\t\t'Continue':\n\t\t\t\t['Continuar {dir}', ' en {road}'],\n\t\t\t'TurnAround':\n\t\t\t\t['Dar vuelta'],\n\t\t\t'WaypointReached':\n\t\t\t\t['Llegó a un punto del camino'],\n\t\t\t'Roundabout':\n\t\t\t\t['Tomar {exitStr} salida en la rotonda', ' en {road}'],\n\t\t\t'DestinationReached':\n\t\t\t\t['Llegada a destino'],\n\t\t\t'Fork': ['En el cruce gira a {modifier}', ' hacia {road}'],\n\t\t\t'Merge': ['Incorpórate {modifier}', ' hacia {road}'],\n\t\t\t'OnRamp': ['Gira {modifier} en la salida', ' hacia {road}'],\n\t\t\t'OffRamp': ['Toma la salida {modifier}', ' hacia {road}'],\n\t\t\t'EndOfRoad': ['Gira {modifier} al final de la carretera', ' hacia {road}'],\n\t\t\t'Onto': 'hacia {road}'\n\t\t},\n\t\tformatOrder: function(n) {\n\t\t\treturn n + 'º';\n\t\t},\n\t\tui: {\n\t\t\tstartPlaceholder: 'Inicio',\n\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\tendPlaceholder: 'Destino'\n\t\t},\n\t\tunits: {\n\t\t\tmeters: 'm',\n\t\t\tkilometers: 'km',\n\t\t\tyards: 'yd',\n\t\t\tmiles: 'mi',\n\t\t\thours: 'h',\n\t\t\tminutes: 'min',\n\t\t\tseconds: 's'\n\t\t}\n\t};\n\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.Localization = L.Class.extend({\n\t\tinitialize: function(langs) {\n\t\t\tthis._langs = L.Util.isArray(langs) ? langs : [langs, 'en'];\n\n\t\t\tfor (var i = 0, l = this._langs.length; i < l; i++) {\n\t\t\t\tif (!L.Routing.Localization[this._langs[i]]) {\n\t\t\t\t\tthrow new Error('No localization for language \"' + this._langs[i] + '\".');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tlocalize: function(keys) {\n\t\t\tvar dict,\n\t\t\t\tkey,\n\t\t\t\tvalue;\n\n\t\t\tkeys = L.Util.isArray(keys) ? keys : [keys];\n\n\t\t\tfor (var i = 0, l = this._langs.length; i < l; i++) {\n\t\t\t\tdict = L.Routing.Localization[this._langs[i]];\n\t\t\t\tfor (var j = 0, nKeys = keys.length; dict && j < nKeys; j++) {\n\t\t\t\t\tkey = keys[j];\n\t\t\t\t\tvalue = dict[key];\n\t\t\t\t\tdict = value;\n\t\t\t\t}\n\n\t\t\t\tif (value) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tL.Routing.Localization = L.extend(L.Routing.Localization, {\n\t\t'en': {\n\t\t\tdirections: {\n\t\t\t\tN: 'north',\n\t\t\t\tNE: 'northeast',\n\t\t\t\tE: 'east',\n\t\t\t\tSE: 'southeast',\n\t\t\t\tS: 'south',\n\t\t\t\tSW: 'southwest',\n\t\t\t\tW: 'west',\n\t\t\t\tNW: 'northwest',\n\t\t\t\tSlightRight: 'slight right',\n\t\t\t\tRight: 'right',\n\t\t\t\tSharpRight: 'sharp right',\n\t\t\t\tSlightLeft: 'slight left',\n\t\t\t\tLeft: 'left',\n\t\t\t\tSharpLeft: 'sharp left',\n\t\t\t\tUturn: 'Turn around'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Head {dir}', ' on {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Continue {dir}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Turn around'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Waypoint reached'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Take the {exitStr} exit in the roundabout', ' onto {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Destination reached'],\n\t\t\t\t'Fork': ['At the fork, turn {modifier}', ' onto {road}'],\n\t\t\t\t'Merge': ['Merge {modifier}', ' onto {road}'],\n\t\t\t\t'OnRamp': ['Turn {modifier} on the ramp', ' onto {road}'],\n\t\t\t\t'OffRamp': ['Take the ramp on the {modifier}', ' onto {road}'],\n\t\t\t\t'EndOfRoad': ['Turn {modifier} at the end of the road', ' onto {road}'],\n\t\t\t\t'Onto': 'onto {road}'\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\tvar i = n % 10 - 1,\n\t\t\t\tsuffix = ['st', 'nd', 'rd'];\n\n\t\t\t\treturn suffix[i] ? n + suffix[i] : n + 'th';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Start',\n\t\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\t\tendPlaceholder: 'End'\n\t\t\t},\n\t\t\tunits: {\n\t\t\t\tmeters: 'm',\n\t\t\t\tkilometers: 'km',\n\t\t\t\tyards: 'yd',\n\t\t\t\tmiles: 'mi',\n\t\t\t\thours: 'h',\n\t\t\t\tminutes: 'min',\n\t\t\t\tseconds: 's'\n\t\t\t}\n\t\t},\n\n\t\t'de': {\n\t\t\tdirections: {\n\t\t\t\tN: 'Norden',\n\t\t\t\tNE: 'Nordosten',\n\t\t\t\tE: 'Osten',\n\t\t\t\tSE: 'Südosten',\n\t\t\t\tS: 'Süden',\n\t\t\t\tSW: 'Südwesten',\n\t\t\t\tW: 'Westen',\n\t\t\t\tNW: 'Nordwesten'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Richtung {dir}', ' auf {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Geradeaus Richtung {dir}', ' auf {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Leicht rechts abbiegen', ' auf {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Rechts abbiegen', ' auf {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Scharf rechts abbiegen', ' auf {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Wenden'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Scharf links abbiegen', ' auf {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Links abbiegen', ' auf {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Leicht links abbiegen', ' auf {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Zwischenhalt erreicht'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Nehmen Sie die {exitStr} Ausfahrt im Kreisverkehr', ' auf {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Sie haben ihr Ziel erreicht'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + '.';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Start',\n\t\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\t\tendPlaceholder: 'Ziel'\n\t\t\t}\n\t\t},\n\n\t\t'sv': {\n\t\t\tdirections: {\n\t\t\t\tN: 'norr',\n\t\t\t\tNE: 'nordost',\n\t\t\t\tE: 'öst',\n\t\t\t\tSE: 'sydost',\n\t\t\t\tS: 'syd',\n\t\t\t\tSW: 'sydväst',\n\t\t\t\tW: 'väst',\n\t\t\t\tNW: 'nordväst',\n\t\t\t\tSlightRight: 'svagt höger',\n\t\t\t\tRight: 'höger',\n\t\t\t\tSharpRight: 'skarpt höger',\n\t\t\t\tSlightLeft: 'svagt vänster',\n\t\t\t\tLeft: 'vänster',\n\t\t\t\tSharpLeft: 'skarpt vänster',\n\t\t\t\tUturn: 'Vänd'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Åk åt {dir}', ' till {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Fortsätt {dir}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Svagt höger', ' till {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Sväng höger', ' till {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Skarpt höger', ' till {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Vänd'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Skarpt vänster', ' till {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Sväng vänster', ' till {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Svagt vänster', ' till {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Viapunkt nådd'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Tag {exitStr} avfarten i rondellen', ' till {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Framme vid resans mål'],\n\t\t\t\t'Fork': ['Tag av {modifier}', ' till {road}'],\n\t\t\t\t'Merge': ['Anslut {modifier} ', ' till {road}'],\n\t\t\t\t'OnRamp': ['Tag påfarten {modifier}', ' till {road}'],\n\t\t\t\t'OffRamp': ['Tag avfarten {modifier}', ' till {road}'],\n\t\t\t\t'EndOfRoad': ['Sväng {modifier} vid vägens slut', ' till {road}'],\n\t\t\t\t'Onto': 'till {road}'\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn ['första', 'andra', 'tredje', 'fjärde', 'femte',\n\t\t\t\t\t'sjätte', 'sjunde', 'åttonde', 'nionde', 'tionde'\n\t\t\t\t\t/* Can't possibly be more than ten exits, can there? */][n - 1];\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Från',\n\t\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\t\tendPlaceholder: 'Till'\n\t\t\t}\n\t\t},\n\n\t\t'es': spanish,\n    'sp': spanish,\n\t\t\n\t\t'nl': {\n\t\t\tdirections: {\n\t\t\t\tN: 'noordelijke',\n\t\t\t\tNE: 'noordoostelijke',\n\t\t\t\tE: 'oostelijke',\n\t\t\t\tSE: 'zuidoostelijke',\n\t\t\t\tS: 'zuidelijke',\n\t\t\t\tSW: 'zuidewestelijke',\n\t\t\t\tW: 'westelijke',\n\t\t\t\tNW: 'noordwestelijke'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Vertrek in {dir} richting', ' de {road} op'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Ga in {dir} richting', ' de {road} op'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Volg de weg naar rechts', ' de {road} op'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Ga rechtsaf', ' de {road} op'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Ga scherpe bocht naar rechts', ' de {road} op'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Keer om'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Ga scherpe bocht naar links', ' de {road} op'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Ga linksaf', ' de {road} op'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Volg de weg naar links', ' de {road} op'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Aangekomen bij tussenpunt'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Neem de {exitStr} afslag op de rotonde', ' de {road} op'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Aangekomen op eindpunt'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\tif (n === 1 || n >= 20) {\n\t\t\t\t\treturn n + 'ste';\n\t\t\t\t} else {\n\t\t\t\t\treturn n + 'de';\n\t\t\t\t}\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Vertrekpunt',\n\t\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\t\tendPlaceholder: 'Bestemming'\n\t\t\t}\n\t\t},\n\t\t'fr': {\n\t\t\tdirections: {\n\t\t\t\tN: 'nord',\n\t\t\t\tNE: 'nord-est',\n\t\t\t\tE: 'est',\n\t\t\t\tSE: 'sud-est',\n\t\t\t\tS: 'sud',\n\t\t\t\tSW: 'sud-ouest',\n\t\t\t\tW: 'ouest',\n\t\t\t\tNW: 'nord-ouest'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Tout droit au {dir}', ' sur {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Continuer au {dir}', ' sur {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Légèrement à droite', ' sur {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['A droite', ' sur {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Complètement à droite', ' sur {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Faire demi-tour'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Complètement à gauche', ' sur {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['A gauche', ' sur {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Légèrement à gauche', ' sur {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Point d\\'étape atteint'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Au rond-point, prenez la {exitStr} sortie', ' sur {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Destination atteinte'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + 'º';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Départ',\n\t\t\t\tviaPlaceholder: 'Intermédiaire {viaNumber}',\n\t\t\t\tendPlaceholder: 'Arrivée'\n\t\t\t}\n\t\t},\n\t\t'it': {\n\t\t\tdirections: {\n\t\t\t\tN: 'nord',\n\t\t\t\tNE: 'nord-est',\n\t\t\t\tE: 'est',\n\t\t\t\tSE: 'sud-est',\n\t\t\t\tS: 'sud',\n\t\t\t\tSW: 'sud-ovest',\n\t\t\t\tW: 'ovest',\n\t\t\t\tNW: 'nord-ovest'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Dritto verso {dir}', ' su {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Continuare verso {dir}', ' su {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Mantenere la destra', ' su {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['A destra', ' su {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Strettamente a destra', ' su {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Fare inversione di marcia'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Strettamente a sinistra', ' su {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['A sinistra', ' sur {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Mantenere la sinistra', ' su {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Punto di passaggio raggiunto'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Alla rotonda, prendere la {exitStr} uscita'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Destinazione raggiunta'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + 'º';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Partenza',\n\t\t\t\tviaPlaceholder: 'Intermedia {viaNumber}',\n\t\t\t\tendPlaceholder: 'Destinazione'\n\t\t\t}\n\t\t},\n\t\t'pt': {\n\t\t\tdirections: {\n\t\t\t\tN: 'norte',\n\t\t\t\tNE: 'nordeste',\n\t\t\t\tE: 'leste',\n\t\t\t\tSE: 'sudeste',\n\t\t\t\tS: 'sul',\n\t\t\t\tSW: 'sudoeste',\n\t\t\t\tW: 'oeste',\n\t\t\t\tNW: 'noroeste',\n\t\t\t\tSlightRight: 'curva ligeira a direita',\n\t\t\t\tRight: 'direita',\n\t\t\t\tSharpRight: 'curva fechada a direita',\n\t\t\t\tSlightLeft: 'ligeira a esquerda',\n\t\t\t\tLeft: 'esquerda',\n\t\t\t\tSharpLeft: 'curva fechada a esquerda',\n\t\t\t\tUturn: 'Meia volta'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Siga {dir}', ' na {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Continue {dir}', ' na {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Curva ligeira a direita', ' na {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Curva a direita', ' na {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Curva fechada a direita', ' na {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Retorne'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Curva fechada a esquerda', ' na {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Curva a esquerda', ' na {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Curva ligueira a esquerda', ' na {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Ponto de interesse atingido'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Pegue a {exitStr} saída na rotatória', ' na {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Destino atingido'],\n\t\t\t\t'Fork': ['Na encruzilhada, vire a {modifier}', ' na {road}'],\n\t\t\t\t'Merge': ['Entre à {modifier}', ' na {road}'],\n\t\t\t\t'OnRamp': ['Vire {modifier} na rampa', ' na {road}'],\n\t\t\t\t'OffRamp': ['Entre na rampa na {modifier}', ' na {road}'],\n\t\t\t\t'EndOfRoad': ['Vire {modifier} no fim da rua', ' na {road}'],\n\t\t\t\t'Onto': 'na {road}'\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + 'º';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Origem',\n\t\t\t\tviaPlaceholder: 'Intermédio {viaNumber}',\n\t\t\t\tendPlaceholder: 'Destino'\n\t\t\t}\n\t\t},\n\t\t'sk': {\n\t\t\tdirections: {\n\t\t\t\tN: 'sever',\n\t\t\t\tNE: 'serverovýchod',\n\t\t\t\tE: 'východ',\n\t\t\t\tSE: 'juhovýchod',\n\t\t\t\tS: 'juh',\n\t\t\t\tSW: 'juhozápad',\n\t\t\t\tW: 'západ',\n\t\t\t\tNW: 'serverozápad'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Mierte na {dir}', ' na {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Pokračujte na {dir}', ' na {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Mierne doprava', ' na {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Doprava', ' na {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Prudko doprava', ' na {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Otočte sa'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Prudko doľava', ' na {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Doľava', ' na {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Mierne doľava', ' na {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Ste v prejazdovom bode.'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Odbočte na {exitStr} výjazde', ' na {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Prišli ste do cieľa.'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\tvar i = n % 10 - 1,\n\t\t\t\tsuffix = ['.', '.', '.'];\n\n\t\t\t\treturn suffix[i] ? n + suffix[i] : n + '.';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Začiatok',\n\t\t\t\tviaPlaceholder: 'Cez {viaNumber}',\n\t\t\t\tendPlaceholder: 'Koniec'\n\t\t\t}\n\t\t},\n\t\t'el': {\n\t\t\tdirections: {\n\t\t\t\tN: 'βόρεια',\n\t\t\t\tNE: 'βορειοανατολικά',\n\t\t\t\tE: 'ανατολικά',\n\t\t\t\tSE: 'νοτιοανατολικά',\n\t\t\t\tS: 'νότια',\n\t\t\t\tSW: 'νοτιοδυτικά',\n\t\t\t\tW: 'δυτικά',\n\t\t\t\tNW: 'βορειοδυτικά'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t// instruction, postfix if the road is named\n\t\t\t\t'Head':\n\t\t\t\t\t['Κατευθυνθείτε {dir}', ' στην {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Συνεχίστε {dir}', ' στην {road}'],\n\t\t\t\t'SlightRight':\n\t\t\t\t\t['Ελαφρώς δεξιά', ' στην {road}'],\n\t\t\t\t'Right':\n\t\t\t\t\t['Δεξιά', ' στην {road}'],\n\t\t\t\t'SharpRight':\n\t\t\t\t\t['Απότομη δεξιά στροφή', ' στην {road}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Κάντε αναστροφή'],\n\t\t\t\t'SharpLeft':\n\t\t\t\t\t['Απότομη αριστερή στροφή', ' στην {road}'],\n\t\t\t\t'Left':\n\t\t\t\t\t['Αριστερά', ' στην {road}'],\n\t\t\t\t'SlightLeft':\n\t\t\t\t\t['Ελαφρώς αριστερά', ' στην {road}'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Φτάσατε στο σημείο αναφοράς'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Ακολουθήστε την {exitStr} έξοδο στο κυκλικό κόμβο', ' στην {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Φτάσατε στον προορισμό σας'],\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + 'º';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Αφετηρία',\n\t\t\t\tviaPlaceholder: 'μέσω {viaNumber}',\n\t\t\t\tendPlaceholder: 'Προορισμός'\n\t\t\t}\n\t\t},\n\t\t'ca': {\n\t\t\tdirections: {\n\t\t\t\tN: 'nord',\n\t\t\t\tNE: 'nord-est',\n\t\t\t\tE: 'est',\n\t\t\t\tSE: 'sud-est',\n\t\t\t\tS: 'sud',\n\t\t\t\tSW: 'sud-oest',\n\t\t\t\tW: 'oest',\n\t\t\t\tNW: 'nord-oest',\n\t\t\t\tSlightRight: 'lleu gir a la dreta',\n\t\t\t\tRight: 'dreta',\n\t\t\t\tSharpRight: 'gir pronunciat a la dreta',\n\t\t\t\tSlightLeft: 'gir pronunciat a l\\'esquerra',\n\t\t\t\tLeft: 'esquerra',\n\t\t\t\tSharpLeft: 'lleu gir a l\\'esquerra',\n\t\t\t\tUturn: 'mitja volta'\n\t\t\t},\n\t\t\tinstructions: {\n\t\t\t\t'Head':\n\t\t\t\t\t['Recte {dir}', ' sobre {road}'],\n\t\t\t\t'Continue':\n\t\t\t\t\t['Continuar {dir}'],\n\t\t\t\t'TurnAround':\n\t\t\t\t\t['Donar la volta'],\n\t\t\t\t'WaypointReached':\n\t\t\t\t\t['Ha arribat a un punt del camí'],\n\t\t\t\t'Roundabout':\n\t\t\t\t\t['Agafar {exitStr} sortida a la rotonda', ' a {road}'],\n\t\t\t\t'DestinationReached':\n\t\t\t\t\t['Arribada al destí'],\n\t\t\t\t'Fork': ['A la cruïlla gira a la {modifier}', ' cap a {road}'],\n\t\t\t\t'Merge': ['Incorpora\\'t {modifier}', ' a {road}'],\n\t\t\t\t'OnRamp': ['Gira {modifier} a la sortida', ' cap a {road}'],\n\t\t\t\t'OffRamp': ['Pren la sortida {modifier}', ' cap a {road}'],\n\t\t\t\t'EndOfRoad': ['Gira {modifier} al final de la carretera', ' cap a {road}'],\n\t\t\t\t'Onto': 'cap a {road}'\n\t\t\t},\n\t\t\tformatOrder: function(n) {\n\t\t\t\treturn n + 'º';\n\t\t\t},\n\t\t\tui: {\n\t\t\t\tstartPlaceholder: 'Origen',\n\t\t\t\tviaPlaceholder: 'Via {viaNumber}',\n\t\t\t\tendPlaceholder: 'Destí'\n\t\t\t},\n\t\t\tunits: {\n\t\t\t\tmeters: 'm',\n\t\t\t\tkilometers: 'km',\n\t\t\t\tyards: 'yd',\n\t\t\t\tmiles: 'mi',\n\t\t\t\thours: 'h',\n\t\t\t\tminutes: 'min',\n\t\t\t\tseconds: 's'\n\t\t\t}\n\t\t}\n\t});\n\n\tmodule.exports = L.Routing;\n})();\n\n},{}],12:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.OSRMv1'));\n\n\t/**\n\t * Works against OSRM's new API in version 5.0; this has\n\t * the API version v1.\n\t */\n\tL.Routing.Mapbox = L.Routing.OSRMv1.extend({\n\t\toptions: {\n\t\t\tserviceUrl: 'https://api.mapbox.com/directions/v5',\n\t\t\tprofile: 'mapbox/driving',\n\t\t\tuseHints: false\n\t\t},\n\n\t\tinitialize: function(accessToken, options) {\n\t\t\tL.Routing.OSRMv1.prototype.initialize.call(this, options);\n\t\t\tthis.options.requestParameters = this.options.requestParameters || {};\n\t\t\t/* jshint camelcase: false */\n\t\t\tthis.options.requestParameters.access_token = accessToken;\n\t\t\t/* jshint camelcase: true */\n\t\t}\n\t});\n\n\tL.Routing.mapbox = function(accessToken, options) {\n\t\treturn new L.Routing.Mapbox(accessToken, options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.OSRMv1\":13}],13:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null),\n\t\tcorslite = require('corslite'),\n\t\tpolyline = require('polyline');\n\n\t// Ignore camelcase naming for this file, since OSRM's API uses\n\t// underscores.\n\t/* jshint camelcase: false */\n\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.Waypoint'));\n\n\t/**\n\t * Works against OSRM's new API in version 5.0; this has\n\t * the API version v1.\n\t */\n\tL.Routing.OSRMv1 = L.Class.extend({\n\t\toptions: {\n\t\t\tserviceUrl: 'https://router.project-osrm.org/route/v1',\n\t\t\tprofile: 'driving',\n\t\t\ttimeout: 30 * 1000,\n\t\t\troutingOptions: {\n\t\t\t\talternatives: true,\n\t\t\t\tsteps: true\n\t\t\t},\n\t\t\tpolylinePrecision: 5,\n\t\t\tuseHints: true\n\t\t},\n\n\t\tinitialize: function(options) {\n\t\t\tL.Util.setOptions(this, options);\n\t\t\tthis._hints = {\n\t\t\t\tlocations: {}\n\t\t\t};\n\t\t},\n\n\t\troute: function(waypoints, callback, context, options) {\n\t\t\tvar timedOut = false,\n\t\t\t\twps = [],\n\t\t\t\turl,\n\t\t\t\ttimer,\n\t\t\t\twp,\n\t\t\t\ti,\n\t\t\t\txhr;\n\n\t\t\toptions = L.extend({}, this.options.routingOptions, options);\n\t\t\turl = this.buildRouteUrl(waypoints, options);\n\t\t\tif (this.options.requestParameters) {\n\t\t\t\turl += L.Util.getParamString(this.options.requestParameters, url);\n\t\t\t}\n\n\t\t\ttimer = setTimeout(function() {\n\t\t\t\ttimedOut = true;\n\t\t\t\tcallback.call(context || callback, {\n\t\t\t\t\tstatus: -1,\n\t\t\t\t\tmessage: 'OSRM request timed out.'\n\t\t\t\t});\n\t\t\t}, this.options.timeout);\n\n\t\t\t// Create a copy of the waypoints, since they\n\t\t\t// might otherwise be asynchronously modified while\n\t\t\t// the request is being processed.\n\t\t\tfor (i = 0; i < waypoints.length; i++) {\n\t\t\t\twp = waypoints[i];\n\t\t\t\twps.push(new L.Routing.Waypoint(wp.latLng, wp.name, wp.options));\n\t\t\t}\n\n\t\t\treturn xhr = corslite(url, L.bind(function(err, resp) {\n\t\t\t\tvar data,\n\t\t\t\t\terror =  {};\n\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tif (!timedOut) {\n\t\t\t\t\tif (!err) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdata = JSON.parse(resp.responseText);\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn this._routeDone(data, wps, options, callback, context);\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\terror.status = -3;\n\t\t\t\t\t\t\t\terror.error = ex.toString();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\terror.status = -2;\n\t\t\t\t\t\t\terror.error = 'Error parsing OSRM response: ' + ex.toString();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror = L.extend({}, err, {\n\t\t\t\t\t\t\terror: 'HTTP request failed: ' + err.type,\n\t\t\t\t\t\t\tstatus: -1\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback.call(context || callback, error);\n\t\t\t\t} else {\n\t\t\t\t\txhr.abort();\n\t\t\t\t}\n\t\t\t}, this));\n\t\t},\n\n\t\trequiresMoreDetail: function(route, zoom, bounds) {\n\t\t\tif (!route.properties.isSimplified) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar waypoints = route.inputWaypoints,\n\t\t\t\ti;\n\t\t\tfor (i = 0; i < waypoints.length; ++i) {\n\t\t\t\tif (!bounds.contains(waypoints[i].latLng)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_routeDone: function(response, inputWaypoints, options, callback, context) {\n\t\t\tvar alts = [],\n\t\t\t    actualWaypoints,\n\t\t\t    i,\n\t\t\t    route;\n\n\t\t\tcontext = context || callback;\n\t\t\tif (response.code !== 'Ok') {\n\t\t\t\tcallback.call(context, {\n\t\t\t\t\tstatus: response.code\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tactualWaypoints = this._toWaypoints(inputWaypoints, response.waypoints);\n\n\t\t\tfor (i = 0; i < response.routes.length; i++) {\n\t\t\t\troute = this._convertRoute(response.routes[i]);\n\t\t\t\troute.inputWaypoints = inputWaypoints;\n\t\t\t\troute.waypoints = actualWaypoints;\n\t\t\t\troute.properties = {isSimplified: !options || !options.geometryOnly || options.simplifyGeometry};\n\t\t\t\talts.push(route);\n\t\t\t}\n\n\t\t\tthis._saveHintData(response.waypoints, inputWaypoints);\n\n\t\t\tcallback.call(context, null, alts);\n\t\t},\n\n\t\t_convertRoute: function(responseRoute) {\n\t\t\tvar result = {\n\t\t\t\t\tname: '',\n\t\t\t\t\tcoordinates: [],\n\t\t\t\t\tinstructions: [],\n\t\t\t\t\tsummary: {\n\t\t\t\t\t\ttotalDistance: responseRoute.distance,\n\t\t\t\t\t\ttotalTime: responseRoute.duration\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tlegNames = [],\n\t\t\t\tindex = 0,\n\t\t\t\tlegCount = responseRoute.legs.length,\n\t\t\t\thasSteps = responseRoute.legs[0].steps.length > 0,\n\t\t\t\ti,\n\t\t\t\tj,\n\t\t\t\tleg,\n\t\t\t\tstep,\n\t\t\t\tgeometry,\n\t\t\t\ttype,\n\t\t\t\tmodifier;\n\n\t\t\tfor (i = 0; i < legCount; i++) {\n\t\t\t\tleg = responseRoute.legs[i];\n\t\t\t\tlegNames.push(leg.summary && leg.summary.charAt(0).toUpperCase() + leg.summary.substring(1));\n\t\t\t\tfor (j = 0; j < leg.steps.length; j++) {\n\t\t\t\t\tstep = leg.steps[j];\n\t\t\t\t\tgeometry = this._decodePolyline(step.geometry);\n\t\t\t\t\tresult.coordinates.push.apply(result.coordinates, geometry);\n\t\t\t\t\ttype = this._maneuverToInstructionType(step.maneuver, i === legCount - 1);\n\t\t\t\t\tmodifier = this._maneuverToModifier(step.maneuver);\n\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\tresult.instructions.push({\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\tdistance: step.distance,\n\t\t\t\t\t\t\ttime: step.duration,\n\t\t\t\t\t\t\troad: step.name,\n\t\t\t\t\t\t\tdirection: this._bearingToDirection(step.maneuver.bearing_after),\n\t\t\t\t\t\t\texit: step.maneuver.exit,\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\tmode: step.mode,\n\t\t\t\t\t\t\tmodifier: modifier\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tindex += geometry.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.name = legNames.join(', ');\n\t\t\tif (!hasSteps) {\n\t\t\t\tresult.coordinates = this._decodePolyline(responseRoute.geometry);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\t_bearingToDirection: function(bearing) {\n\t\t\tvar oct = Math.round(bearing / 45) % 8;\n\t\t\treturn ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'][oct];\n\t\t},\n\n\t\t_maneuverToInstructionType: function(maneuver, lastLeg) {\n\t\t\tswitch (maneuver.type) {\n\t\t\tcase 'new name':\n\t\t\t\treturn 'Continue';\n\t\t\tcase 'depart':\n\t\t\t\treturn 'Head';\n\t\t\tcase 'arrive':\n\t\t\t\treturn lastLeg ? 'DestinationReached' : 'WaypointReached';\n\t\t\tcase 'roundabout':\n\t\t\tcase 'rotary':\n\t\t\t\treturn 'Roundabout';\n\t\t\tcase 'merge':\n\t\t\tcase 'fork':\n\t\t\tcase 'on ramp':\n\t\t\tcase 'off ramp':\n\t\t\tcase 'end of road':\n\t\t\t\treturn this._camelCase(maneuver.type);\n\t\t\t// These are all reduced to the same instruction in the current model\n\t\t\t//case 'turn':\n\t\t\t//case 'ramp': // deprecated in v5.1\n\t\t\tdefault:\n\t\t\t\treturn this._camelCase(maneuver.modifier);\n\t\t\t}\n\t\t},\n\n\t\t_maneuverToModifier: function(maneuver) {\n\t\t\tvar modifier = maneuver.modifier;\n\n\t\t\tswitch (maneuver.type) {\n\t\t\tcase 'merge':\n\t\t\tcase 'fork':\n\t\t\tcase 'on ramp':\n\t\t\tcase 'off ramp':\n\t\t\tcase 'end of road':\n\t\t\t\tmodifier = this._leftOrRight(modifier);\n\t\t\t}\n\n\t\t\treturn modifier && this._camelCase(modifier);\n\t\t},\n\n\t\t_camelCase: function(s) {\n\t\t\tvar words = s.split(' '),\n\t\t\t\tresult = '';\n\t\t\tfor (var i = 0, l = words.length; i < l; i++) {\n\t\t\t\tresult += words[i].charAt(0).toUpperCase() + words[i].substring(1);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\t_leftOrRight: function(d) {\n\t\t\treturn d.indexOf('left') >= 0 ? 'Left' : 'Right';\n\t\t},\n\n\t\t_decodePolyline: function(routeGeometry) {\n\t\t\tvar cs = polyline.decode(routeGeometry, this.options.polylinePrecision),\n\t\t\t\tresult = new Array(cs.length),\n\t\t\t\ti;\n\t\t\tfor (i = cs.length - 1; i >= 0; i--) {\n\t\t\t\tresult[i] = L.latLng(cs[i]);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\n\t\t_toWaypoints: function(inputWaypoints, vias) {\n\t\t\tvar wps = [],\n\t\t\t    i,\n\t\t\t    viaLoc;\n\t\t\tfor (i = 0; i < vias.length; i++) {\n\t\t\t\tviaLoc = vias[i].location;\n\t\t\t\twps.push(L.Routing.waypoint(L.latLng(viaLoc[1], viaLoc[0]),\n\t\t\t\t                            inputWaypoints[i].name,\n\t\t\t\t\t\t\t\t\t\t\tinputWaypoints[i].options));\n\t\t\t}\n\n\t\t\treturn wps;\n\t\t},\n\n\t\tbuildRouteUrl: function(waypoints, options) {\n\t\t\tvar locs = [],\n\t\t\t\thints = [],\n\t\t\t\twp,\n\t\t\t\tlatLng,\n\t\t\t    computeInstructions,\n\t\t\t    computeAlternative = true;\n\n\t\t\tfor (var i = 0; i < waypoints.length; i++) {\n\t\t\t\twp = waypoints[i];\n\t\t\t\tlatLng = wp.latLng;\n\t\t\t\tlocs.push(latLng.lng + ',' + latLng.lat);\n\t\t\t\thints.push(this._hints.locations[this._locationKey(latLng)] || '');\n\t\t\t}\n\n\t\t\tcomputeInstructions =\n\t\t\t\t!(options && options.geometryOnly);\n\n\t\t\treturn this.options.serviceUrl + '/' + this.options.profile + '/' +\n\t\t\t\tlocs.join(';') + '?' +\n\t\t\t\t(options.geometryOnly ? (options.simplifyGeometry ? '' : 'overview=full') : 'overview=false') +\n\t\t\t\t'&alternatives=' + computeAlternative.toString() +\n\t\t\t\t'&steps=' + computeInstructions.toString() +\n\t\t\t\t(this.options.useHints ? '&hints=' + hints.join(';') : '') +\n\t\t\t\t(options.allowUTurns ? '&continue_straight=' + !options.allowUTurns : '');\n\t\t},\n\n\t\t_locationKey: function(location) {\n\t\t\treturn location.lat + ',' + location.lng;\n\t\t},\n\n\t\t_saveHintData: function(actualWaypoints, waypoints) {\n\t\t\tvar loc;\n\t\t\tthis._hints = {\n\t\t\t\tlocations: {}\n\t\t\t};\n\t\t\tfor (var i = actualWaypoints.length - 1; i >= 0; i--) {\n\t\t\t\tloc = waypoints[i].latLng;\n\t\t\t\tthis._hints.locations[this._locationKey(loc)] = actualWaypoints[i].hint;\n\t\t\t}\n\t\t},\n\t});\n\n\tL.Routing.osrmv1 = function(options) {\n\t\treturn new L.Routing.OSRMv1(options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.Waypoint\":15,\"corslite\":1,\"polyline\":2}],14:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\tL.Routing = L.Routing || {};\n\tL.extend(L.Routing, require('./L.Routing.GeocoderElement'));\n\tL.extend(L.Routing, require('./L.Routing.Waypoint'));\n\n\tL.Routing.Plan = (L.Layer || L.Class).extend({\n\t\tincludes: L.Mixin.Events,\n\n\t\toptions: {\n\t\t\tdragStyles: [\n\t\t\t\t{color: 'black', opacity: 0.15, weight: 9},\n\t\t\t\t{color: 'white', opacity: 0.8, weight: 6},\n\t\t\t\t{color: 'red', opacity: 1, weight: 2, dashArray: '7,12'}\n\t\t\t],\n\t\t\tdraggableWaypoints: true,\n\t\t\trouteWhileDragging: false,\n\t\t\taddWaypoints: true,\n\t\t\treverseWaypoints: false,\n\t\t\taddButtonClassName: '',\n\t\t\tlanguage: 'en',\n\t\t\tcreateGeocoderElement: L.Routing.geocoderElement,\n\t\t\tcreateMarker: function(i, wp) {\n\t\t\t\tvar options = {\n\t\t\t\t\t\tdraggable: this.draggableWaypoints\n\t\t\t\t\t},\n\t\t\t\t    marker = L.marker(wp.latLng, options);\n\n\t\t\t\treturn marker;\n\t\t\t},\n\t\t\tgeocodersClassName: ''\n\t\t},\n\n\t\tinitialize: function(waypoints, options) {\n\t\t\tL.Util.setOptions(this, options);\n\t\t\tthis._waypoints = [];\n\t\t\tthis.setWaypoints(waypoints);\n\t\t},\n\n\t\tisReady: function() {\n\t\t\tvar i;\n\t\t\tfor (i = 0; i < this._waypoints.length; i++) {\n\t\t\t\tif (!this._waypoints[i].latLng) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tgetWaypoints: function() {\n\t\t\tvar i,\n\t\t\t\twps = [];\n\n\t\t\tfor (i = 0; i < this._waypoints.length; i++) {\n\t\t\t\twps.push(this._waypoints[i]);\n\t\t\t}\n\n\t\t\treturn wps;\n\t\t},\n\n\t\tsetWaypoints: function(waypoints) {\n\t\t\tvar args = [0, this._waypoints.length].concat(waypoints);\n\t\t\tthis.spliceWaypoints.apply(this, args);\n\t\t\treturn this;\n\t\t},\n\n\t\tspliceWaypoints: function() {\n\t\t\tvar args = [arguments[0], arguments[1]],\n\t\t\t    i;\n\n\t\t\tfor (i = 2; i < arguments.length; i++) {\n\t\t\t\targs.push(arguments[i] && arguments[i].hasOwnProperty('latLng') ? arguments[i] : L.Routing.waypoint(arguments[i]));\n\t\t\t}\n\n\t\t\t[].splice.apply(this._waypoints, args);\n\n\t\t\t// Make sure there's always at least two waypoints\n\t\t\twhile (this._waypoints.length < 2) {\n\t\t\t\tthis.spliceWaypoints(this._waypoints.length, 0, null);\n\t\t\t}\n\n\t\t\tthis._updateMarkers();\n\t\t\tthis._fireChanged.apply(this, args);\n\t\t},\n\n\t\tonAdd: function(map) {\n\t\t\tthis._map = map;\n\t\t\tthis._updateMarkers();\n\t\t},\n\n\t\tonRemove: function() {\n\t\t\tvar i;\n\t\t\tthis._removeMarkers();\n\n\t\t\tif (this._newWp) {\n\t\t\t\tfor (i = 0; i < this._newWp.lines.length; i++) {\n\t\t\t\t\tthis._map.removeLayer(this._newWp.lines[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelete this._map;\n\t\t},\n\n\t\tcreateGeocoders: function() {\n\t\t\tvar container = L.DomUtil.create('div', 'leaflet-routing-geocoders ' + this.options.geocodersClassName),\n\t\t\t\twaypoints = this._waypoints,\n\t\t\t    addWpBtn,\n\t\t\t    reverseBtn;\n\n\t\t\tthis._geocoderContainer = container;\n\t\t\tthis._geocoderElems = [];\n\n\n\t\t\tif (this.options.addWaypoints) {\n\t\t\t\taddWpBtn = L.DomUtil.create('button', 'leaflet-routing-add-waypoint ' + this.options.addButtonClassName, container);\n\t\t\t\taddWpBtn.setAttribute('type', 'button');\n\t\t\t\tL.DomEvent.addListener(addWpBtn, 'click', function() {\n\t\t\t\t\tthis.spliceWaypoints(waypoints.length, 0, null);\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tif (this.options.reverseWaypoints) {\n\t\t\t\treverseBtn = L.DomUtil.create('button', 'leaflet-routing-reverse-waypoints', container);\n\t\t\t\treverseBtn.setAttribute('type', 'button');\n\t\t\t\tL.DomEvent.addListener(reverseBtn, 'click', function() {\n\t\t\t\t\tthis._waypoints.reverse();\n\t\t\t\t\tthis.setWaypoints(this._waypoints);\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tthis._updateGeocoders();\n\t\t\tthis.on('waypointsspliced', this._updateGeocoders);\n\n\t\t\treturn container;\n\t\t},\n\n\t\t_createGeocoder: function(i) {\n\t\t\tvar geocoder = this.options.createGeocoderElement(this._waypoints[i], i, this._waypoints.length, this.options);\n\t\t\tgeocoder\n\t\t\t.on('delete', function() {\n\t\t\t\tif (i > 0 || this._waypoints.length > 2) {\n\t\t\t\t\tthis.spliceWaypoints(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\tthis.spliceWaypoints(i, 1, new L.Routing.Waypoint());\n\t\t\t\t}\n\t\t\t}, this)\n\t\t\t.on('geocoded', function(e) {\n\t\t\t\tthis._updateMarkers();\n\t\t\t\tthis._fireChanged();\n\t\t\t\tthis._focusGeocoder(i + 1);\n\t\t\t\tthis.fire('waypointgeocoded', {\n\t\t\t\t\twaypointIndex: i,\n\t\t\t\t\twaypoint: e.waypoint\n\t\t\t\t});\n\t\t\t}, this)\n\t\t\t.on('reversegeocoded', function(e) {\n\t\t\t\tthis.fire('waypointgeocoded', {\n\t\t\t\t\twaypointIndex: i,\n\t\t\t\t\twaypoint: e.waypoint\n\t\t\t\t});\n\t\t\t}, this);\n\n\t\t\treturn geocoder;\n\t\t},\n\n\t\t_updateGeocoders: function() {\n\t\t\tvar elems = [],\n\t\t\t\ti,\n\t\t\t    geocoderElem;\n\n\t\t\tfor (i = 0; i < this._geocoderElems.length; i++) {\n\t\t\t\tthis._geocoderContainer.removeChild(this._geocoderElems[i].getContainer());\n\t\t\t}\n\n\t\t\tfor (i = this._waypoints.length - 1; i >= 0; i--) {\n\t\t\t\tgeocoderElem = this._createGeocoder(i);\n\t\t\t\tthis._geocoderContainer.insertBefore(geocoderElem.getContainer(), this._geocoderContainer.firstChild);\n\t\t\t\telems.push(geocoderElem);\n\t\t\t}\n\n\t\t\tthis._geocoderElems = elems.reverse();\n\t\t},\n\n\t\t_removeMarkers: function() {\n\t\t\tvar i;\n\t\t\tif (this._markers) {\n\t\t\t\tfor (i = 0; i < this._markers.length; i++) {\n\t\t\t\t\tif (this._markers[i]) {\n\t\t\t\t\t\tthis._map.removeLayer(this._markers[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._markers = [];\n\t\t},\n\n\t\t_updateMarkers: function() {\n\t\t\tvar i,\n\t\t\t    m;\n\n\t\t\tif (!this._map) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._removeMarkers();\n\n\t\t\tfor (i = 0; i < this._waypoints.length; i++) {\n\t\t\t\tif (this._waypoints[i].latLng) {\n\t\t\t\t\tm = this.options.createMarker(i, this._waypoints[i], this._waypoints.length);\n\t\t\t\t\tif (m) {\n\t\t\t\t\t\tm.addTo(this._map);\n\t\t\t\t\t\tif (this.options.draggableWaypoints) {\n\t\t\t\t\t\t\tthis._hookWaypointEvents(m, i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tm = null;\n\t\t\t\t}\n\t\t\t\tthis._markers.push(m);\n\t\t\t}\n\t\t},\n\n\t\t_fireChanged: function() {\n\t\t\tthis.fire('waypointschanged', {waypoints: this.getWaypoints()});\n\n\t\t\tif (arguments.length >= 2) {\n\t\t\t\tthis.fire('waypointsspliced', {\n\t\t\t\t\tindex: Array.prototype.shift.call(arguments),\n\t\t\t\t\tnRemoved: Array.prototype.shift.call(arguments),\n\t\t\t\t\tadded: arguments\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t_hookWaypointEvents: function(m, i, trackMouseMove) {\n\t\t\tvar eventLatLng = function(e) {\n\t\t\t\t\treturn trackMouseMove ? e.latlng : e.target.getLatLng();\n\t\t\t\t},\n\t\t\t\tdragStart = L.bind(function(e) {\n\t\t\t\t\tthis.fire('waypointdragstart', {index: i, latlng: eventLatLng(e)});\n\t\t\t\t}, this),\n\t\t\t\tdrag = L.bind(function(e) {\n\t\t\t\t\tthis._waypoints[i].latLng = eventLatLng(e);\n\t\t\t\t\tthis.fire('waypointdrag', {index: i, latlng: eventLatLng(e)});\n\t\t\t\t}, this),\n\t\t\t\tdragEnd = L.bind(function(e) {\n\t\t\t\t\tthis._waypoints[i].latLng = eventLatLng(e);\n\t\t\t\t\tthis._waypoints[i].name = '';\n\t\t\t\t\tif (this._geocoderElems) {\n\t\t\t\t\t\tthis._geocoderElems[i].update(true);\n\t\t\t\t\t}\n\t\t\t\t\tthis.fire('waypointdragend', {index: i, latlng: eventLatLng(e)});\n\t\t\t\t\tthis._fireChanged();\n\t\t\t\t}, this),\n\t\t\t\tmouseMove,\n\t\t\t\tmouseUp;\n\n\t\t\tif (trackMouseMove) {\n\t\t\t\tmouseMove = L.bind(function(e) {\n\t\t\t\t\tthis._markers[i].setLatLng(e.latlng);\n\t\t\t\t\tdrag(e);\n\t\t\t\t}, this);\n\t\t\t\tmouseUp = L.bind(function(e) {\n\t\t\t\t\tthis._map.dragging.enable();\n\t\t\t\t\tthis._map.off('mouseup', mouseUp);\n\t\t\t\t\tthis._map.off('mousemove', mouseMove);\n\t\t\t\t\tdragEnd(e);\n\t\t\t\t}, this);\n\t\t\t\tthis._map.dragging.disable();\n\t\t\t\tthis._map.on('mousemove', mouseMove);\n\t\t\t\tthis._map.on('mouseup', mouseUp);\n\t\t\t\tdragStart({latlng: this._waypoints[i].latLng});\n\t\t\t} else {\n\t\t\t\tm.on('dragstart', dragStart);\n\t\t\t\tm.on('drag', drag);\n\t\t\t\tm.on('dragend', dragEnd);\n\t\t\t}\n\t\t},\n\n\t\tdragNewWaypoint: function(e) {\n\t\t\tvar newWpIndex = e.afterIndex + 1;\n\t\t\tif (this.options.routeWhileDragging) {\n\t\t\t\tthis.spliceWaypoints(newWpIndex, 0, e.latlng);\n\t\t\t\tthis._hookWaypointEvents(this._markers[newWpIndex], newWpIndex, true);\n\t\t\t} else {\n\t\t\t\tthis._dragNewWaypoint(newWpIndex, e.latlng);\n\t\t\t}\n\t\t},\n\n\t\t_dragNewWaypoint: function(newWpIndex, initialLatLng) {\n\t\t\tvar wp = new L.Routing.Waypoint(initialLatLng),\n\t\t\t\tprevWp = this._waypoints[newWpIndex - 1],\n\t\t\t\tnextWp = this._waypoints[newWpIndex],\n\t\t\t\tmarker = this.options.createMarker(newWpIndex, wp, this._waypoints.length + 1),\n\t\t\t\tlines = [],\n\t\t\t\tmouseMove = L.bind(function(e) {\n\t\t\t\t\tvar i;\n\t\t\t\t\tif (marker) {\n\t\t\t\t\t\tmarker.setLatLng(e.latlng);\n\t\t\t\t\t}\n\t\t\t\t\tfor (i = 0; i < lines.length; i++) {\n\t\t\t\t\t\tlines[i].spliceLatLngs(1, 1, e.latlng);\n\t\t\t\t\t}\n\t\t\t\t}, this),\n\t\t\t\tmouseUp = L.bind(function(e) {\n\t\t\t\t\tvar i;\n\t\t\t\t\tif (marker) {\n\t\t\t\t\t\tthis._map.removeLayer(marker);\n\t\t\t\t\t}\n\t\t\t\t\tfor (i = 0; i < lines.length; i++) {\n\t\t\t\t\t\tthis._map.removeLayer(lines[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis._map.off('mousemove', mouseMove);\n\t\t\t\t\tthis._map.off('mouseup', mouseUp);\n\t\t\t\t\tthis.spliceWaypoints(newWpIndex, 0, e.latlng);\n\t\t\t\t}, this),\n\t\t\t\ti;\n\n\t\t\tif (marker) {\n\t\t\t\tmarker.addTo(this._map);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < this.options.dragStyles.length; i++) {\n\t\t\t\tlines.push(L.polyline([prevWp.latLng, initialLatLng, nextWp.latLng],\n\t\t\t\t\tthis.options.dragStyles[i]).addTo(this._map));\n\t\t\t}\n\n\t\t\tthis._map.on('mousemove', mouseMove);\n\t\t\tthis._map.on('mouseup', mouseUp);\n\t\t},\n\n\t\t_focusGeocoder: function(i) {\n\t\t\tif (this._geocoderElems[i]) {\n\t\t\t\tthis._geocoderElems[i].focus();\n\t\t\t} else {\n\t\t\t\tdocument.activeElement.blur();\n\t\t\t}\n\t\t}\n\t});\n\n\tL.Routing.plan = function(waypoints, options) {\n\t\treturn new L.Routing.Plan(waypoints, options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./L.Routing.GeocoderElement\":7,\"./L.Routing.Waypoint\":15}],15:[function(require,module,exports){\n(function (global){\n(function() {\n\t'use strict';\n\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\n\tL.Routing = L.Routing || {};\n\n\tL.Routing.Waypoint = L.Class.extend({\n\t\t\toptions: {\n\t\t\t\tallowUTurn: false,\n\t\t\t},\n\t\t\tinitialize: function(latLng, name, options) {\n\t\t\t\tL.Util.setOptions(this, options);\n\t\t\t\tthis.latLng = L.latLng(latLng);\n\t\t\t\tthis.name = name;\n\t\t\t}\n\t\t});\n\n\tL.Routing.waypoint = function(latLng, name, options) {\n\t\treturn new L.Routing.Waypoint(latLng, name, options);\n\t};\n\n\tmodule.exports = L.Routing;\n})();\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}]},{},[4])(4)\n});","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\r\nfunction corslite(url, callback, cors) {\r\n    var sent = false;\r\n\r\n    if (typeof window.XMLHttpRequest === 'undefined') {\r\n        return callback(Error('Browser not supported'));\r\n    }\r\n\r\n    if (typeof cors === 'undefined') {\r\n        var m = url.match(/^\\s*https?:\\/\\/[^\\/]*/);\r\n        cors = m && (m[0] !== location.protocol + '//' + location.hostname +\r\n                (location.port ? ':' + location.port : ''));\r\n    }\r\n\r\n    var x = new window.XMLHttpRequest();\r\n\r\n    function isSuccessful(status) {\r\n        return status >= 200 && status < 300 || status === 304;\r\n    }\r\n\r\n    if (cors && !('withCredentials' in x)) {\r\n        // IE8-9\r\n        x = new window.XDomainRequest();\r\n\r\n        // Ensure callback is never called synchronously, i.e., before\r\n        // x.send() returns (this has been observed in the wild).\r\n        // See https://github.com/mapbox/mapbox.js/issues/472\r\n        var original = callback;\r\n        callback = function() {\r\n            if (sent) {\r\n                original.apply(this, arguments);\r\n            } else {\r\n                var that = this, args = arguments;\r\n                setTimeout(function() {\r\n                    original.apply(that, args);\r\n                }, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    function loaded() {\r\n        if (\r\n            // XDomainRequest\r\n            x.status === undefined ||\r\n            // modern browsers\r\n            isSuccessful(x.status)) callback.call(x, null, x);\r\n        else callback.call(x, x, null);\r\n    }\r\n\r\n    // Both `onreadystatechange` and `onload` can fire. `onreadystatechange`\r\n    // has [been supported for longer](http://stackoverflow.com/a/9181508/229001).\r\n    if ('onload' in x) {\r\n        x.onload = loaded;\r\n    } else {\r\n        x.onreadystatechange = function readystate() {\r\n            if (x.readyState === 4) {\r\n                loaded();\r\n            }\r\n        };\r\n    }\r\n\r\n    // Call the callback with the XMLHttpRequest object as an error and prevent\r\n    // it from ever being called again by reassigning it to `noop`\r\n    x.onerror = function error(evt) {\r\n        // XDomainRequest provides no evt parameter\r\n        callback.call(this, evt || true, null);\r\n        callback = function() { };\r\n    };\r\n\r\n    // IE9 must have onprogress be set to a unique function.\r\n    x.onprogress = function() { };\r\n\r\n    x.ontimeout = function(evt) {\r\n        callback.call(this, evt, null);\r\n        callback = function() { };\r\n    };\r\n\r\n    x.onabort = function(evt) {\r\n        callback.call(this, evt, null);\r\n        callback = function() { };\r\n    };\r\n\r\n    // GET is the only supported HTTP Verb by XDomainRequest and is the\r\n    // only one supported here.\r\n    x.open('GET', url, true);\r\n\r\n    // Send the request. Sending data is not supported.\r\n    x.send(null);\r\n    sent = true;\r\n\r\n    return x;\r\n}\r\n\r\nif (typeof module !== 'undefined') module.exports = corslite;\r\n\r\n},{}],2:[function(require,module,exports){\r\n'use strict';\r\n\r\n/**\r\n * Based off of [the offical Google document](https://developers.google.com/maps/documentation/utilities/polylinealgorithm)\r\n *\r\n * Some parts from [this implementation](http://facstaff.unca.edu/mcmcclur/GoogleMaps/EncodePolyline/PolylineEncoder.js)\r\n * by [Mark McClure](http://facstaff.unca.edu/mcmcclur/)\r\n *\r\n * @module polyline\r\n */\r\n\r\nvar polyline = {};\r\n\r\nfunction encode(coordinate, factor) {\r\n    coordinate = Math.round(coordinate * factor);\r\n    coordinate <<= 1;\r\n    if (coordinate < 0) {\r\n        coordinate = ~coordinate;\r\n    }\r\n    var output = '';\r\n    while (coordinate >= 0x20) {\r\n        output += String.fromCharCode((0x20 | (coordinate & 0x1f)) + 63);\r\n        coordinate >>= 5;\r\n    }\r\n    output += String.fromCharCode(coordinate + 63);\r\n    return output;\r\n}\r\n\r\n/**\r\n * Decodes to a [latitude, longitude] coordinates array.\r\n *\r\n * This is adapted from the implementation in Project-OSRM.\r\n *\r\n * @param {String} str\r\n * @param {Number} precision\r\n * @returns {Array}\r\n *\r\n * @see https://github.com/Project-OSRM/osrm-frontend/blob/master/WebContent/routing/OSRM.RoutingGeometry.js\r\n */\r\npolyline.decode = function(str, precision) {\r\n    var index = 0,\r\n        lat = 0,\r\n        lng = 0,\r\n        coordinates = [],\r\n        shift = 0,\r\n        result = 0,\r\n        byte = null,\r\n        latitude_change,\r\n        longitude_change,\r\n        factor = Math.pow(10, precision || 5);\r\n\r\n    // Coordinates have variable length when encoded, so just keep\r\n    // track of whether we've hit the end of the string. In each\r\n    // loop iteration, a single coordinate is decoded.\r\n    while (index < str.length) {\r\n\r\n        // Reset shift, result, and byte\r\n        byte = null;\r\n        shift = 0;\r\n        result = 0;\r\n\r\n        do {\r\n            byte = str.charCodeAt(index++) - 63;\r\n            result |= (byte & 0x1f) << shift;\r\n            shift += 5;\r\n        } while (byte >= 0x20);\r\n\r\n        latitude_change = ((result & 1) ? ~(result >> 1) : (result >> 1));\r\n\r\n        shift = result = 0;\r\n\r\n        do {\r\n            byte = str.charCodeAt(index++) - 63;\r\n            result |= (byte & 0x1f) << shift;\r\n            shift += 5;\r\n        } while (byte >= 0x20);\r\n\r\n        longitude_change = ((result & 1) ? ~(result >> 1) : (result >> 1));\r\n\r\n        lat += latitude_change;\r\n        lng += longitude_change;\r\n\r\n        coordinates.push([lat / factor, lng / factor]);\r\n    }\r\n\r\n    return coordinates;\r\n};\r\n\r\n/**\r\n * Encodes the given [latitude, longitude] coordinates array.\r\n *\r\n * @param {Array.<Array.<Number>>} coordinates\r\n * @param {Number} precision\r\n * @returns {String}\r\n */\r\npolyline.encode = function(coordinates, precision) {\r\n    if (!coordinates.length) { return ''; }\r\n\r\n    var factor = Math.pow(10, precision || 5),\r\n        output = encode(coordinates[0][0], factor) + encode(coordinates[0][1], factor);\r\n\r\n    for (var i = 1; i < coordinates.length; i++) {\r\n        var a = coordinates[i], b = coordinates[i - 1];\r\n        output += encode(a[0] - b[0], factor);\r\n        output += encode(a[1] - b[1], factor);\r\n    }\r\n\r\n    return output;\r\n};\r\n\r\nfunction flipped(coords) {\r\n    var flipped = [];\r\n    for (var i = 0; i < coords.length; i++) {\r\n        flipped.push(coords[i].slice().reverse());\r\n    }\r\n    return flipped;\r\n}\r\n\r\n/**\r\n * Encodes a GeoJSON LineString feature/geometry.\r\n *\r\n * @param {Object} geojson\r\n * @param {Number} precision\r\n * @returns {String}\r\n */\r\npolyline.fromGeoJSON = function(geojson, precision) {\r\n    if (geojson && geojson.type === 'Feature') {\r\n        geojson = geojson.geometry;\r\n    }\r\n    if (!geojson || geojson.type !== 'LineString') {\r\n        throw new Error('Input must be a GeoJSON LineString');\r\n    }\r\n    return polyline.encode(flipped(geojson.coordinates), precision);\r\n};\r\n\r\n/**\r\n * Decodes to a GeoJSON LineString geometry.\r\n *\r\n * @param {String} str\r\n * @param {Number} precision\r\n * @returns {Object}\r\n */\r\npolyline.toGeoJSON = function(str, precision) {\r\n    var coords = polyline.decode(str, precision);\r\n    return {\r\n        type: 'LineString',\r\n        coordinates: flipped(coords)\r\n    };\r\n};\r\n\r\nif (typeof module === 'object' && module.exports) {\r\n    module.exports = polyline;\r\n}\r\n\r\n},{}],3:[function(require,module,exports){\r\n(function (global){\r\nvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\r\nvar MapzenRouter = require('./mapzenRouter');\r\nvar MapzenLine = require('./mapzenLine');\r\nvar MapzenFormatter = require('./mapzenFormatter');\r\n\r\nL.Routing = L.Routing || {};\r\nL.routing = L.routing || {};\r\n\r\nL.Routing.Mapzen = MapzenRouter;\r\nL.Routing.MapzenLine = MapzenLine;\r\nL.Routing.MapzenFormatter = MapzenFormatter;\r\n\r\n\r\nL.routing.mapzen = function(key, options) {\r\n  return new MapzenRouter(key, options);\r\n}\r\n\r\nL.routing.mapzenLine = function(route, options) {\r\n  return new MapzenLine(route, options);\r\n}\r\n\r\nL.routing.mapzenFormatter = function(options) {\r\n  return new MapzenFormatter(options);\r\n}\r\n\r\n// deperecate these parts later\r\n\r\nL.Routing.mapzen = L.routing.mapzen;\r\nL.Routing.mapzenLine = L.routing.mapzenLine;\r\nL.Routing.mapzenFormatter = L.routing.mapzenFormatter;\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{\"./mapzenFormatter\":4,\"./mapzenLine\":5,\"./mapzenRouter\":6}],4:[function(require,module,exports){\r\n(function (global){\r\n(function() {\r\n  'use strict';\r\n\r\n  var L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\r\n\r\n  //L.extend(L.Routing, require('./L.Routing.Localization'));\r\n  module.exports = L.Class.extend({\r\n    options: {\r\n      units: 'metric',\r\n      unitNames: {\r\n        meters: 'm',\r\n        kilometers: 'km',\r\n        yards: 'yd',\r\n        miles: 'mi',\r\n        hours: 'h',\r\n        minutes: 'mín',\r\n        seconds: 's'\r\n      },\r\n      language: 'en',\r\n      roundingSensitivity: 1,\r\n      distanceTemplate: '{value} {unit}'\r\n    },\r\n\r\n    initialize: function(options) {\r\n      L.setOptions(this, options);\r\n    },\r\n\r\n    formatDistance: function(d /* Number (meters) */) {\r\n      var un = this.options.unitNames,\r\n          v,\r\n        data;\r\n      if (this.options.units === 'imperial') {\r\n        //valhalla returns distance in km\r\n        d  = d * 1000;\r\n        d = d / 1.609344;\r\n        if (d >= 1000) {\r\n          data = {\r\n            value: (this._round(d) / 1000),\r\n            unit: un.miles\r\n          };\r\n        } else {\r\n          data = {\r\n            value: this._round(d / 1.760),\r\n            unit: un.yards\r\n          };\r\n        }\r\n      } else {\r\n        v = d;\r\n        data = {\r\n          value: v >= 1 ? v: v*1000,\r\n          unit: v >= 1 ? un.kilometers : un.meters\r\n        };\r\n      }\r\n\r\n       return L.Util.template(this.options.distanceTemplate, data);\r\n    },\r\n\r\n    _round: function(d) {\r\n      var pow10 = Math.pow(10, (Math.floor(d / this.options.roundingSensitivity) + '').length - 1),\r\n        r = Math.floor(d / pow10),\r\n        p = (r > 5) ? pow10 : pow10 / 2;\r\n\r\n      return Math.round(d / p) * p;\r\n    },\r\n\r\n    formatTime: function(t /* Number (seconds) */) {\r\n      if (t > 86400) {\r\n        return Math.round(t / 3600) + ' h';\r\n      } else if (t > 3600) {\r\n        return Math.floor(t / 3600) + ' h ' +\r\n          Math.round((t % 3600) / 60) + ' min';\r\n      } else if (t > 300) {\r\n        return Math.round(t / 60) + ' min';\r\n      } else if (t > 60) {\r\n        return Math.floor(t / 60) + ' min' +\r\n          (t % 60 !== 0 ? ' ' + (t % 60) + ' s' : '');\r\n      } else {\r\n        return t + ' s';\r\n      }\r\n    },\r\n\r\n    formatInstruction: function(instr, i) {\r\n      // Valhalla returns instructions itself.\r\n      return instr.instruction;\r\n    },\r\n\r\n    getIconName: function(instr, i) {\r\n      // you can find all Valhalla's direction types at https://github.com/valhalla/odin/blob/master/proto/tripdirections.proto\r\n      switch (instr.type) {\r\n        case 0:\r\n          return 'kNone';\r\n        case 1:\r\n          return 'kStart';\r\n        case 2:\r\n          return 'kStartRight';\r\n        case 3:\r\n          return 'kStartLeft';\r\n        case 4:\r\n          return 'kDestination';\r\n        case 5:\r\n          return 'kDestinationRight';\r\n        case 6:\r\n          return 'kDestinationLeft';\r\n        case 7:\r\n          return 'kBecomes';\r\n        case 8:\r\n          return 'kContinue';\r\n        case 9:\r\n          return 'kSlightRight';\r\n        case 10:\r\n          return 'kRight';\r\n        case 11:\r\n          return 'kSharpRight';\r\n        case 12:\r\n          return 'kUturnRight';\r\n        case 13:\r\n          return 'kUturnLeft';\r\n        case 14:\r\n          return 'kSharpLeft';\r\n        case 15:\r\n          return 'kLeft';\r\n        case 16:\r\n          return 'kSlightLeft';\r\n        case 17:\r\n          return 'kRampStraight';\r\n        case 18:\r\n          return 'kRampRight';\r\n        case 19:\r\n          return 'kRampLeft';\r\n        case 20:\r\n          return 'kExitRight';\r\n        case 21:\r\n          return 'kExitLeft';\r\n        case 22:\r\n          return 'kStayStraight';\r\n        case 23:\r\n          return 'kStayRight';\r\n        case 24:\r\n          return 'kStayLeft';\r\n        case 25:\r\n          return 'kMerge';\r\n        case 26:\r\n          return 'kRoundaboutEnter';\r\n        case 27:\r\n          return 'kRoundaboutExit';\r\n        case 28:\r\n          return 'kFerryEnter';\r\n        case 29:\r\n          return 'kFerryExit';\r\n        // lrm-mapzen unifies transit commands and give them same icons\r\n        case 30:\r\n        case 31: //'kTransitTransfer'\r\n        case 32: //'kTransitRemainOn'\r\n        case 33: //'kTransitConnectionStart'\r\n        case 34: //'kTransitConnectionTransfer'\r\n        case 35: //'kTransitConnectionDestination'\r\n        case 36: //'kTransitConnectionDestination'\r\n          if (instr.edited_travel_type) return 'kTransit' + this._getCapitalizedName(instr.edited_travel_type);\r\n          else return 'kTransit';\r\n      }\r\n    },\r\n\r\n    _getInstructionTemplate: function(instr, i) {\r\n      return instr.instruction + \" \" +instr.length;\r\n    },\r\n    _getCapitalizedName: function(name) {\r\n      return name.charAt(0).toUpperCase() + name.slice(1);\r\n    }\r\n  });\r\n\r\n})();\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{}],5:[function(require,module,exports){\r\n(function (global){\r\n(function() {\r\n\t'use strict';\r\n\r\n\tvar L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\r\n\r\n\tmodule.exports = L.LayerGroup.extend({\r\n\t\tincludes: L.Mixin.Events,\r\n\r\n\t\toptions: {\r\n\t\t\tstyles: [\r\n\t\t\t\t{color: 'black', opacity: 0.15, weight: 9},\r\n\t\t\t\t{color: 'white', opacity: 0.8, weight: 6},\r\n\t\t\t\t{color: 'red', opacity: 1, weight: 2}\r\n\t\t\t],\r\n\t\t\tmissingRouteStyles: [\r\n\t\t\t\t{color: 'black', opacity: 0.15, weight: 7},\r\n\t\t\t\t{color: 'white', opacity: 0.6, weight: 4},\r\n\t\t\t\t{color: 'gray', opacity: 0.8, weight: 2, dashArray: '7,12'}\r\n\t\t\t],\r\n\t\t\taddWaypoints: true,\r\n\t\t\textendToWaypoints: true,\r\n\t\t\tmissingRouteTolerance: 10\r\n\t\t},\r\n\r\n\t\tinitialize: function(route, options) {\r\n\t\t\tL.setOptions(this, options);\r\n\t\t\tL.LayerGroup.prototype.initialize.call(this, options);\r\n\t\t\tthis._route = route;\r\n\r\n\t\t\tif (this.options.extendToWaypoints) {\r\n\t\t\t\tthis._extendToWaypoints();\r\n\t\t\t}\r\n\r\n\t\t\tif (route.subRoutes) {\r\n\t\t\t\tfor(var i = 0; i < route.subRoutes.length; i++) {\r\n\t\t\t\t\tif(!route.subRoutes[i].styles) route.subRoutes[i].styles = this.options.styles;\r\n\t\t\t\t\tthis._addSegment(\r\n\t\t\t\t\t\troute.subRoutes[i].coordinates,\r\n\t\t\t\t\t\troute.subRoutes[i].styles,\r\n\t\t\t\t\t\tthis.options.addWaypoints);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t this._addSegment(\r\n\t\t\t \troute.coordinates,\r\n\t\t\t \tthis.options.styles,\r\n\t\t\t \tthis.options.addWaypoints);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\taddTo: function(map) {\r\n\t\t\tmap.addLayer(this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tgetBounds: function() {\r\n\t\t\treturn L.latLngBounds(this._route.coordinates);\r\n\t\t},\r\n\r\n\t\t_findWaypointIndices: function() {\r\n\t\t\tvar wps = this._route.inputWaypoints,\r\n\t\t\t    indices = [],\r\n\t\t\t    i;\r\n\t\t\tfor (i = 0; i < wps.length; i++) {\r\n\t\t\t\tindices.push(this._findClosestRoutePoint(wps[i].latLng));\r\n\t\t\t}\r\n\r\n\t\t\treturn indices;\r\n\t\t},\r\n\r\n\t\t_findClosestRoutePoint: function(latlng) {\r\n\t\t\tvar minDist = Number.MAX_VALUE,\r\n\t\t\t\tminIndex,\r\n\t\t\t    i,\r\n\t\t\t    d;\r\n\r\n\t\t\tfor (i = this._route.coordinates.length - 1; i >= 0 ; i--) {\r\n\t\t\t\t// TODO: maybe do this in pixel space instead?\r\n\t\t\t\td = latlng.distanceTo(this._route.coordinates[i]);\r\n\t\t\t\tif (d < minDist) {\r\n\t\t\t\t\tminIndex = i;\r\n\t\t\t\t\tminDist = d;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn minIndex;\r\n\t\t},\r\n\r\n\t\t_extendToWaypoints: function() {\r\n\t\t\tvar wps = this._route.inputWaypoints,\r\n\t\t\t\twpIndices = this._getWaypointIndices(),\r\n\t\t\t    i,\r\n\t\t\t    wpLatLng,\r\n\t\t\t    routeCoord;\r\n\r\n\t\t\tfor (i = 0; i < wps.length; i++) {\r\n\t\t\t\twpLatLng = wps[i].latLng;\r\n\t\t\t\trouteCoord = L.latLng(this._route.coordinates[wpIndices[i]]);\r\n\t\t\t\tif (wpLatLng.distanceTo(routeCoord) >\r\n\t\t\t\t\tthis.options.missingRouteTolerance) {\r\n\t\t\t\t\tthis._addSegment([wpLatLng, routeCoord],\r\n\t\t\t\t\t\tthis.options.missingRouteStyles);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addSegment: function(coords, styles, mouselistener) {\r\n\t\t\tvar i,\r\n\t\t\t\tpl;\r\n\t\t\tfor (i = 0; i < styles.length; i++) {\r\n\t\t\t\tpl = L.polyline(coords, styles[i]);\r\n\t\t\t\tthis.addLayer(pl);\r\n\t\t\t\tif (mouselistener) {\r\n\t\t\t\t\tpl.on('mousedown', this._onLineTouched, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_findNearestWpBefore: function(i) {\r\n\t\t\tvar wpIndices = this._getWaypointIndices(),\r\n\t\t\t\tj = wpIndices.length - 1;\r\n\t\t\twhile (j >= 0 && wpIndices[j] > i) {\r\n\t\t\t\tj--;\r\n\t\t\t}\r\n\r\n\t\t\treturn j;\r\n\t\t},\r\n\r\n\t\t_onLineTouched: function(e) {\r\n\t\t\tvar afterIndex = this._findNearestWpBefore(this._findClosestRoutePoint(e.latlng));\r\n\t\t\tthis.fire('linetouched', {\r\n\t\t\t\tafterIndex: afterIndex,\r\n\t\t\t\tlatlng: e.latlng\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_getWaypointIndices: function() {\r\n\t\t\tif (!this._wpIndices) {\r\n\t\t\t\tthis._wpIndices = this._route.waypointIndices || this._findWaypointIndices();\r\n\t\t\t}\r\n\r\n\t\t\treturn this._wpIndices;\r\n\t\t}\r\n\t});\r\n\r\n})();\r\n\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{}],6:[function(require,module,exports){\r\n(function (global){\r\n(function() {\r\n  'use strict';\r\n\r\n  var L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\r\n  var corslite = require('corslite');\r\n  var polyline = require('polyline');\r\n\r\n  var Waypoint = require('./waypoint');\r\n\r\n  module.exports = L.Class.extend({\r\n    options: {\r\n      timeout: 30 * 1000\r\n    },\r\n\r\n    initialize: function(accessToken, options) {\r\n      L.Util.setOptions(this, options);\r\n      this._accessToken = accessToken;\r\n      this._hints = {\r\n        locations: {}\r\n      };\r\n    },\r\n\r\n    route: function(waypoints, callback, context, options) {\r\n      var timedOut = false,\r\n        wps = [],\r\n        routeOptions = {},\r\n        url,\r\n        timer,\r\n        wp,\r\n        i;\r\n\r\n      routeOptions = this.options || {};\r\n      //waypoints = options.waypoints || waypoints;\r\n\r\n      url = this.buildRouteUrl(waypoints, routeOptions);\r\n\r\n      timer = setTimeout(function() {\r\n                timedOut = true;\r\n                callback.call(context || callback, {\r\n                  status: -1,\r\n                  message: 'Time out.'\r\n                });\r\n              }, this.options.timeout);\r\n\r\n      // Create a copy of the waypoints, since they\r\n      // might otherwise be asynchronously modified while\r\n      // the request is being processed.\r\n      for (i = 0; i < waypoints.length; i++) {\r\n        wp = waypoints[i];\r\n        wps.push(new Waypoint(L.latLng(wp.latLng), wp.name || \"\", wp.options || {}))\r\n      }\r\n\r\n      corslite(url, L.bind(function(err, resp) {\r\n        var data;\r\n\r\n        clearTimeout(timer);\r\n        if (!timedOut) {\r\n          if (!err) {\r\n            data = JSON.parse(resp.responseText);\r\n            this._routeDone(data, wps, routeOptions, callback, context);\r\n          } else {\r\n            console.log(\"Error : \" + err.response);\r\n            callback.call(context || callback, {\r\n              status: err.status,\r\n              message: err.response\r\n            });\r\n          }\r\n        }\r\n      }, this), true);\r\n\r\n      return this;\r\n    },\r\n\r\n    _routeDone: function(response, inputWaypoints, routeOptions, callback, context) {\r\n\r\n      var coordinates,\r\n          alts,\r\n          actualWaypoints,\r\n          i;\r\n      context = context || callback;\r\n      if (response.trip.status !== 0) {\r\n        callback.call(context, {\r\n          status: response.status,\r\n          message: response.status_message\r\n        });\r\n        return;\r\n      }\r\n\r\n      var insts = [];\r\n      var coordinates = [];\r\n      var shapeIndex =  0;\r\n\r\n      for(var i = 0; i < response.trip.legs.length; i++){\r\n        var coord = polyline.decode(response.trip.legs[i].shape, 6);\r\n\r\n        for(var k = 0; k < coord.length; k++){\r\n          coordinates.push(L.latLng(coord[k][0], coord[k][1]));\r\n        }\r\n\r\n        for(var j =0; j < response.trip.legs[i].maneuvers.length; j++){\r\n          var res = response.trip.legs[i].maneuvers[j];\r\n          res.distance = response.trip.legs[i].maneuvers[j][\"length\"];\r\n          res.index = shapeIndex + response.trip.legs[i].maneuvers[j][\"begin_shape_index\"];\r\n          insts.push(res);\r\n        }\r\n\r\n        if(routeOptions.costing === 'multimodal') insts = this._unifyTransitManeuver(insts);\r\n\r\n        shapeIndex += response.trip.legs[i].maneuvers[response.trip.legs[i].maneuvers.length-1][\"begin_shape_index\"];\r\n      }\r\n\r\n      actualWaypoints = this._toWaypoints(inputWaypoints, response.trip.locations);\r\n\r\n      var subRoutes;\r\n      if(routeOptions.costing == 'multimodal') subRoutes = this._getSubRoutes(response.trip.legs)\r\n\r\n      alts = [{\r\n        name: this._trimLocationKey(inputWaypoints[0].latLng) + \" , \" + this._trimLocationKey(inputWaypoints[1].latLng) ,\r\n        unit: response.trip.units,\r\n        costing: routeOptions.costing,\r\n        coordinates: coordinates,\r\n        subRoutes: subRoutes,\r\n        instructions: insts,//response.route_instructions ? this._convertInstructions(response.route_instructions) : [],\r\n        summary: response.trip.summary ? this._convertSummary(response.trip.summary) : [],\r\n        inputWaypoints: inputWaypoints,\r\n        waypoints: actualWaypoints,\r\n        waypointIndices: this._clampIndices([0,response.trip.legs[0].maneuvers.length], coordinates)\r\n      }];\r\n\r\n      // only versions <4.5.0 will support this flag\r\n        if (response.hint_data) {\r\n          this._saveHintData(response.hint_data, inputWaypoints);\r\n        }\r\n      callback.call(context, null, alts);\r\n    },\r\n\r\n    // lrm mapzen is trying to unify manuver of subroutes,\r\n    // travle type number including transit routing is > 30 including entering the station, exiting the station\r\n    // look at the api docs for more info (docs link coming soon)\r\n    _unifyTransitManeuver: function(insts) {\r\n\r\n      var transitType;\r\n      var newInsts = insts;\r\n\r\n      for(var i = 0; i < newInsts.length; i++) {\r\n        if(newInsts[i].type == 30) {\r\n          transitType = newInsts[i].travel_type;\r\n          break;\r\n        }\r\n      }\r\n\r\n      for(var j = 0; j < newInsts.length; j++) {\r\n        if(newInsts[j].type > 29) newInsts[j].edited_travel_type = transitType;\r\n      }\r\n\r\n      return newInsts;\r\n\r\n    },\r\n\r\n    //creates section of the polyline based on change of travel mode for multimodal\r\n    _getSubRoutes: function(legs) {\r\n\r\n      var subRoute = [];\r\n\r\n      for (var i = 0; i < legs.length; i++) {\r\n\r\n        var coords = polyline.decode(legs[i].shape, 6);\r\n\r\n        var lastTravelType;\r\n        var transitIndices = [];\r\n        for(var j = 0; j < legs[i].maneuvers.length; j++){\r\n\r\n          var res = legs[i].maneuvers[j];\r\n          var travelType = res.travel_type;\r\n\r\n          if(travelType !== lastTravelType || res.type === 31 /*this is for transfer*/) {\r\n            //transit_info only exists in the transit maneuvers\r\n            //loop thru maneuvers and populate indices array with begin shape index\r\n            //also populate subRoute array to contain the travel type & color associated with the transit polyline sub-section\r\n            //otherwise just populate with travel type and use fallback style\r\n            if(res.begin_shape_index > 0) transitIndices.push(res.begin_shape_index);\r\n            if(res.transit_info) subRoute.push({ travel_type: travelType, styles: this._getPolylineColor(res.transit_info.color) })\r\n            else subRoute.push({travel_type: travelType})\r\n          }\r\n\r\n          lastTravelType = travelType;\r\n        }\r\n\r\n        //add coords length to indices array\r\n        transitIndices.push(coords.length);\r\n\r\n        //logic to create the subsets of the polyline by indexing into the shape\r\n        var index_marker = 0;\r\n        for(var index = 0; index < transitIndices.length; index++) {\r\n          var subRouteArr = [];\r\n          var overwrapping = 0;\r\n          //if index != the last indice, we want to overwrap (or add 1) so that routes connect\r\n          if(index !== transitIndices.length-1) overwrapping = 1;\r\n          for (var ti = index_marker; ti < transitIndices[index] + overwrapping; ti++){\r\n            subRouteArr.push(coords[ti]);\r\n          }\r\n\r\n          var temp_array = subRouteArr;\r\n          index_marker = transitIndices[index];\r\n          subRoute[index].coordinates = temp_array;\r\n        }\r\n      }\r\n      return subRoute;\r\n    },\r\n\r\n    _getPolylineColor: function(intColor) {\r\n\r\n      // isolate red, green, and blue components\r\n      var red = (intColor >> 16) & 0xff,\r\n          green = (intColor >> 8) & 0xff,\r\n          blue = (intColor >> 0) & 0xff;\r\n\r\n      // calculate luminance in YUV colorspace based on\r\n      // https://en.wikipedia.org/wiki/YUV#Conversion_to.2Ffrom_RGB\r\n      var lum = 0.299 * red + 0.587 * green + 0.114 * blue,\r\n          is_light = (lum > 0xbb);\r\n\r\n      // generate a CSS color string like 'RRGGBB'\r\n      var paddedHex = 0x1000000 | (intColor & 0xffffff),\r\n          lineColor = paddedHex.toString(16).substring(1, 7);\r\n\r\n      var polylineColor = [\r\n              // Color of outline depending on luminance against background.\r\n              (is_light ? {color: '#000', opacity: 0.4, weight: 10}\r\n                        : {color: '#fff', opacity: 0.8, weight: 10}),\r\n\r\n              // Color of the polyline subset.\r\n              {color: '#'+lineColor.toUpperCase(), opacity: 1, weight: 6}\r\n            ]\r\n\r\n      return polylineColor;\r\n   },\r\n\r\n\r\n    _saveHintData: function(hintData, waypoints) {\r\n      var loc;\r\n      this._hints = {\r\n        checksum: hintData.checksum,\r\n        locations: {}\r\n      };\r\n      for (var i = hintData.locations.length - 1; i >= 0; i--) {\r\n        loc = waypoints[i].latLng;\r\n        this._hints.locations[this._locationKey(loc)] = hintData.locations[i];\r\n      }\r\n    },\r\n\r\n    _toWaypoints: function(inputWaypoints, vias) {\r\n      var wps = [],\r\n          i;\r\n      for (i = 0; i < vias.length; i++) {\r\n        wps.push(new Waypoint(L.latLng([vias[i][\"lat\"],vias[i][\"lon\"]]),\r\n                                    \"name\",\r\n                                    {}));\r\n      }\r\n\r\n      return wps;\r\n    },\r\n    ///mapzen example\r\n    buildRouteUrl: function(waypoints, options) {\r\n      var serviceUrl = 'https://valhalla.mapzen.com';\r\n      var locs = [],\r\n          locationKey,\r\n          hint;\r\n\r\n      var costing = options.costing;\r\n      var costingOptions = options.costing_options;\r\n      var directionsOptions = options.directions_options;\r\n      var dateTime = options.date_time;\r\n\r\n      for (var i = 0; i < waypoints.length; i++) {\r\n        var loc;\r\n        locationKey = this._locationKey(waypoints[i].latLng).split(',');\r\n        if(i === 0 || i === waypoints.length-1){\r\n          loc = {\r\n            lat: parseFloat(locationKey[0]),\r\n            lon: parseFloat(locationKey[1]),\r\n            type: \"break\"\r\n          }\r\n        }else{\r\n          loc = {\r\n            lat: parseFloat(locationKey[0]),\r\n            lon: parseFloat(locationKey[1]),\r\n            type: \"through\"\r\n          }\r\n        }\r\n        locs.push(loc);\r\n      }\r\n\r\n      var params = JSON.stringify({\r\n        locations: locs,\r\n        costing: costing,\r\n        costing_options: costingOptions,\r\n        directions_options: directionsOptions,\r\n        date_time: dateTime\r\n     });\r\n\r\n      return serviceUrl + '/route?json=' +\r\n              params + '&api_key=' + this._accessToken;\r\n    },\r\n\r\n    _locationKey: function(location) {\r\n      return location.lat + ',' + location.lng;\r\n    },\r\n\r\n    _trimLocationKey: function(location){\r\n      var lat = location.lat;\r\n      var lng = location.lng;\r\n\r\n      var nameLat = Math.floor(location.lat * 1000)/1000;\r\n      var nameLng = Math.floor(location.lng * 1000)/1000;\r\n\r\n      return nameLat + ' , ' + nameLng;\r\n\r\n    },\r\n\r\n    _convertSummary: function(route) {\r\n      return {\r\n        totalDistance: route.length,\r\n        totalTime: route.time\r\n      };\r\n    },\r\n\r\n    _convertInstructions: function(instructions) {\r\n      var result = [],\r\n          i,\r\n          instr,\r\n          type,\r\n          driveDir;\r\n\r\n      for (i = 0; i < instructions.length; i++) {\r\n        instr = instructions[i];\r\n        type = this._drivingDirectionType(instr[0]);\r\n        driveDir = instr[0].split('-');\r\n        if (type) {\r\n          result.push({\r\n            type: type,\r\n            distance: instr[2],\r\n            time: instr[4],\r\n            road: instr[1],\r\n            direction: instr[6],\r\n            exit: driveDir.length > 1 ? driveDir[1] : undefined,\r\n            index: instr[3]\r\n          });\r\n        }\r\n      }\r\n      return result;\r\n    },\r\n\r\n    _clampIndices: function(indices, coords) {\r\n      var maxCoordIndex = coords.length - 1,\r\n        i;\r\n      for (i = 0; i < indices.length; i++) {\r\n        indices[i] = Math.min(maxCoordIndex, Math.max(indices[i], 0));\r\n      }\r\n    }\r\n  });\r\n\r\n})();\r\n\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{\"./waypoint\":7,\"corslite\":1,\"polyline\":2}],7:[function(require,module,exports){\r\n(function (global){\r\n(function() {\r\n  'use strict';\r\n\r\n  var L = (typeof window !== \"undefined\" ? window['L'] : typeof global !== \"undefined\" ? global['L'] : null);\r\n\r\n  module.exports = L.Class.extend({\r\n    options: {\r\n      allowUTurn: false,\r\n    },\r\n    initialize: function(latLng, name, options) {\r\n      L.Util.setOptions(this, options);\r\n      this.latLng = L.latLng(latLng);\r\n      this.name = name;\r\n    }\r\n  });\r\n})();\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{}]},{},[3,4,5,6,7]);\r\n","(function (factory) {\r\n\t// Packaging/modules magic dance\r\n\tvar L;\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\t// AMD\r\n\t\tdefine(['leaflet'], factory);\r\n\t} else if (typeof module !== 'undefined') {\r\n\t\t// Node/CommonJS\r\n\t\tL = require('leaflet');\r\n\t\tmodule.exports = factory(L);\r\n\t} else {\r\n\t\t// Browser globals\r\n\t\tif (typeof window.L === 'undefined')\r\n\t\t\tthrow 'Leaflet must be loaded first';\r\n\t\tfactory(window.L);\r\n\t}\r\n}(function (L) {\r\n\t'use strict';\r\n\tL.Control.Geocoder = L.Control.extend({\r\n\t\toptions: {\r\n\t\t\tshowResultIcons: false,\r\n\t\t\tcollapsed: true,\r\n\t\t\texpand: 'click',\r\n\t\t\tposition: 'topright',\r\n\t\t\tplaceholder: 'Search...',\r\n\t\t\terrorMessage: 'Nothing found.'\r\n\t\t},\r\n\r\n\t\t_callbackId: 0,\r\n\r\n\t\tinitialize: function (options) {\r\n\t\t\tL.Util.setOptions(this, options);\r\n\t\t\tif (!this.options.geocoder) {\r\n\t\t\t\tthis.options.geocoder = new L.Control.Geocoder.Nominatim();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonAdd: function (map) {\r\n\t\t\tvar className = 'leaflet-control-geocoder',\r\n\t\t\t    container = L.DomUtil.create('div', className),\r\n\t\t\t\ticon = L.DomUtil.create('div', 'leaflet-control-geocoder-icon', container),\r\n\t\t\t    form = this._form = L.DomUtil.create('form', className + '-form', container),\r\n\t\t\t    input;\r\n\r\n\t\t\tthis._map = map;\r\n\t\t\tthis._container = container;\r\n\t\t\tinput = this._input = L.DomUtil.create('input');\r\n\t\t\tinput.type = 'text';\r\n\t\t\tinput.placeholder = this.options.placeholder;\r\n\r\n\t\t\tL.DomEvent.addListener(input, 'keydown', this._keydown, this);\r\n\t\t\t//L.DomEvent.addListener(input, 'onpaste', this._clearResults, this);\r\n\t\t\t//L.DomEvent.addListener(input, 'oninput', this._clearResults, this);\r\n\r\n\t\t\tthis._errorElement = document.createElement('div');\r\n\t\t\tthis._errorElement.className = className + '-form-no-error';\r\n\t\t\tthis._errorElement.innerHTML = this.options.errorMessage;\r\n\r\n\t\t\tthis._alts = L.DomUtil.create('ul', className + '-alternatives leaflet-control-geocoder-alternatives-minimized');\r\n\r\n\t\t\tform.appendChild(input);\r\n\t\t\tform.appendChild(this._errorElement);\r\n\t\t\tcontainer.appendChild(this._alts);\r\n\r\n\t\t\tL.DomEvent.addListener(form, 'submit', this._geocode, this);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tif (this.options.expand === 'click') {\r\n\t\t\t\t\tL.DomEvent.addListener(icon, 'click', function(e) {\r\n\t\t\t\t\t\t// TODO: touch\r\n\t\t\t\t\t\tif (e.button === 0 && e.detail !== 2) {\r\n\t\t\t\t\t\t\tthis._toggle();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tL.DomEvent.addListener(icon, 'mouseover', this._expand, this);\r\n\t\t\t\t\tL.DomEvent.addListener(icon, 'mouseout', this._collapse, this);\r\n\t\t\t\t\tthis._map.on('movestart', this._collapse, this);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._expand();\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.disableClickPropagation(container);\r\n\r\n\t\t\treturn container;\r\n\t\t},\r\n\r\n\t\t_geocodeResult: function (results) {\r\n\t\t\tL.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-throbber');\r\n\t\t\tif (results.length === 1) {\r\n\t\t\t\tthis._geocodeResultSelected(results[0]);\r\n\t\t\t} else if (results.length > 0) {\r\n\t\t\t\tthis._alts.innerHTML = '';\r\n\t\t\t\tthis._results = results;\r\n\t\t\t\tL.DomUtil.removeClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n\t\t\t\tfor (var i = 0; i < results.length; i++) {\r\n\t\t\t\t\tthis._alts.appendChild(this._createAlt(results[i], i));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tL.DomUtil.addClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmarkGeocode: function(result) {\r\n\t\t\tthis._map.fitBounds(result.bbox);\r\n\r\n\t\t\tif (this._geocodeMarker) {\r\n\t\t\t\tthis._map.removeLayer(this._geocodeMarker);\r\n\t\t\t}\r\n\r\n\t\t\tthis._geocodeMarker = new L.Marker(result.center)\r\n\t\t\t\t.bindPopup(result.html || result.name)\r\n\t\t\t\t.addTo(this._map)\r\n\t\t\t\t.openPopup();\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t_geocode: function(event) {\r\n\t\t\tL.DomEvent.preventDefault(event);\r\n\r\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-control-geocoder-throbber');\r\n\t\t\tthis._clearResults();\r\n\t\t\tthis.options.geocoder.geocode(this._input.value, this._geocodeResult, this);\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_geocodeResultSelected: function(result) {\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t} else {\r\n\t\t\t\tthis._clearResults();\r\n\t\t\t}\r\n\t\t\tthis.markGeocode(result);\r\n\t\t},\r\n\r\n\t\t_toggle: function() {\r\n\t\t\tif (this._container.className.indexOf('leaflet-control-geocoder-expanded') >= 0) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t} else {\r\n\t\t\t\tthis._expand();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_expand: function () {\r\n\t\t\tL.DomUtil.addClass(this._container, 'leaflet-control-geocoder-expanded');\r\n\t\t\tthis._input.select();\r\n\t\t},\r\n\r\n\t\t_collapse: function () {\r\n\t\t\tthis._container.className = this._container.className.replace(' leaflet-control-geocoder-expanded', '');\r\n\t\t\tL.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n\t\t\tL.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n\t\t},\r\n\r\n\t\t_clearResults: function () {\r\n\t\t\tL.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n\t\t\tthis._selection = null;\r\n\t\t\tL.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n\t\t},\r\n\r\n\t\t_createAlt: function(result, index) {\r\n\t\t\tvar li = document.createElement('li'),\r\n\t\t\t    a = L.DomUtil.create('a', '', li),\r\n\t\t\t    icon = this.options.showResultIcons && result.icon ? L.DomUtil.create('img', '', a) : null,\r\n\t\t\t    text = result.html ? undefined : document.createTextNode(result.name);\r\n\r\n\t\t\tif (icon) {\r\n\t\t\t\ticon.src = result.icon;\r\n\t\t\t}\r\n\r\n\t\t\ta.href = '#';\r\n\t\t\ta.setAttribute('data-result-index', index);\r\n\r\n\t\t\tif (result.html) {\r\n\t\t\t\ta.innerHTML = result.html;\r\n\t\t\t} else {\r\n\t\t\t\ta.appendChild(text);\r\n\t\t\t}\r\n\r\n\t\t\tL.DomEvent.addListener(li, 'click', function clickHandler(e) {\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t\tthis._geocodeResultSelected(result);\r\n\t\t\t}, this);\r\n\r\n\t\t\treturn li;\r\n\t\t},\r\n\r\n\t\t_keydown: function(e) {\r\n\t\t\tvar _this = this,\r\n\t\t\t\tselect = function select(dir) {\r\n\t\t\t\t\tif (_this._selection) {\r\n\t\t\t\t\t\tL.DomUtil.removeClass(_this._selection.firstChild, 'leaflet-control-geocoder-selected');\r\n\t\t\t\t\t\t_this._selection = _this._selection[dir > 0 ? 'nextSibling' : 'previousSibling'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!_this._selection) {\r\n\t\t\t\t\t\t_this._selection = _this._alts[dir > 0 ? 'firstChild' : 'lastChild'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (_this._selection) {\r\n\t\t\t\t\t\tL.DomUtil.addClass(_this._selection.firstChild, 'leaflet-control-geocoder-selected');\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t// Escape\r\n\t\t\tcase 27:\r\n\t\t\t\tif (this.options.collapsed) {\r\n\t\t\t\t\tthis._collapse();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t// Up\r\n\t\t\tcase 38:\r\n\t\t\t\tselect(-1);\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t\tbreak;\r\n\t\t\t// Up\r\n\t\t\tcase 40:\r\n\t\t\t\tselect(1);\r\n\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t\tbreak;\r\n\t\t\t// Enter\r\n\t\t\tcase 13:\r\n\t\t\t\tif (this._selection) {\r\n\t\t\t\t\tvar index = parseInt(this._selection.firstChild.getAttribute('data-result-index'), 10);\r\n\t\t\t\t\tthis._geocodeResultSelected(this._results[index]);\r\n\t\t\t\t\tthis._clearResults();\r\n\t\t\t\t\tL.DomEvent.preventDefault(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.geocoder = function(id, options) {\r\n\t\treturn new L.Control.Geocoder(id, options);\r\n\t};\r\n\r\n\tL.Control.Geocoder.callbackId = 0;\r\n\tL.Control.Geocoder.jsonp = function(url, params, callback, context, jsonpParam) {\r\n\t\tvar callbackId = '_l_geocoder_' + (L.Control.Geocoder.callbackId++);\r\n\t\tparams[jsonpParam || 'callback'] = callbackId;\r\n\t\twindow[callbackId] = L.Util.bind(callback, context);\r\n\t\tvar script = document.createElement('script');\r\n\t\tscript.type = 'text/javascript';\r\n\t\tscript.src = url + L.Util.getParamString(params);\r\n\t\tscript.id = callbackId;\r\n\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\r\n\t};\r\n\tL.Control.Geocoder.getJSON = function(url, params, callback) {\r\n\t\tvar xmlHttp = new XMLHttpRequest();\r\n\t\txmlHttp.open( \"GET\", url + L.Util.getParamString(params), true);\r\n\t\txmlHttp.send(null);\r\n\t\txmlHttp.onreadystatechange = function () {\r\n\t\t\tif (xmlHttp.readyState != 4) return;\r\n\t\t\tif (xmlHttp.status != 200 && req.status != 304) return;\r\n\t\t\tcallback(JSON.parse(xmlHttp.response));\r\n\t\t};\r\n\t};\r\n\r\n\tL.Control.Geocoder.template = function (str, data, htmlEscape) {\r\n\t\treturn str.replace(/\\{ *([\\w_]+) *\\}/g, function (str, key) {\r\n\t\t\tvar value = data[key];\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvalue = '';\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\tvalue = value(data);\r\n\t\t\t}\r\n\t\t\treturn L.Control.Geocoder.htmlEscape(value);\r\n\t\t});\r\n\t};\r\n\r\n\t// Adapted from handlebars.js\r\n\t// https://github.com/wycats/handlebars.js/\r\n\tL.Control.Geocoder.htmlEscape = (function() {\r\n\t\tvar badChars = /[&<>\"'`]/g;\r\n\t\tvar possible = /[&<>\"'`]/;\r\n\t\tvar escape = {\r\n\t\t  '&': '&amp;',\r\n\t\t  '<': '&lt;',\r\n\t\t  '>': '&gt;',\r\n\t\t  '\"': '&quot;',\r\n\t\t  '\\'': '&#x27;',\r\n\t\t  '`': '&#x60;'\r\n\t\t};\r\n\r\n\t\tfunction escapeChar(chr) {\r\n\t\t  return escape[chr];\r\n\t\t}\r\n\r\n\t\treturn function(string) {\r\n\t\t\tif (string == null) {\r\n\t\t\t\treturn '';\r\n\t\t\t} else if (!string) {\r\n\t\t\t\treturn string + '';\r\n\t\t\t}\r\n\r\n\t\t\t// Force a string conversion as this will be done by the append regardless and\r\n\t\t\t// the regex test will do this transparently behind the scenes, causing issues if\r\n\t\t\t// an object's to string has escaped characters in it.\r\n\t\t\tstring = '' + string;\r\n\r\n\t\t\tif (!possible.test(string)) {\r\n\t\t\t\treturn string;\r\n\t\t\t}\r\n\t\t\treturn string.replace(badChars, escapeChar);\r\n\t\t};\r\n\t})();\r\n\r\n\tL.Control.Geocoder.Nominatim = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\tserviceUrl: '//nominatim.openstreetmap.org/',\r\n\t\t\tgeocodingQueryParams: {},\r\n\t\t\treverseQueryParams: {},\r\n\t\t\thtmlTemplate: function(r) {\r\n\t\t\t\tvar a = r.address,\r\n\t\t\t\t\tparts = [];\r\n\t\t\t\tif (a.road || a.building) {\r\n\t\t\t\t\tparts.push('{building} {road} {house_number}');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (a.city || a.town || a.village) {\r\n\t\t\t\t\tparts.push('<span class=\"' + (parts.length > 0 ? 'leaflet-control-geocoder-address-detail' : '') +\r\n\t\t\t\t\t\t'\">{postcode} {city} {town} {village}</span>');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (a.state || a.country) {\r\n\t\t\t\t\tparts.push('<span class=\"' + (parts.length > 0 ? 'leaflet-control-geocoder-address-context' : '') +\r\n\t\t\t\t\t\t'\">{state} {country}</span>');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn L.Control.Geocoder.template(parts.join('<br/>'), a, true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitialize: function(options) {\r\n\t\t\tL.Util.setOptions(this, options);\r\n\t\t},\r\n\r\n\t\tgeocode: function(query, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp(this.options.serviceUrl + 'search/', L.extend({\r\n\t\t\t\tq: query,\r\n\t\t\t\tlimit: 5,\r\n\t\t\t\tformat: 'json',\r\n\t\t\t\taddressdetails: 1\r\n\t\t\t}, this.options.geocodingQueryParams),\r\n\t\t\tfunction(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor (var i = data.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar bbox = data[i].boundingbox;\r\n\t\t\t\t\tfor (var j = 0; j < 4; j++) bbox[j] = parseFloat(bbox[j]);\r\n\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\ticon: data[i].icon,\r\n\t\t\t\t\t\tname: data[i].display_name,\r\n\t\t\t\t\t\thtml: this.options.htmlTemplate ?\r\n\t\t\t\t\t\t\tthis.options.htmlTemplate(data[i])\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\tbbox: L.latLngBounds([bbox[0], bbox[2]], [bbox[1], bbox[3]]),\r\n\t\t\t\t\t\tcenter: L.latLng(data[i].lat, data[i].lon),\r\n\t\t\t\t\t\tproperties: data[i]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this, 'json_callback');\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp(this.options.serviceUrl + 'reverse/', L.extend({\r\n\t\t\t\tlat: location.lat,\r\n\t\t\t\tlon: location.lng,\r\n\t\t\t\tzoom: Math.round(Math.log(scale / 256) / Math.log(2)),\r\n\t\t\t\taddressdetails: 1,\r\n\t\t\t\tformat: 'json'\r\n\t\t\t}, this.options.reverseQueryParams), function(data) {\r\n\t\t\t\tvar result = [],\r\n\t\t\t\t    loc;\r\n\r\n\t\t\t\tif (data && data.lat && data.lon) {\r\n\t\t\t\t\tloc = L.latLng(data.lat, data.lon);\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\tname: data.display_name,\r\n\t\t\t\t\t\thtml: this.options.htmlTemplate ?\r\n\t\t\t\t\t\t\tthis.options.htmlTemplate(data)\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\tcenter: loc,\r\n\t\t\t\t\t\tbounds: L.latLngBounds(loc, loc),\r\n\t\t\t\t\t\tproperties: data\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcb.call(context, result);\r\n\t\t\t}, this, 'json_callback');\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.nominatim = function(options) {\r\n\t\treturn new L.Control.Geocoder.Nominatim(options);\r\n\t};\r\n\r\n\tL.Control.Geocoder.Bing = L.Class.extend({\r\n\t\tinitialize: function(key) {\r\n\t\t\tthis.key = key;\r\n\t\t},\r\n\r\n\t\tgeocode : function (query, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('//dev.virtualearth.net/REST/v1/Locations', {\r\n\t\t\t\tquery: query,\r\n\t\t\t\tkey : this.key\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor (var i = data.resourceSets[0].resources.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar resource = data.resourceSets[0].resources[i],\r\n\t\t\t\t\t\tbbox = resource.bbox;\r\n\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\tname: resource.name,\r\n\t\t\t\t\t\tbbox: L.latLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\r\n\t\t\t\t\t\tcenter: L.latLng(resource.point.coordinates)\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this, 'jsonp');\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('//dev.virtualearth.net/REST/v1/Locations/' + location.lat + ',' + location.lng, {\r\n\t\t\t\tkey : this.key\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor (var i = data.resourceSets[0].resources.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar resource = data.resourceSets[0].resources[i],\r\n\t\t\t\t\t\tbbox = resource.bbox;\r\n\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\tname: resource.name,\r\n\t\t\t\t\t\tbbox: L.latLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\r\n\t\t\t\t\t\tcenter: L.latLng(resource.point.coordinates)\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this, 'jsonp');\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.bing = function(key) {\r\n\t\treturn new L.Control.Geocoder.Bing(key);\r\n\t};\r\n\r\n\tL.Control.Geocoder.RaveGeo = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\tquerySuffix: '',\r\n\t\t\tdeepSearch: true,\r\n\t\t\twordBased: false\r\n\t\t},\r\n\r\n\t\tjsonp: function(params, callback, context) {\r\n\t\t\tvar callbackId = '_l_geocoder_' + (L.Control.Geocoder.callbackId++),\r\n\t\t\t\tparamParts = [];\r\n\t\t\tparams.prepend = callbackId + '(';\r\n\t\t\tparams.append = ')';\r\n\t\t\tfor (var p in params) {\r\n\t\t\t\tparamParts.push(p + '=' + escape(params[p]));\r\n\t\t\t}\r\n\r\n\t\t\twindow[callbackId] = L.Util.bind(callback, context);\r\n\t\t\tvar script = document.createElement('script');\r\n\t\t\tscript.type = 'text/javascript';\r\n\t\t\tscript.src = this._serviceUrl + '?' + paramParts.join('&');\r\n\t\t\tscript.id = callbackId;\r\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\r\n\t\t},\r\n\r\n\t\tinitialize: function(serviceUrl, scheme, options) {\r\n\t\t\tL.Util.setOptions(this, options);\r\n\r\n\t\t\tthis._serviceUrl = serviceUrl;\r\n\t\t\tthis._scheme = scheme;\r\n\t\t},\r\n\r\n\t\tgeocode: function(query, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp(this._serviceUrl, {\r\n\t\t\t\taddress: query + this.options.querySuffix,\r\n\t\t\t\tscheme: this._scheme,\r\n\t\t\t\toutputFormat: 'jsonp',\r\n\t\t\t\tdeepSearch: this.options.deepSearch,\r\n\t\t\t\twordBased: this.options.wordBased\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor (var i = data.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar r = data[i],\r\n\t\t\t\t\t\tc = L.latLng(r.y, r.x);\r\n\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\tname: r.address,\r\n\t\t\t\t\t\tbbox: L.latLngBounds([c]),\r\n\t\t\t\t\t\tcenter: c\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.raveGeo = function(serviceUrl, scheme, options) {\r\n\t\treturn new L.Control.Geocoder.RaveGeo(serviceUrl, scheme, options);\r\n\t};\r\n\r\n\tL.Control.Geocoder.MapQuest = L.Class.extend({\r\n\t\tinitialize: function(key) {\r\n\t\t\t// MapQuest seems to provide URI encoded API keys,\r\n\t\t\t// so to avoid encoding them twice, we decode them here\r\n\t\t\tthis._key = decodeURIComponent(key);\r\n\t\t},\r\n\r\n\t\t_formatName: function() {\r\n\t\t\tvar r = [],\r\n\t\t\t\ti;\r\n\t\t\tfor (i = 0; i < arguments.length; i++) {\r\n\t\t\t\tif (arguments[i]) {\r\n\t\t\t\t\tr.push(arguments[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn r.join(', ');\r\n\t\t},\r\n\r\n\t\tgeocode: function(query, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('//www.mapquestapi.com/geocoding/v1/address', {\r\n\t\t\t\tkey: this._key,\r\n\t\t\t\tlocation: query,\r\n\t\t\t\tlimit: 5,\r\n\t\t\t\toutFormat: 'json'\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [],\r\n\t\t\t\t\tloc,\r\n\t\t\t\t\tlatLng;\r\n\t\t\t\tif (data.results && data.results[0].locations) {\r\n\t\t\t\t\tfor (var i = data.results[0].locations.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tloc = data.results[0].locations[i];\r\n\t\t\t\t\t\tlatLng = L.latLng(loc.latLng);\r\n\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\tname: this._formatName(loc.street, loc.adminArea4, loc.adminArea3, loc.adminArea1),\r\n\t\t\t\t\t\t\tbbox: L.latLngBounds(latLng, latLng),\r\n\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('//www.mapquestapi.com/geocoding/v1/reverse', {\r\n\t\t\t\tkey: this._key,\r\n\t\t\t\tlocation: location.lat + ',' + location.lng,\r\n\t\t\t\toutputFormat: 'json'\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [],\r\n\t\t\t\t\tloc,\r\n\t\t\t\t\tlatLng;\r\n\t\t\t\tif (data.results && data.results[0].locations) {\r\n\t\t\t\t\tfor (var i = data.results[0].locations.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tloc = data.results[0].locations[i];\r\n\t\t\t\t\t\tlatLng = L.latLng(loc.latLng);\r\n\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\tname: this._formatName(loc.street, loc.adminArea4, loc.adminArea3, loc.adminArea1),\r\n\t\t\t\t\t\t\tbbox: L.latLngBounds(latLng, latLng),\r\n\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.mapQuest = function(key) {\r\n\t\treturn new L.Control.Geocoder.MapQuest(key);\r\n\t};\r\n\r\n\tL.Control.Geocoder.Mapbox = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\tservice_url: 'https://api.tiles.mapbox.com/v4/geocode/mapbox.places-v1/'\r\n\t\t},\r\n\r\n\t\tinitialize: function(access_token) {\r\n\t\t\tthis._access_token = access_token;\r\n\t\t},\r\n\r\n\t\tgeocode: function(query, cb, context) {\r\n\t\t\tL.Control.Geocoder.getJSON(this.options.service_url + encodeURIComponent(query) + '.json', {\r\n\t\t\t\taccess_token: this._access_token,\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [],\r\n\t\t\t\tloc,\r\n\t\t\t\tlatLng,\r\n\t\t\t\tlatLngBounds;\r\n\t\t\t\tif (data.features && data.features.length) {\r\n\t\t\t\t\tfor (var i = 0; i <= data.features.length - 1; i++) {\r\n\t\t\t\t\t\tloc = data.features[i];\r\n\t\t\t\t\t\tlatLng = L.latLng(loc.center.reverse());\r\n\t\t\t\t\t\tif(loc.hasOwnProperty('bbox'))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlatLngBounds = L.latLngBounds(L.latLng(loc.bbox.slice(0, 2).reverse()), L.latLng(loc.bbox.slice(2, 4).reverse()));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlatLngBounds = L.latLngBounds(latLng, latLng);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\t\tname: loc.place_name,\r\n\t\t\t\t\t\t\t\tbbox: latLngBounds,\r\n\t\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcb.call(context, results);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsuggest: function(query, cb, context) {\r\n\t\t\treturn this.geocode(query, cb, context);\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tL.Control.Geocoder.getJSON(this.options.service_url + encodeURIComponent(location.lng) + ',' + encodeURIComponent(location.lat) + '.json', {\r\n\t\t\t\taccess_token: this._access_token,\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [],\r\n\t\t\t\tloc,\r\n\t\t\t\tlatLng,\r\n\t\t\t\tlatLngBounds;\r\n\t\t\t\tif (data.features && data.features.length) {\r\n\t\t\t\t\tfor (var i = 0; i <= data.features.length - 1; i++) {\r\n\t\t\t\t\t\tloc = data.features[i];\r\n\t\t\t\t\t\tlatLng = L.latLng(loc.center.reverse());\r\n\t\t\t\t\t\tif(loc.hasOwnProperty('bbox'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlatLngBounds = L.latLngBounds(L.latLng(loc.bbox.slice(0, 2).reverse()), L.latLng(loc.bbox.slice(2, 4).reverse()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlatLngBounds = L.latLngBounds(latLng, latLng);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\tname: loc.place_name,\r\n\t\t\t\t\t\t\tbbox: latLngBounds,\r\n\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.mapbox = function(access_token) {\r\n\t\t\treturn new L.Control.Geocoder.Mapbox(access_token);\r\n\t};\r\n\r\n\tL.Control.Geocoder.Google = L.Class.extend({\r\n\t\toptions: {\r\n\t\t\tservice_url: 'https://maps.googleapis.com/maps/api/geocode/json'\r\n\t\t},\r\n\r\n\t\tinitialize: function(key) {\r\n\t\t\t\tthis._key = key;\r\n\t\t},\r\n\r\n\t\tgeocode: function(query, cb, context) {\r\n\t\t\tvar params = {\r\n\t\t\t\taddress: query,\r\n\t\t\t};\r\n\t\t\tif(this._key && this._key.length)\r\n\t\t\t{\r\n\t\t\t\tparams['key'] = this._key\r\n\t\t\t}\r\n\r\n\t\t\tL.Control.Geocoder.getJSON(this.options.service_url, params, function(data) {\r\n\t\t\t\t\tvar results = [],\r\n\t\t\t\t\t\t\tloc,\r\n\t\t\t\t\t\t\tlatLng,\r\n\t\t\t\t\t\t\tlatLngBounds;\r\n\t\t\t\t\tif (data.results && data.results.length) {\r\n\t\t\t\t\t\tfor (var i = 0; i <= data.results.length - 1; i++) {\r\n\t\t\t\t\t\t\tloc = data.results[i];\r\n\t\t\t\t\t\t\tlatLng = L.latLng(loc.geometry.location);\r\n\t\t\t\t\t\t\tlatLngBounds = L.latLngBounds(L.latLng(loc.geometry.viewport.northeast), L.latLng(loc.geometry.viewport.southwest));\r\n\t\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\t\t\tname: loc.formatted_address,\r\n\t\t\t\t\t\t\t\t\tbbox: latLngBounds,\r\n\t\t\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcb.call(context, results);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tvar params = {\r\n\t\t\t\tlatlng: encodeURIComponent(location.lat) + ',' + encodeURIComponent(location.lng)\r\n\t\t\t};\r\n\t\t\tif(this._key && this._key.length)\r\n\t\t\t{\r\n\t\t\t\tparams['key'] = this._key\r\n\t\t\t}\r\n\t\t\tL.Control.Geocoder.getJSON(this.options.service_url, params, function(data) {\r\n\t\t\t\tvar results = [],\r\n\t\t\t\t\t\tloc,\r\n\t\t\t\t\t\tlatLng,\r\n\t\t\t\t\t\tlatLngBounds;\r\n\t\t\t\tif (data.results && data.results.length) {\r\n\t\t\t\t\tfor (var i = 0; i <= data.results.length - 1; i++) {\r\n\t\t\t\t\t\tloc = data.results[i];\r\n\t\t\t\t\t\tlatLng = L.latLng(loc.geometry.location);\r\n\t\t\t\t\t\tlatLngBounds = L.latLngBounds(L.latLng(loc.geometry.viewport.northeast), L.latLng(loc.geometry.viewport.southwest));\r\n\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\tname: loc.formatted_address,\r\n\t\t\t\t\t\t\tbbox: latLngBounds,\r\n\t\t\t\t\t\t\tcenter: latLng\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.google = function(key) {\r\n\t\treturn new L.Control.Geocoder.Google(key);\r\n\t};\r\n\t\r\n\tL.Control.Geocoder.ICGC = L.Class.extend({\r\n\t\tinitialize: function() {\r\n\t\t\r\n\t\t},\r\n\r\n\t\tgeocode : function (query, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('http://www.icc.cat/geocodificador/json', {\r\n\t\t\t\tmetode: 'cercaCaixaUnica',\r\n\t\t\t\tentrada : query,\r\n\t\t\t\tconfiguracio: 4,\r\n\t\t\t\tobtenirCoordGeografiques:'si'\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tvar resultsIndex=0;\r\n\t\t\t\tif (data.length==0){\r\n\t\t\t\t\t new L.Control.Geocoder.nominatim().geocode(query,cb,context);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tfor (var i = 0; i <=data.length; i++) {\r\n\t\t\t\t\t\tvar resource = data[i];\r\n\t\t\t\t\t\tif (resource!=null){\r\n\t\t\t\t\t\t\tfor (var j=resource.length-1;j>=0;j--){\r\n\t\t\t\t\t\t\t\tif (resource[j].adrecaXY!=undefined) {\r\n\t\t\t\t\t\t\t\t\tresults[resultsIndex] = {\r\n\t\t\t\t\t\t\t\t\t\tname: resource[j].adrecaXY,\r\n\t\t\t\t\t\t\t\t\t\tcenter: L.latLng(resource[j].coordenadesETRS89LonLat.y,resource[j].coordenadesETRS89LonLat.x)\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresults[resultsIndex] = {\r\n\t\t\t\t\t\t\t\t\t\t\tname: resource[j].nom,\r\n\t\t\t\t\t\t\t\t\t\t\tcenter: L.latLng(resource[j].coordenadesETRS89LonLat.y,resource[j].coordenadesETRS89LonLat.x)\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresultsIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (results.length==0){\r\n\t\t\t\t\tnew L.Control.Geocoder.nominatim().geocode(query, cb, context);\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this, 'jsonp');\r\n\t\t},\r\n\r\n\t\treverse: function(location, scale, cb, context) {\r\n\t\t\tL.Control.Geocoder.jsonp('http://www.icc.cat/geocodificador/json' , {\r\n\t\t\t\tmetode: 'geocodificacioInversa',\r\n\t\t\t\tx_lonlatetrs89:location.lng,\r\n\t\t\t\ty_lonlatetrs89:location.lat\r\n\t\t\t\t\r\n\t\t\t}, function(data) {\r\n\t\t\t\tvar results = [];\r\n\t\t\t\tfor (var i = data.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tvar resource = data[i];\r\n\t\t\t\t\tif (resource.incidencia){\r\n\t\t\t\t\t\t new L.Control.Geocoder.nominatim().reverse(location,scale,cb,context);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tvar resultStr=\"\";\r\n\t\t\t\t\t\tif (resource.via!=null && resource.via!=\"\\\"null\\\"\") resultStr += resource.via+ \" \";\r\n\t\t\t\t\t\tif (resource.portalSenar!=null && resource.portalSenar!=\"\\\"null\\\"\") resultStr += resource.portalSenar+\" \";\r\n\t\t\t\t\t\tif (resource.portalParell!=null && resource.portalParell!=\"\\\"null\\\"\") resultStr += resource.portalParell+\" \";\r\n\t\t\t\t\t\tif (resource.municipi!=null && resource.municipi!=\"\\\"null\\\"\")  {\r\n\t\t\t\t\t\t\tif (resultStr!=\"\") resultStr +=\",\";\r\n\t\t\t\t\t\t\tresultStr+=\" \"+resource.municipi;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresults[i] = {\r\n\t\t\t\t\t\t\tname: resultStr,\r\n\t\t\t\t\t\t\t//bbox: L.latLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\r\n\t\t\t\t\t\t\tcenter: L.latLng(location.lat,location.lng)\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcb.call(context, results);\r\n\t\t\t}, this, 'jsonp');\r\n\t\t}\r\n\t});\r\n\r\n\tL.Control.Geocoder.icgc = function() {\r\n\t\treturn new L.Control.Geocoder.ICGC();\r\n\t};\r\n\treturn L.Control.Geocoder;\r\n}));\r\n"]}