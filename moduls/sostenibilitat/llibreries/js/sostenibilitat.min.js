(function(l){l.Sostenibilitat=function(){this.Edificis="Edificis";this.Teulades="Teulades";this.UNITS={};this.UNITS.kWh_any="kWh/any";this.UNITS.kWh_pic="kW pic";this.UNITS.m2="m&sup2;";this.UNITS.euro="&euro;";this.UNITS.euro_any="&euro;/any";this.UNITS.anys="anys";this.UNITS.kg_any="kg/any";this.UNITS.graus="&deg;";this.UNITS.percent="%";this.UNITS.euro_kwh="&euro;/kWh";this.UNITS.euro_panell="&euro;/panell";this.CONST_degradacio_panells=[1,.991113974,.98230691,.973578105,.964926865,.9563525,.947854327,
.939431669,.931083855,.922810219,.914610104,.906482855,.898427825,.890444372,.88253186,.874689659,.866917144,.859213696,.851578701,.844011551,.836511642,.829078378,.821711166,.814409419,.807172556,.8];this.matriu_preu_electricitat_fv=[.17,.17822204,.188915362,.200250284,.212265301,.225001219,.238501292,.25281137,.267980052,.284058855,.301102387,.31916853,.338318642,.35861776,.380134826,.402942915,.42711949,.45274666,.479911459,.508706147,.539228515,.571582226,.60587716,.64222979,.680763577,.721609392];
this.getPotencialFotovoltaicEdificis=function(a,b){return this.calculaPotencialFotovoltaic(a,b,this.Edificis,!1)};this.getPotencialFotovoltaicTeulades=function(a,b){return this.calculaPotencialFotovoltaic(a,b,this.Teulades,!1)};this.getTermoSolarEdificis=function(a,b){return this.calculaPotencialSolarTermic(a,b,this.Edificis,!1)};this.getTermoSolarTeulades=function(a,b){return this.calculaPotencialSolarTermic(a,b,this.Teulades,!1)};this.getPotencialFotovoltaicEdificisDebug=function(a,b){return this.calculaPotencialFotovoltaic(a,
b,this.Edifici,!0)};this.getPotencialFotovoltaicTeuladesDebug=function(a,b){return this.calculaPotencialFotovoltaic(a,b,this.Teulades,!0)};this.getTermoSolarEdificisDebug=function(a,b){return this.calculaPotencialSolarTermic(a,b,this.Edificis,!0)};this.getTermoSolarTeuladesDebug=function(a,b){return this.calculaPotencialSolarTermic(a,b,this.Teulades,!0)};this.calculaPotencialSolarTermic=function(a,b,d,e){b?this.TS=b:this.TS={};this.TS.RESULT||(this.TS.RESULT={});this.TS.RESULT.INPUT||(this.TS.RESULT.INPUT=
{});this.TS.RESULT.OUTPUT||(this.TS.RESULT.OUTPUT={});this.STATUS="OK";(this.scope=d)&&this.scope==this.Teulades?this.scope=this.Teulades:this.scope=this.Edificis;this.TS.SCOPE||(this.TS.SCOPE=this.scope);this.TS.RESULT.INPUT.Preu_del_panell_EDIT||(this.TS.RESULT.INPUT.Preu_del_panell_EDIT=1200);this.TS.peatge_fv||(this.TS.peatge_fv=.5);this.TS.RESULT.INPUT.Preu_de_lenergia_EDIT||(this.TS.RESULT.INPUT.Preu_de_lenergia_EDIT=.17);this.TS.CONTS_Increment_preu_fv||(this.TS.CONTS_Increment_preu_fv=6);
this.TS.CONTS_area_panell_fv||(this.TS.CONTS_area_panell_fv=1.95);this.TS.RESULT.INPUT.Preu_inversor_EDIT||(this.TS.RESULT.INPUT.Preu_inversor_EDIT=0);this.TS.CONTS_interessos_prestec||(this.TS.CONTS_interessos_prestec=2);this.TS.CONTS_interessos_beneficis||(this.TS.CONTS_interessos_beneficis=2);this.TS.CONTS_serie_geometrica1||(this.TS.CONTS_serie_geometrica1=1.04);this.TS.CONTS_serie_geometrica2||(this.TS.CONTS_serie_geometrica2=.98);this.TS.RESULT.INPUT.Eficiencia_panells_EDIT||(this.TS.RESULT.INPUT.Eficiencia_panells_EDIT=
32);this.TS.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT||(this.TS.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT=14);this.TS.RESULT.INPUT.Consum_anual_EDIT||(this.TS.RESULT.INPUT.Consum_anual_EDIT=0);this.TS.RESULT.OUTPUT.efi_panells_MATRIU=[30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60];this.TS.RESULT.OUTPUT.efi_perdus_MATRIU=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35];this.TS.val_area3d_fv=
this.sumaPropietats(a,"area3d");this.TS.val_area2d_fv=this.sumaPropietats(a,"area2d");this.GEOJSON=this.addColorParcelaTS(a,"sts1","sts2","sts3");this.TS.val_sfv1_fv=this.sumaPropietats(a,"sts1");this.TS.val_sfv2_fv=0;this.TS.val_sfv3_fv=this.sumaPropietats(a,"sts2");this.TS.val_sfv4_fv=this.sumaPropietats(a,"sts3");this.TS.SCOPE==this.Edificis?(this.TS.val_ghifv1_fv=this.sumaPropietats(a,"ghits1"),this.TS.val_ghifv2_fv=0,this.TS.val_ghifv3_fv=this.sumaPropietats(a,"ghits2"),this.TS.val_ghifv4_fv=
this.sumaPropietats(a,"ghits3")):this.TS.SCOPE==this.Teulades?(this.TS.val_ghifv1_fv=this.sumaPropietats(a,"ts1_sum"),this.TS.val_ghifv2_fv=0,this.TS.val_ghifv3_fv=this.sumaPropietats(a,"ts2_sum"),this.TS.val_ghifv4_fv=this.sumaPropietats(a,"ts3_sum"),1==a.features.length&&(this.TS.RESULT.OUTPUT.fv_inclina=this.sumaPropietats(a,"slope_mean"),this.TS.RESULT.OUTPUT.fv_azimut=this.sumaPropietats(a,"aspect"))):(this.STATUS.TIPUS="ERROR",this.STATUS.MSG="Tipus no definit");try{this.TS=this.calcualValorsInit(this.TS)}catch(c){this.STATUS.TIPUS=
"ERROR",this.STATUS.MSG=c+" "}try{this.TS=this.calculaElectricitatGenerada_FV(this.TS)}catch(c){this.STATUS.TIPUS="ERROR1",this.STATUS.MSG=c+" "}try{this.TS=this.calculaPotenciaInstalacio(this.TS)}catch(c){this.STATUS.TIPUS="ERROR2",this.STATUS.MSG=c+" "}try{this.TS=this.calculaCostInversio_FV(this.TS)}catch(c){this.STATUS.TIPUS="ERROR3",this.STATUS.MSG=c+" "}try{this.TS=this.calculaRetornPrevist_FV(this.TS)}catch(c){this.STATUS.TIPUS="ERROR4",this.STATUS.MSG=c+" "}try{this.TS=this.tempsAmortitzacio_FV(this.TS)}catch(c){this.STATUS.TIPUS=
"ERROR5",this.STATUS.MSG=c+" "}try{this.TS=this.generateMappingHTML(this.TS)}catch(c){this.STATUS.TIPUS="ERROR6",this.STATUS.MSG=c+" "}return e?{geojson:this.GEOJSON,resultset:this.TS,status:this.STATUS}:{geojson:this.GEOJSON,resultset:this.TS.RESULT,status:this.STATUS}};this.calculaPotencialFotovoltaic=function(a,b,d,e){b?this.FEV=b:this.FEV={};this.FEV.RESULT||(this.FEV.RESULT={});this.FEV.RESULT.INPUT||(this.FEV.RESULT.INPUT={});this.FEV.RESULT.OUTPUT||(this.FEV.RESULT.OUTPUT={});this.STATUS="OK";
(this.scope=d)&&this.scope==this.Teulades?this.scope=this.Teulades:this.scope=this.Edificis;this.FEV.SCOPE||(this.FEV.SCOPE=this.scope);this.FEV.RESULT.INPUT.Preu_del_panell_EDIT||(this.FEV.RESULT.INPUT.Preu_del_panell_EDIT=350);this.FEV.peatge_fv||(this.FEV.peatge_fv=.5);this.FEV.RESULT.INPUT.Preu_de_lenergia_EDIT||(this.FEV.RESULT.INPUT.Preu_de_lenergia_EDIT=.17);this.FEV.CONTS_Increment_preu_fv||(this.FEV.CONTS_Increment_preu_fv=6);this.FEV.CONTS_area_panell_fv||(this.FEV.CONTS_area_panell_fv=
1.7);this.FEV.RESULT.INPUT.Preu_inversor_EDIT||(this.FEV.RESULT.INPUT.Preu_inversor_EDIT=330);this.FEV.CONTS_interessos_prestec||(this.FEV.CONTS_interessos_prestec=2);this.FEV.CONTS_interessos_beneficis||(this.FEV.CONTS_interessos_beneficis=2);this.FEV.CONTS_serie_geometrica1||(this.FEV.CONTS_serie_geometrica1=1.03);this.FEV.CONTS_serie_geometrica2||(this.FEV.CONTS_serie_geometrica2=.97);this.FEV.RESULT.INPUT.Eficiencia_panells_EDIT||(this.FEV.RESULT.INPUT.Eficiencia_panells_EDIT=15);this.FEV.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT||
(this.FEV.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT=14);this.FEV.RESULT.INPUT.Consum_anual_EDIT||(this.FEV.RESULT.INPUT.Consum_anual_EDIT=0);this.FEV.RESULT.OUTPUT.efi_panells_MATRIU=[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40];this.FEV.RESULT.OUTPUT.efi_perdus_MATRIU=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35];this.FEV.val_area3d_fv=this.sumaPropietats(a,"area3d");this.FEV.val_area2d_fv=
this.sumaPropietats(a,"area2d");this.FEV.SCOPE==this.Edificis?(this.FEV.val_ghifv1_fv=this.sumaPropietats(a,"ghifv1"),this.FEV.val_ghifv2_fv=this.sumaPropietats(a,"ghifv2"),this.FEV.val_ghifv3_fv=this.sumaPropietats(a,"ghifv3"),this.FEV.val_ghifv4_fv=this.sumaPropietats(a,"ghifv4")):this.FEV.SCOPE==this.Teulades?(this.FEV.val_ghifv1_fv=this.sumaPropietats(a,"fv1_sum"),this.FEV.val_ghifv2_fv=this.sumaPropietats(a,"fv2_sum"),this.FEV.val_ghifv3_fv=this.sumaPropietats(a,"fv3_sum"),this.FEV.val_ghifv4_fv=
this.sumaPropietats(a,"fv4_sum"),1==a.features.length&&(this.FEV.RESULT.OUTPUT.fv_inclina=this.sumaPropietats(a,"slope_mean"),this.FEV.RESULT.OUTPUT.fv_azimut=this.sumaPropietats(a,"aspect"))):(this.STATUS.TIPUS="ERROR",this.STATUS.MSG="Tipus no definit");this.FEV.val_sfv1_fv=this.sumaPropietats(a,"sfv1");this.FEV.val_sfv2_fv=this.sumaPropietats(a,"sfv2");this.FEV.val_sfv3_fv=this.sumaPropietats(a,"sfv3");this.FEV.val_sfv4_fv=this.sumaPropietats(a,"sfv4");this.GEOJSON=this.addColorParcelaFV(a,"sfv1",
"sfv2","sfv3","sfv4");try{this.FEV=this.calcualValorsInit(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR",this.STATUS.MSG=c+" "}try{this.FEV=this.calculaElectricitatGenerada_FV(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR1",this.STATUS.MSG=c+" "}try{this.FEV=this.calculaPotenciaInstalacio(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR2",this.STATUS.MSG=c+" "}try{this.FEV=this.calculaCostInversio_FV(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR3",this.STATUS.MSG=c+" "}try{this.FEV=this.calculaRetornPrevist_FV(this.FEV)}catch(c){this.STATUS.TIPUS=
"ERROR4",this.STATUS.MSG=c+" "}try{this.FEV=this.tempsAmortitzacio_FV(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR5",this.STATUS.MSG=c+" "}try{this.FEV=this.generateMappingHTML(this.FEV)}catch(c){this.STATUS.TIPUS="ERROR6",this.STATUS.MSG=c+" "}return e?{geojson:this.GEOJSON,resultset:this.FEV,status:this.STATUS}:{geojson:this.GEOJSON,resultset:this.FEV.RESULT,status:this.STATUS}};this.calcualValorsInit=function(a){a=this.sumValue_FV(null,a);a.fv_area_t_FORMATED=this.addCommas(parseInt(a.val_area3d_fv).toFixed(0));
a.fv_area_t_UNITS=this.UNITS.m2;a.RESULT.INPUT.Nombre_de_panells_EDIT||a.area_instalada_fv?(a.RESULT.INPUT.Nombre_de_panells_EDIT=parseFloat(a.RESULT.INPUT.Nombre_de_panells_EDIT),a=this.modificaNombrePanells(a),a.fv_area_i_FORMATED=this.addCommas(a.area_instalada_fv),a.fv_area_i_UNITS=this.UNITS.m2):(a.RESULT.INPUT.Nombre_de_panells_EDIT=Math.floor((a.area_instalable_fv/a.CONTS_area_panell_fv).toFixed(0)),a.fv_num_panells_FORMATED=this.addCommas(a.RESULT.INPUT.Nombre_de_panells_EDIT),a.RESULT.INPUT.Nombre_de_panells_EDIT_inicial=
a.RESULT.INPUT.Nombre_de_panells_EDIT,a.area_instalada_fv=(a.CONTS_area_panell_fv*a.RESULT.INPUT.Nombre_de_panells_EDIT).toFixed(2),a.fv_area_i_FORMATED=this.addCommas(a.area_instalada_fv),a.fv_area_i_UNITS=this.UNITS.m2,a.area_instalada_fv=a.area_instalada_fv);a.eficiencia_panells_fv_FORMATED=parseInt(a.RESULT.INPUT.Eficiencia_panells_EDIT);a.eficiencia_panells_fv_UNITS=this.UNITS.percent;return a};this.generateMappingHTML=function(a){a.RESULT.OUTPUT.Irradiacio_global=a.irradiacio_global_fv_FORMATED;
a.RESULT.OUTPUT.Irradiacio_global_UOM=a.irradiacio_global_fv_UNITS;a.RESULT.OUTPUT.Area_total=a.fv_area_t_FORMATED;a.RESULT.OUTPUT.Area_total_UOM=a.fv_area_t_UNITS;a.RESULT.OUTPUT.Area_instalada=a.fv_area_i_FORMATED;a.RESULT.OUTPUT.Area_instalada_UOM=a.fv_area_i_UNITS;a.RESULT.OUTPUT.Nombre_de_panells_EDIT=a.RESULT.INPUT.Nombre_de_panells_EDIT;a.RESULT.OUTPUT.Eficiencia_panells_EDIT=a.RESULT.INPUT.Eficiencia_panells_EDIT;a.RESULT.OUTPUT.Eficiencia_panells_UOM=a.eficiencia_panells_fv_UNITS;a.RESULT.OUTPUT.Perdues_estimades_del_sistema_EDIT=
a.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT;a.RESULT.OUTPUT.Perdues_estimades_del_sistema_UOM=this.UNITS.percent;a.RESULT.OUTPUT.Potencia_de_instalacio=a.potenciaInstalada;a.RESULT.OUTPUT.Potencia_de_instalacio_UOM=a.fv_poten_ins_UNITS;a.RESULT.OUTPUT.Electricitat_generada=a.fv_elct_gen_FORMATED;a.RESULT.OUTPUT.Electricitat_generada_UOM=a.fv_elct_gen_UNITS;a.RESULT.OUTPUT.Consum_anual_EDIT=a.RESULT.INPUT.Consum_anual_EDIT;a.RESULT.OUTPUT.Generacio_propia=a.fv_gen_propia_FORMATED;a.RESULT.OUTPUT.Generacio_propia_UOM=
a.fv_gen_propia_UNITS;a.RESULT.OUTPUT.Cost_de_la_inversio_euros=a.fv_cost_i_euro_FORMATED;a.RESULT.OUTPUT.Cost_de_la_inversio_euros_UOM=a.fv_cost_i_euro_UNITS;a.RESULT.OUTPUT.Cost_de_la_inversio_euros_kwp=a.fv_cost_i_KWP_FORMATED;a.RESULT.OUTPUT.Cost_de_la_inversio_euros_kwp_UOM=a.fv_cost_i_KWP_UNITS;a.RESULT.OUTPUT.Preu_de_lenergia_EDIT=a.RESULT.INPUT.Preu_de_lenergia_EDIT;a.RESULT.OUTPUT.Preu_de_lenergia_UOM=a.fv_cost_i_KWP_UNITS;a.RESULT.OUTPUT.Preu_del_panell_EDIT=a.RESULT.INPUT.Preu_del_panell_EDIT;
a.RESULT.OUTPUT.Preu_del_panell_UOM=a.fv_cost_i_euro_UNITS;a.RESULT.OUTPUT.Preu_inversor_EDIT=a.RESULT.INPUT.Preu_inversor_EDIT;a.RESULT.OUTPUT.Preu_inversor_UOM=this.UNITS.euro_panell;a.RESULT.OUTPUT.Retorn_previst=a.fv_retorn_FORMATED;a.RESULT.OUTPUT.Retorn_previst_UOM=a.fv_retorn_UNITS;a.RESULT.OUTPUT.Temps_damortitzacio=a.fv_temps_FORMATED;a.RESULT.OUTPUT.Temps_damortitzacio_UOM=a.fv_temps_UNITS;a.RESULT.OUTPUT.Estalvi_en_CO2=a.fv_CO_FORMATED;a.RESULT.OUTPUT.Estalvi_en_CO2_UOM=a.fv_CO_UNITS;a.RESULT.OUTPUT.DibuixGraficMatriu=
a.graficMatriu;return a};this.tempsAmortitzacio_FV=function(a){var b=[],d=[],e=!1,c=0;b.push(["Anys","Cost instal.laci&oacute; (\u20ac)","Retorn inversi&oacute; (\u20ac)"]);for(var f=1;25>f;f++){var g=f;a.CONTS_serie_geometrica1=this.CONST_degradacio_panells[0]*(1+parseFloat(a.CONTS_Increment_preu_fv)/100)/(1+parseFloat(a.CONTS_interessos_beneficis)/100);a.CONTS_serie_geometrica2=this.CONST_degradacio_panells[0]/(1+parseFloat(a.CONTS_interessos_beneficis)/100);var h=a.cost_inversio_fv*Math.pow(1+
a.CONTS_interessos_prestec/100,g),k=a.energia_produida_fv*a.RESULT.INPUT.Preu_de_lenergia_EDIT*Math.pow(1+a.CONTS_interessos_beneficis/100,g)*(1-Math.pow(a.CONTS_serie_geometrica1,g+1))/(1-a.CONTS_serie_geometrica1)-a.peatge_fv/1E3*a.energia_produida_fv*Math.pow(1+a.CONTS_interessos_beneficis/100,g)*(1-Math.pow(a.CONTS_serie_geometrica2,g+1))/(1-a.CONTS_serie_geometrica2);d.push(parseInt(h)-parseInt(k));b.push([g,parseInt(h),parseInt(k)])}for(f=0;f<d.length;f++)if(0>d[f]){e=!0;c=[f];break}e?(a.fv_temps_FORMATED=
this.addCommas(this.calculaMesos(d,c)),a.fv_temps_UNITS=this.UNITS.anys,a.fv_retorn_FORMATED=this.addCommas(a.retorn_previst_fv),a.fv_retorn_UNITS=this.UNITS.euro_any):(a.fv_temps_FORMATED="+ 25",a.fv_temps_UNITS=this.UNITS.anys);a.graficMatriu=b;return a};this.calculaMesos=function(a,b){var d=a[b-1]/(a[b-1]+Math.abs(a[b])),d=(parseFloat(b)+parseFloat(d)).toFixed(1);isNaN(d)&&(d=1);return d};this.calculaRetornPrevist_FV=function(a){a.energia_produida_fv=a.irradiacio_aprofitable_fv*this.CONST_degradacio_panells[0];
a.retorn_previst_fv=(a.energia_produida_fv*(a.RESULT.INPUT.Preu_de_lenergia_EDIT-a.peatge_fv/1E3)).toFixed(0);a.fv_retorn_FORMATED=this.addCommas(a.retorn_previst_fv);a.fv_retorn_UNITS=this.UNITS.euro_any;return a};this.calculaCostInversio_FV=function(a){a.cost_inversio_fv=(a.RESULT.INPUT.Nombre_de_panells_EDIT*a.RESULT.INPUT.Preu_del_panell_EDIT+a.RESULT.INPUT.Preu_inversor_EDIT*Math.ceil(a.RESULT.INPUT.Nombre_de_panells_EDIT)).toFixed(0);a.cost_inversio_KWP_fv=((parseFloat(a.RESULT.INPUT.Preu_del_panell_EDIT)+
parseFloat(a.RESULT.INPUT.Preu_inversor_EDIT))/(a.CONTS_area_panell_fv*a.RESULT.INPUT.Eficiencia_panells_EDIT/100)).toFixed(0);a.fv_cost_i_euro_FORMATED=this.addCommas(a.cost_inversio_fv);a.fv_cost_i_euro_UNITS=this.UNITS.euro;a.fv_cost_i_KWP_FORMATED=this.addCommas(a.cost_inversio_KWP_fv);a.fv_cost_i_KWP_UNITS=this.UNITS.euro_kwh;return a};this.calculaPotenciaInstalacio=function(a){a.potenciaInstalada=(parseFloat(a.area_instalada_fv)*parseFloat(a.RESULT.INPUT.Eficiencia_panells_EDIT)*1/100).toFixed(2);
a.fv_poten_ins_FORMATED=this.addCommas(a.potenciaInstalada);a.fv_poten_ins_UNITS=this.UNITS.kWh_pic;return a};this.calculaElectricitatGenerada_FV=function(a){a.perdues_estimades=parseFloat(a.RESULT.INPUT.Perdues_estimades_del_sistema_EDIT/100);try{a=this.calculaNivellAprofitament(a)}catch(b){console.info(b)}a.energia_inicident=parseFloat(a.irradiacio_aprofitable_fv_mes1)+parseFloat(a.val_ghifv_actual)*((a.area_instalada_fv*a.val_area2d_fv/a.val_area3d_fv-a.area_instalable_fv_meny1)/a.val_sfv_actual);
a.irradiacio_aprofitable_fv=(a.energia_inicident*(1-a.perdues_estimades)*a.RESULT.INPUT.Eficiencia_panells_EDIT/100).toFixed(2);a.electricitat_generada_fv=a.irradiacio_aprofitable_fv;a.fv_elct_gen_FORMATED=this.addCommas(a.electricitat_generada_fv);a.fv_elct_gen_UNITS=this.UNITS.kWh_any;try{a=this.calculaEstalviCO_FV(a)}catch(b){console.info(b)}a.generacio_propia=100*parseInt(a.electricitat_generada_fv)/a.RESULT.INPUT.Consum_anual_EDIT;a.fv_gen_propia_FORMATED=0==a.RESULT.INPUT.Consum_anual_EDIT?
"":this.addCommas(a.generacio_propia.toFixed(1));a.fv_gen_propia_UNITS=this.UNITS.percent;return a};this.calculaEstalviCO_FV=function(a){a.estalviCO_fv=(.3*a.electricitat_generada_fv).toFixed(0);a.fv_CO_FORMATED=this.addCommas(a.estalviCO_fv);a.fv_CO_UNITS=this.UNITS.kg_any;return a};this.calculaNivellAprofitament=function(a){for(var b=4;0<b;b--)if(a=this.sumValue_FV(b,a),parseFloat(a.area_instalable_fv)>=parseFloat(a.area_instalada_fv).toFixed(0))return a};this.modificaNombrePanells=function(a){a.area_instalada_fv=
(a.CONTS_area_panell_fv*a.RESULT.INPUT.Nombre_de_panells_EDIT).toFixed(2);a.area_instalada_fv>a.val_area3d_fv&&(a.RESULT.INPUT.Nombre_de_panells_EDIT=(a.val_area3d_fv/a.CONTS_area_panell_fv).toFixed(0));return a};this.sumValue_FV=function(a,b){null==a&&(a=3);b.irradiacio_global_fv=(parseFloat(b.val_ghifv1_fv)+parseFloat(b.val_ghifv2_fv)+parseFloat(b.val_ghifv3_fv)+parseFloat(b.val_ghifv4_fv)).toFixed(0);1==a?(b.area_instalable_fv=(parseFloat(b.val_sfv1_fv)+parseFloat(b.val_sfv2_fv)+parseFloat(b.val_sfv3_fv)+
parseFloat(b.val_sfv4_fv)).toFixed(0),b.area_instalable_fv_meny1=(parseFloat(b.val_sfv2_fv)+parseFloat(b.val_sfv3_fv)+parseFloat(b.val_sfv4_fv)).toFixed(0),b.val_ghifv_actual=parseFloat(b.val_ghifv1_fv),b.val_sfv_actual=parseFloat(b.val_sfv1_fv),b.irradiacio_aprofitable_fv=((parseFloat(b.val_ghifv1_fv)+parseFloat(b.val_ghifv2_fv)+parseFloat(b.val_ghifv3_fv)+parseFloat(b.val_ghifv4_fv))*b.area_instalable_fv).toFixed(0),b.irradiacio_aprofitable_fv_mes1=(parseFloat(b.val_ghifv2_fv)+parseFloat(b.val_ghifv3_fv)+
parseFloat(b.val_ghifv4_fv)).toFixed(0)):2==a?(b.irradiacio_aprofitable_fv=(parseFloat(b.val_ghifv2_fv)+parseFloat(b.val_ghifv3_fv)+parseFloat(b.val_ghifv4_fv)).toFixed(0),b.area_instalable_fv=(parseFloat(b.val_sfv2_fv)+parseFloat(b.val_sfv3_fv)+parseFloat(b.val_sfv4_fv)).toFixed(1),b.area_instalable_fv_meny1=(parseFloat(b.val_sfv3_fv)+parseFloat(b.val_sfv4_fv)).toFixed(1),b.irradiacio_aprofitable_fv_mes1=(parseFloat(b.val_ghifv3_fv)+parseFloat(b.val_ghifv4_fv)).toFixed(0),b.val_ghifv_actual=parseFloat(b.val_ghifv2_fv),
b.val_sfv_actual=parseFloat(b.val_sfv2_fv)):3==a?(b.irradiacio_aprofitable_fv=(parseFloat(b.val_ghifv3_fv)+parseFloat(b.val_ghifv4_fv)).toFixed(0),b.area_instalable_fv=(parseFloat(b.val_sfv3_fv)+parseFloat(b.val_sfv4_fv)).toFixed(1),b.area_instalable_fv_meny1=parseFloat(b.val_sfv4_fv).toFixed(1),b.irradiacio_aprofitable_fv_mes1=parseFloat(b.val_ghifv4_fv).toFixed(0),b.val_ghifv_actual=parseFloat(b.val_ghifv3_fv),b.val_sfv_actual=parseFloat(b.val_sfv3_fv)):4==a&&(b.irradiacio_aprofitable_fv=parseFloat(b.val_ghifv4_fv).toFixed(0),
b.area_instalable_fv=parseFloat(b.val_sfv4_fv).toFixed(1),b.area_instalable_fv_meny1=0,b.irradiacio_aprofitable_fv_mes1=0,b.val_ghifv_actual=parseFloat(b.val_ghifv4_fv),b.val_sfv_actual=parseFloat(b.val_sfv4_fv));b.irradiacio_global_fv_FORMATED=this.addCommas(b.irradiacio_global_fv);b.irradiacio_global_fv_UNITS=this.UNITS.kWh_any;b.valor=a;return b};this.addCommas=function(a){return a};this.addCommasFormated=function(a){a=(a+"").replace(".",",");x=a.split(",");x1=x[0];x2=1<x.length?","+x[1]:"";for(a=
/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1.$2");return x1+x2};this.sumaPropietats=function(a,b){for(var d=0,e=0;e<a.features.length;e++)a.features[e].properties[b]&&(d+=parseFloat(a.features[e].properties[b]));return d.toFixed(2)};this.determinaValorMaxim=function(a){for(var b=a[0],d=0,e=1;e<a.length;e++)a[e]>b&&(d=e,b=a[e]);return d};this.addColorParcelaTS=function(a,b,d,e){for(i=0;i<a.features.length;i++){var c=this.determinaValorMaxim([parseFloat(a.features[i].properties[b]),parseFloat(a.features[i].properties[d]),
parseFloat(a.features[i].properties[e])]),f="#ff0000";0==c?f="#3B1B00":1==c?f="#BB6911":2==c&&(f="#FFFF00");a.features[i].properties.style={weight:2,color:"#F200FF",opacity:1,fillColor:f,fillOpacity:1}}return a};this.addColorParcelaFV=function(a,b,d,e,c){for(var f=0;f<a.features.length;f++){var g=this.determinaValorMaxim([parseFloat(a.features[f].properties[b]),parseFloat(a.features[f].properties[d]),parseFloat(a.features[f].properties[e]),parseFloat(a.features[f].properties[c])]),h="#ff0000";0==
g?h="#3B1B00":1==g?h="#BB6910":2==g?h="#FFB002":3==g&&(h="#FFFF00");a.features[f].properties.style={weight:2,color:"#F200FF",opacity:1,fillColor:h,fillOpacity:1}}return a};this.getValor=function(a){return parseInt(a)+3}}})("undefined"===typeof exports?this.sostenibilitat={}:exports);
